<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema# article: http://ogp.me/ns/article# book: http://ogp.me/ns/book# profile: http://ogp.me/ns/profile# video: http://ogp.me/ns/video#" >

<head profile="http://www.w3.org/1999/xhtml/vocab">
	  <!--[if IE]><![endif]-->
<meta charset="utf-8" />
<meta name="revision" title="5b11dd7d-0c73-475a-947b-d3aad17d9b78" product="7eff92b4-effc-4326-8604-6f852e3e9747" revision="c2973328ba7082bc1ee91cdd08745139619ae7de:en-us" page="4ff986d0-3235-48b5-a327-d4e41a559f82" />
<meta name="generator" content="Drupal 7 (http://drupal.org)" />
<link rel="canonical" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/index" />
<link rel="shortlink" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/index" />
<meta property="og:site_name" content="Red Hat Customer Portal" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/index" />
<meta property="og:title" content="Advanced Overcloud Customization Red Hat OpenStack Platform 16.1 | Red Hat Customer Portal" />
<meta property="og:description" content="This guide explains how to configure certain advanced features for a Red Hat OpenStack Platform enterprise environment using the Red Hat OpenStack Platform Director. This includes features such as network isolation, storage configuration, SSL communication, and general configuration methods." />
<meta property="og:image" content="https://access.redhat.com/webassets/avalon/g/shadowman-200.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:url" content="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/index" />
<meta name="twitter:title" content="Advanced Overcloud Customization Red Hat OpenStack Platform 16.1 | Red Hat Customer Portal" />
<meta name="twitter:description" content="This guide explains how to configure certain advanced features for a Red Hat OpenStack Platform enterprise environment using the Red Hat OpenStack Platform Director. This includes features such as network isolation, storage configuration, SSL communication, and general configuration methods." />
<meta name="twitter:image:src" content="https://access.redhat.com/webassets/avalon/g/shadowman-200.png" />
  <title>Advanced Overcloud Customization Red Hat OpenStack Platform 16.1 | Red Hat Customer Portal</title>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<!--[if IEMobile]><meta http-equiv="cleartype" content="on"><![endif]-->

<!-- metaInclude -->
<meta name="avalon-host-info" content="kcs07.web.prod.ext.phx2.redhat.com" />
<meta name="avalon-version" content="fc526cb5" />
<meta name="cp-chrome-build-date" content="2020-10-15T21:45:53.836Z" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Chrome, Firefox OS and Opera -->
<meta name="theme-color" content="#000000">
<!-- Windows Phone -->
<meta name="msapplication-navbutton-color" content="#000000">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-status-bar-style" content="#000000">
<link rel="manifest" href="https://access.redhat.com/webassets/avalon/j/manifest.json">
<!-- Open Search - Tap to search -->
<link rel="search" type="application/opensearchdescription+xml" title="Red Hat Customer Portal" href="https://access.redhat.com/webassets/avalon/j/opensearch.xml" />

 

<script type="text/javascript">
    window.portal = {
        analytics : {},
        host      : "https://access.redhat.com",
        idp_url   : "https://sso.redhat.com",
        lang      : "en",  
        version   : "fc526cb5",
        builddate : "2020-10-15T21:45:53.836Z",
        fetchdate : "2020-10-19T10:38:31-0400",
        nrid      : "14615289",
        nrlk      : "2a497fa56f"
    };
</script>
<script type="text/javascript">
    if (!/\/logout.*/.test(location.pathname) && portal.host === location.origin && document.cookie.indexOf('rh_sso_session') >= 0 && !(document.cookie.indexOf('rh_jwt') >= 0)) window.location = '/login?redirectTo=' + encodeURIComponent(window.location.href);
</script>
<!-- cssInclude -->

<link rel="shortcut icon" href="favicon.ico" />

<link media="all" rel="stylesheet" type="text/css" href="bootstrap.css%3Fv=fc526cb5.css" />
<link media="all" rel="stylesheet" type="text/css" href="bootstrap-grid.css%3Fv=fc526cb5.css" />
<link media="all" rel="stylesheet" type="text/css" href="main.css%3Fv=fc526cb5.css" />
<link media="all" rel="stylesheet" type="text/css" href="components.css%3Fv=fc526cb5.css" />
<link media="all" rel="stylesheet" type="text/css" href="pages.css%3Fv=fc526cb5.css" />

<link href="chosen.css%3Fv=fc526cb5.css" rel="stylesheet" type="text/css" />

<!--[if lte IE 9]>
<link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/chrome_themes/nimbus/css/ie.css" />
<![endif]-->

<noscript>
    <style type="text/css" media="screen"> .primary-nav { display: block; } </style>
</noscript>

<!-- /cssInclude -->
<script type="text/javascript" src="require.js%3Fv=fc526cb5" data-main="/webassets/avalon/j/"></script>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<script src="https://access.redhat.com/chrome_themes/nimbus/js/ie8.js"></script>
<![endif]-->

  <!-- TrustArc -->
  <script src="https://static.redhat.com/libs/redhat/marketing/latest/trustarc/trustarc.js"></script>

  <link type="text/css" rel="stylesheet" href="css__c2Nkkx_5vYh8rvZbfBAGB4EMzMtH5ouFJDBlDsnhSR8__-ax0_8bam15ZDJT9j7LilCfJrDyEhGGAgc0KC8HYvJg__7oVp6UW_380R7g-dHXPK35SfMqy4yUfhIx8G4wh5Zdk.css" media="all" />
<link type="text/css" rel="stylesheet" href="css__Jy3BSr8TrxptaufAzQDT1skBUlX2CnL_wm6BizzYuGw__-YZvqB8yuA4kK_iKklbk5HdZCoG2qAgz1l-8Qi2NFH4__7oVp6UW_380R7g-dHXPK35SfMqy4yUfhIx8G4wh5Zdk.css" media="all" />
<link type="text/css" rel="stylesheet" href="messages.css" media="all" />
<link type="text/css" rel="stylesheet" href="css__m76iIFREtc70Nmw5xe1ZwHbNBlwOP2Zjc3DcacNWnFQ__STEh8aY3w8E_bKzhB4Xke2WOQ9XMDQquHIP5B8SeDIY__7oVp6UW_380R7g-dHXPK35SfMqy4yUfhIx8G4wh5Zdk.css" media="all" />
<link type="text/css" rel="stylesheet" href="css__4sM4s6XOQ2Nm0pdkrWRLvrgtwpTmHAFzR_LcdesKYj8__vJ0jjVEhoPh3KBeLZfkqg51T3AFxhQCuXg1reipa__k__7oVp6UW_380R7g-dHXPK35SfMqy4yUfhIx8G4wh5Zdk.css" media="print" />
  <link rel="stylesheet" type="text/css" media="all" href="list.css" />
  <script src="js__ZyeOaiFuDejQQbhUV7yg7atYZnj4WLfH77o0scv4068__MZdWWgUEYpsEWLcU0RqkaXMsEyksbpCgnf4XwXRkqz0__7oVp6UW_380R7g-dHXPK35SfMqy4yUfhIx8G4wh5Zdk.js"></script>
<script src="js__5ysXPc5KIyMmizxqRY68ILfrEGrj0P29WBIifnPTJvQ__Cap0DACEVMsefumg1gS1APLLd8stDkdGfp6c1uswMo4__7oVp6UW_380R7g-dHXPK35SfMqy4yUfhIx8G4wh5Zdk.js"></script>
<script>chrometwo_require(["analytics/attributes"], function(attributes) {
attributes.set('ResourceID',       '5b11dd7d-0c73-475a-947b-d3aad17d9b78');
attributes.set('ResourceTitle',    'Advanced Overcloud Customization');
attributes.set('Language',         'en-us');
attributes.set('RevisionId',       'c2973328ba7082bc1ee91cdd08745139619ae7de:en-us');
attributes.set('PublicationState', ['active','published']);
attributes.set('Product',          'Red Hat OpenStack Platform');
attributes.set('ProductVersion',   '16.1');
attributes.set('ProductId',        'Red Hat OpenStack Platform 16.1');
});</script>
<script>breadcrumbs = [ ["Products &amp; Services", "/products/"], ["Product Documentation", "/documentation/"], ["Red Hat OpenStack Platform", "/documentation/en-us/red_hat_openstack_platform/"], ["16.1", "/documentation/en-us/red_hat_openstack_platform/16.1/"], ["Advanced Overcloud Customization", "/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/"] ];</script>
<script>window.siteMapState = "products";</script>
<script src="js__i6ieGBO-OPmIKm_f0srsb6gM7QELIWrBpKh6ub_yj8A__wjRg_duSK4rEZCRV2uwrCIPMl80Z_LJ9ew61H5hE-ZI__7oVp6UW_380R7g-dHXPK35SfMqy4yUfhIx8G4wh5Zdk.js"></script>
<script src="js__vGeEtorfXGI3aPAp71YA74N5p8wfpYVhnoIqwaJrOiQ__8abcou7ybLtGOLy-V9E-NQlDejOMZmdStjlYfyX9W-k__7oVp6UW_380R7g-dHXPK35SfMqy4yUfhIx8G4wh5Zdk.js"></script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"kcs","theme_token":"hltpJxJjnSWrjPfMT4aaGefqgbAwaHjFTwGjL8nNHGw","js":{"misc\/jquery-extend-3.4.0.js":1,"misc\/jquery-html-prefilter-3.5.0-backport.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/libraries\/chosen\/chosen\/chosen.jquery.min.js":1,"modules\/chosen\/chosen.js":1,"sites\/all\/modules\/custom\/rh_doc_fetcher\/js\/prism.js":1,"sites\/all\/modules\/custom\/rh_doc_fetcher\/js\/underscore.js":1,"sites\/all\/themes\/kcs\/js\/kcs_base.js":1,"sites\/all\/themes\/kcs\/js\/showdown.js":1,"sites\/all\/themes\/kcs\/js\/case_links.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/book\/book.css":1,"modules\/comment\/comment.css":1,"modules\/date\/date_api\/date.css":1,"modules\/date\/date_popup\/themes\/datepicker.1.7.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/contrib\/user_prune\/css\/user_prune.css":1,"modules\/views\/css\/views.css":1,"sites\/all\/libraries\/chosen\/chosen\/chosen.css":1,"modules\/ctools\/css\/ctools.css":1,"sites\/all\/modules\/contrib\/panels\/css\/panels.css":1,"sites\/all\/modules\/custom\/rate\/rate.css":1,"sites\/all\/modules\/custom\/rh_doc_fetcher\/plugins\/layouts\/docs_page\/docs_page.css":1,"https:\/\/access.redhat.com\/webassets\/avalon\/s\/messages.css":1,"sites\/all\/themes\/zen\/system.base.css":1,"sites\/all\/themes\/zen\/system.menus.css":1,"sites\/all\/themes\/zen\/system.messages.css":1,"sites\/all\/themes\/zen\/system.theme.css":1,"sites\/all\/themes\/zen\/comment.css":1,"sites\/all\/themes\/zen\/node.css":1,"sites\/all\/themes\/kcs\/css\/html-reset.css":1,"sites\/all\/themes\/kcs\/css\/wireframes.css":1,"sites\/all\/themes\/kcs\/css\/layout-fixed.css":1,"sites\/all\/themes\/kcs\/css\/page-backgrounds.css":1,"sites\/all\/themes\/kcs\/css\/tabs.css":1,"sites\/all\/themes\/kcs\/css\/pages.css":1,"sites\/all\/themes\/kcs\/css\/blocks.css":1,"sites\/all\/themes\/kcs\/css\/navigation.css":1,"sites\/all\/themes\/kcs\/css\/views-styles.css":1,"sites\/all\/themes\/kcs\/css\/nodes.css":1,"sites\/all\/themes\/kcs\/css\/comments.css":1,"sites\/all\/themes\/kcs\/css\/forms.css":1,"sites\/all\/themes\/kcs\/css\/fields.css":1,"sites\/all\/themes\/kcs\/css\/kcs.css":1,"sites\/all\/themes\/kcs\/css\/print.css":1}},"chosen":{"selector":"#edit-field-kcs-component-select-und, #edit-field-kcs-sbr-select-und, #edit-field-kcs-product-select-und, #edit-field-kcs-type-select-und, #edit-language, #edit-field-kcs-a-category-select-und, #edit-field-kcs-state-select-und, #edit-field-kcs-tags-select-und, #edit-field-kcs-state-select-value, #edit-field-vid-reference-product-und, #edit-state, #edit-product, #edit-category, #edit-field-kcs-product-select-tid, #edit-field-kcs-type-select-tid, #edit-field-kcs-a-category-select-tid, #edit-sort-bef-combine, #edit-kcs-state, #edit-field-category-tid, #edit-field-product-tid, #edit-field-tags-tid, #edit-field-category-und, #edit-field-product-und, #edit-field-tags-und, #views-exposed-form-questions-list-questions-filter-block #edit-field-category, #edit-field-tags-und, #views-exposed-form-questions-list-questions-filter-block #edit-field-product, #views-exposed-form-questions-list-questions-filter-block #edit-field-tags, #edit-field-mega-menu-tab-und, #edit-field-internal-tags-tid, #edit-tags, #edit-field-kcs-tags-select-tid, #edit-subscriptions-and-choose-field-select, #edit-subscriptions-and-type, #edit-vid-13, #edit-vid-4, #edit-vid-5, #edit-vid-53, #edit-vid-1, #edit-vid-3, #edit-group-blog, #edit-subscriptions-and-choose-field-select-two, #edit-subscriptions-and-type-two, #edit-vid-13-two, #edit-vid-4-two, #edit-vid-5-two, #edit-vid-53-two, #edit-vid-1-two, #edit-vid-3-two, #edit-group-blog-two, #edit-subscriptions-and-edit-choose-field-select, #edit-subscriptions-and-type-edit, #edit-subscriptions-and-edit-type-two, #edit-vid-13-edit-two, #edit-vid-4-edit-two, #edit-vid-5-edit-two, #edit-vid-53-edit-two, #edit-vid-1-edit-two, #edit-vid-3-edit-two, #edit-subscriptions-and-edit-choose-field-select-two, #edit-vid-13-edit, #edit-vid-4-edit, #edit-vid-5-edit, #edit-vid-53-edit, #edit-vid-1-edit, #edit-vid-3-edit, #edit-group-blog-edit, #edit-field-supported-languages-tid, #edit-field-geography-und, #edit-field-supported-products-und, #edit-field-supported-languages-und, #edit-field-vendor-und, #edit-field-errata-type-text-und, #edit-field-errata-severity-text-und, #edit-field-software-partner-level-und, #edit-field-scert-product-category-und, #edit-field-certifications-und-0-field-product-und, #edit-kcs-article-type, #edit-field-eco-industry-tag-select-tid, #edit-field-eco-software-catego-select-tid, #edit-field-ecosystem-tag-select-und, #edit-field-eco-industry-tag-select-und, #edit-field-eco-software-catego-select-und, #edit-field-vendor-tsanet-member-ref-und, #edit-field-og-vendor-ref-und-0-default, #edit-field-eco-products-enabled-col-und-0-field-eco-subscription-model-ref-und, #edit-field-eco-products-enabled-col-und-0-field-eco-support-level-ref-und, #edit-field-eco-products-enabled-col-und-0-field-eco-product-select-und, #edit-field-eco-certifications-select-und-0-field-eco-product-select-und, #edit-field-eco-certifications-select-und-0-field-eco-product-archite-select-und, #edit-field-eco-certifications-select-und-0-field-eco-certificati-lvl-select-und, #edit-field-eco-certifications-select-und-0-field-eco-hypervisor-str-und, #edit-field-eco-supported-language-ref-und, #edit-field-eco-region-ref-und, #edit-field-cs-product-category-str-und, #edit-field-eco-certifications-select-und-0-field-eco-format-ref-und, #edit-field-eco-group-access-ref-und, #edit-field-hw-category-tag-ref-und, #edit-field-profile-industry-und, #edit-field-profile-tech-interests-und, #edit-field-product-page-features-ref-und, #edit-field-eco-product-select-und, #edit-field-base-product-ref-und, #edit-field-eco-product-archite-select-und, #edit-field-eco-format-ref-und, #edit-field-certification-status-ref-und, #edit-field-certification-result-ref-und, #edit-field-og-certified-product-ref-und-0-default, #edit-field-eco-subscription-model-ref-und, #edit-field-eco-support-level-ref-und, #edit-field-eco-certificati-lvl-select-und, #edit-field-eco-hypervisor-str-und, #edit-field-ccp-thirdparty-cert-select-und, .use_, #edit-field-eco-cert-product-tag-und, #edit-field-documentation-location-ref-und, #edit-field-documentation-title-und, #edit-field-accelerator-products-und","minimum":"0"},"section":"","kcs":{"nodeType":null,"nodeId":null}});</script>
    <!--[if lt IE 9]>
  <script src="https://access.redhat.com/sites/all/themes/kcs/js/html5shiv.js"></script>
  <![endif]-->
  
      


    <!--kcs05-->
<script type="text/javascript">
  Drupal.portal = {"version":{"redhat_portal":"package drupal7-redhat_portal is not installed"}};
  Drupal.portal.currentUser = {};
  </script>

</head>

<body class="portal-page  kcs_external" >
  
  <div id="page-wrap" class="page-wrap">
    <div class="top-page-wrap">

        <!--googleoff: all-->
        <header class="masthead" id="masthead">

            <script>
    chrometwo_require(["wc"], function(wc){    
        wc.include("@cpelements/cp-search-autocomplete/dist/cp-search-autocomplete.umd");
    }); 
</script>

<!-- Accessibility Nav & Header -->
<div class="accessibility-nav sr-only">
    <a href="https://access.redhat.com/">
        <h1>Red Hat <span>Customer </span><span>Portal</span></h1>
    </a>
    <p><a href="index.html#cp-main">Skip to main content</a></p>
    <nav aria-labelledby="accessibility-nav-heading">
        <h2 id="accessibility-nav-heading">Main Navigation</h2>
        <ul>
    <li>
        <a href="index.html#" class="has-subnav"><span>Products &amp; Services</span></a>
        <ul class="mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li><a href="https://access.redhat.com/products">View All Products</a></li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Infrastructure and Management</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-enterprise-linux/">Red Hat Enterprise Linux</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-virtualization/">Red Hat Virtualization</a></li>
                    <li><a href="https://access.redhat.com/products/identity-management/">Red Hat Identity Management</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-directory-server/">Red Hat Directory Server</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-certificate-system/">Red Hat Certificate System</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-satellite/">Red Hat Satellite</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-subscription-management/">Red Hat Subscription Management</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-update-infrastructure/">Red Hat Update Infrastructure</a></li>
                    <li><a href="https://access.redhat.com/insights/info/?intcmp=mm|p|im|rhaijan2016&">Red Hat Insights</a></li>
                    <li><a href="https://access.redhat.com/products/ansible-tower-red-hat/">Red Hat Ansible Tower</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-ansible-engine/">Red Hat Ansible Engine</a></li>
                </ul>
            </li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Cloud Computing</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-cloudforms/">Red Hat CloudForms</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-openstack-platform/">Red Hat OpenStack Platform</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-cloud-suite/">Red Hat Cloud Suite</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-openshift-container-platform/">Red Hat OpenShift Container Platform</a></li>
                    <li><a href="https://access.redhat.com/products/openshift-online-red-hat/">Red Hat OpenShift Online</a></li>
                    <li><a href="https://access.redhat.com/products/openshift-dedicated-red-hat/">Red Hat OpenShift Dedicated</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/">Red Hat Advanced Cluster Management for Kubernetes</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-quay/">Red Hat Quay</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-codeready-workspaces/">Red Hat CodeReady Workspaces</a></li>
                </ul>
            </li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Storage</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-storage/">Red Hat Gluster Storage</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/">Red Hat Hyperconverged Infrastructure</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-ceph-storage/">Red Hat Ceph Storage</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-openshift-container-storage">Red Hat Openshift Container Storage</a></li>
                </ul>
            </li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Runtimes</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true">
                      <a href="index.html#" class="back">Back</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-runtimes/">Red Hat Runtimes</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/">Red Hat JBoss Enterprise Application Platform</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-data-grid/">Red Hat Data Grid</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-jboss-web-server/">Red Hat JBoss Web Server</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-single-sign-on/">Red Hat Single Sign On</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/spring-boot/">Red Hat support for Spring Boot</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/nodejs/">Red Hat build of Node.js</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/thorntail/">Red Hat build of Thorntail</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/eclipse-vertx/">Red Hat build of Eclipse Vert.x</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/openjdk/">Red Hat build of OpenJDK</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/open-liberty/">Open Liberty</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/quarkus/">Red Hat build of Quarkus</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-codeready-studio/">Red Hat CodeReady Studio</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Integration and Automation</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-integration/">Red Hat Integration</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-fuse/">Red Hat Fuse</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-amq/">Red Hat AMQ</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-3scale/">Red Hat 3scale API Management</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-jboss-data-virtualization/">Red Hat JBoss Data Virtualization</a>
                    </li>
                    <li>
                      <a href="https://access.redhat.com/products/red-hat-process-automation/">Red Hat Process Automation</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-process-automation-manager/">Red Hat Process Automation Manager</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-decision-manager/">Red Hat Decision Manager</a>
                    </li>
                </ul>
            </li>

            <li class="heading"><a class="cta-link cta-link-darkbg" href="https://access.redhat.com/support/">Support</a></li>
            <li><a href="https://access.redhat.com/support/offerings/production/">Production Support</a></li>
            <li><a href="https://access.redhat.com/support/offerings/developer/">Development Support</a></li>
            <li><a href="https://access.redhat.com/product-life-cycles/">Product Life Cycles</a></li>

            <li class="heading"><a class="cta-link cta-link-darkbg" href="https://access.redhat.com/documentation/">Documentation</a></li>
            <li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux">Red Hat Enterprise Linux</a></li>
            <li><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform">Red Hat JBoss Enterprise Application Platform</a></li>
            <li><a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform">Red Hat OpenStack Platform</a></li>
            <li><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform">Red Hat OpenShift Container Platform</a></li>

            <li class="heading">Services</li>
            <li><a href="https://www.redhat.com/en/services/consulting">Consulting</a></li>
            <li><a href="https://access.redhat.com/support/offerings/tam/">Technical Account Management</a></li>
            <li><a href="https://www.redhat.com/en/services/training-and-certification">Training &amp; Certifications</a></li>

            
            <li class="heading"><a class="cta-link cta-link-darkbg" href="https://catalog.redhat.com/">Ecosystem Catalog</a></li>
            <li><a href="https://access.redhat.com/ecosystem/partner-resources">Partner Resources</a></li>
            <li><a href="https://access.redhat.com/public-cloud">Red Hat in the Public Cloud</a></li>
          </ul>
    </li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Tools</span></a>
        <ul class="mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li><a href="https://access.redhat.com/insights/info/?intcmp=mm|t|c1|rhaidec2015&">Red Hat Insights</a></li>
            <li class="heading">Tools</li>
            <li><a href="https://access.redhat.com/solution-engine">Solution Engine</a></li>
            <li><a href="https://access.redhat.com/downloads/content/package-browser">Packages</a></li>
            <li><a href="https://access.redhat.com/errata/">Errata</a></li>
            <li class="heading">Customer Portal Labs</li>
            <li><a href="https://access.redhat.com/labs/">Explore Labs</a></li>
            <li><a href="https://access.redhat.com/labs/#?type=config">Configuration</a></li>
            <li><a href="https://access.redhat.com/labs/#?type=deploy">Deployment</a></li>
            <li><a href="https://access.redhat.com/labs/#?type=security">Security</a></li>
            <li><a href="https://access.redhat.com/labs/#?type=troubleshoot">Troubleshooting</a></li>
        </ul>
    </li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Security</span></a>
        <ul class="mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li><a href="https://access.redhat.com/security/">Product Security Center</a></li>
            <li class="heading">Security Updates</li>
            <li><a href="https://access.redhat.com/security/security-updates/#/security-advisories">Security Advisories</a></li>
            <li><a href="https://access.redhat.com/security/security-updates/#/cve">Red Hat CVE Database</a></li>
            <li><a href="https://access.redhat.com/security/security-updates/#/security-labs">Security Labs</a></li>
            <li class="heading">Resources</li>
            <li><a href="https://access.redhat.com/security/overview/">Overview</a></li>
            <li><a href="https://access.redhat.com/blogs/product-security">Security Blog</a></li>
            <li><a href="https://www.redhat.com/security/data/metrics/">Security Measurement</a></li>
            <li><a href="https://access.redhat.com/security/updates/classification/">Severity Ratings</a></li>
            <li><a href="https://access.redhat.com/security/updates/backporting/">Backporting Policies</a></li>
            <li><a href="https://access.redhat.com/security/team/key/">Product Signing (GPG) Keys</a></li>
        </ul>
    </li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Community</span></a>
        <ul class="mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li class="heading">Customer Portal Community</li>
            <li><a href="https://access.redhat.com/discussions?keyword=&name=&product=All&category=All&tags=All">Discussions</a></li>
            <li><a href="https://access.redhat.com/blogs/">Blogs</a></li>
            <li><a href="https://access.redhat.com/groups/">Private Groups</a></li>
            <li><a href="https://access.redhat.com/community/">Community Activity</a></li>
            <li class="heading">Customer Events</li>
            <li><a href="https://access.redhat.com/convergence/">Red Hat Convergence</a></li>
            <li><a href="http://www.redhat.com/summit/">Red Hat Summit</a></li>
            <li class="heading">Stories</li>
            <li><a href="https://access.redhat.com/subscription-value/">Red Hat Subscription Value</a></li>
            <li><a href="https://access.redhat.com/you-asked-we-acted/">You Asked. We Acted.</a></li>
            <li><a href="http://www.redhat.com/en/open-source">Open Source Communities</a></li>
        </ul>
    </li>
    <li><a href="https://access.redhat.com/management/">Subscriptions</a></li>
    <li><a href="https://access.redhat.com/downloads/">Downloads</a></li>
    <li><a href="https://catalog.redhat.com/software/containers/explore/">Containers</a></li>
    <li><a href="https://access.redhat.com/support/cases/">Support Cases</a></li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Account</span></a>
        <ul class="utility mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li class="mobile-accountLinksLoggedOut unauthenticated"><a href="https://access.redhat.com/login" id="accessibility-accountLogin">Log In</a></li>
            <li class="mobile-accountLinksLoggedOut unauthenticated"><a href="https://www.redhat.com/wapps/ugc/register.html">Register</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated">
                <div class="account-info" id="accessibility-accountUser">
                    <div class="account-name"><strong id="accessibility-userFullName"></strong></div>
                    <div class="account-org"><span id="accessibility-userOrg"></span></div>
                    <div class="account-number mobile-accountNumber"><span class="property">Red Hat Account Number:</span> <span class="value"></span></div>
                </div>
            </li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://www.redhat.com/wapps/ugc/protected/personalInfo.html">Account Details</a></li>
            <!-- <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://www.redhat.com/wapps/ugc/protected/prefs.html">Newsletter and Contact Preferences</a></li> -->
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://www.redhat.com/wapps/ugc/protected/usermgt/userList.html" class="user-management-link">User Management</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://www.redhat.com/wapps/ugc/protected/account.html">Account Maintenance</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://access.redhat.com/user">My Profile</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://access.redhat.com/user" id="accessibility-userNotificationsLink">Notifications</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://access.redhat.com/help/">Help</a></li>
            <li class="logout mobile-accountLinksLoggedIn authenticated"><a href="https://sso.redhat.com/auth/realms/redhat-external/logout?redirectUrl=https%3A%2F%2Faccess.redhat.com%2Flogout">Log Out</a></li>
        </ul>
    </li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Language</span></a>
        <ul class="utility mm-hide" id="accessibility-localesMenu">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li><a href="https://access.redhat.com/changeLanguage?language=en" id="accessibility-en">English</a></li>
            <li><a href="https://access.redhat.com/changeLanguage?language=ko" id="accessibility-ko">한국어</a></li>
            <li><a href="https://access.redhat.com/changeLanguage?language=ja" id="accessibility-ja">日本語</a></li>
            <li><a href="https://access.redhat.com/changeLanguage?language=zh_CN" id="accessibility-zh_CN">中文 (中国)</a></li>
		</ul>
    </li>
</ul>
    </nav>
</div>

<!-- Mobile Header -->
<nav class="mobile-nav-bar hidden-sm hidden-md hidden-lg" aria-hidden="true">
    <button id="menu-btn" class="menu menu-white" type="button" aria-label="Toggle Navigation">
        <span class="lines"></span>
    </button>
    <a class="logo" href="https://access.redhat.com/">
        <span class="logo-crop">
          <!-- logo -->
          <span class="sr-only">Red Hat Customer Portal</span>
          <svg aria-hidden="true" class="rh-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 200">
            <defs>
            <style>
              .rh-logo-type {
                fill:#fff;
              }
              .rh-logo-hat {
                fill:#e00;
              }
            </style>
            </defs>
            <g id="Two_lines" data-name="Two lines"><g id="Two_line_logo" data-name="Two line logo"><path class="rh-logo-type" d="M318.62,9.25h25.44c11.13,0,18.64,6.72,18.64,16.56,0,7.36-4.47,13-11.51,15.36l12.48,24.08h-9.29l-11.6-23H327v23h-8.4Zm8.4,7.36V35.33h16.33c6.55,0,10.87-3.76,10.87-9.36s-4.32-9.36-10.87-9.36Z"/><path class="rh-logo-type" d="M387.5,66a21,21,0,0,1-21.36-21.12c0-11.76,9-21,20.4-21,11.2,0,19.68,9.28,19.68,21.28v2.32H374.06a13.74,13.74,0,0,0,13.76,11.68,15.84,15.84,0,0,0,10.32-3.6l5.13,5A24.33,24.33,0,0,1,387.5,66ZM374.14,41.49H398.3c-1.19-6.24-6-10.88-11.92-10.88C380.22,30.61,375.34,35,374.14,41.49Z"/><path class="rh-logo-type" d="M445.18,61.41a19.23,19.23,0,0,1-12.48,4.48c-11.52,0-20.56-9.2-20.56-21a20.72,20.72,0,0,1,33-17V9.25l8-1.76V65.25h-7.92Zm-11.36-2.48a14.67,14.67,0,0,0,11.28-4.88V35.57a14.89,14.89,0,0,0-11.28-4.8,13.63,13.63,0,0,0-13.84,14A13.77,13.77,0,0,0,433.82,58.93Z"/><path class="rh-logo-type" d="M480.22,9.25h8.4v24h29.76v-24h8.4v56h-8.4V40.85H488.62v24.4h-8.4Z"/><path class="rh-logo-type" d="M534.38,53.57c0-7.68,6.24-12.4,16.48-12.4A28.75,28.75,0,0,1,562,43.41V39.09c0-5.76-3.44-8.64-9.92-8.64-3.76,0-7.6,1-12.64,3.44l-3-6c6.08-2.88,11.36-4.16,16.72-4.16,10.56,0,16.64,5.2,16.64,14.56v27H562V61.73A19.32,19.32,0,0,1,549.34,66C540.46,66,534.38,60.93,534.38,53.57Zm16.8,6.48A15.66,15.66,0,0,0,562,56.21v-7a21.15,21.15,0,0,0-10.48-2.48c-5.84,0-9.44,2.64-9.44,6.72C542.06,57.33,545.74,60.05,551.18,60.05Z"/><path class="rh-logo-type" d="M582.7,31.25h-8.64V24.53h8.64V14.13l7.92-1.92V24.53h12v6.72h-12V53.33c0,4.16,1.68,5.68,6,5.68a15.72,15.72,0,0,0,5.84-1v6.72a26.5,26.5,0,0,1-7.6,1.2c-7.92,0-12.16-3.76-12.16-10.8Z"/><path class="rh-logo-type" d="M361,132.21l7.59,7.52a30.76,30.76,0,0,1-23,10.32c-16.88,0-29.84-12.56-29.84-28.8s13-28.88,29.84-28.88c9,0,18.09,4.08,23.28,10.48l-7.83,7.76a19.52,19.52,0,0,0-15.45-7.6c-10.16,0-17.92,7.84-17.92,18.24A17.8,17.8,0,0,0,346,139.33,19.24,19.24,0,0,0,361,132.21Z"/><path class="rh-logo-type" d="M383.74,131.81c0,5.36,3.44,8.8,8.64,8.8a10.05,10.05,0,0,0,8.65-4.16V107.57h11v41.68H401v-3.36a17.79,17.79,0,0,1-11.77,4.16c-9.68,0-16.48-6.88-16.48-16.64V107.57h11Z"/><path class="rh-logo-type" d="M422.46,137c4.88,3.2,9.12,4.72,13.52,4.72,4.88,0,8.08-1.76,8.08-4.4,0-2.16-1.6-3.36-5.2-3.92l-8-1.2c-8.24-1.28-12.64-5.36-12.64-12.08,0-8.08,6.72-13.2,17.36-13.2a30.75,30.75,0,0,1,17.12,5.2l-5.28,7c-4.56-2.72-8.64-4-12.88-4-4,0-6.56,1.6-6.56,4.08,0,2.24,1.6,3.36,5.68,3.92l8,1.2c8.16,1.2,12.72,5.44,12.72,11.92,0,7.84-7.76,13.76-18.24,13.76-7.6,0-14.4-2-19.12-5.76Z"/><path class="rh-logo-type" d="M464.7,116.77h-8.56v-9.2h8.56V96.93l11-2.48v13.12H487.5v9.2H475.66v18.48c0,3.92,1.52,5.36,5.76,5.36a16.86,16.86,0,0,0,5.84-1v9a34,34,0,0,1-8.48,1.28c-9.28,0-14.08-4.24-14.08-12.4Z"/><path class="rh-logo-type" d="M512.86,106.77c12.48,0,22.24,9.52,22.24,21.68s-9.76,21.6-22.24,21.6-22.24-9.44-22.24-21.6S500.38,106.77,512.86,106.77Zm11.52,21.68c0-6.88-5-12.16-11.52-12.16s-11.52,5.28-11.52,12.16c0,6.72,5,12.08,11.52,12.08S524.38,135.17,524.38,128.45Z"/><path class="rh-logo-type" d="M541.82,107.57h11v3.12a16.21,16.21,0,0,1,10.88-3.92A15,15,0,0,1,576.22,113,17.16,17.16,0,0,1,590,106.77c9.36,0,15.91,6.8,15.91,16.56v25.92h-11V124.93c0-5.28-3-8.72-7.83-8.72a9.37,9.37,0,0,0-8,4.16,18.89,18.89,0,0,1,.23,3v25.92h-11V124.93c0-5.28-3-8.72-7.84-8.72a9.3,9.3,0,0,0-7.76,3.76v29.28h-11Z"/><path class="rh-logo-type" d="M634.78,150.05c-12.64,0-22.4-9.44-22.4-21.6a21.28,21.28,0,0,1,21.44-21.6c11.84,0,20.64,9.6,20.64,22.4v2.88h-31a12,12,0,0,0,11.84,8.72,13.12,13.12,0,0,0,9.2-3.36l7.2,6.56A25,25,0,0,1,634.78,150.05Zm-11.44-25.76h20.4c-1.36-5-5.36-8.4-10.16-8.4C628.54,115.89,624.7,119.17,623.34,124.29Z"/><path class="rh-logo-type" d="M661.18,107.57h11v4.56a13.26,13.26,0,0,1,11.12-5.52,9.44,9.44,0,0,1,4.56,1v9.6a14,14,0,0,0-5.6-1.12,11,11,0,0,0-10.08,6.24v27h-11Z"/><path class="rh-logo-type" d="M710.54,93.25h28.08c11,0,18.8,7.28,18.8,17.6,0,10-7.92,17.28-18.8,17.28H722.14v21.12h-11.6Zm11.6,10v15.28h15.2c5,0,8.32-3,8.32-7.6s-3.28-7.68-8.32-7.68Z"/><path class="rh-logo-type" d="M782.14,106.77c12.48,0,22.24,9.52,22.24,21.68s-9.76,21.6-22.24,21.6-22.24-9.44-22.24-21.6S769.66,106.77,782.14,106.77Zm11.52,21.68c0-6.88-5-12.16-11.52-12.16s-11.52,5.28-11.52,12.16c0,6.72,5,12.08,11.52,12.08S793.66,135.17,793.66,128.45Z"/><path class="rh-logo-type" d="M811.1,107.57h11v4.56a13.26,13.26,0,0,1,11.12-5.52,9.44,9.44,0,0,1,4.56,1v9.6a14,14,0,0,0-5.6-1.12,11,11,0,0,0-10.08,6.24v27h-11Z"/><path class="rh-logo-type" d="M850,116.77h-8.56v-9.2H850V96.93l11-2.48v13.12h11.84v9.2H860.94v18.48c0,3.92,1.52,5.36,5.76,5.36a16.86,16.86,0,0,0,5.84-1v9a34,34,0,0,1-8.48,1.28c-9.28,0-14.08-4.24-14.08-12.4Z"/><path class="rh-logo-type" d="M876.22,137.17c0-7.92,6.4-12.64,17.12-12.64a33.71,33.71,0,0,1,10.16,1.6v-3c0-4.8-3-7.28-8.8-7.28-3.52,0-7.44,1.12-12.72,3.44l-4-8.08a43.46,43.46,0,0,1,18.56-4.48c11.28,0,17.76,5.6,17.76,15.44v27H903.5v-2.88a19.81,19.81,0,0,1-12.08,3.6C882.46,150,876.22,144.77,876.22,137.17Zm18.08,5a15.78,15.78,0,0,0,9.2-2.64v-6.24a24.22,24.22,0,0,0-8.8-1.52c-5,0-8,2-8,5.2S889.66,142.13,894.3,142.13Z"/><path class="rh-logo-type" d="M933.58,149.25h-11v-56l11-2.4Z"/><g id="Hat_icon" data-name="Hat icon"><path id="Red_hat" data-name="Red hat" class="rh-logo-hat" d="M129,92.24c12.5,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42L151.82,39c-1.72-7.12-3.23-10.35-15.74-16.6-9.7-5-30.82-13.15-37.07-13.15-5.83,0-7.55,7.54-14.45,7.54-6.68,0-11.64-5.6-17.89-5.6-6,0-9.92,4.1-12.93,12.5,0,0-8.41,23.72-9.49,27.16A6.43,6.43,0,0,0,44,52.79C44,62,80.32,92.24,129,92.24Zm32.55-11.42c1.72,8.19,1.72,9.05,1.72,10.13,0,14-15.73,21.77-36.43,21.77-46.77,0-87.73-27.37-87.73-45.48a18.32,18.32,0,0,1,1.51-7.33C23.77,60.77,2,63.79,2,83c0,31.48,74.59,70.28,133.65,70.28,45.27,0,56.7-20.48,56.7-36.65C192.35,103.88,181.35,89.44,161.52,80.82Z"/><path class="rh-logo-band" id="Black_band" data-name="Black band" d="M161.52,80.82c1.72,8.19,1.72,9.05,1.72,10.13,0,14-15.73,21.77-36.43,21.77-46.77,0-87.73-27.37-87.73-45.48a18.32,18.32,0,0,1,1.51-7.33l3.66-9.06A6.43,6.43,0,0,0,44,52.79C44,62,80.32,92.24,129,92.24c12.5,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42Z"/></g><path id="Dividing_line" data-name="Dividing line" class="rh-logo-type" d="M255.47,160.75a2.25,2.25,0,0,1-2.25-2.25V4.25a2.25,2.25,0,0,1,4.5,0V158.5A2.25,2.25,0,0,1,255.47,160.75Z"/></g></g>
          </svg>
        </span>
            </a>
    <button class="btn btn-search btn-utility" data-target="#site-search">
        <span class="web-icon-search"></span>
        <span class="link-text">Search</span>
    </button>
</nav>

<!-- Mobile Menu Drawer -->
<div class="nav-drawer mobile-nav-drawer hidden-sm hidden-md hidden-lg" aria-hidden="true">
    <nav class="nav-container">
        <ul>
    <li>
        <a href="index.html#" class="has-subnav"><span>Products &amp; Services</span></a>
        <ul class="mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li><a href="https://access.redhat.com/products">View All Products</a></li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Infrastructure and Management</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-enterprise-linux/">Red Hat Enterprise Linux</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-virtualization/">Red Hat Virtualization</a></li>
                    <li><a href="https://access.redhat.com/products/identity-management/">Red Hat Identity Management</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-directory-server/">Red Hat Directory Server</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-certificate-system/">Red Hat Certificate System</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-satellite/">Red Hat Satellite</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-subscription-management/">Red Hat Subscription Management</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-update-infrastructure/">Red Hat Update Infrastructure</a></li>
                    <li><a href="https://access.redhat.com/insights/info/?intcmp=mm|p|im|rhaijan2016&">Red Hat Insights</a></li>
                    <li><a href="https://access.redhat.com/products/ansible-tower-red-hat/">Red Hat Ansible Tower</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-ansible-engine/">Red Hat Ansible Engine</a></li>
                </ul>
            </li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Cloud Computing</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-cloudforms/">Red Hat CloudForms</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-openstack-platform/">Red Hat OpenStack Platform</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-cloud-suite/">Red Hat Cloud Suite</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-openshift-container-platform/">Red Hat OpenShift Container Platform</a></li>
                    <li><a href="https://access.redhat.com/products/openshift-online-red-hat/">Red Hat OpenShift Online</a></li>
                    <li><a href="https://access.redhat.com/products/openshift-dedicated-red-hat/">Red Hat OpenShift Dedicated</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/">Red Hat Advanced Cluster Management for Kubernetes</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-quay/">Red Hat Quay</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-codeready-workspaces/">Red Hat CodeReady Workspaces</a></li>
                </ul>
            </li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Storage</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-storage/">Red Hat Gluster Storage</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/">Red Hat Hyperconverged Infrastructure</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-ceph-storage/">Red Hat Ceph Storage</a></li>
                    <li><a href="https://access.redhat.com/products/red-hat-openshift-container-storage">Red Hat Openshift Container Storage</a></li>
                </ul>
            </li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Runtimes</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true">
                      <a href="index.html#" class="back">Back</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-runtimes/">Red Hat Runtimes</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/">Red Hat JBoss Enterprise Application Platform</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-data-grid/">Red Hat Data Grid</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-jboss-web-server/">Red Hat JBoss Web Server</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-single-sign-on/">Red Hat Single Sign On</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/spring-boot/">Red Hat support for Spring Boot</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/nodejs/">Red Hat build of Node.js</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/thorntail/">Red Hat build of Thorntail</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/eclipse-vertx/">Red Hat build of Eclipse Vert.x</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/openjdk/">Red Hat build of OpenJDK</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/open-liberty/">Open Liberty</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/quarkus/">Red Hat build of Quarkus</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-codeready-studio/">Red Hat CodeReady Studio</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="index.html#" class="has-subnav"><span>Integration and Automation</span></a>
                <ul class="mm-hide">
                    <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-integration/">Red Hat Integration</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-fuse/">Red Hat Fuse</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-amq/">Red Hat AMQ</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-3scale/">Red Hat 3scale API Management</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-jboss-data-virtualization/">Red Hat JBoss Data Virtualization</a>
                    </li>
                    <li>
                      <a href="https://access.redhat.com/products/red-hat-process-automation/">Red Hat Process Automation</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-process-automation-manager/">Red Hat Process Automation Manager</a>
                    </li>
                    <li>
                        <a href="https://access.redhat.com/products/red-hat-decision-manager/">Red Hat Decision Manager</a>
                    </li>
                </ul>
            </li>

            <li class="heading"><a class="cta-link cta-link-darkbg" href="https://access.redhat.com/support/">Support</a></li>
            <li><a href="https://access.redhat.com/support/offerings/production/">Production Support</a></li>
            <li><a href="https://access.redhat.com/support/offerings/developer/">Development Support</a></li>
            <li><a href="https://access.redhat.com/product-life-cycles/">Product Life Cycles</a></li>

            <li class="heading"><a class="cta-link cta-link-darkbg" href="https://access.redhat.com/documentation/">Documentation</a></li>
            <li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux">Red Hat Enterprise Linux</a></li>
            <li><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform">Red Hat JBoss Enterprise Application Platform</a></li>
            <li><a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform">Red Hat OpenStack Platform</a></li>
            <li><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform">Red Hat OpenShift Container Platform</a></li>

            <li class="heading">Services</li>
            <li><a href="https://www.redhat.com/en/services/consulting">Consulting</a></li>
            <li><a href="https://access.redhat.com/support/offerings/tam/">Technical Account Management</a></li>
            <li><a href="https://www.redhat.com/en/services/training-and-certification">Training &amp; Certifications</a></li>

            
            <li class="heading"><a class="cta-link cta-link-darkbg" href="https://catalog.redhat.com/">Ecosystem Catalog</a></li>
            <li><a href="https://access.redhat.com/ecosystem/partner-resources">Partner Resources</a></li>
            <li><a href="https://access.redhat.com/public-cloud">Red Hat in the Public Cloud</a></li>
          </ul>
    </li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Tools</span></a>
        <ul class="mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li><a href="https://access.redhat.com/insights/info/?intcmp=mm|t|c1|rhaidec2015&">Red Hat Insights</a></li>
            <li class="heading">Tools</li>
            <li><a href="https://access.redhat.com/solution-engine">Solution Engine</a></li>
            <li><a href="https://access.redhat.com/downloads/content/package-browser">Packages</a></li>
            <li><a href="https://access.redhat.com/errata/">Errata</a></li>
            <li class="heading">Customer Portal Labs</li>
            <li><a href="https://access.redhat.com/labs/">Explore Labs</a></li>
            <li><a href="https://access.redhat.com/labs/#?type=config">Configuration</a></li>
            <li><a href="https://access.redhat.com/labs/#?type=deploy">Deployment</a></li>
            <li><a href="https://access.redhat.com/labs/#?type=security">Security</a></li>
            <li><a href="https://access.redhat.com/labs/#?type=troubleshoot">Troubleshooting</a></li>
        </ul>
    </li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Security</span></a>
        <ul class="mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li><a href="https://access.redhat.com/security/">Product Security Center</a></li>
            <li class="heading">Security Updates</li>
            <li><a href="https://access.redhat.com/security/security-updates/#/security-advisories">Security Advisories</a></li>
            <li><a href="https://access.redhat.com/security/security-updates/#/cve">Red Hat CVE Database</a></li>
            <li><a href="https://access.redhat.com/security/security-updates/#/security-labs">Security Labs</a></li>
            <li class="heading">Resources</li>
            <li><a href="https://access.redhat.com/security/overview/">Overview</a></li>
            <li><a href="https://access.redhat.com/blogs/product-security">Security Blog</a></li>
            <li><a href="https://www.redhat.com/security/data/metrics/">Security Measurement</a></li>
            <li><a href="https://access.redhat.com/security/updates/classification/">Severity Ratings</a></li>
            <li><a href="https://access.redhat.com/security/updates/backporting/">Backporting Policies</a></li>
            <li><a href="https://access.redhat.com/security/team/key/">Product Signing (GPG) Keys</a></li>
        </ul>
    </li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Community</span></a>
        <ul class="mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li class="heading">Customer Portal Community</li>
            <li><a href="https://access.redhat.com/discussions?keyword=&name=&product=All&category=All&tags=All">Discussions</a></li>
            <li><a href="https://access.redhat.com/blogs/">Blogs</a></li>
            <li><a href="https://access.redhat.com/groups/">Private Groups</a></li>
            <li><a href="https://access.redhat.com/community/">Community Activity</a></li>
            <li class="heading">Customer Events</li>
            <li><a href="https://access.redhat.com/convergence/">Red Hat Convergence</a></li>
            <li><a href="http://www.redhat.com/summit/">Red Hat Summit</a></li>
            <li class="heading">Stories</li>
            <li><a href="https://access.redhat.com/subscription-value/">Red Hat Subscription Value</a></li>
            <li><a href="https://access.redhat.com/you-asked-we-acted/">You Asked. We Acted.</a></li>
            <li><a href="http://www.redhat.com/en/open-source">Open Source Communities</a></li>
        </ul>
    </li>
    <li><a href="https://access.redhat.com/management/">Subscriptions</a></li>
    <li><a href="https://access.redhat.com/downloads/">Downloads</a></li>
    <li><a href="https://catalog.redhat.com/software/containers/explore/">Containers</a></li>
    <li><a href="https://access.redhat.com/support/cases/">Support Cases</a></li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Account</span></a>
        <ul class="utility mm-hide">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li class="mobile-accountLinksLoggedOut unauthenticated"><a href="https://access.redhat.com/login" id="mobile-accountLogin">Log In</a></li>
            <li class="mobile-accountLinksLoggedOut unauthenticated"><a href="https://www.redhat.com/wapps/ugc/register.html">Register</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated">
                <div class="account-info" id="mobile-accountUser">
                    <div class="account-name"><strong id="mobile-userFullName"></strong></div>
                    <div class="account-org"><span id="mobile-userOrg"></span></div>
                    <div class="account-number mobile-accountNumber"><span class="property">Red Hat Account Number:</span> <span class="value"></span></div>
                </div>
            </li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://www.redhat.com/wapps/ugc/protected/personalInfo.html">Account Details</a></li>
            <!-- <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://www.redhat.com/wapps/ugc/protected/prefs.html">Newsletter and Contact Preferences</a></li> -->
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://www.redhat.com/wapps/ugc/protected/usermgt/userList.html" class="user-management-link">User Management</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://www.redhat.com/wapps/ugc/protected/account.html">Account Maintenance</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://access.redhat.com/user">My Profile</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://access.redhat.com/user" id="mobile-userNotificationsLink">Notifications</a></li>
            <li class="mobile-accountLinksLoggedIn authenticated"><a href="https://access.redhat.com/help/">Help</a></li>
            <li class="logout mobile-accountLinksLoggedIn authenticated"><a href="https://sso.redhat.com/auth/realms/redhat-external/logout?redirectUrl=https%3A%2F%2Faccess.redhat.com%2Flogout">Log Out</a></li>
        </ul>
    </li>
    <li>
        <a href="index.html#" class="has-subnav"><span>Language</span></a>
        <ul class="utility mm-hide" id="mobile-localesMenu">
            <li aria-hidden="true"><a href="index.html#" class="back">Back</a></li>
            <li><a href="https://access.redhat.com/changeLanguage?language=en" id="mobile-en">English</a></li>
            <li><a href="https://access.redhat.com/changeLanguage?language=ko" id="mobile-ko">한국어</a></li>
            <li><a href="https://access.redhat.com/changeLanguage?language=ja" id="mobile-ja">日本語</a></li>
            <li><a href="https://access.redhat.com/changeLanguage?language=zh_CN" id="mobile-zh_CN">中文 (中国)</a></li>
		</ul>
    </li>
</ul>
    </nav>
</div>

<!-- White Utility Menu for large screens -->
<div class="utility-wrap" aria-hidden="true">
    <div class="utility-container">
        <div class="utility-bar hidden-xs">
            <div role="navigation" class="top-nav">
                <ul>
                    <li id="nav-subscription" data-portal-tour-1="1"><a class="top-nav-subscriptions" href="https://access.redhat.com/management/">Subscriptions</a></li>
                    <li id="nav-downloads" data-portal-tour-1="2"><a class="top-nav-downloads" href="https://access.redhat.com/downloads/">Downloads</a></li>
                    <li id="nav-containers"><a class="top-nav-containers" href="https://catalog.redhat.com/software/containers/explore/">Containers</a></li>
                    <li id="nav-support" data-portal-tour-1="3"><a class="top-nav-support-cases" href="https://access.redhat.com/support/cases/">Support Cases</a></li>
                </ul>
            </div>

            <div role="navigation" class="utility-nav">
                <ul>
                    <li id="searchABTestHide">
                        <a class="btn-search" data-target="#site-search" title="Search" data-toggle="tooltip" data-placement="bottom">
                            <span class="web-icon-search" aria-label="search"></span>
                            <span class="link-text">Search</span>
                        </a>
                    </li>
                    <!-- AB Test -->
                    <li id="searchABTestShow">
                        <form id="topSearchFormABTest" name="topSearchFormABTest">
                            <label for="topSearchInputABTest" class="sr-only">Search</label>
                            <input id="topSearchInputABTest" name="keyword" placeholder="Search" value="" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="form-control">
                            <button type="submit" class="btn btn-app btn-sm btn-link"><span class="web-icon-search" aria-label="search"></span></button>
                        </form>
                    </li>
                    <!-- End of AB Test -->
                    <li>
                        <a class="btn-profile" data-target="#account-info" data-portal-tour-1="4a" title="Account" data-toggle="tooltip" data-placement="bottom">
                            <span class="web-icon-user" aria-label="log in"></span>
                            <span class="link-text">Log In</span>
                            <span class="account-user" id="accountUserName"></span>
                        </a>
                    </li>
                    <li>
                        <a class="btn-language" data-target="#language" data-portal-tour-1="6" title="Language" data-toggle="tooltip" data-placement="bottom">
                            <span class="web-icon-globe" aria-label="language"></span>
                            <span class="link-text">Language</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Utility Tray -->
        <div class="utility-tray-container">
            <div class="utility-tray">
                <div id="site-search" class="utility-link site-search">
                    <div class="content">
                        <form class="ng-pristine ng-valid topSearchForm" id="topSearchForm" name="topSearchForm" action="https://access.redhat.com/search/browse/search/" method="get" enctype="application/x-www-form-urlencoded">
                            <cp-search-autocomplete class="push-bottom" path="/webassets/avalon/j/data.json"></cp-search-autocomplete>
                            <div class="input-group push-bottom">
                                <input class="form-control searchField" id="topSearchInput" name="keyword" value="" placeholder="Enter your search term" type="text">
                                <span class="input-group-btn">
                                    <button type="submit" class="btn btn-primary">Search</button>
                                </span>
                            </div>
                            <div>Or <a href="https://access.redhat.com/support/cases/#/troubleshoot">troubleshoot an issue</a>.</div>
                        </form>
                    </div>
                </div>
                <div id="account-info" class="utility-link account-info">
                    <div class="content">

                        <!-- Account Unauthenticated -->
                        <div id="accountLinksLoggedOut" class="unauthenticated">
                            <h2 class="utility-header">Log in to Your Red Hat Account</h2>
                            <div class="row col-border-row">
                                <div class="col-sm-6 col-border">
                                    <p><a href="https://access.redhat.com/login" id="accountLogin" class="btn btn-primary">Log In</a></p>
                                    <p>Your Red Hat account gives you access to your profile, preferences, and services, depending on your status.</p>
                                </div>
                                <div class="col-sm-6 col-border col-border-left">
                                    <p><a href="https://www.redhat.com/wapps/ugc/register.html" class="btn btn-primary">Register</a></p>
                                    <p>If you are a new customer, register now for access to product evaluations and purchasing capabilities. </p>

                                    <strong>Need access to an account?</strong><p>If your company has an existing Red Hat account, your organization administrator can grant you access.</p>

                                    <p><a href="https://access.redhat.com/support/contact/customerService/">If you have any questions, please contact customer service.</a></p>
                                </div>
                            </div>
                        </div>

                        <!-- Account Authenticated -->
                        <div id="accountLinksLoggedIn" class="authenticated">
                            <h2 class="utility-header"><span id="userFirstName"></span></h2>
                            <div class="row col-border-row">
                                <div class="col-sm-6 col-border col-border-right">
                                    <div class="account-info" id="accountUser">
                                        <div class="avatar"><!-- placeholder--></div>
                                        <div class="account-name"><strong id="userFullName"></strong></div>
                                        <div class="account-org"><span id="userOrg"></span></div>
                                        <div class="account-number accountNumber"><span class="property">Red Hat Account Number:</span> <span class="value"></span></div>
                                    </div>

                                    <div class="row account-settings">
                                        <div class="col-md-6" data-portal-tour-1="4">
                                            <h3>Red Hat Account</h3>
                                            <ul class="reset">
                                                <li><a href="https://www.redhat.com/wapps/ugc/protected/personalInfo.html">Account Details</a></li>
                                                <!-- <li><a href="https://www.redhat.com/wapps/ugc/protected/prefs.html">Newsletter and Contact Preferences</a></li> -->
                                                <li><a href="https://www.redhat.com/wapps/ugc/protected/usermgt/userList.html" class="user-management-link">User Management</a></li>
                                                <li><a href="https://www.redhat.com/wapps/ugc/protected/account.html">Account Maintenance</a></li>
                                                <li><a href="https://access.redhat.com/account-team">Account Team</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6" data-portal-tour-1="5">
                                            <h3>Customer Portal</h3>
                                            <ul class="reset">
                                                <li><a href="https://access.redhat.com/user">My Profile</a></li>
                                                <li><a href="https://access.redhat.com/user" id="userNotificationsLink">Notifications</a></li>
                                                <li><a href="https://access.redhat.com/help/">Help</a></li>
                                            </ul>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-sm-6 col-border">
                                    <p>For your security, if you’re on a public computer and have finished using your Red Hat services, please be sure to log out.</p>
                                    <p><a href="https://sso.redhat.com/auth/realms/redhat-external/logout?redirectUrl=https%3A%2F%2Faccess.redhat.com%2Flogout" id="accountLogout" class="btn btn-primary">Log Out</a></p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div id="language" class="utility-link language">
                    <div class="content">
                        <h2 class="utility-header">Select Your Language</h2>
                        <div class="row" id="localesMenu">
                            <div class="col-sm-2">
                                <ul class="reset">
                                    <li><a href="https://access.redhat.com/changeLanguage?language=en" data-lang="en" id="en">English</a></li>
                                    <li><a href="https://access.redhat.com/changeLanguage?language=ko" data-lang="ko" id="ko">한국어</a></li>
                                </ul>
                            </div>
                            <div class="col-sm-2">
                                <ul class="reset">
                                    <li><a href="https://access.redhat.com/changeLanguage?language=ja"    data-lang="ja"    id="ja">日本語</a></li>
                                    <li><a href="https://access.redhat.com/changeLanguage?language=zh_CN" data-lang="zh_CN" id="zh_CN">中文 (中国)</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="scroll-anchor"></div>

<!-- Main Menu for large screens -->
<div class="header-nav visible-sm visible-md visible-lg" aria-hidden="true">
    <div id="header-nav">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">

                    <a href="https://access.redhat.com/" class="logo">
                      <span class="sr-only">Red Hat Customer Portal</span>
                      <span class="logo-crop">
                        <svg aria-hidden="true" class="rh-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 200">
                          <defs>
                          <style>
                            .rh-logo-type {
                              fill:#fff;
                            }
                            .rh-logo-hat {
                              fill:#e00;
                            }
                          </style>
                          </defs>
                          <title>Red Hat Customer Portal</title><g id="Two_lines" data-name="Two lines"><g id="Two_line_logo" data-name="Two line logo"><path class="rh-logo-type" d="M318.62,9.25h25.44c11.13,0,18.64,6.72,18.64,16.56,0,7.36-4.47,13-11.51,15.36l12.48,24.08h-9.29l-11.6-23H327v23h-8.4Zm8.4,7.36V35.33h16.33c6.55,0,10.87-3.76,10.87-9.36s-4.32-9.36-10.87-9.36Z"/><path class="rh-logo-type" d="M387.5,66a21,21,0,0,1-21.36-21.12c0-11.76,9-21,20.4-21,11.2,0,19.68,9.28,19.68,21.28v2.32H374.06a13.74,13.74,0,0,0,13.76,11.68,15.84,15.84,0,0,0,10.32-3.6l5.13,5A24.33,24.33,0,0,1,387.5,66ZM374.14,41.49H398.3c-1.19-6.24-6-10.88-11.92-10.88C380.22,30.61,375.34,35,374.14,41.49Z"/><path class="rh-logo-type" d="M445.18,61.41a19.23,19.23,0,0,1-12.48,4.48c-11.52,0-20.56-9.2-20.56-21a20.72,20.72,0,0,1,33-17V9.25l8-1.76V65.25h-7.92Zm-11.36-2.48a14.67,14.67,0,0,0,11.28-4.88V35.57a14.89,14.89,0,0,0-11.28-4.8,13.63,13.63,0,0,0-13.84,14A13.77,13.77,0,0,0,433.82,58.93Z"/><path class="rh-logo-type" d="M480.22,9.25h8.4v24h29.76v-24h8.4v56h-8.4V40.85H488.62v24.4h-8.4Z"/><path class="rh-logo-type" d="M534.38,53.57c0-7.68,6.24-12.4,16.48-12.4A28.75,28.75,0,0,1,562,43.41V39.09c0-5.76-3.44-8.64-9.92-8.64-3.76,0-7.6,1-12.64,3.44l-3-6c6.08-2.88,11.36-4.16,16.72-4.16,10.56,0,16.64,5.2,16.64,14.56v27H562V61.73A19.32,19.32,0,0,1,549.34,66C540.46,66,534.38,60.93,534.38,53.57Zm16.8,6.48A15.66,15.66,0,0,0,562,56.21v-7a21.15,21.15,0,0,0-10.48-2.48c-5.84,0-9.44,2.64-9.44,6.72C542.06,57.33,545.74,60.05,551.18,60.05Z"/><path class="rh-logo-type" d="M582.7,31.25h-8.64V24.53h8.64V14.13l7.92-1.92V24.53h12v6.72h-12V53.33c0,4.16,1.68,5.68,6,5.68a15.72,15.72,0,0,0,5.84-1v6.72a26.5,26.5,0,0,1-7.6,1.2c-7.92,0-12.16-3.76-12.16-10.8Z"/><path class="rh-logo-type" d="M361,132.21l7.59,7.52a30.76,30.76,0,0,1-23,10.32c-16.88,0-29.84-12.56-29.84-28.8s13-28.88,29.84-28.88c9,0,18.09,4.08,23.28,10.48l-7.83,7.76a19.52,19.52,0,0,0-15.45-7.6c-10.16,0-17.92,7.84-17.92,18.24A17.8,17.8,0,0,0,346,139.33,19.24,19.24,0,0,0,361,132.21Z"/><path class="rh-logo-type" d="M383.74,131.81c0,5.36,3.44,8.8,8.64,8.8a10.05,10.05,0,0,0,8.65-4.16V107.57h11v41.68H401v-3.36a17.79,17.79,0,0,1-11.77,4.16c-9.68,0-16.48-6.88-16.48-16.64V107.57h11Z"/><path class="rh-logo-type" d="M422.46,137c4.88,3.2,9.12,4.72,13.52,4.72,4.88,0,8.08-1.76,8.08-4.4,0-2.16-1.6-3.36-5.2-3.92l-8-1.2c-8.24-1.28-12.64-5.36-12.64-12.08,0-8.08,6.72-13.2,17.36-13.2a30.75,30.75,0,0,1,17.12,5.2l-5.28,7c-4.56-2.72-8.64-4-12.88-4-4,0-6.56,1.6-6.56,4.08,0,2.24,1.6,3.36,5.68,3.92l8,1.2c8.16,1.2,12.72,5.44,12.72,11.92,0,7.84-7.76,13.76-18.24,13.76-7.6,0-14.4-2-19.12-5.76Z"/><path class="rh-logo-type" d="M464.7,116.77h-8.56v-9.2h8.56V96.93l11-2.48v13.12H487.5v9.2H475.66v18.48c0,3.92,1.52,5.36,5.76,5.36a16.86,16.86,0,0,0,5.84-1v9a34,34,0,0,1-8.48,1.28c-9.28,0-14.08-4.24-14.08-12.4Z"/><path class="rh-logo-type" d="M512.86,106.77c12.48,0,22.24,9.52,22.24,21.68s-9.76,21.6-22.24,21.6-22.24-9.44-22.24-21.6S500.38,106.77,512.86,106.77Zm11.52,21.68c0-6.88-5-12.16-11.52-12.16s-11.52,5.28-11.52,12.16c0,6.72,5,12.08,11.52,12.08S524.38,135.17,524.38,128.45Z"/><path class="rh-logo-type" d="M541.82,107.57h11v3.12a16.21,16.21,0,0,1,10.88-3.92A15,15,0,0,1,576.22,113,17.16,17.16,0,0,1,590,106.77c9.36,0,15.91,6.8,15.91,16.56v25.92h-11V124.93c0-5.28-3-8.72-7.83-8.72a9.37,9.37,0,0,0-8,4.16,18.89,18.89,0,0,1,.23,3v25.92h-11V124.93c0-5.28-3-8.72-7.84-8.72a9.3,9.3,0,0,0-7.76,3.76v29.28h-11Z"/><path class="rh-logo-type" d="M634.78,150.05c-12.64,0-22.4-9.44-22.4-21.6a21.28,21.28,0,0,1,21.44-21.6c11.84,0,20.64,9.6,20.64,22.4v2.88h-31a12,12,0,0,0,11.84,8.72,13.12,13.12,0,0,0,9.2-3.36l7.2,6.56A25,25,0,0,1,634.78,150.05Zm-11.44-25.76h20.4c-1.36-5-5.36-8.4-10.16-8.4C628.54,115.89,624.7,119.17,623.34,124.29Z"/><path class="rh-logo-type" d="M661.18,107.57h11v4.56a13.26,13.26,0,0,1,11.12-5.52,9.44,9.44,0,0,1,4.56,1v9.6a14,14,0,0,0-5.6-1.12,11,11,0,0,0-10.08,6.24v27h-11Z"/><path class="rh-logo-type" d="M710.54,93.25h28.08c11,0,18.8,7.28,18.8,17.6,0,10-7.92,17.28-18.8,17.28H722.14v21.12h-11.6Zm11.6,10v15.28h15.2c5,0,8.32-3,8.32-7.6s-3.28-7.68-8.32-7.68Z"/><path class="rh-logo-type" d="M782.14,106.77c12.48,0,22.24,9.52,22.24,21.68s-9.76,21.6-22.24,21.6-22.24-9.44-22.24-21.6S769.66,106.77,782.14,106.77Zm11.52,21.68c0-6.88-5-12.16-11.52-12.16s-11.52,5.28-11.52,12.16c0,6.72,5,12.08,11.52,12.08S793.66,135.17,793.66,128.45Z"/><path class="rh-logo-type" d="M811.1,107.57h11v4.56a13.26,13.26,0,0,1,11.12-5.52,9.44,9.44,0,0,1,4.56,1v9.6a14,14,0,0,0-5.6-1.12,11,11,0,0,0-10.08,6.24v27h-11Z"/><path class="rh-logo-type" d="M850,116.77h-8.56v-9.2H850V96.93l11-2.48v13.12h11.84v9.2H860.94v18.48c0,3.92,1.52,5.36,5.76,5.36a16.86,16.86,0,0,0,5.84-1v9a34,34,0,0,1-8.48,1.28c-9.28,0-14.08-4.24-14.08-12.4Z"/><path class="rh-logo-type" d="M876.22,137.17c0-7.92,6.4-12.64,17.12-12.64a33.71,33.71,0,0,1,10.16,1.6v-3c0-4.8-3-7.28-8.8-7.28-3.52,0-7.44,1.12-12.72,3.44l-4-8.08a43.46,43.46,0,0,1,18.56-4.48c11.28,0,17.76,5.6,17.76,15.44v27H903.5v-2.88a19.81,19.81,0,0,1-12.08,3.6C882.46,150,876.22,144.77,876.22,137.17Zm18.08,5a15.78,15.78,0,0,0,9.2-2.64v-6.24a24.22,24.22,0,0,0-8.8-1.52c-5,0-8,2-8,5.2S889.66,142.13,894.3,142.13Z"/><path class="rh-logo-type" d="M933.58,149.25h-11v-56l11-2.4Z"/><g id="Hat_icon" data-name="Hat icon"><path id="Red_hat" data-name="Red hat" class="rh-logo-hat" d="M129,92.24c12.5,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42L151.82,39c-1.72-7.12-3.23-10.35-15.74-16.6-9.7-5-30.82-13.15-37.07-13.15-5.83,0-7.55,7.54-14.45,7.54-6.68,0-11.64-5.6-17.89-5.6-6,0-9.92,4.1-12.93,12.5,0,0-8.41,23.72-9.49,27.16A6.43,6.43,0,0,0,44,52.79C44,62,80.32,92.24,129,92.24Zm32.55-11.42c1.72,8.19,1.72,9.05,1.72,10.13,0,14-15.73,21.77-36.43,21.77-46.77,0-87.73-27.37-87.73-45.48a18.32,18.32,0,0,1,1.51-7.33C23.77,60.77,2,63.79,2,83c0,31.48,74.59,70.28,133.65,70.28,45.27,0,56.7-20.48,56.7-36.65C192.35,103.88,181.35,89.44,161.52,80.82Z"/><path class="rh-logo-band" id="Black_band" data-name="Black band" d="M161.52,80.82c1.72,8.19,1.72,9.05,1.72,10.13,0,14-15.73,21.77-36.43,21.77-46.77,0-87.73-27.37-87.73-45.48a18.32,18.32,0,0,1,1.51-7.33l3.66-9.06A6.43,6.43,0,0,0,44,52.79C44,62,80.32,92.24,129,92.24c12.5,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42Z"/></g><path id="Dividing_line" data-name="Dividing line" class="rh-logo-type" d="M255.47,160.75a2.25,2.25,0,0,1-2.25-2.25V4.25a2.25,2.25,0,0,1,4.5,0V158.5A2.25,2.25,0,0,1,255.47,160.75Z"/></g></g>
                        </svg>
                      </span>
                                            </a>

                    <nav class="primary-nav hidden-sm">
                        <ul>
                            <li id="nav-products"><a class="products" data-link="mega" data-target="products-menu" href="https://access.redhat.com/products/" id="products-menu">Products &amp; Services</a></li>
                            <li id="nav-tools"><a class="tools" data-link="mega" data-target="tools-menu" href="https://access.redhat.com/labs/" id="tools-menu">Tools</a></li>
                            <li id="nav-security"><a class="security" data-link="mega" data-target="security-menu" href="https://access.redhat.com/security/" id="security-menu">Security</a></li>
                            <li id="nav-community"><a class="community" data-link="mega" data-target="community-menu" href="https://access.redhat.com/community/" id="community-menu">Community</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Mega Menu for large screens -->
<div class="mega-wrap visible-sm visible-md visible-lg" aria-hidden="true">
    <nav class="mega">
        <div class="container">
            <div class="mega-menu-wrap">

                <!-- Products Menu -->
                <div aria-labelledby="products-menu" class="products-menu mega-menu" data-eh="mega-menu" role="navigation">
                    <div class="row">
                        <div class="col-md-6 col-sm-8">
                            <div class="root clearfix" data-portal-tour-1="7">
                                <ul class="subnav subnav-root">
                                    <li data-target="infrastructure-menu" class="active">
                                        <h3>Infrastructure and Management</h3>
                                    </li>
                                    <li data-target="cloud-menu">
                                        <h3>Cloud Computing</h3>
                                    </li>
                                    <li data-target="storage-menu">
                                        <h3>Storage</h3>
                                    </li>
                                    <li data-target="jboss-dev-menu">
                                        <h3>Runtimes</h3>
                                    </li>
                                    <li data-target="jboss-int-menu">
                                        <h3>Integration and Automation</h3>
                                    </li>
                                </ul>
                                <div class="subnav subnav-child" data-eh="subnav-child" data-menu-local="infrastructure-menu" style="display: block;">
                                    <ul>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-enterprise-linux/">Red Hat Enterprise Linux</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-virtualization/">Red Hat Virtualization</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/identity-management/">Red Hat Identity Management</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-directory-server/">Red Hat Directory Server</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-certificate-system/">Red Hat Certificate System</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-satellite/">Red Hat Satellite</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-subscription-management/">Red Hat Subscription Management</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-update-infrastructure/">Red Hat Update Infrastructure</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-insights/">Red Hat Insights</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/ansible-tower-red-hat/">Red Hat Ansible Tower</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-ansible-engine/">Red Hat Ansible Engine</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="subnav subnav-child" data-eh="subnav-child" data-menu-local="cloud-menu">
                                    <ul>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-cloudforms/">Red Hat CloudForms</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-openstack-platform/">Red Hat OpenStack Platform</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-cloud-suite/">Red Hat Cloud Suite</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-openshift-container-platform/">Red Hat OpenShift Container Platform</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/openshift-online-red-hat/">Red Hat OpenShift Online</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/openshift-dedicated-red-hat/">Red Hat OpenShift Dedicated</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/">Red Hat Advanced Cluster Management for Kubernetes</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-quay/">Red Hat Quay</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-codeready-workspaces/">Red Hat CodeReady Workspaces</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="subnav subnav-child" data-eh="subnav-child" data-menu-local="storage-menu">
                                    <ul>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-storage/">Red Hat Gluster Storage</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/">Red Hat Hyperconverged Infrastructure</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-ceph-storage/">Red Hat Ceph Storage</a>
                                        </li>
                                        <li>
                                          <a href="https://access.redhat.com/products/red-hat-openshift-container-storage">Red Hat Openshift Container Storage</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="subnav subnav-child" data-eh="subnav-child" data-menu-local="jboss-dev-menu">
                                    <ul>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-runtimes/">Red Hat Runtimes</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/">Red Hat JBoss Enterprise Application Platform</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-data-grid/">Red Hat Data Grid</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-jboss-web-server/">Red Hat JBoss Web Server</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-single-sign-on/">Red Hat Single Sign On</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/spring-boot/">Red Hat support for Spring Boot</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/nodejs/">Red Hat build of Node.js</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/thorntail/">Red Hat build of Thorntail</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/eclipse-vertx/">Red Hat build of Eclipse Vert.x</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/openjdk/">Red Hat build of OpenJDK</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/open-liberty/">Open Liberty</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/quarkus/">Red Hat build of Quarkus</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-codeready-studio/">Red Hat CodeReady Studio</a>
                                        </li>
                                    </ul>
                                </div>
                                <!-- <div class="subnav subnav-child" data-eh="subnav-child" data-menu-local="jboss-int-menu">
                                    <ul>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-jboss-data-virtualization/">Red Hat JBoss Data Virtualization</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-fuse/">Red Hat Fuse</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-amq/">Red Hat AMQ</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-process-automation-manager/">Red Hat Process Automation Manager</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-decision-manager/">Red Hat Decision Manager</a>
                                        </li>
                                        <li>
                                            <a href="https://access.redhat.com/products/red-hat-3scale/">Red Hat 3scale API Management</a>
                                        </li>
                                    </ul>
                                </div> -->
                                <div class="subnav subnav-child" data-eh="subnav-child" data-menu-local="jboss-int-menu">
                                    <ul class="border-bottom" id="portal-menu-border-bottom">
                                      <li>
                                          <a href="https://access.redhat.com/products/red-hat-integration/">Red Hat Integration</a>
                                      </li>
                                      <li>
                                          <a href="https://access.redhat.com/products/red-hat-fuse/">Red Hat Fuse</a>
                                      </li>
                                      <li>
                                          <a href="https://access.redhat.com/products/red-hat-amq/">Red Hat AMQ</a>
                                      </li>
                                      <li>
                                          <a href="https://access.redhat.com/products/red-hat-3scale/">Red Hat 3scale API Management</a>
                                      </li>
                                      <li>
                                          <a href="https://access.redhat.com/products/red-hat-jboss-data-virtualization/">Red Hat JBoss Data Virtualization</a>
                                      </li>
                                    </ul>
                                    <ul>
                                      <li>
                                        <a href="https://access.redhat.com/products/red-hat-process-automation/">Red Hat Process Automation</a>
                                      </li>
                                      <li>
                                          <a href="https://access.redhat.com/products/red-hat-process-automation-manager/">Red Hat Process Automation Manager</a>
                                      </li>
                                      <li>
                                          <a href="https://access.redhat.com/products/red-hat-decision-manager/">Red Hat Decision Manager</a>
                                      </li>
                                    </ul>
                                </div>
                            </div>
                            <a href="https://access.redhat.com/products" class="btn btn-primary">View All Products</a>
                        </div>

                        <div class="col-md-6 col-sm-4 pull-right" data-portal-tour-1="8">
                            <div class="row">
                                <div class="col-md-6">
                                    <ul>
                                        <li><a href="https://access.redhat.com/support" class="cta-link cta-link-darkbg">Support</a></li>
                                        <li><a href="https://access.redhat.com/support/offerings/production/">Production Support</a></li>
                                        <li><a href="https://access.redhat.com/support/offerings/developer/">Development Support</a></li>
                                        <li><a href="https://access.redhat.com/product-life-cycles/">Product Life Cycles</a></li>
                                    </ul>
                                    <h4 class="nav-title">Services</h4>
                                    <ul>
                                        <li><a href="https://www.redhat.com/en/services/consulting">Consulting</a></li>
                                        <li><a href="https://access.redhat.com/support/offerings/tam/">Technical Account Management</a></li>
                                        <li><a href="https://www.redhat.com/en/services/training-and-certification">Training &amp; Certifications</a></li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul>
                                        <li><a href="https://access.redhat.com/documentation" class="cta-link cta-link-darkbg">Documentation</a></li>
                                        <li><a href="https://access.redhat.com/documentation/en/red_hat_enterprise_linux">Red Hat Enterprise Linux</a></li>
                                        <li><a href="https://access.redhat.com/documentation/en/red_hat_jboss_enterprise_application_platform">Red Hat JBoss Enterprise Application Platform</a></li>
                                        <li><a href="https://access.redhat.com/documentation/en/red_hat_openstack_platform">Red Hat OpenStack Platform</a></li>
                                        <li><a href="https://access.redhat.com/documentation/en/openshift_container_platform">Red Hat OpenShift Container Platform</a></li>
                                    </ul>
                                    <ul>
                                        
                                        <li><a href="https://catalog.redhat.com/" class="cta-link cta-link-darkbg">Ecosystem Catalog</a></li>
                                        <li><a href="https://access.redhat.com/public-cloud">Red Hat in the Public Cloud</a></li>
                                        <li><a href="https://access.redhat.com/ecosystem/partner-resources">Partner Resources</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tools Menu -->
                <div aria-labelledby="tools-menu" class="tools-menu mega-menu" data-eh="mega-menu" role="navigation">
                    <div class="row" data-portal-tour-1="9">
                        <div class="col-sm-12">
                            <div class="row">
                                <div class="col-sm-4">
                                    <h3 class="nav-title">Tools</h3>
                                    <ul>
                                        <li><a href="https://access.redhat.com/solution-engine">Solution Engine</a></li>
                                        <li><a href="https://access.redhat.com/downloads/content/package-browser">Packages</a></li>
                                        <li><a href="https://access.redhat.com/errata/">Errata</a></li>
                                    </ul>
                                </div>
                                <div class="col-sm-4">
                                    <ul class="list-flat">
                                        <li><a href="https://access.redhat.com/labs/" class="cta-link cta-link-darkbg">Customer Portal Labs</a></li>
                                        <li><a href="https://access.redhat.com/labs/#?type=config">Configuration</a></li>
                                        <li><a href="https://access.redhat.com/labs/#?type=deploy">Deployment</a></li>
                                        <li><a href="https://access.redhat.com/labs/#?type=security">Security</a></li>
                                        <li><a href="https://access.redhat.com/labs/#?type=troubleshoot">Troubleshooting</a></li>
                                    </ul>
                                </div>

                                <div class="col-sm-4">
                                    <div class="card card-dark-grey">
                                        <h4 class="card-heading">Red Hat Insights</h4>
                                        <p class="text-white">Increase visibility into IT operations to detect and resolve technical issues before they impact your business.</p>
                                        <ul class="list-flat rh-l-grid rh-m-gutters rh-m-all-6-col-on-md">
                                          <li><a href="https://www.redhat.com/en/technologies/management/insights" class="cta-link cta-link-md cta-link-darkbg">Learn more</a></li>
                                          <li><a href="https://cloud.redhat.com/insights" class="cta-link cta-link-md cta-link-darkbg">Go to Insights</a></li>
                                        </ul>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>

                <!-- Security Menu -->
                <div aria-labelledby="security-menu" class="security-menu mega-menu" data-eh="mega-menu" role="navigation">
                    <div class="row">
                        <div class="col-sm-12 basic" data-portal-tour-1="10">

                            <div class="row">
                                <div class="col-sm-4">
                                    <h2 class="nav-title">Red Hat Product Security Center</h2>
                                    <p class="text-white">Engage with our Red Hat Product Security team, access security updates, and ensure your environments are not exposed to any known security vulnerabilities.</p>
                                    <p><a href="https://access.redhat.com/security/" class="btn btn-primary">Product Security Center</a></p>
                                </div>

                                <div class="col-sm-4">
                                    <h2 class="nav-title">Security Updates</h2>
                                    <ul>
                                        <li><a href="https://access.redhat.com/security/security-updates/#/security-advisories">Security Advisories</a></li>
                                        <li><a href="https://access.redhat.com/security/security-updates/#/cve">Red Hat CVE Database</a></li>
                                        <li><a href="https://access.redhat.com/security/security-updates/#/security-labs">Security Labs</a></li>
                                    </ul>
                                    <p class="text-white">Keep your systems secure with Red Hat&#039;s specialized responses for high-priority security vulnerabilities.</p>
                                    <ul>
                                        <li class="more-link"><a href="https://access.redhat.com/security/vulnerability">View Responses</a></li>
                                    </ul>
                                </div>

                                <div class="col-sm-4">
                                    <h2 class="nav-title">Resources</h2>
                                    <ul>
                                        <li><a href="https://access.redhat.com/security/overview/">Overview</a></li>
                                        <li><a href="https://www.redhat.com/en/blog/channel/security">Security Blog</a></li>
                                        <li><a href="https://www.redhat.com/security/data/metrics/">Security Measurement</a></li>
                                        <li><a href="https://access.redhat.com/security/updates/classification/">Severity Ratings</a></li>
                                        <li><a href="https://access.redhat.com/security/updates/backporting/">Backporting Policies</a></li>
                                        <li><a href="https://access.redhat.com/security/team/key/">Product Signing (GPG) Keys</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Community Menu -->
                <div aria-labelledby="community-menu" class="community-menu mega-menu" data-eh="mega-menu" role="navigation">
                    <div class="row">
                        <div class="col-sm-12 basic" data-portal-tour-1="11">
                            <div class="row">
                                <div class="col-sm-4">
                                    <h2 class="nav-title">Customer Portal Community</h2>
                                    <ul>
                                        <li><a href="https://access.redhat.com/discussions?keyword=&name=&product=All&category=All&tags=All">Discussions</a></li>
                                        <li><a href="https://access.redhat.com/blogs/">Blogs</a></li>
                                        <li><a href="https://access.redhat.com/groups/">Private Groups</a></li>
                                        <p class="push-top"><a href="https://access.redhat.com/community/" class="btn btn-primary">Community Activity</a></p>
                                    </ul>
                                </div>
                                <div class="col-sm-4">
                                    <h2 class="nav-title">Customer Events</h2>
                                    <ul>
                                        <li><a href="https://access.redhat.com/convergence/">Red Hat Convergence</a></li>
                                        <li><a href="http://www.redhat.com/summit/">Red Hat Summit</a></li>
                                    </ul>
                                </div>
                                <div class="col-sm-4">
                                    <h2 class="nav-title">Stories</h2>
                                    <ul>
                                        <li><a href="https://access.redhat.com/subscription-value/">Red Hat Subscription Value</a></li>
                                        <li><a href="https://access.redhat.com/you-asked-we-acted/">You Asked. We Acted.</a></li>
                                        <li><a href="http://www.redhat.com/en/open-source">Open Source Communities</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!--<a href="https://access.redhat.com/community/" class="btn btn-primary">Explore Community</a>-->
                    </div>
                </div>
            </div>
        </div>
    </nav>
</div>

            <!--[if IE 8]>
            <div class="portal-messages">
                <div class="alert alert-warning alert-portal alert-w-icon">
                    <span class="icon-warning alert-icon" aria-hidden="true"></span>
                    You are using an unsupported web browser. Update to a supported browser for the best experience. <a href="/announcements/2120951">Read the announcement</a>.
                </div>
            </div>
            <![endif]-->
            <!--[if IE 9]>
            <div class="portal-messages">
                <div class="alert alert-warning alert-portal alert-w-icon">
                    <span class="icon-warning alert-icon" aria-hidden="true"></span>
                    As of March 1, 2016, the Red Hat Customer Portal will no longer support Internet Explorer 9. See our new <a href="/help/browsers">browser support policy</a> for more information.
                </div>
            </div>
            <![endif]-->
            <div id="site-section"></div>
        </header>
        <!--googleon: all-->

        <main id="cp-main" class="portal-content-area">
            <div id="cp-content" class="main-content">
  <script type="text/javascript">
    chrometwo_require(['jquery-ui']);
  </script>


      <article class="rh_docs">
  <div class="container">
        <!-- Display: Book Page Content -->
    
  

<div class="row">
  <div itemscope="" itemtype="https://schema.org/TechArticle" itemref="techArticle-md1 techArticle-md2 techArticle-md3"></div>
  <div itemscope="" itemtype="https://schema.org/SoftwareApplication" itemref="softwareApplication-md1 softwareApplication-md2 softwareApplication-md3 softwareApplication-md4"></div>
  


<a class="toc-toggle toc-show" data-toggle="collapse" data-target="#toc-main" aria-expanded="false" aria-controls="toc-main">
  <span class="sr-only">Show Table of Contents</span>
  <span class="web-icon-mobile-menu" aria-hidden="true"></span>
</a>
<nav id="toc-main" class="toc-main collapse in">
  <div class="toc-menu affix-top">
    <a class="toc-toggle toc-hide" data-toggle="collapse" data-target="#toc-main" aria-expanded="false" aria-controls="toc-main">
      <span class="sr-only">Hide Table of Contents</span>
      <span class="icon-remove" aria-hidden="true"></span>
    </a>
    <div class="doc-options">
      <div class="doc-language btn-group">
        <button type="button" class="btn btn-app dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
          English <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
                      <li><a href="index.html">English</a></li>
                      <li><a href="https://access.redhat.com/documentation/ja-jp/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/">日本語</a></li>
                  </ul>
      </div>
      <div class="doc-format btn-group">
        <button type="button" class="btn btn-app dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
          Single-page HTML <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
                      <li><a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/">Multi-page HTML</a></li>
                                <li><a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/pdf/advanced_overcloud_customization/Red_Hat_OpenStack_Platform-16.1-Advanced_Overcloud_Customization-en-US.pdf">PDF</a></li>
                      <li><a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/epub/advanced_overcloud_customization/Red_Hat_OpenStack_Platform-16.1-Advanced_Overcloud_Customization-en-US.epub">ePub</a></li>
                  </ul>
      </div>
    </div>
    <ol class="menu"><li class=" leaf"><a href="index.html">Advanced Overcloud Customization</a></li><li class=" leaf"><a href="index.html#chap-Introduction">1. Introduction</a></li><li class=" leaf"><a href="index.html#sect-Understanding_Heat_Templates">2. Understanding Heat Templates</a><ol class="menu"><li class=" leaf"><a href="index.html#sect-Heat_Templates">2.1. Heat Templates</a></li><li class=" leaf"><a href="index.html#sect-Environment_Files">2.2. Environment Files</a></li><li class=" leaf"><a href="index.html#sect-Core_Overcloud_Heat_Templates">2.3. Core Overcloud Heat Templates</a></li><li class=" leaf"><a href="index.html#plan_environment">2.4. Plan Environment Metadata</a></li><li class=" leaf"><a href="index.html#sect-Including_Environment_Files_in_Overcloud_Creation">2.5. Including Environment Files in Overcloud Creation</a></li><li class=" leaf"><a href="index.html#sect-Using_Customized_Overcloud_Heat_Templates">2.6. Using Customized Core Heat Templates</a></li><li class=" leaf"><a href="index.html#jinja2-rendering">2.7. Jinja2 rendering</a></li></ol></li><li class=" leaf"><a href="index.html#sect-Configuring_Base_Parameters">3. Parameters</a><ol class="menu"><li class=" leaf"><a href="index.html#example_1_configuring_the_time_zone">3.1. Example 1: Configuring the time zone</a></li><li class=" leaf"><a href="index.html#example_2_enabling_networking_distributed_virtual_routing_dvr">3.2. Example 2: Enabling Networking Distributed Virtual Routing (DVR)</a></li><li class=" leaf"><a href="index.html#example_3_configuring_rabbitmq_file_descriptor_limit">3.3. Example 3: Configuring RabbitMQ File Descriptor Limit</a></li><li class=" leaf"><a href="index.html#example_4_enabling_and_disabling_parameters">3.4. Example 4: Enabling and Disabling Parameters</a></li><li class=" leaf"><a href="index.html#identifying_parameters_to_modify">3.5. Identifying Parameters to Modify</a></li></ol></li><li class=" leaf"><a href="index.html#chap-Configuration_Hooks">4. Configuration Hooks</a><ol class="menu"><li class=" leaf"><a href="index.html#sect-Customizing_Configuration_on_First_Boot">4.1. First Boot: Customizing First Boot Configuration</a></li><li class=" leaf"><a href="index.html#sect-Customizing_Overcloud_PreConfiguration">4.2. Pre-Configuration: Customizing Specific Overcloud Roles</a></li><li class=" leaf"><a href="index.html#sect-Customizing_Overcloud_PreConfiguration_All">4.3. Pre-Configuration: Customizing All Overcloud Roles</a></li><li class=" leaf"><a href="index.html#sect-Customizing_Overcloud_PostConfiguration_All">4.4. Post-Configuration: Customizing All Overcloud Roles</a></li><li class=" leaf"><a href="index.html#sect-Customizing_Puppet_Configuration_Data">4.5. Puppet: Customizing Hieradata for Roles</a></li><li class=" leaf"><a href="index.html#sect-Customizing_Hieradata_for_Individual_Nodes">4.6. Puppet: Customizing Hieradata for Individual Nodes</a></li><li class=" leaf"><a href="index.html#sect-Applying_Custom_Puppet_Configuration">4.7. Puppet: Applying Custom Manifests</a></li></ol></li><li class=" leaf"><a href="index.html#ansible-based-registration">5. Ansible-based overcloud registration</a><ol class="menu"><li class=" leaf"><a href="index.html#rhsm-composable-service-registration">5.1. Red Hat Subscription Manager (RHSM) composable service</a></li><li class=" leaf"><a href="index.html#rhsmvars-parameters-registration">5.2. RhsmVars sub-parameters</a></li><li class=" leaf"><a href="index.html#registering-the-overcloud-with-the-rhsm-composable-service-registration">5.3. Registering the overcloud with the rhsm composable service</a></li><li class=" leaf"><a href="index.html#applying-the-rhsm-composable-service-to-different-roles-registration">5.4. Applying the rhsm composable service to different roles</a></li><li class=" leaf"><a href="index.html#registering-the-overcloud-to-red-hat-satellite-registration">5.5. Registering the overcloud to Red Hat Satellite</a></li><li class=" leaf"><a href="index.html#switching-to-the-rhsm-composable-service-registration">5.6. Switching to the rhsm composable service</a></li><li class=" leaf"><a href="index.html#rhel-registration-to-rhsm-mappings-registration">5.7. rhel-registration to rhsm mappings</a></li><li class=" leaf"><a href="index.html#deploying-the-overcloud-with-the-rhsm-composable-service-registration">5.8. Deploying the overcloud with the rhsm composable service</a></li><li class=" leaf"><a href="index.html#running-ansible-based-registration-manually-registration">5.9. Running Ansible-based registration manually</a></li></ol></li><li class=" leaf"><a href="index.html#Chap-Roles">6. Composable Services and Custom Roles</a><ol class="menu"><li class=" leaf"><a href="index.html#doc-Composable_Services-Architectures">6.1. Supported Role Architecture</a></li><li class=" leaf"><a href="index.html#roles">6.2. Roles</a><ol class="menu"><li class=" leaf"><a href="index.html#Examining_Composable_Role_Architecture">6.2.1. Examining the roles_data File</a></li><li class=" leaf"><a href="index.html#sect-Creating_a_Custom_Roles_File">6.2.2. Creating a roles_data File</a></li><li class=" leaf"><a href="index.html#supported-custom-roles">6.2.3. Supported Custom Roles</a></li><li class=" leaf"><a href="index.html#create-custom-network-role-ovn">6.2.4. Creating a Custom Networker Role with ML2/OVN</a></li><li class=" leaf"><a href="index.html#Examining_Composable_Role_Parameters">6.2.5. Examining Role Parameters</a></li><li class=" leaf"><a href="index.html#sect-Creating_a_New_Role">6.2.6. Creating a New Role</a></li></ol></li><li class=" leaf"><a href="index.html#composable_services">6.3. Composable Services</a><ol class="menu"><li class=" leaf"><a href="index.html#sect-Composable_Services-Guidelines">6.3.1. Guidelines and Limitations</a></li><li class=" leaf"><a href="index.html#Examining_Composable_Service_Architecture">6.3.2. Examining Composable Service Architecture</a></li><li class=" leaf"><a href="index.html#sect-Adding_and_Removing_Services_from_Roles">6.3.3. Adding and Removing Services from Roles</a></li><li class=" leaf"><a href="index.html#sect-Enabling_Disabled_Services">6.3.4. Enabling Disabled Services</a></li><li class=" leaf"><a href="index.html#sect-Creating_a_Generic_Node_with_No_Services">6.3.5. Creating a Generic Node with No Services</a></li></ol></li></ol></li><li class=" leaf"><a href="index.html#sect-Containerized_Services">7. Containerized Services</a><ol class="menu"><li class=" leaf"><a href="index.html#sect-Containerized_Service_Architecture">7.1. Containerized Service Architecture</a></li><li class=" leaf"><a href="index.html#sect-Containerized_Service_Parameters">7.2. Containerized Service Parameters</a></li><li class=" leaf"><a href="index.html#preparing-container-images">7.3. Preparing container images</a></li><li class=" leaf"><a href="index.html#container-image-preparation-parameters">7.4. Container image preparation parameters</a></li><li class=" leaf"><a href="index.html#layering-image-preparation-entries">7.5. Layering image preparation entries</a></li><li class=" leaf"><a href="index.html#modifying-images-during-preparation">7.6. Modifying images during preparation</a></li><li class=" leaf"><a href="index.html#updating-existing-packages-on-container-images">7.7. Updating existing packages on container images</a></li><li class=" leaf"><a href="index.html#installing-additional-rpm-files-to-container-images">7.8. Installing additional RPM files to container images</a></li><li class=" leaf"><a href="index.html#modifying-container-images-with-a-custom-dockerfile">7.9. Modifying container images with a custom Dockerfile</a></li></ol></li><li class=" leaf"><a href="index.html#basic-network-isolation">8. Basic network isolation</a><ol class="menu"><li class=" leaf"><a href="index.html#network-isolation">8.1. Network isolation</a></li><li class=" leaf"><a href="index.html#modifying-isolated-network-configuration">8.2. Modifying isolated network configuration</a></li><li class=" leaf"><a href="index.html#network-interface-templates">8.3. Network Interface Templates</a></li><li class=" leaf"><a href="index.html#default-network-interface-templates">8.4. Default network interface templates</a></li><li class=" leaf"><a href="index.html#enabling-basic-network-isolation">8.5. Enabling basic network isolation</a></li></ol></li><li class=" leaf"><a href="index.html#custom-composable-networks">9. Custom composable networks</a><ol class="menu"><li class=" leaf"><a href="index.html#composable-networks">9.1. Composable networks</a></li><li class=" leaf"><a href="index.html#adding-a-composable-network">9.2. Adding a composable network</a></li><li class=" leaf"><a href="index.html#including-a-composable-network-in-a-role">9.3. Including a composable network in a role</a></li><li class=" leaf"><a href="index.html#assigning-openstack-services-to-composable-networks">9.4. Assigning OpenStack services to composable networks</a></li><li class=" leaf"><a href="index.html#enabling-custom-composable-networks">9.5. Enabling custom composable networks</a></li><li class=" leaf"><a href="index.html#renaming-default-networks">9.6. Renaming the default networks</a></li></ol></li><li class=" leaf"><a href="index.html#custom-network-interface-templates">10. Custom network interface templates</a><ol class="menu"><li class=" leaf"><a href="index.html#custom-network-architecture">10.1. Custom network architecture</a></li><li class=" leaf"><a href="index.html#rendering-default-network-interface-templates-for-customization">10.2. Rendering default network interface templates for customization</a></li><li class=" leaf"><a href="index.html#network-interface-architecture">10.3. Network interface architecture</a></li><li class=" leaf"><a href="index.html#network-interface-reference">10.4. Network interface reference</a></li><li class=" leaf"><a href="index.html#example-network-interface-layout">10.5. Example network interface layout</a></li><li class=" leaf"><a href="index.html#network_interface_template_considerations_for_custom_networks">10.6. Network interface template considerations for custom networks</a></li><li class=" leaf"><a href="index.html#custom-network-environment-file">10.7. Custom network environment file</a></li><li class=" leaf"><a href="index.html#network-environment-parameters">10.8. Network environment parameters</a></li><li class=" leaf"><a href="index.html#example-custom-network-environment-file">10.9. Example custom network environment file</a></li><li class=" leaf"><a href="index.html#enabling-network-isolation-with-custom-nics">10.10. Enabling network isolation with custom NICs</a></li></ol></li><li class=" leaf"><a href="index.html#additional-network-configuration">11. Additional network configuration</a><ol class="menu"><li class=" leaf"><a href="index.html#configuring-custom-interfaces">11.1. Configuring custom Interfaces</a></li><li class=" leaf"><a href="index.html#configuring-routes-and-default-routes">11.2. Configuring routes and default routes</a></li><li class=" leaf"><a href="index.html#configuring-policy-based-routing">11.3. Configuring policy-based routing</a></li><li class=" leaf"><a href="index.html#configuring-jumbo-frames">11.4. Configuring jumbo frames</a></li><li class=" leaf"><a href="index.html#configuring-the-native-vlan-for-floating-ips">11.5. Configuring the native VLAN for floating IPs</a></li><li class=" leaf"><a href="index.html#configuring-the-native-vlan-on-a-trunked-interface">11.6. Configuring the native VLAN on a trunked interface</a></li></ol></li><li class=" leaf"><a href="index.html#overcloud-network-interface-bonding">12. Network Interface Bonding</a><ol class="menu"><li class=" leaf"><a href="index.html#bonding-overview">12.1. Network Interface Bonding and Link Aggregation Control Protocol (LACP)</a></li><li class=" leaf"><a href="index.html#open-vswitch-bonding-options">12.2. Open vSwitch Bonding Options</a></li><li class=" leaf"><a href="index.html#linux-bonding-options">12.3. Linux bonding options</a></li><li class=" leaf"><a href="index.html#general-bonding-options">12.4. General bonding options</a></li></ol></li><li class=" leaf"><a href="index.html#sect-Controlling_Node_Placement">13. Controlling Node Placement</a><ol class="menu"><li class=" leaf"><a href="index.html#sect-Assign_Specific_Node_IDs">13.1. Assigning Specific Node IDs</a></li><li class=" leaf"><a href="index.html#sect-Custom_Hostnames">13.2. Assigning Custom Hostnames</a></li><li class=" leaf"><a href="index.html#sect-Predictable_IPs">13.3. Assigning Predictable IPs</a></li><li class=" leaf"><a href="index.html#sect-Predictable_VIPs">13.4. Assigning Predictable Virtual IPs</a></li></ol></li><li class=" leaf"><a href="index.html#sect-Enabling_SSLTLS_on_the_Overcloud">14. Enabling SSL/TLS on Overcloud Public Endpoints</a><ol class="menu"><li class=" leaf"><a href="index.html#Initializing_the_Certificate_Authority">14.1. Initializing the Signing Host</a></li><li class=" leaf"><a href="index.html#Creating_a_Certificate_Authority">14.2. Creating a Certificate Authority</a></li><li class=" leaf"><a href="index.html#Adding_the_Certificate_Authority_to_Clients">14.3. Adding the Certificate Authority to Clients</a></li><li class=" leaf"><a href="index.html#Creating_an_SSL_TLS_Key">14.4. Creating an SSL/TLS Key</a></li><li class=" leaf"><a href="index.html#Creating_an_SSL_TLS_Certificate_Signing_Request">14.5. Creating an SSL/TLS Certificate Signing Request</a></li><li class=" leaf"><a href="index.html#Creating_the_SSL_TLS_Certificate">14.6. Creating the SSL/TLS Certificate</a></li><li class=" leaf"><a href="index.html#enabling_ssl_tls">14.7. Enabling SSL/TLS</a></li><li class=" leaf"><a href="index.html#injecting_a_root_certificate">14.8. Injecting a Root Certificate</a></li><li class=" leaf"><a href="index.html#configuring_dns_endpoints">14.9. Configuring DNS endpoints</a></li><li class=" leaf"><a href="index.html#adding_environment_files_during_overcloud_creation">14.10. Adding Environment Files During Overcloud Creation</a></li><li class=" leaf"><a href="index.html#updating_ssl_tls_certificates">14.11. Updating SSL/TLS Certificates</a></li></ol></li><li class=" leaf"><a href="index.html#sect-Enabling_Internal_SSLTLS_on_the_Overcloud">15. Enabling SSL/TLS on Internal and Public Endpoints with Identity Management</a><ol class="menu"><li class=" leaf"><a href="index.html#add_the_undercloud_to_the_ca">15.1. Add the undercloud to the CA</a></li><li class=" leaf"><a href="index.html#add_the_undercloud_to_idm">15.2. Add the undercloud to IdM</a></li><li class=" leaf"><a href="index.html#configure_overcloud_dns">15.3. Configure overcloud DNS</a></li><li class=" leaf"><a href="index.html#configure_overcloud_to_use_novajoin">15.4. Configure overcloud to use novajoin</a></li></ol></li><li class=" leaf"><a href="index.html#sect-tripleo-ipa">16. Implementing TLS-e with Ansible</a><ol class="menu"><li class=" leaf"><a href="index.html#configuring_tls_e_on_the_undercloud">16.1. Configuring TLS-e on the undercloud</a></li><li class=" leaf"><a href="index.html#configuring_tls_e_on_the_overcloud">16.2. Configuring TLS-e on the overcloud</a></li></ol></li><li class=" leaf"><a href="index.html#chap-Debug_Modes">17. Debug Modes</a></li><li class=" leaf"><a href="index.html#chap-Policies">18. Policies</a></li><li class=" leaf"><a href="index.html#storage_configuration">19. Storage Configuration</a><ol class="menu"><li class=" leaf"><a href="index.html#sect-Configuring_NFS_Storage">19.1. Configuring NFS Storage</a></li><li class=" leaf"><a href="index.html#sect-Configuring_Ceph_Storage">19.2. Configuring Ceph Storage</a></li><li class=" leaf"><a href="index.html#sect-Standalone_Swift_Cluster">19.3. Using an External Object Storage Cluster</a></li><li class=" leaf"><a href="index.html#configuring_ceph_object_store_to_use_external_ceph_object_gateway">19.4. Configuring Ceph Object Store to use external Ceph Object Gateway</a></li><li class=" leaf"><a href="index.html#sect-configure-image-import">19.5. Configuring the Image Import Method and Shared Staging Area</a><ol class="menu"><li class=" leaf"><a href="index.html#sect-create-glance-settings">19.5.1. Creating and Deploying the glance-settings.yaml File</a></li><li class=" leaf"><a href="index.html#sect-glance-import-white-black-list-settings">19.5.2. Controlling Image Web-Import Sources</a></li><li class=" leaf"><a href="index.html#sect-glance-import-inject-metadata">19.5.3. Injecting Metadata on Image Import to Control Where VMs Launch</a></li></ol></li><li class=" leaf"><a href="index.html#sect-cinder-backend-glance">19.6. Configuring cinder back end for the Image service</a></li><li class=" leaf"><a href="index.html#sect-Config_max_disk_devices_to_attach">19.7. Configuring the maximum number of storage devices to attach to one instance</a></li><li class=" leaf"><a href="index.html#section-image-service-caching">19.8. Improving scalability with Image service caching</a></li><li class=" leaf"><a href="index.html#sect-Configuring_Third_Party_Storage">19.9. Configuring Third Party Storage</a></li></ol></li><li class=" leaf"><a href="index.html#sect-Security_Enhancements">20. Security Enhancements</a><ol class="menu"><li class=" leaf"><a href="index.html#managing_the_overcloud_firewall">20.1. Managing the Overcloud Firewall</a></li><li class=" leaf"><a href="index.html#changing_the_simple_network_management_protocol_snmp_strings">20.2. Changing the Simple Network Management Protocol (SNMP) Strings</a></li><li class=" leaf"><a href="index.html#changing_the_ssl_tls_cipher_and_rules_for_haproxy">20.3. Changing the SSL/TLS Cipher and Rules for HAProxy</a></li><li class=" leaf"><a href="index.html#sect_OVS_Firewall">20.4. Using the Open vSwitch Firewall</a></li><li class=" leaf"><a href="index.html#enabling_root_user_access">20.5. Using Secure Root User Access</a></li></ol></li><li class=" leaf"><a href="index.html#sect-Monitoring_Tools_Configuration">21. Configuring Monitoring Tools</a></li><li class=" leaf"><a href="index.html#sect-Network_Plugins">22. Configuring Network Plugins</a><ol class="menu"><li class=" leaf"><a href="index.html#fujitsu_converged_fabric_c_fabric">22.1. Fujitsu Converged Fabric (C-Fabric)</a></li><li class=" leaf"><a href="index.html#fujitsu_fos_switch">22.2. Fujitsu FOS Switch</a></li></ol></li><li class=" leaf"><a href="index.html#sect-Identity_Configuration">23. Configuring Identity</a><ol class="menu"><li class=" leaf"><a href="index.html#region_name">23.1. Region Name</a></li></ol></li><li class=" leaf"><a href="index.html#other_configurations">24. Other Configurations</a><ol class="menu"><li class=" leaf"><a href="index.html#configuring-the-kernel-on-overcloud-nodes">24.1. Configuring the kernel on overcloud nodes</a></li><li class=" leaf"><a href="index.html#sect-Configuring_External_Load_Balancing">24.2. Configuring External Load Balancing</a></li><li class=" leaf"><a href="index.html#sect-Configuring_IPv6_Networking">24.3. Configuring IPv6 Networking</a></li></ol></li><li class=" leaf"><a href="index.html#idm140097851105392">Legal Notice</a></li></ol>  </div>
</nav>


  <div class="doc-wrapper">
    <div class="panel-pane pane-page-title"  >
  
      
  
  <h1 class="title" itemprop="name">Advanced Overcloud Customization</h1>
  
  </div>
<div class="panel-pane pane-page-body"  >
  
      
  
  <div class="body"><div xml:lang="en-US" class="book" id="idm140097849182192"><div class="titlepage"><div><div class="producttitle"><span class="productname">Red Hat OpenStack Platform</span> <span class="productnumber">16.1</span></div><div><h2 class="subtitle">Methods for configuring advanced features using Red Hat OpenStack Platform director</h2></div><div><div xml:lang="en-US" class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">OpenStack</span> <span class="othername">Documentation</span> <span class="surname">Team</span></h3><code class="email"><a class="email" href="mailto:rhos-docs@redhat.com">rhos-docs@redhat.com</a></code></div></div></div><div><a href="index.html#idm140097851105392">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				This guide explains how to configure certain advanced features for a Red Hat OpenStack Platform enterprise environment using the Red Hat OpenStack Platform Director. This includes features such as network isolation, storage configuration, SSL communication, and general configuration methods.
			</div></div></div></div><hr/></div><section class="chapter" id="chap-Introduction"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Introduction</h1></div></div></div><p>
			The Red Hat OpenStack Platform director provides a set of tools to provision and create a fully featured OpenStack environment, also known as the overcloud. The <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/director_installation_and_usage/"><span class="emphasis"><em>Director Installation and Usage Guide</em></span></a> covers the preparation and configuration of the overcloud. However, a proper production-level overcloud might require additional configuration, including:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Basic network configuration to integrate the overcloud into your existing network infrastructure.
				</li><li class="listitem">
					Network traffic isolation on separate VLANs for certain OpenStack network traffic types.
				</li><li class="listitem">
					SSL configuration to secure communication on public endpoints
				</li><li class="listitem">
					Storage options such as NFS, iSCSI, Red Hat Ceph Storage, and multiple third-party storage devices.
				</li><li class="listitem">
					Registration of nodes to the Red Hat Content Delivery Network or your internal Red Hat Satellite 5 or 6 server.
				</li><li class="listitem">
					Various system-level options.
				</li><li class="listitem">
					Various OpenStack service options.
				</li></ul></div><p>
			This guide provides instructions for augmenting your Overcloud through the director. At this point, the director has registered the nodes and configured the necessary services for Overcloud creation. Now you can customize your Overcloud using the methods in this guide.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				The examples in this guide are optional steps for configuring the overcloud. These steps are only required to provide the overcloud with additional functionality. Use the steps that apply to the needs of your environment.
			</p></div></div></section><section class="chapter" id="sect-Understanding_Heat_Templates"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Understanding Heat Templates</h1></div></div></div><p>
			The custom configurations in this guide use Heat templates and environment files to define certain aspects of the Overcloud. This chapter provides a basic introduction to Heat templates so that you can understand the structure and format of these templates in the context of the Red Hat OpenStack Platform director.
		</p><section class="section" id="sect-Heat_Templates"><div class="titlepage"><div><div><h2 class="title">2.1. Heat Templates</h2></div></div></div><p>
				The director uses Heat Orchestration Templates (HOT) as a template format for its Overcloud deployment plan. Templates in HOT format are usually expressed in YAML format. The purpose of a template is to define and create a <span class="emphasis"><em>stack</em></span>, which is a collection of resources that Heat creates, and the configuration of the resources. Resources are objects in OpenStack and can include compute resources, network configuration, security groups, scaling rules, and custom resources.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The Heat template file extension must be <code class="literal">.yaml</code> or <code class="literal">.template</code>, or it will not be treated as a custom template resource.
				</p></div></div><p>
				The structure of a Heat template has three main sections:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Parameters</span></dt><dd>
							These are settings passed to Heat, which provide a way to customize a stack, and any default values for parameters without passed values. These settings are defined in the <code class="literal">parameters</code> section of a template.
						</dd><dt><span class="term">Resources</span></dt><dd>
							These are the specific objects to create and configure as part of a stack. OpenStack contains a set of core resources that span across all components. These are defined in the <code class="literal">resources</code> section of a template.
						</dd><dt><span class="term">Output</span></dt><dd>
							These are values passed from Heat after the creation of the stack. You can access these values either through the Heat API or client tools. These are defined in the <code class="literal">output</code> section of a template.
						</dd></dl></div><p>
				Here is an example of a basic Heat template:
			</p><pre class="screen">heat_template_version: 2013-05-23

description: &gt; A very basic Heat template.

parameters:
  key_name:
    type: string
    default: lars
    description: Name of an existing key pair to use for the instance
  flavor:
    type: string
    description: Instance type for the instance to be created
    default: m1.small
  image:
    type: string
    default: cirros
    description: ID or name of the image to use for the instance

resources:
  my_instance:
    type: OS::Nova::Server
    properties:
      name: My Cirros Instance
      image: { get_param: image }
      flavor: { get_param: flavor }
      key_name: { get_param: key_name }

output:
  instance_name:
    description: Get the instance's name
    value: { get_attr: [ my_instance, name ] }</pre><p>
				This template uses the resource type <code class="literal">type: OS::Nova::Server</code> to create an instance called <code class="literal">my_instance</code> with a particular flavor, image, and key. The stack can return the value of <code class="literal">instance_name</code>, which is called <code class="literal">My Cirros Instance</code>.
			</p><p>
				When Heat processes a template it creates a stack for the template and a set of child stacks for resource templates. This creates a hierarchy of stacks that descend from the main stack you define with your template. You can view the stack hierarchy using this following command:
			</p><pre class="screen">$ openstack stack list --nested</pre></section><section class="section" id="sect-Environment_Files"><div class="titlepage"><div><div><h2 class="title">2.2. Environment Files</h2></div></div></div><p>
				An environment file is a special type of template that provides customization for your Heat templates. This includes three key parts:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Resource Registry</span></dt><dd>
							This section defines custom resource names, linked to other Heat templates. This provides a method to create custom resources that do not exist within the core resource collection. These are defined in the <code class="literal">resource_registry</code> section of an environment file.
						</dd><dt><span class="term">Parameters</span></dt><dd>
							These are common settings you apply to the top-level template’s parameters. For example, if you have a template that deploys nested stacks, such as resource registry mappings, the parameters only apply to the top-level template and not templates for the nested resources. Parameters are defined in the <code class="literal">parameters</code> section of an environment file.
						</dd><dt><span class="term">Parameter Defaults</span></dt><dd>
							These parameters modify the default values for parameters in all templates. For example, if you have a Heat template that deploys nested stacks, such as resource registry mappings,the parameter defaults apply to all templates. The parameter defaults are defined in the <code class="literal">parameter_defaults</code> section of an environment file.
						</dd></dl></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					It is recommended to use <code class="literal">parameter_defaults</code> instead of <code class="literal">parameters</code> When creating custom environment files for your Overcloud. This is so the parameters apply to all stack templates for the Overcloud.
				</p></div></div><p>
				An example of a basic environment file:
			</p><pre class="screen">resource_registry:
  OS::Nova::Server::MyServer: myserver.yaml

parameter_defaults:
  NetworkName: my_network

parameters:
  MyIP: 192.168.0.1</pre><p>
				For example, this environment file (<code class="literal">my_env.yaml</code>) might be included when creating a stack from a certain Heat template (<code class="literal">my_template.yaml</code>). The <code class="literal">my_env.yaml</code> files creates a new resource type called <code class="literal">OS::Nova::Server::MyServer</code>. The <code class="literal">myserver.yaml</code> file is a Heat template file that provides an implementation for this resource type that overrides any built-in ones. You can include the <code class="literal">OS::Nova::Server::MyServer</code> resource in your <code class="literal">my_template.yaml</code> file.
			</p><p>
				The <code class="literal">MyIP</code> applies a parameter only to the main Heat template that deploys along with this environment file. In this example, it only applies to the parameters in <code class="literal">my_template.yaml</code>.
			</p><p>
				The <code class="literal">NetworkName</code> applies to both the main Heat template (in this example, <code class="literal">my_template.yaml</code>) and the templates associated with resources included the main template, such as the <code class="literal">OS::Nova::Server::MyServer</code> resource and its <code class="literal">myserver.yaml</code> template in this example.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The environment file extension must be <code class="literal">.yaml</code> or <code class="literal">.template</code>, or it will not be treated as a custom template resource.
				</p></div></div></section><section class="section" id="sect-Core_Overcloud_Heat_Templates"><div class="titlepage"><div><div><h2 class="title">2.3. Core Overcloud Heat Templates</h2></div></div></div><p>
				The director contains a core Heat template collection for the Overcloud. This collection is stored in <code class="literal">/usr/share/openstack-tripleo-heat-templates</code>.
			</p><p>
				There are many Heat templates and environment files in this collection. However, the main files and directories to note in this template collection are:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">overcloud.j2.yaml</code></span></dt><dd>
							This is the main template file used to create the Overcloud environment. This file uses Jinja2 syntax to iterate over certain sections in the template to create custom roles. The Jinja2 formatting is rendered into YAML during the Overcloud deployment process.
						</dd><dt><span class="term"><code class="literal">overcloud-resource-registry-puppet.j2.yaml</code></span></dt><dd>
							This is the main environment file used to create the Overcloud environment. It provides a set of configurations for Puppet modules stored on the Overcloud image. After the director writes the Overcloud image to each node, Heat starts the Puppet configuration for each node using the resources registered in this environment file. This file uses Jinja2 syntax to iterate over certain sections in the template to create custom roles. The Jinja2 formatting is rendered into YAML during the overcloud deployment process.
						</dd><dt><span class="term"><code class="literal">roles_data.yaml</code></span></dt><dd>
							A file that defines the roles in an overcloud and maps services to each role.
						</dd><dt><span class="term"><code class="literal">network_data.yaml</code></span></dt><dd>
							A file that defines the networks in an overcloud and their properties such as subnets, allocation pools, and VIP status. The default <code class="literal">network_data</code> file contains the default networks: External, Internal Api, Storage, Storage Management, Tenant, and Management. You can create a custom <code class="literal">network_data</code> file and add it to your <code class="literal">openstack overcloud deploy</code> command with the <code class="literal">-n</code> option.
						</dd><dt><span class="term"><code class="literal">plan-environment.yaml</code></span></dt><dd>
							A file that defines the metadata for your overcloud plan. This includes the plan name, main template to use, and environment files to apply to the overcloud.
						</dd><dt><span class="term"><code class="literal">capabilities-map.yaml</code></span></dt><dd>
							A mapping of environment files for an overcloud plan. Use this file to describe and enable environment files through the director’s web UI. Custom environment files detected in the <code class="literal">environments</code> directory in an overcloud plan but not defined in the <code class="literal">capabilities-map.yaml</code> are listed in the <span class="strong strong"><strong>Other</strong></span> subtab of <span class="strong strong"><strong>2 Specify Deployment Configuration &gt; Overall Settings</strong></span> on the web UI.
						</dd><dt><span class="term"><code class="literal">environments</code></span></dt><dd>
							Contains additional Heat environment files that you can use with your Overcloud creation. These environment files enable extra functions for your resulting OpenStack environment. For example, the directory contains an environment file for enabling Cinder NetApp backend storage (<code class="literal">cinder-netapp-config.yaml</code>). Any environment files detected in this directory that are not defined in the <code class="literal">capabilities-map.yaml</code> file are listed in the <span class="strong strong"><strong>Other</strong></span> subtab of <span class="strong strong"><strong>2 Specify Deployment Configuration &gt; Overall Settings</strong></span> in the director’s web UI.
						</dd><dt><span class="term"><code class="literal">network</code></span></dt><dd>
							A set of Heat templates to help create isolated networks and ports.
						</dd><dt><span class="term"><code class="literal">puppet</code></span></dt><dd>
							Templates mostly driven by configuration with puppet. The aforementioned <code class="literal">overcloud-resource-registry-puppet.j2.yaml</code> environment file uses the files in this directory to drive the application of the Puppet configuration on each node.
						</dd><dt><span class="term"><code class="literal">puppet/services</code></span></dt><dd>
							A directory containing Heat templates for all services in the composable service architecture.
						</dd><dt><span class="term"><code class="literal">extraconfig</code></span></dt><dd>
							Templates used to enable extra functionality.
						</dd><dt><span class="term"><code class="literal">firstboot</code></span></dt><dd>
							Provides example <code class="literal">first_boot</code> scripts that the director uses when initially creating the nodes.
						</dd></dl></div></section><section class="section" id="plan_environment"><div class="titlepage"><div><div><h2 class="title">2.4. Plan Environment Metadata</h2></div></div></div><p>
				A plan environment metadata file allows you to define metadata about your overcloud plan. This information is used when importing and exporting your overcloud plan, plus used during the overcloud creation from your plan.
			</p><p>
				A plan environment metadata file includes the following parameters:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">version</span></dt><dd>
							The version of the template.
						</dd><dt><span class="term">name</span></dt><dd>
							The name of the overcloud plan and the container in OpenStack Object Storage (swift) used to store the plan files.
						</dd><dt><span class="term">template</span></dt><dd>
							The core parent template to use for the overcloud deployment. This is most often <code class="literal">overcloud.yaml</code>, which is the rendered version of the <code class="literal">overcloud.yaml.j2</code> template.
						</dd><dt><span class="term">environments</span></dt><dd>
							Defines a list of environment files to use. Specify the path of each environment file with the <code class="literal">path</code> sub-parameter.
						</dd><dt><span class="term">parameter_defaults</span></dt><dd>
							A set of parameters to use in your overcloud. This functions in the same way as the <code class="literal">parameter_defaults</code> section in a standard environment file.
						</dd><dt><span class="term">passwords</span></dt><dd>
							A set of parameters to use for overcloud passwords. This functions in the same way as the <code class="literal">parameter_defaults</code> section in a standard environment file. Usually, the director automatically populates this section with randomly generated passwords.
						</dd><dt><span class="term">workflow_parameters</span></dt><dd>
							Allows you to provide a set of parameters to OpenStack Workflow (mistral) namespaces. You can use this to calculate and automatically generate certain overcloud parameters.
						</dd></dl></div><p>
				The following is an example of the syntax of a plan environment file:
			</p><pre class="screen">version: 1.0
name: myovercloud
description: 'My Overcloud Plan'
template: overcloud.yaml
environments:
- path: overcloud-resource-registry-puppet.yaml
- path: environments/containers-default-parameters.yaml
- path: user-environment.yaml
parameter_defaults:
  ControllerCount: 1
  ComputeCount: 1
  OvercloudComputeFlavor: compute
  OvercloudControllerFlavor: control
workflow_parameters:
  tripleo.derive_params.v1.derive_parameters:
    num_phy_cores_per_numa_node_for_pmd: 2</pre><p>
				You can include the plan environment metadata file with the <code class="literal">openstack overcloud deploy</code> command using the <code class="literal">-p</code> option. For example:
			</p><pre class="screen">(undercloud) $ openstack overcloud deploy --templates \
  -p /my-plan-environment.yaml \
  [OTHER OPTIONS]</pre><p>
				You can also view plan metadata for an existing overcloud plan using the following command:
			</p><pre class="screen">(undercloud) $ openstack object save overcloud plan-environment.yaml --file -</pre></section><section class="section" id="sect-Including_Environment_Files_in_Overcloud_Creation"><div class="titlepage"><div><div><h2 class="title">2.5. Including Environment Files in Overcloud Creation</h2></div></div></div><p>
				The deployment command (<code class="literal">openstack overcloud deploy</code>) uses the <code class="literal">-e</code> option to include an environment file to customize your Overcloud. You can include as many environment files as necessary. However, the order of the environment files is important as the parameters and resources defined in subsequent environment files take precedence. For example, you might have two environment files:
			</p><div class="formalpara"><p class="title"><strong>environment-file-1.yaml</strong></p><p>
					
<pre class="screen">resource_registry:
  OS::TripleO::NodeExtraConfigPost: /home/stack/templates/template-1.yaml

parameter_defaults:
  RabbitFDLimit: 65536
  TimeZone: 'Japan'</pre>

				</p></div><div class="formalpara"><p class="title"><strong>environment-file-2.yaml</strong></p><p>
					
<pre class="screen">resource_registry:
  OS::TripleO::NodeExtraConfigPost: /home/stack/templates/template-2.yaml

parameter_defaults:
  TimeZone: 'Hongkong'</pre>

				</p></div><p>
				Then deploy with both environment files included:
			</p><pre class="screen">$ openstack overcloud deploy --templates -e environment-file-1.yaml -e environment-file-2.yaml</pre><p>
				In this example, both environment files contain a common resource type (<code class="literal">OS::TripleO::NodeExtraConfigPost</code>) and a common parameter (<code class="literal">TimeZone</code>). The <code class="literal">openstack overcloud deploy</code> command runs through the following process:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Loads the default configuration from the core Heat template collection as per the <code class="literal">--template</code> option.
					</li><li class="listitem">
						Applies the configuration from <code class="literal">environment-file-1.yaml</code>, which overrides any common settings from the default configuration.
					</li><li class="listitem">
						Applies the configuration from <code class="literal">environment-file-2.yaml</code>, which overrides any common settings from the default configuration and <code class="literal">environment-file-1.yaml</code>.
					</li></ol></div><p>
				This results in the following changes to the default configuration of the Overcloud:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">OS::TripleO::NodeExtraConfigPost</code> resource is set to <code class="literal">/home/stack/templates/template-2.yaml</code> as per <code class="literal">environment-file-2.yaml</code>.
					</li><li class="listitem">
						<code class="literal">TimeZone</code> parameter is set to <code class="literal">Hongkong</code> as per <code class="literal">environment-file-2.yaml</code>.
					</li><li class="listitem">
						<code class="literal">RabbitFDLimit</code> parameter is set to <code class="literal">65536</code> as per <code class="literal">environment-file-1.yaml</code>. <code class="literal">environment-file-2.yaml</code> does not change this value.
					</li></ul></div><p>
				This provides a method for defining custom configuration to the your Overcloud without values from multiple environment files conflicting.
			</p></section><section class="section" id="sect-Using_Customized_Overcloud_Heat_Templates"><div class="titlepage"><div><div><h2 class="title">2.6. Using Customized Core Heat Templates</h2></div></div></div><p>
				When creating the overcloud, the director uses a core set of Heat templates located in <code class="literal">/usr/share/openstack-tripleo-heat-templates</code>. If you want to customize this core template collection, use a Git workflow to track changes and merge updates. Use the following git processes to help manage your custom template collection:
			</p><div class="formalpara"><p class="title"><strong>Initializing a Custom Template Collection</strong></p><p>
					Use the following procedure to create an initial Git repository containing the Heat template collection:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Copy the template collection to the <code class="literal">stack</code> users directory. This example copies the collection to the <code class="literal">~/templates</code> directory:
					</p><pre class="screen">$ cd ~/templates
$ cp -r /usr/share/openstack-tripleo-heat-templates .</pre></li><li class="listitem"><p class="simpara">
						Change to the custom template directory and initialize a Git repository:
					</p><pre class="screen">$ cd openstack-tripleo-heat-templates
$ git init .</pre></li><li class="listitem"><p class="simpara">
						Configure your Git user name and email address:
					</p><pre class="screen">$ git config --global user.name "&lt;USER_NAME&gt;"
$ git config --global user.email "&lt;EMAIL_ADDRESS&gt;"</pre><p class="simpara">
						Replace <code class="literal">&lt;USER_NAME&gt;</code> with the user name that you want to use. Replace <code class="literal">&lt;EMAIL_ADDRESS&gt;</code> with your email address.
					</p></li><li class="listitem"><p class="simpara">
						Stage all templates for the initial commit:
					</p><pre class="screen">$ git add *</pre></li><li class="listitem"><p class="simpara">
						Create an initial commit:
					</p><pre class="screen">$ git commit -m "Initial creation of custom core heat templates"</pre></li></ol></div><p>
				This creates an initial <code class="literal">master</code> branch containing the latest core template collection. Use this branch as the basis for your custom branch and merge new template versions to this branch.
			</p><div class="formalpara"><p class="title"><strong>Creating a Custom Branch and Committing Changes</strong></p><p>
					Use a custom branch to store your changes to the core template collection. Use the following procedure to create a <code class="literal">my-customizations</code> branch and add customizations to it:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create the <code class="literal">my-customizations</code> branch and switch to it:
					</p><pre class="screen">$ git checkout -b my-customizations</pre></li><li class="listitem">
						Edit the files in the custom branch.
					</li><li class="listitem"><p class="simpara">
						Stage the changes in git:
					</p><pre class="screen">$ git add <span class="emphasis"><em>[edited files]</em></span></pre></li><li class="listitem"><p class="simpara">
						Commit the changes to the custom branch:
					</p><pre class="screen">$ git commit -m "<span class="emphasis"><em>[Commit message for custom changes]</em></span>"</pre></li></ol></div><p>
				This adds your changes as commits to the <code class="literal">my-customizations</code> branch. When the <code class="literal">master</code> branch updates, you can rebase <code class="literal">my-customizations</code> off <code class="literal">master</code>, which causes git to add these commits on to the updated template collection. This helps track your customizations and replay them on future template updates.
			</p><div class="formalpara"><p class="title"><strong>Updating the Custom Template Collection:</strong></p><p>
					When updating the undercloud, the <code class="literal">openstack-tripleo-heat-templates</code> package might also update. When this occurs, use the following procedure to update your custom template collection:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Save the <code class="literal">openstack-tripleo-heat-templates</code> package version as an environment variable:
					</p><pre class="screen">$ export PACKAGE=$(rpm -qv openstack-tripleo-heat-templates)</pre></li><li class="listitem"><p class="simpara">
						Change to your template collection directory and create a new branch for the updated templates:
					</p><pre class="screen">$ cd ~/templates/openstack-tripleo-heat-templates
$ git checkout -b $PACKAGE</pre></li><li class="listitem"><p class="simpara">
						Remove all files in the branch and replace them with the new versions:
					</p><pre class="screen">$ git rm -rf *
$ cp -r /usr/share/openstack-tripleo-heat-templates/* .</pre></li><li class="listitem"><p class="simpara">
						Add all templates for the initial commit:
					</p><pre class="screen">$ git add *</pre></li><li class="listitem"><p class="simpara">
						Create a commit for the package update:
					</p><pre class="screen">$ git commit -m "Updates for $PACKAGE"</pre></li><li class="listitem"><p class="simpara">
						Merge the branch into master. If you use a Git management system (such as GitLab), use the management workflow. If you use git locally, merge by switching to the <code class="literal">master</code> branch and run the <code class="literal">git merge</code> command:
					</p><pre class="screen">$ git checkout master
$ git merge $PACKAGE</pre></li></ol></div><p>
				The <code class="literal">master</code> branch now contains the latest version of the core template collection. You can now rebase the <code class="literal">my-customization</code> branch from this updated collection.
			</p><div class="formalpara"><p class="title"><strong>Rebasing the Custom Branch</strong></p><p>
					Use the following procedure to update the <code class="literal">my-customization</code> branch,:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Change to the <code class="literal">my-customizations</code> branch:
					</p><pre class="screen">$ git checkout my-customizations</pre></li><li class="listitem"><p class="simpara">
						Rebase the branch off <code class="literal">master</code>:
					</p><pre class="screen">$ git rebase master</pre></li></ol></div><p>
				This updates the <code class="literal">my-customizations</code> branch and replays the custom commits made to this branch.
			</p><p>
				If git reports any conflicts during the rebase, use this procedure:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Check which files contain the conflicts:
					</p><pre class="screen">$ git status</pre></li><li class="listitem">
						Resolve the conflicts of the template files identified.
					</li><li class="listitem"><p class="simpara">
						Add the resolved files:
					</p><pre class="screen">$ git add <span class="emphasis"><em>[resolved files]</em></span></pre></li><li class="listitem"><p class="simpara">
						Continue the rebase:
					</p><pre class="screen">$ git rebase --continue</pre></li></ol></div><div class="formalpara"><p class="title"><strong>Deploying Custom Templates</strong></p><p>
					Use the following procedure to deploy the custom template collection:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Ensure that you have switched to the <code class="literal">my-customization</code> branch:
					</p><pre class="screen">git checkout my-customizations</pre></li><li class="listitem"><p class="simpara">
						Run the <code class="literal">openstack overcloud deploy</code> command with the <code class="literal">--templates</code> option to specify your local template directory:
					</p><pre class="screen">$ openstack overcloud deploy --templates /home/stack/templates/openstack-tripleo-heat-templates <span class="emphasis"><em>[OTHER OPTIONS]</em></span></pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The director uses the default template directory (<code class="literal">/usr/share/openstack-tripleo-heat-templates</code>) if you specify the <code class="literal">--templates</code> option without a directory.
				</p></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Red Hat recommends using the methods in <a class="xref" href="index.html#chap-Configuration_Hooks" title="Chapter 4. Configuration Hooks">Chapter 4, <em>Configuration Hooks</em></a> instead of modifying the Heat template collection.
				</p></div></div></section><section class="section" id="jinja2-rendering"><div class="titlepage"><div><div><h2 class="title">2.7. Jinja2 rendering</h2></div></div></div><p>
				The core Heat templates in <code class="literal">/usr/share/openstack-tripleo-heat-templates</code> contains a number of files ending with a <code class="literal">j2.yaml</code> extension. These files contain Jinja2 template syntax and the director renders these files to their static Heat template equivalents ending in <code class="literal">.yaml</code>. For example, the main <code class="literal">overcloud.j2.yaml</code> file renders into <code class="literal">overcloud.yaml</code>. The director uses the resulting <code class="literal">overcloud.yaml</code> file.
			</p><p>
				The Jinja2-enabled Heat templates use Jinja2 syntax to create parameters and resources for iterative values. For example, the <code class="literal">overcloud.j2.yaml</code> file contains the following snippet:
			</p><pre class="screen">parameters:
...
{% for role in roles %}
  ...
  {{role.name}}Count:
    description: Number of {{role.name}} nodes to deploy
    type: number
    default: {{role.CountDefault|default(0)}}
  ...
{% endfor %}</pre><p>
				When the director renders the Jinja2 syntax, the director iterates over the roles defined in the <code class="literal">roles_data.yaml</code> file and populates the <code class="literal">{{role.name}}Count</code> parameter with the name of the role. The default <code class="literal">roles_data.yaml</code> file contains five roles and results in the the following parameters from our example:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">ControllerCount</code>
					</li><li class="listitem">
						<code class="literal">ComputeCount</code>
					</li><li class="listitem">
						<code class="literal">BlockStorageCount</code>
					</li><li class="listitem">
						<code class="literal">ObjectStorageCount</code>
					</li><li class="listitem">
						<code class="literal">CephStorageCount</code>
					</li></ul></div><p>
				A example rendered version of the parameter looks like this:
			</p><pre class="screen">parameters:
  ...
  ControllerCount:
    description: Number of Controller nodes to deploy
    type: number
    default: 1
  ...</pre><p>
				The director only renders Jinja2-enabled templates and environment files within the directory of your core Heat templates. The following use cases demonstrate the correct method to render the Jinja2 templates.
			</p><div class="formalpara"><p class="title"><strong>Use case 1: Default core templates</strong></p><p>
					<span class="strong strong"><strong>Template directory:</strong></span> <code class="literal">/usr/share/openstack-tripleo-heat-templates/</code>
				</p></div><p>
				<span class="strong strong"><strong>Environment file:</strong></span> <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/network-isolation.j2.yaml</code>
			</p><p>
				The director uses the default core template location (<code class="literal">--templates</code>). The director renders the <code class="literal">network-isolation.j2.yaml</code> file into <code class="literal">network-isolation.yaml</code>. When running the <code class="literal">openstack overcloud deploy</code> command, use the <code class="literal">-e</code> option to include the name of rendered <code class="literal">network-isolation.yaml</code> file.
			</p><pre class="screen">$ openstack ovecloud deploy --templates \
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml
    ...</pre><div class="formalpara"><p class="title"><strong>Use case 2: Custom core templates</strong></p><p>
					<span class="strong strong"><strong>Template directory:</strong></span> <code class="literal">/home/stack/tripleo-heat-templates</code>
				</p></div><p>
				<span class="strong strong"><strong>Environment file:</strong></span> <code class="literal">/home/stack/tripleo-heat-templates/environments/network-isolation.j2.yaml</code>
			</p><p>
				The director uses a custom core template location (<code class="literal">--templates /home/stack/tripleo-heat-templates</code>). The director renders the <code class="literal">network-isolation.j2.yaml</code> file within the custom core templates into <code class="literal">network-isolation.yaml</code>. When running the <code class="literal">openstack overcloud deploy</code> command, use the <code class="literal">-e</code> option to include the name of rendered <code class="literal">network-isolation.yaml</code> file.
			</p><pre class="screen">$ openstack ovecloud deploy --templates /home/stack/tripleo-heat-templates \
    -e /home/stack/tripleo-heat-templates/environments/network-isolation.yaml
    ...</pre><div class="formalpara"><p class="title"><strong>Use case 3: Incorrect usage</strong></p><p>
					<span class="strong strong"><strong>Template directory:</strong></span> <code class="literal">/usr/share/openstack-tripleo-heat-templates/</code>
				</p></div><p>
				<span class="strong strong"><strong>Environment file:</strong></span> <code class="literal">/home/stack/tripleo-heat-templates/environments/network-isolation.j2.yaml</code>
			</p><p>
				This director uses a custom core template location (<code class="literal">--templates /home/stack/tripleo-heat-templates</code>). However, the chosen <code class="literal">network-isolation.j2.yaml</code> is not located within the custom core templates, so it <span class="emphasis"><em>will not</em></span> render into <code class="literal">network-isolation.yaml</code>. This causes the deployment to fail.
			</p></section></section><section class="chapter" id="sect-Configuring_Base_Parameters"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Parameters</h1></div></div></div><p>
			Each Heat template in the director’s template collection contains a <code class="literal">parameters</code> section. This section defines all parameters specific to a particular overcloud service. This includes the following:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					<code class="literal">overcloud.j2.yaml</code> - Default base parameters
				</li><li class="listitem">
					<code class="literal">roles_data.yaml</code> - Default parameters for composable roles
				</li><li class="listitem">
					<code class="literal">deployment/*.yaml</code> - Default parameters for specific services
				</li></ul></div><p>
			You can modify the values for these parameters using the following method:
		</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
					Create an environment file for your custom parameters.
				</li><li class="listitem">
					Include your custom parameters in the <code class="literal">parameter_defaults</code> section of the environment file.
				</li><li class="listitem">
					Include the environment file with the <code class="literal">openstack overcloud deploy</code> command.
				</li></ol></div><p>
			The next few sections contain examples to demonstrate how to configure specific parameters for services in the <code class="literal">deployment</code> directory.
		</p><section class="section" id="example_1_configuring_the_time_zone"><div class="titlepage"><div><div><h2 class="title">3.1. Example 1: Configuring the time zone</h2></div></div></div><p>
				The Heat template for setting the time zone (<code class="literal">deployment/time/timezone-baremetal-ansible.yaml</code>) contains a <code class="literal">TimeZone</code> parameter. If you leave the <code class="literal">TimeZone</code> parameter blank, the overcloud sets the time zone to <code class="literal">UTC</code> by default. The director recognizes the standard time zone names defined in the time zone database <code class="literal">/usr/share/zoneinfo/</code>. For example, if you want to set your time zone to <code class="literal">Japan</code>, examine the contents of <code class="literal">/usr/share/zoneinfo</code> to locate a suitable entry:
			</p><pre class="screen">$ ls /usr/share/zoneinfo/
Africa      Asia       Canada   Cuba   EST      GB       GMT-0      HST      iso3166.tab  Kwajalein  MST      NZ-CHAT   posix       right      Turkey     UTC       Zulu
America     Atlantic   CET      EET    EST5EDT  GB-Eire  GMT+0      Iceland  Israel       Libya      MST7MDT  Pacific   posixrules  ROC        UCT        WET
Antarctica  Australia  Chile    Egypt  Etc      GMT      Greenwich  Indian   Jamaica      MET        Navajo   Poland    PRC         ROK        Universal  W-SU
Arctic      Brazil     CST6CDT  Eire   Europe   GMT0     Hongkong   Iran     Japan        Mexico     NZ       Portugal  PST8PDT     Singapore  US         zone.tab</pre><p>
				The output listed above includes time zone files and directories containing additional time zone files. For example, <code class="literal">Japan</code> is an individual time zone file in this result, but <code class="literal">Africa</code> is a directory containing additional time zone files:
			</p><pre class="screen">$ ls /usr/share/zoneinfo/Africa/
Abidjan      Algiers  Bamako  Bissau       Bujumbura   Ceuta    Dar_es_Salaam  El_Aaiun  Harare        Kampala   Kinshasa    Lome        Lusaka  Maseru     Monrovia  Niamey       Porto-Novo  Tripoli
Accra        Asmara   Bangui  Blantyre     Cairo       Conakry  Djibouti       Freetown  Johannesburg  Khartoum  Lagos       Luanda      Malabo  Mbabane    Nairobi   Nouakchott   Sao_Tome    Tunis
Addis_Ababa  Asmera   Banjul  Brazzaville  Casablanca  Dakar    Douala         Gaborone  Juba          Kigali    Libreville  Lubumbashi  Maputo  Mogadishu  Ndjamena  Ouagadougou  Timbuktu    Windhoek</pre><p>
				Add the entry in an environment file to set your time zone to <code class="literal">Japan</code>:
			</p><pre class="screen">parameter_defaults:
  TimeZone: 'Japan'</pre></section><section class="section" id="example_2_enabling_networking_distributed_virtual_routing_dvr"><div class="titlepage"><div><div><h2 class="title">3.2. Example 2: Enabling Networking Distributed Virtual Routing (DVR)</h2></div></div></div><p>
				DVR is enabled by default in new ML2/OVN deployments and disabled by default in new ML2/OVS deployments. The Heat template for the OpenStack Networking (neutron) API (<code class="literal">deployment/neutron/neutron-api-container-puppet.yaml</code>) contains a parameter to enable and disable Distributed Virtual Routing (DVR). To disable DVR, use the following in an environment file:
			</p><pre class="screen">parameter_defaults:
  NeutronEnableDVR: false</pre></section><section class="section" id="example_3_configuring_rabbitmq_file_descriptor_limit"><div class="titlepage"><div><div><h2 class="title">3.3. Example 3: Configuring RabbitMQ File Descriptor Limit</h2></div></div></div><p>
				For certain configurations, you might need to increase the file descriptor limit for the RabbitMQ server. The <code class="literal">deployment/rabbitmq/rabbitmq-container-puppet.yaml</code> Heat template allows you to set the <code class="literal">RabbitFDLimit</code> parameter to the limit you require. Add the following to an environment file:
			</p><pre class="screen">parameter_defaults:
  RabbitFDLimit: 65536</pre></section><section class="section" id="example_4_enabling_and_disabling_parameters"><div class="titlepage"><div><div><h2 class="title">3.4. Example 4: Enabling and Disabling Parameters</h2></div></div></div><p>
				You might need to initially set a parameter during a deployment, then disable the parameter for a future deployment operation, such as updates or scaling operations. For example, to include a custom RPM during the overcloud creation, include the following:
			</p><pre class="screen">parameter_defaults:
  DeployArtifactURLs: ["http://www.example.com/myfile.rpm"]</pre><p>
				To disable this parameter from a future deployment, it is not enough to remove the parameter. Instead, you set the parameter to an empty value:
			</p><pre class="screen">parameter_defaults:
  DeployArtifactURLs: []</pre><p>
				This ensures the parameter is no longer set for subsequent deployments operations.
			</p></section><section class="section" id="identifying_parameters_to_modify"><div class="titlepage"><div><div><h2 class="title">3.5. Identifying Parameters to Modify</h2></div></div></div><p>
				Red Hat OpenStack Platform director provides many parameters for configuration. In some cases, you might experience difficulty identifying a certain option to configure and the corresponding director parameter. If there is an option you want to configure through the director, use the following workflow to identify and map the option to a specific overcloud parameter:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Identify the option you aim to configure. Make a note of the service that uses the option.
					</li><li class="listitem"><p class="simpara">
						Check the corresponding Puppet module for this option. The Puppet modules for Red Hat OpenStack Platform are located under <code class="literal">/etc/puppet/modules</code> on the director node. Each module corresponds to a particular service. For example, the <code class="literal">keystone</code> module corresponds to the OpenStack Identity (keystone).
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								If the Puppet module contains a variable that controls the chosen option, move to the next step.
							</li><li class="listitem">
								If the Puppet module does not contain a variable that controls the chosen option, no hieradata exists for this option. If possible, you can set the option manually after the overcloud completes deployment.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Check the director’s core Heat template collection for the Puppet variable in the form of hieradata. The templates in <code class="literal">deployment/*</code> usually correspond to the Puppet modules of the same services. For example, the <code class="literal">deployment/keystone/keystone-container-puppet.yaml</code> template provides hieradata to the <code class="literal">keystone</code> module.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								If the Heat template sets hieradata for the Puppet variable, the template should also disclose the director-based parameter to modify.
							</li><li class="listitem">
								If the Heat template does not set hieradata for the Puppet variable, use the configuration hooks to pass the hieradata using an environment file. See <a class="xref" href="index.html#sect-Customizing_Puppet_Configuration_Data" title="4.5. Puppet: Customizing Hieradata for Roles">Section 4.5, “Puppet: Customizing Hieradata for Roles”</a> for more information on customizing hieradata.
							</li></ul></div></li></ol></div><div class="formalpara"><p class="title"><strong>Workflow Example</strong></p><p>
					To change the notification format for OpenStack Identity (keystone), use the workflow and complete the following steps:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Identify the OpenStack parameter to configure (<code class="literal">notification_format</code>).
					</li><li class="listitem"><p class="simpara">
						Search the <code class="literal">keystone</code> Puppet module for the <code class="literal">notification_format</code> setting. For example:
					</p><pre class="screen">$ grep notification_format /etc/puppet/modules/keystone/manifests/*</pre><p class="simpara">
						In this case, the <code class="literal">keystone</code> module manages this option using the <code class="literal">keystone::notification_format</code> variable.
					</p></li><li class="listitem"><p class="simpara">
						Search the <code class="literal">keystone</code> service template for this variable. For example:
					</p><pre class="screen">$ grep "keystone::notification_format" /usr/share/openstack-tripleo-heat-templates/deployment/keystone/keystone-container-puppet.yaml</pre><p class="simpara">
						The output shows the director using the <code class="literal">KeystoneNotificationFormat</code> parameter to set the <code class="literal">keystone::notification_format</code> hieradata.
					</p></li></ol></div><p>
				The following table shows the eventual mapping:
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097859292704" scope="col">Director Parameter</th><th align="left" valign="top" id="idm140097859291616" scope="col">Puppet Hieradata</th><th align="left" valign="top" id="idm140097859290528" scope="col">OpenStack Identity (keystone) option</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097859292704"> <p>
								<code class="literal">KeystoneNotificationFormat</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097859291616"> <p>
								<code class="literal">keystone::notification_format</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097859290528"> <p>
								<code class="literal">notification_format</code>
							</p>
							 </td></tr></tbody></table></div><p>
				You set the <code class="literal">KeystoneNotificationFormat</code> in an overcloud’s environment file which in turn sets the <code class="literal">notification_format</code> option in the <code class="literal">keystone.conf</code> file during the overcloud’s configuration.
			</p></section></section><section class="chapter" id="chap-Configuration_Hooks"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Configuration Hooks</h1></div></div></div><p>
			The configuration hooks provide a method to inject your own configuration functions into the Overcloud deployment process. This includes hooks for injecting custom configuration before and after the main Overcloud services configuration and hook for modifying and including Puppet-based configuration.
		</p><section class="section" id="sect-Customizing_Configuration_on_First_Boot"><div class="titlepage"><div><div><h2 class="title">4.1. First Boot: Customizing First Boot Configuration</h2></div></div></div><p>
				The director provides a mechanism to perform configuration on all nodes upon the initial creation of the Overcloud. The director achieves this through <code class="literal">cloud-init</code>, which you can call using the <code class="literal">OS::TripleO::NodeUserData</code> resource type.
			</p><p>
				In this example, update the nameserver with a custom IP address on all nodes. First, create a basic Heat template (<code class="literal">/home/stack/templates/nameserver.yaml</code>) that runs a script to append each node’s <code class="literal">resolv.conf</code> with a specific nameserver. You can use the <code class="literal">OS::TripleO::MultipartMime</code> resource type to send the configuration script.
			</p><pre class="screen">heat_template_version: 2014-10-16

description: &gt;
  Extra hostname configuration

resources:
  userdata:
    type: OS::Heat::MultipartMime
    properties:
      parts:
      - config: {get_resource: nameserver_config}

  nameserver_config:
    type: OS::Heat::SoftwareConfig
    properties:
      config: |
        #!/bin/bash
        echo "nameserver 192.168.1.1" &gt;&gt; /etc/resolv.conf

outputs:
  OS::stack_id:
    value: {get_resource: userdata}</pre><p>
				Create an environment file (<code class="literal">/home/stack/templates/firstboot.yaml</code>) that registers your Heat template as the <code class="literal">OS::TripleO::NodeUserData</code> resource type.
			</p><pre class="screen">resource_registry:
  OS::TripleO::NodeUserData: /home/stack/templates/nameserver.yaml</pre><p>
				To add the first boot configuration, add the environment file to the stack along with your other environment files when first creating the Overcloud. For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -e /home/stack/templates/firstboot.yaml \
    ...</pre><p>
				The <code class="literal">-e</code> applies the environment file to the Overcloud stack.
			</p><p>
				This adds the configuration to all nodes when they are first created and boot for the first time. Subsequent inclusions of these templates, such as updating the Overcloud stack, does not run these scripts.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					You can only register the <code class="literal">OS::TripleO::NodeUserData</code> to one Heat template. Subsequent usage overrides the Heat template to use.
				</p></div></div></section><section class="section" id="sect-Customizing_Overcloud_PreConfiguration"><div class="titlepage"><div><div><h2 class="title">4.2. Pre-Configuration: Customizing Specific Overcloud Roles</h2></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Previous versions of this document used the <code class="literal">OS::TripleO::Tasks::*PreConfig</code> resources to provide pre-configuration hooks on a per role basis. The director’s Heat template collection requires dedicated use of these hooks, which means you should not use them for custom use. Instead, use the <code class="literal">OS::TripleO::*ExtraConfigPre</code> hooks outlined below.
				</p></div></div><p>
				The Overcloud uses Puppet for the core configuration of OpenStack components. The director provides a set of hooks to provide custom configuration for specific node roles after the first boot completes and before the core configuration begins. These hooks include:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">OS::TripleO::ControllerExtraConfigPre</span></dt><dd>
							Additional configuration applied to Controller nodes before the core Puppet configuration.
						</dd><dt><span class="term">OS::TripleO::ComputeExtraConfigPre</span></dt><dd>
							Additional configuration applied to Compute nodes before the core Puppet configuration.
						</dd><dt><span class="term">OS::TripleO::CephStorageExtraConfigPre</span></dt><dd>
							Additional configuration applied to Ceph Storage nodes before the core Puppet configuration.
						</dd><dt><span class="term">OS::TripleO::ObjectStorageExtraConfigPre</span></dt><dd>
							Additional configuration applied to Object Storage nodes before the core Puppet configuration.
						</dd><dt><span class="term">OS::TripleO::BlockStorageExtraConfigPre</span></dt><dd>
							Additional configuration applied to Block Storage nodes before the core Puppet configuration.
						</dd><dt><span class="term">OS::TripleO::[ROLE]ExtraConfigPre</span></dt><dd>
							Additional configuration applied to custom nodes before the core Puppet configuration. Replace <code class="literal">[ROLE]</code> with the composable role name.
						</dd></dl></div><p>
				In this example, you first create a basic Heat template (<code class="literal">/home/stack/templates/nameserver.yaml</code>) that runs a script to write to a node’s <code class="literal">resolv.conf</code> with a variable nameserver.
			</p><pre class="screen">heat_template_version: 2014-10-16

description: &gt;
  Extra hostname configuration

parameters:
  server:
    type: json
  nameserver_ip:
    type: string
  DeployIdentifier:
    type: string

resources:
  CustomExtraConfigPre:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      config:
        str_replace:
          template: |
            #!/bin/sh
            echo "nameserver _NAMESERVER_IP_" &gt; /etc/resolv.conf
          params:
            _NAMESERVER_IP_: {get_param: nameserver_ip}

  CustomExtraDeploymentPre:
    type: OS::Heat::SoftwareDeployment
    properties:
      server: {get_param: server}
      config: {get_resource: CustomExtraConfigPre}
      actions: ['CREATE','UPDATE']
      input_values:
        deploy_identifier: {get_param: DeployIdentifier}

outputs:
  deploy_stdout:
    description: Deployment reference, used to trigger pre-deploy on changes
    value: {get_attr: [CustomExtraDeploymentPre, deploy_stdout]}</pre><p>
				In this example, the <code class="literal">resources</code> section contains the following parameters:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CustomExtraConfigPre</span></dt><dd>
							This defines a software configuration. In this example, we define a Bash <code class="literal">script</code> and Heat replaces <code class="literal">_NAMESERVER_IP_</code> with the value stored in the <code class="literal">nameserver_ip</code> parameter.
						</dd><dt><span class="term">CustomExtraDeploymentPre</span></dt><dd><p class="simpara">
							This executes a software configuration, which is the software configuration from the <code class="literal">CustomExtraConfigPre</code> resource. Note the following:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The <code class="literal">config</code> parameter makes a reference to the <code class="literal">CustomExtraConfigPre</code> resource so Heat knows what configuration to apply.
								</li><li class="listitem">
									The <code class="literal">server</code> parameter retrieves a map of the Overcloud nodes. This parameter is provided by the parent template and is mandatory in templates for this hook.
								</li><li class="listitem">
									The <code class="literal">actions</code> parameter defines when to apply the configuration. In this case, apply the configuration when the Overcloud is created. Possible actions include <code class="literal">CREATE</code>, <code class="literal">UPDATE</code>, <code class="literal">DELETE</code>, <code class="literal">SUSPEND</code>, and <code class="literal">RESUME</code>.
								</li><li class="listitem">
									<code class="literal">input_values</code> contains a parameter called <code class="literal">deploy_identifier</code>, which stores the <code class="literal">DeployIdentifier</code> from the parent template. This parameter provides a timestamp to the resource for each deployment update. This ensures the resource reapplies on subsequent overcloud updates.
								</li></ul></div></dd></dl></div><p>
				Create an environment file (<code class="literal">/home/stack/templates/pre_config.yaml</code>) that registers your Heat template to the role-based resource type. For example, to apply only to Controller nodes, use the <code class="literal">ControllerExtraConfigPre</code> hook:
			</p><pre class="screen">resource_registry:
  OS::TripleO::ControllerExtraConfigPre: /home/stack/templates/nameserver.yaml

parameter_defaults:
  nameserver_ip: 192.168.1.1</pre><p>
				To apply the configuration, add the environment file to the stack along with your other environment files when creating or updating the Overcloud. For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -e /home/stack/templates/pre_config.yaml \
    ...</pre><p>
				This applies the configuration to all Controller nodes before the core configuration begins on either the initial Overcloud creation or subsequent updates.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					You can only register each resource to only one Heat template per hook. Subsequent usage overrides the Heat template to use.
				</p></div></div></section><section class="section" id="sect-Customizing_Overcloud_PreConfiguration_All"><div class="titlepage"><div><div><h2 class="title">4.3. Pre-Configuration: Customizing All Overcloud Roles</h2></div></div></div><p>
				The Overcloud uses Puppet for the core configuration of OpenStack components. The director provides a hook to configure all node types after the first boot completes and before the core configuration begins:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">OS::TripleO::NodeExtraConfig</span></dt><dd>
							Additional configuration applied to all nodes roles before the core Puppet configuration.
						</dd></dl></div><p>
				In this example, create a basic Heat template (<code class="literal">/home/stack/templates/nameserver.yaml</code>) that runs a script to append each node’s <code class="literal">resolv.conf</code> with a variable nameserver.
			</p><pre class="screen">heat_template_version: 2014-10-16

description: &gt;
  Extra hostname configuration

parameters:
  server:
    type: string
  nameserver_ip:
    type: string
  DeployIdentifier:
    type: string

resources:
  CustomExtraConfigPre:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      config:
        str_replace:
          template: |
            #!/bin/sh
            echo "nameserver _NAMESERVER_IP_" &gt;&gt; /etc/resolv.conf
          params:
            _NAMESERVER_IP_: {get_param: nameserver_ip}

  CustomExtraDeploymentPre:
    type: OS::Heat::SoftwareDeployment
    properties:
      server: {get_param: server}
      config: {get_resource: CustomExtraConfigPre}
      actions: ['CREATE','UPDATE']
      input_values:
        deploy_identifier: {get_param: DeployIdentifier}

outputs:
  deploy_stdout:
    description: Deployment reference, used to trigger pre-deploy on changes
    value: {get_attr: [CustomExtraDeploymentPre, deploy_stdout]}</pre><p>
				In this example, the <code class="literal">resources</code> section contains the following parameters:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CustomExtraConfigPre</span></dt><dd>
							This defines a software configuration. In this example, we define a Bash <code class="literal">script</code> and Heat replaces <code class="literal">_NAMESERVER_IP_</code> with the value stored in the <code class="literal">nameserver_ip</code> parameter.
						</dd><dt><span class="term">CustomExtraDeploymentPre</span></dt><dd><p class="simpara">
							This executes a software configuration, which is the software configuration from the <code class="literal">CustomExtraConfigPre</code> resource. Note the following:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The <code class="literal">config</code> parameter makes a reference to the <code class="literal">CustomExtraConfigPre</code> resource so Heat knows what configuration to apply.
								</li><li class="listitem">
									The <code class="literal">server</code> parameter retrieves a map of the Overcloud nodes. This parameter is provided by the parent template and is mandatory in templates for this hook.
								</li><li class="listitem">
									The <code class="literal">actions</code> parameter defines when to apply the configuration. In this case, we only apply the configuration when the Overcloud is created. Possible actions include <code class="literal">CREATE</code>, <code class="literal">UPDATE</code>, <code class="literal">DELETE</code>, <code class="literal">SUSPEND</code>, and <code class="literal">RESUME</code>.
								</li><li class="listitem">
									The <code class="literal">input_values</code> parameter contains a sub-parameter called <code class="literal">deploy_identifier</code>, which stores the <code class="literal">DeployIdentifier</code> from the parent template. This parameter provides a timestamp to the resource for each deployment update. This ensures the resource reapplies on subsequent overcloud updates.
								</li></ul></div></dd></dl></div><p>
				Next, create an environment file (<code class="literal">/home/stack/templates/pre_config.yaml</code>) that registers your heat template as the <code class="literal">OS::TripleO::NodeExtraConfig</code> resource type.
			</p><pre class="screen">resource_registry:
  OS::TripleO::NodeExtraConfig: /home/stack/templates/nameserver.yaml

parameter_defaults:
  nameserver_ip: 192.168.1.1</pre><p>
				To apply the configuration, add the environment file to the stack along with your other environment files when creating or updating the Overcloud. For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -e /home/stack/templates/pre_config.yaml \
    ...</pre><p>
				This applies the configuration to all nodes before the core configuration begins on either the initial Overcloud creation or subsequent updates.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					You can only register the <code class="literal">OS::TripleO::NodeExtraConfig</code> to only one Heat template. Subsequent usage overrides the Heat template to use.
				</p></div></div></section><section class="section" id="sect-Customizing_Overcloud_PostConfiguration_All"><div class="titlepage"><div><div><h2 class="title">4.4. Post-Configuration: Customizing All Overcloud Roles</h2></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Previous versions of this document used the <code class="literal">OS::TripleO::Tasks::*PostConfig</code> resources to provide post-configuration hooks on a per role basis. The director’s Heat template collection requires dedicated use of these hooks, which means you should not use them for custom use. Instead, use the <code class="literal">OS::TripleO::NodeExtraConfigPost</code> hook outlined below.
				</p></div></div><p>
				A situation might occur where you have completed the creation of your Overcloud but want to add additional configuration to all roles, either on initial creation or on a subsequent update of the Overcloud. In this case, you use the following post-configuration hook:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">OS::TripleO::NodeExtraConfigPost</span></dt><dd>
							Additional configuration applied to all nodes roles after the core Puppet configuration.
						</dd></dl></div><p>
				In this example, you first create a basic heat template (<code class="literal">/home/stack/templates/nameserver.yaml</code>) that runs a script to append each node’s <code class="literal">resolv.conf</code> with a variable nameserver.
			</p><pre class="screen">heat_template_version: 2014-10-16

description: &gt;
  Extra hostname configuration

parameters:
  servers:
    type: json
  nameserver_ip:
    type: string
  DeployIdentifier:
    type: string
  EndpointMap:
    default: {}
    type: json

resources:
  CustomExtraConfig:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      config:
        str_replace:
          template: |
            #!/bin/sh
            echo "nameserver _NAMESERVER_IP_" &gt;&gt; /etc/resolv.conf
          params:
            _NAMESERVER_IP_: {get_param: nameserver_ip}

  CustomExtraDeployments:
    type: OS::Heat::SoftwareDeploymentGroup
    properties:
      servers:  {get_param: servers}
      config: {get_resource: CustomExtraConfig}
      actions: ['CREATE','UPDATE']
      input_values:
        deploy_identifier: {get_param: DeployIdentifier}</pre><p>
				In this example, the <code class="literal">resources</code> section contains the following:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CustomExtraConfig</span></dt><dd>
							This defines a software configuration. In this example, we define a Bash <code class="literal">script</code> and Heat replaces <code class="literal">_NAMESERVER_IP_</code> with the value stored in the <code class="literal">nameserver_ip</code> parameter.
						</dd><dt><span class="term">CustomExtraDeployments</span></dt><dd><p class="simpara">
							This executes a software configuration, which is the software configuration from the <code class="literal">CustomExtraConfig</code> resource. Note the following:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The <code class="literal">config</code> parameter makes a reference to the <code class="literal">CustomExtraConfig</code> resource so Heat knows what configuration to apply.
								</li><li class="listitem">
									The <code class="literal">servers</code> parameter retrieves a map of the Overcloud nodes. This parameter is provided by the parent template and is mandatory in templates for this hook.
								</li><li class="listitem">
									The <code class="literal">actions</code> parameter defines when to apply the configuration. In this case, we apply the configuration when the Overcloud is created. Possible actions include <code class="literal">CREATE</code>, <code class="literal">UPDATE</code>, <code class="literal">DELETE</code>, <code class="literal">SUSPEND</code>, and <code class="literal">RESUME</code>.
								</li><li class="listitem">
									<code class="literal">input_values</code> contains a parameter called <code class="literal">deploy_identifier</code>, which stores the <code class="literal">DeployIdentifier</code> from the parent template. This parameter provides a timestamp to the resource for each deployment update. This ensures the resource reapplies on subsequent overcloud updates.
								</li></ul></div></dd></dl></div><p>
				Create an environment file (<code class="literal">/home/stack/templates/post_config.yaml</code>) that registers your Heat template as the <code class="literal">OS::TripleO::NodeExtraConfigPost:</code> resource type.
			</p><pre class="screen">resource_registry:
  OS::TripleO::NodeExtraConfigPost: /home/stack/templates/nameserver.yaml

parameter_defaults:
  nameserver_ip: 192.168.1.1</pre><p>
				To apply the configuration, add the environment file to the stack along with your other environment files when creating or updating the Overcloud. For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -e /home/stack/templates/post_config.yaml \
    ...</pre><p>
				This applies the configuration to all nodes after the core configuration completes on either initial Overcloud creation or subsequent updates.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					You can only register the <code class="literal">OS::TripleO::NodeExtraConfigPost</code> to only one Heat template. Subsequent usage overrides the Heat template to use.
				</p></div></div></section><section class="section" id="sect-Customizing_Puppet_Configuration_Data"><div class="titlepage"><div><div><h2 class="title">4.5. Puppet: Customizing Hieradata for Roles</h2></div></div></div><p>
				The Heat template collection contains a set of parameters to pass extra configuration to certain node types. These parameters save the configuration as hieradata for the node’s Puppet configuration. These parameters are:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ControllerExtraConfig</span></dt><dd>
							Configuration to add to all Controller nodes.
						</dd><dt><span class="term">ComputeExtraConfig</span></dt><dd>
							Configuration to add to all Compute nodes.
						</dd><dt><span class="term">BlockStorageExtraConfig</span></dt><dd>
							Configuration to add to all Block Storage nodes.
						</dd><dt><span class="term">ObjectStorageExtraConfig</span></dt><dd>
							Configuration to add to all Object Storage nodes.
						</dd><dt><span class="term">CephStorageExtraConfig</span></dt><dd>
							Configuration to add to all Ceph Storage nodes.
						</dd><dt><span class="term">[ROLE]ExtraConfig</span></dt><dd>
							Configuration to add to a composable role. Replace <code class="literal">[ROLE]</code> with the composable role name.
						</dd><dt><span class="term">ExtraConfig</span></dt><dd>
							Configuration to add to all nodes.
						</dd></dl></div><p>
				To add extra configuration to the post-deployment configuration process, create an environment file that contains these parameters in the <code class="literal">parameter_defaults</code> section. For example, to increase the reserved memory for Compute hosts to 1024 MB and set the VNC keymap to Japanese:
			</p><pre class="screen">parameter_defaults:
  ComputeExtraConfig:
    nova::compute::reserved_host_memory: 1024
    nova::compute::vnc_keymap: ja</pre><p>
				Include this environment file when running <code class="literal">openstack overcloud deploy</code>.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					You can only define each parameter once. Subsequent usage overrides previous values.
				</p></div></div></section><section class="section" id="sect-Customizing_Hieradata_for_Individual_Nodes"><div class="titlepage"><div><div><h2 class="title">4.6. Puppet: Customizing Hieradata for Individual Nodes</h2></div></div></div><p>
				You can set Puppet hieradata for individual nodes using the Heat template collection. To accomplish this, acquire the system UUID saved as part of the introspection data for a node:
			</p><pre class="screen">$ openstack baremetal introspection data save 9dcc87ae-4c6d-4ede-81a5-9b20d7dc4a14 | jq .extra.system.product.uuid</pre><p>
				This outputs a system UUID. For example:
			</p><pre class="screen">"F5055C6C-477F-47FB-AFE5-95C6928C407F"</pre><p>
				Use this system UUID in an environment file that defines node-specific hieradata and registers the <code class="literal">per_node.yaml</code> template to a pre-configuration hook. For example:
			</p><pre class="screen">resource_registry:
  OS::TripleO::ComputeExtraConfigPre: /usr/share/openstack-tripleo-heat-templates/puppet/extraconfig/pre_deploy/per_node.yaml
parameter_defaults:
  NodeDataLookup: '{"F5055C6C-477F-47FB-AFE5-95C6928C407F": {"nova::compute::vcpu_pin_set": [ "2", "3" ]}}'</pre><p>
				Include this environment file when running <code class="literal">openstack overcloud deploy</code>.
			</p><p>
				The <code class="literal">per_node.yaml</code> template generates a set of heiradata files on nodes that correspond to each system UUID and contains the hieradata you defined. If a UUID is not defined, the resulting hieradata file is empty. In the previous example, the <code class="literal">per_node.yaml</code> template runs on all Compute nodes (as per the <code class="literal">OS::TripleO::ComputeExtraConfigPre</code> hook), but only the Compute node with system UUID <code class="literal">F5055C6C-477F-47FB-AFE5-95C6928C407F</code> receives hieradata.
			</p><p>
				This provides a method of tailoring each node to specific requirements.
			</p><p>
				For more information about NodeDataLookup, see section <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/deploying_an_overcloud_with_containerized_red_hat_ceph/#map_disk_layout_non-homogen_ceph">Mapping the Disk Layout to Non-Homogeneous Ceph Storage Nodes</a> of the <span class="emphasis"><em>Storage Guide</em></span>.
			</p></section><section class="section" id="sect-Applying_Custom_Puppet_Configuration"><div class="titlepage"><div><div><h2 class="title">4.7. Puppet: Applying Custom Manifests</h2></div></div></div><p>
				In certain circumstances, you might need to install and configure some additional components to your Overcloud nodes. You can achieve this with a custom Puppet manifest that applies to nodes after the main configuration completes. As a basic example, you might intend to install <code class="literal">motd</code> to each node. The process for accomplishing this is to first create a Heat template (<code class="literal">/home/stack/templates/custom_puppet_config.yaml</code>) that launches Puppet configuration.
			</p><pre class="screen">heat_template_version: 2014-10-16

description: &gt;
  Run Puppet extra configuration to set new MOTD

parameters:
  servers:
    type: json

resources:
  ExtraPuppetConfig:
    type: OS::Heat::SoftwareConfig
    properties:
      config: {get_file: motd.pp}
      group: puppet
      options:
        enable_hiera: True
        enable_facter: False

  ExtraPuppetDeployments:
    type: OS::Heat::SoftwareDeploymentGroup
    properties:
      config: {get_resource: ExtraPuppetConfig}
      servers: {get_param: servers}</pre><p>
				This includes the <code class="literal">/home/stack/templates/motd.pp</code> within the template and passes it to nodes for configuration. The <code class="literal">motd.pp</code> file itself contains the Puppet classes to install and configure <code class="literal">motd</code>.
			</p><p>
				Create an environment file (<code class="literal">/home/stack/templates/puppet_post_config.yaml</code>) that registers your heat template as the <code class="literal">OS::TripleO::NodeExtraConfigPost:</code> resource type.
			</p><pre class="screen">resource_registry:
  OS::TripleO::NodeExtraConfigPost: /home/stack/templates/custom_puppet_config.yaml</pre><p>
				Include this environment file along with your other environment files when creating or updating the Overcloud stack:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -e /home/stack/templates/puppet_post_config.yaml \
    ...</pre><p>
				This applies the configuration from <code class="literal">motd.pp</code> to all nodes in the Overcloud.
			</p></section></section><section class="chapter" id="ansible-based-registration"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Ansible-based overcloud registration</h1></div></div></div><p>
			The director uses Ansible-based methods to register overcloud nodes to the Red Hat Customer Portal or a Red Hat Satellite 6 server.
		</p><section class="section" id="rhsm-composable-service-registration"><div class="titlepage"><div><div><h2 class="title">5.1. Red Hat Subscription Manager (RHSM) composable service</h2></div></div></div><p>
				The <code class="literal">rhsm</code> composable service provides a method to register overcloud nodes through Ansible. Each role in the default <code class="literal">roles_data</code> file contains a <code class="literal">OS::TripleO::Services::Rhsm</code> resource, which is disabled by default. To enable the service, register the resource to the <code class="literal">rhsm</code> composable service file:
			</p><pre class="screen">resource_registry:
  OS::TripleO::Services::Rhsm: /usr/share/openstack-tripleo-heat-templates/deployment/rhsm/rhsm-baremetal-ansible.yaml</pre><p>
				The <code class="literal">rhsm</code> composable service accepts a <code class="literal">RhsmVars</code> parameter, which allows you to define multiple sub-parameters relevant to your registration. For example:
			</p><pre class="screen">parameter_defaults:
  RhsmVars:
    rhsm_repos:
      - rhel-8-for-x86_64-baseos-eus-rpms
      - rhel-8-for-x86_64-appstream-eus-rpms
      - rhel-8-for-x86_64-highavailability-eus-rpms
      …​
    rhsm_username: "myusername"
    rhsm_password: "p@55w0rd!"
    rhsm_org_id: "1234567"
    rhsm_release: 8.2</pre><p>
				You can also use the <code class="literal">RhsmVars</code> parameter in combination with role-specific parameters (e.g. <code class="literal">ControllerParameters</code>) to provide flexibility when enabling specific repositories for different nodes types.
			</p><p>
				The next section is a list of sub-parameters available to use with the <code class="literal">RhsmVars</code> parameter for use with the <code class="literal">rhsm</code> composable service.
			</p></section><section class="section" id="rhsmvars-parameters-registration"><div class="titlepage"><div><div><h2 class="title">5.2. RhsmVars sub-parameters</h2></div></div></div><p>
				See the <a class="link" href="https://github.com/openstack/ansible-role-redhat-subscription/">role documentation</a> to learn about all Ansible parameters.
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 29%; " class="col_1"><!--Empty--></col><col style="width: 71%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097860873952" scope="col"><code class="literal">rhsm</code></th><th align="left" valign="top" id="idm140097860872704" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_method</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								Choose the registration method. Either <code class="literal">portal</code>, <code class="literal">satellite</code>, or <code class="literal">disable</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_org_id</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The organization to use for registration. To locate this ID, run <code class="literal">sudo subscription-manager orgs</code> from the undercloud node. Enter your Red Hat credentials when prompted, and use the resulting <code class="literal">Key</code> value. For more information on your organization ID, see <a class="link" href="https://access.redhat.com/articles/3047431">"Understanding the Red Hat Subscription Management Organization ID "</a>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_pool_ids</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The subscription pool ID to use. Use this if not auto-attaching subscriptions. To locate this ID, run <code class="literal">sudo subscription-manager list --available --all --matches="*OpenStack*"</code> from the undercloud node, and use the resulting <code class="literal">Pool ID</code> value.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_activation_key</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The activation key to use for registration. Does not work when <code class="literal">rhsm_repos</code> is configured.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_autosubscribe</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								Automatically attach compatible subscriptions to this system. Set to <code class="literal">true</code> to enable.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_baseurl</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The base URL for obtaining content. The default is the Red Hat Content Delivery Network URL. If using a Satellite server, change this value to the base URL of your Satellite server content repositories.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_server_hostname</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The hostname of the subscription management service for registration. The default is the Red Hat Subscription Management hostname. If using a Satellite server, change this value to your Satellite server hostname.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_repos</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								A list of repositories to enable. Does not work when <code class="literal">rhsm_activation_key</code> is configured.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_username</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The username for registration. If possible, use activation keys for registration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_password</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The password for registration. If possible, use activation keys for registration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_release</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								Red Hat Enterprise Linux release for pinning the repositories. This is set to <code class="literal">{rhelvernum}</code> for Red Hat OpenStack Platform 16.1.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_rhsm_proxy_hostname</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The hostname for the HTTP proxy. For example: <code class="literal">proxy.example.com</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_rhsm_proxy_port</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The port for HTTP proxy communication. For example: <code class="literal">8080</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_rhsm_proxy_user</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The username to access the HTTP proxy.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097860873952"> <p>
								<code class="literal">rhsm_rhsm_proxy_password</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860872704"> <p>
								The password to access the HTTP proxy.
							</p>
							 </td></tr></tbody></table></div><p>
				Now that you have an understanding of how the <code class="literal">rhsm</code> composable service works and how to configure it, you can use the following procedures to configure your own registration details.
			</p></section><section class="section" id="registering-the-overcloud-with-the-rhsm-composable-service-registration"><div class="titlepage"><div><div><h2 class="title">5.3. Registering the overcloud with the rhsm composable service</h2></div></div></div><p>
				Use the following procedure to create an environment file that enables and configures the <code class="literal">rhsm</code> composable service. The director uses this environment file to register and subscribe your nodes.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Create an environment file (<code class="literal">templates/rhsm.yaml</code>) to store the configuration.
					</li><li class="listitem"><p class="simpara">
						Include your configuration in the environment file. For example:
					</p><pre class="screen">resource_registry:
  OS::TripleO::Services::Rhsm: /usr/share/openstack-tripleo-heat-templates/deployment/rhsm/rhsm-baremetal-ansible.yaml
parameter_defaults:
  RhsmVars:
    rhsm_repos:
      - rhel-8-for-x86_64-baseos-eus-rpms
      - rhel-8-for-x86_64-appstream-eus-rpms
      - rhel-8-for-x86_64-highavailability-eus-rpms
      …​
    rhsm_username: "myusername"
    rhsm_password: "p@55w0rd!"
    rhsm_org_id: "1234567"
    rhsm_pool_ids: "1a85f9223e3d5e43013e3d6e8ff506fd"
    rhsm_method: "portal"
    rhsm_release: 8.2</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The <code class="literal">resource_registry</code> section associates the <code class="literal">rhsm</code> composable service with the <code class="literal">OS::TripleO::Services::Rhsm</code> resource, which is available on each role.
							</li><li class="listitem">
								The <code class="literal">RhsmVars</code> variable passes parameters to Ansible for configuring your Red Hat registration.
							</li></ul></div></li><li class="listitem">
						Save the environment file.
					</li></ol></div><p>
				You can also provide registration details to specific overcloud roles. The next section provides an example of this.
			</p></section><section class="section" id="applying-the-rhsm-composable-service-to-different-roles-registration"><div class="titlepage"><div><div><h2 class="title">5.4. Applying the rhsm composable service to different roles</h2></div></div></div><p>
				You can apply the <code class="literal">rhsm</code> composable service on a per-role basis. For example, you can apply different sets of configurations to Controller nodes, Compute nodes, and Ceph Storage nodes.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Create an environment file (<code class="literal">templates/rhsm.yaml</code>) to store the configuration.
					</li><li class="listitem"><p class="simpara">
						Include your configuration in the environment file. For example:
					</p><pre class="screen">resource_registry:
  OS::TripleO::Services::Rhsm: /usr/share/openstack-tripleo-heat-templates/deployment/rhsm/rhsm-baremetal-ansible.yaml
parameter_defaults:
  ControllerParameters:
    RhsmVars:
      rhsm_repos:
        - rhel-8-for-x86_64-baseos-eus-rpms
        - rhel-8-for-x86_64-appstream-eus-rpms
        - rhel-8-for-x86_64-highavailability-eus-rpms
        - ansible-2.9-for-rhel-8-x86_64-rpms
        - advanced-virt-for-rhel-8-x86_64-rpms
        - openstack-16.1-for-rhel-8-x86_64-rpms
        - rhceph-4-mon-for-rhel-8-x86_64-rpms
        - rhceph-4-tools-for-rhel-8-x86_64-rpms
        - fast-datapath-for-rhel-8-x86_64-rpms
      rhsm_username: "myusername"
      rhsm_password: "p@55w0rd!"
      rhsm_org_id: "1234567"
      rhsm_pool_ids: "55d251f1490556f3e75aa37e89e10ce5"
      rhsm_method: "portal"
      rhsm_release: 8.2
  ComputeParameters:
    RhsmVars:
      rhsm_repos:
        - rhel-8-for-x86_64-baseos-eus-rpms
        - rhel-8-for-x86_64-appstream-eus-rpms
        - rhel-8-for-x86_64-highavailability-eus-rpms
        - ansible-2.9-for-rhel-8-x86_64-rpms
        - advanced-virt-for-rhel-8-x86_64-rpms
        - openstack-16.1-for-rhel-8-x86_64-rpms
        - rhceph-4-tools-for-rhel-8-x86_64-rpms
      rhsm_username: "myusername"
      rhsm_password: "p@55w0rd!"
      rhsm_org_id: "1234567"
      rhsm_pool_ids: "55d251f1490556f3e75aa37e89e10ce5"
      rhsm_method: "portal"
      rhsm_release: 8.2
  CephStorageParameters:
    RhsmVars:
      rhsm_repos:
        - rhel-8-for-x86_64-baseos-rpms
        - rhel-8-for-x86_64-appstream-rpms
        - rhel-8-for-x86_64-highavailability-rpms
        - ansible-2.9-for-rhel-8-x86_64-rpms
        - openstack-16.1-deployment-tools-for-rhel-8-x86_64-rpms
        - rhceph-4-osd-for-rhel-8-x86_64-rpms
        - rhceph-4-tools-for-rhel-8-x86_64-rpms
      rhsm_username: "myusername"
      rhsm_password: "p@55w0rd!"
      rhsm_org_id: "1234567"
      rhsm_pool_ids: "68790a7aa2dc9dc50a9bc39fabc55e0d"
      rhsm_method: "portal"
      rhsm_release: 8.2</pre><p class="simpara">
						The <code class="literal">resource_registry</code> associates the <code class="literal">rhsm</code> composable service with the <code class="literal">OS::TripleO::Services::Rhsm</code> resource, which is available on each role.
					</p><p class="simpara">
						The <code class="literal">ControllerParameters</code>, <code class="literal">ComputeParameters</code>, and <code class="literal">CephStorageParameters</code> use their own <code class="literal">RhsmVars</code> parameter to pass subscription details to their respective roles.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Set the <code class="literal">RhsmVars</code> parameter within the <code class="literal">CephStorageParameters</code> parameter to use a Red Hat Ceph Storage subscription and repositories specific to Ceph Storage. Ensure the <code class="literal">rhsm_repos</code> parameter contains the standard Red Hat Enterprise Linux repositories instead of the Extended Update Support (EUS) repositories that Controller and Compute nodes require.
						</p></div></div></li><li class="listitem">
						Save the environment file.
					</li></ol></div></section><section class="section" id="registering-the-overcloud-to-red-hat-satellite-registration"><div class="titlepage"><div><div><h2 class="title">5.5. Registering the overcloud to Red Hat Satellite</h2></div></div></div><p>
				Use the following procedure to create an environment file that enables and configures the <code class="literal">rhsm</code> composable service to register nodes to Red Hat Satellite instead of the Red Hat Customer Portal.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Create an environment file (<code class="literal">templates/rhsm.yaml</code>) to store the configuration.
					</li><li class="listitem"><p class="simpara">
						Include your configuration in the environment file. For example:
					</p><pre class="screen">resource_registry:
  OS::TripleO::Services::Rhsm: /usr/share/openstack-tripleo-heat-templates/deployment/rhsm/rhsm-baremetal-ansible.yaml
parameter_defaults:
  RhsmVars:
    rhsm_activation_key: "myactivationkey"
    rhsm_method: "satellite"
    rhsm_org_id: "ACME"
    rhsm_server_hostname: satellite.example.com"
    rhsm_baseurl: "https://satellite.example.com/pulp/repos"
    rhsm_release: 8.2</pre><p class="simpara">
						The <code class="literal">resource_registry</code> associates the <code class="literal">rhsm</code> composable service with the <code class="literal">OS::TripleO::Services::Rhsm</code> resource, which is available on each role.
					</p><p class="simpara">
						The <code class="literal">RhsmVars</code> variable passes parameters to Ansible for configuring your Red Hat registration.
					</p></li><li class="listitem">
						Save the environment file.
					</li></ol></div><p>
				These procedures enable and configure <code class="literal">rhsm</code> on the overcloud. However, if you used the <code class="literal">rhel-registration</code> method from previous Red Hat OpenStack Platform version, you must disable it and switch to the Ansible-based method. Use the following procedure to switch from the old <code class="literal">rhel-registration</code> method to the Ansible-based method.
			</p></section><section class="section" id="switching-to-the-rhsm-composable-service-registration"><div class="titlepage"><div><div><h2 class="title">5.6. Switching to the rhsm composable service</h2></div></div></div><p>
				The previous <code class="literal">rhel-registration</code> method runs a bash script to handle the overcloud registration. The scripts and environment files for this method are located in the core Heat template collection at <code class="literal">/usr/share/openstack-tripleo-heat-templates/extraconfig/pre_deploy/rhel-registration/</code>.
			</p><p>
				Complete the following steps to switch from the <code class="literal">rhel-registration</code> method to the <code class="literal">rhsm</code> composable service.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Exclude the <code class="literal">rhel-registration</code> environment files from future deployments operations. In most cases, exclude the following files:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">rhel-registration/environment-rhel-registration.yaml</code>
							</li><li class="listitem">
								<code class="literal">rhel-registration/rhel-registration-resource-registry.yaml</code>
							</li></ul></div></li><li class="listitem"><p class="simpara">
						If you use a custom <code class="literal">roles_data</code> file, ensure that each role in your <code class="literal">roles_data</code> file contains the <code class="literal">OS::TripleO::Services::Rhsm</code> composable service. For example:
					</p><pre class="screen">- name: Controller
  description: |
    Controller role that has all the controller services loaded and handles
    Database, Messaging and Network functions.
  CountDefault: 1
  ...
  ServicesDefault:
    ...
    - OS::TripleO::Services::Rhsm
    ...</pre></li><li class="listitem">
						Add the environment file for <code class="literal">rhsm</code> composable service parameters to future deployment operations.
					</li></ol></div><p>
				This method replaces the <code class="literal">rhel-registration</code> parameters with the <code class="literal">rhsm</code> service parameters and changes the Heat resource that enables the service from:
			</p><pre class="screen">resource_registry:
  OS::TripleO::NodeExtraConfig: rhel-registration.yaml</pre><p>
				To:
			</p><pre class="screen">resource_registry:
  OS::TripleO::Services::Rhsm: /usr/share/openstack-tripleo-heat-templates/deployment/rhsm/rhsm-baremetal-ansible.yaml</pre><p>
				You can also include the <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/rhsm.yaml</code> environment file with your deployment to enable the service.
			</p><p>
				To help transition your details from the <code class="literal">rhel-registration</code> method to the <code class="literal">rhsm</code> method, use the following table to map the your parameters and their values.
			</p></section><section class="section" id="rhel-registration-to-rhsm-mappings-registration"><div class="titlepage"><div><div><h2 class="title">5.7. rhel-registration to rhsm mappings</h2></div></div></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097858066080" scope="col"><code class="literal">rhel-registration</code></th><th align="left" valign="top" id="idm140097858064832" scope="col"><code class="literal">rhsm</code> / <code class="literal">RhsmVars</code></th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_method</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_method</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_org</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_org_id</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_pool_id</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_pool_ids</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_activation_key</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_activation_key</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_auto_attach</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_autosubscribe</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_sat_url</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_satellite_url</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_repos</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_repos</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_user</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_username</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_password</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_password</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_release</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_release</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_http_proxy_host</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_rhsm_proxy_hostname</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_http_proxy_port</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_rhsm_proxy_port</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_http_proxy_username</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_rhsm_proxy_user</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097858066080"> <p>
								<code class="literal">rhel_reg_http_proxy_password</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097858064832"> <p>
								<code class="literal">rhsm_rhsm_proxy_password</code>
							</p>
							 </td></tr></tbody></table></div><p>
				Now that you have configured the environment file for the <code class="literal">rhsm</code> service, you can include it with your next overcloud deployment operation.
			</p></section><section class="section" id="deploying-the-overcloud-with-the-rhsm-composable-service-registration"><div class="titlepage"><div><div><h2 class="title">5.8. Deploying the overcloud with the rhsm composable service</h2></div></div></div><p>
				This section shows how to apply your <code class="literal">rhsm</code> configuration to the overcloud.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Include <code class="literal">rhsm.yml</code> environment file with the <code class="literal">openstack overcloud deploy</code>:
					</p><pre class="screen">openstack overcloud deploy \
    &lt;other cli args&gt; \
    -e ~/templates/rhsm.yaml</pre><p class="simpara">
						This enables the Ansible configuration of the overcloud and the Ansible-based registration.
					</p></li><li class="listitem">
						Wait until the overcloud deployment completes.
					</li><li class="listitem"><p class="simpara">
						Check the subscription details on your overcloud nodes. For example, log into a Controller node and run the following commands:
					</p><pre class="screen">$ sudo subscription-manager status
$ sudo subscription-manager list --consumed</pre></li></ol></div><p>
				In addition to the director-based registration method, you can also manually register after deployment.
			</p></section><section class="section" id="running-ansible-based-registration-manually-registration"><div class="titlepage"><div><div><h2 class="title">5.9. Running Ansible-based registration manually</h2></div></div></div><p>
				You can perform manual Ansible-based registration on a deployed overcloud. You accomplish this using the director’s dynamic inventory script to define node roles as host groups and then run a playbook against them using <code class="literal">ansible-playbook</code>. The following example shows how to manually register Controller nodes using a playbook.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create a playbook with that using the <code class="literal">redhat_subscription</code> modules to register your nodes. For example, the following playbook applies to Controller nodes:
					</p><pre class="screen">---
- name: Register Controller nodes
  hosts: Controller
  become: yes
  vars:
    repos:
      - rhel-8-for-x86_64-baseos-eus-rpms
      - rhel-8-for-x86_64-appstream-eus-rpms
      - rhel-8-for-x86_64-highavailability-eus-rpms
      - ansible-2.9-for-rhel-8-x86_64-rpms
      - advanced-virt-for-rhel-8-x86_64-rpms
      - openstack-16.1-for-rhel-8-x86_64-rpms
      - rhceph-4-mon-for-rhel-8-x86_64-rpms
      - fast-datapath-for-rhel-8-x86_64-rpms
  tasks:
    - name: Register system
      redhat_subscription:
        username: myusername
        password: p@55w0rd!
        org_id: 1234567
        release: 8.2
        pool_ids: 1a85f9223e3d5e43013e3d6e8ff506fd
    - name: Disable all repos
      command: "subscription-manager repos --disable *"
    - name: Enable Controller node repos
      command: "subscription-manager repos --enable {{ item }}"
      with_items: "{{ repos }}"</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								This play contains three tasks:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										Register the node using an activation key.
									</li><li class="listitem">
										Disable any auto-enabled repositories.
									</li><li class="listitem">
										Enable only the repositories relevant to the Controller node. The repositories are listed with the <code class="literal">repos</code> variable.
									</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						After deploying the overcloud, you can run the following command so that Ansible executes the playbook (<code class="literal">ansible-osp-registration.yml</code>) against your overcloud:
					</p><pre class="screen">$ ansible-playbook -i /usr/bin/tripleo-ansible-inventory ansible-osp-registration.yml</pre><p class="simpara">
						This command does the following:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Runs the dynamic inventory script to get a list of host and their groups.
							</li><li class="listitem">
								Applies the playbook tasks to the nodes in the group defined in the playbook’s <code class="literal">hosts</code> parameter, which in this case is the Controller group.
							</li></ul></div></li></ol></div></section></section><section class="chapter" id="Chap-Roles"><div class="titlepage"><div><div><h1 class="title">Chapter 6. Composable Services and Custom Roles</h1></div></div></div><p>
			The Overcloud usually consists of nodes in predefined roles such as Controller nodes, Compute nodes, and different storage node types. Each of these default roles contains a set of services defined in the core Heat template collection on the director node. However, the architecture of the core Heat templates provide methods to do the following tasks:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Create custom roles
				</li><li class="listitem">
					Add and remove services from each role
				</li></ul></div><p>
			This allows the possibility to create different combinations of services on different roles. This chapter explores the architecture of custom roles, composable services, and methods for using them.
		</p><section class="section" id="doc-Composable_Services-Architectures"><div class="titlepage"><div><div><h2 class="title">6.1. Supported Role Architecture</h2></div></div></div><p>
				The following architectures are available when using custom roles and composable services:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Architecture 1 - Default Architecture</span></dt><dd>
							Uses the default <code class="literal">roles_data</code> files. All controller services are contained within one Controller role.
						</dd><dt><span class="term">Architecture 2 - Supported Standalone Roles</span></dt><dd>
							Use the predefined files in <code class="literal">/usr/share/openstack-tripleo-heat-templates/roles</code> to generate a custom <code class="literal">roles_data</code> file`. See <a class="xref" href="index.html#supported-custom-roles" title="6.2.3. Supported Custom Roles">Section 6.2.3, “Supported Custom Roles”</a>.
						</dd><dt><span class="term">Architecture 3 - Custom Composable Services</span></dt><dd>
							Create your own <code class="literal">roles</code> and use them to generate a custom <code class="literal">roles_data</code> file. Note that only a limited number of composable service combinations have been tested and verified and Red Hat cannot support all composable service combinations.
						</dd></dl></div></section><section class="section" id="roles"><div class="titlepage"><div><div><h2 class="title">6.2. Roles</h2></div></div></div><section class="section" id="Examining_Composable_Role_Architecture"><div class="titlepage"><div><div><h3 class="title">6.2.1. Examining the roles_data File</h3></div></div></div><p>
					The Overcloud creation process defines its roles using a <code class="literal">roles_data</code> file. The <code class="literal">roles_data</code> file contains a YAML-formatted list of the roles. The following is a shortened example of the <code class="literal">roles_data</code> syntax:
				</p><pre class="screen">- name: Controller
  description: |
    Controller role that has all the controller services loaded and handles
    Database, Messaging and Network functions.
  ServicesDefault:
    - OS::TripleO::Services::AuditD
    - OS::TripleO::Services::CACerts
    - OS::TripleO::Services::CephClient
    ...
- name: Compute
  description: |
    Basic Compute Node role
  ServicesDefault:
    - OS::TripleO::Services::AuditD
    - OS::TripleO::Services::CACerts
    - OS::TripleO::Services::CephClient
    ...</pre><p>
					The core Heat template collection contains a default <code class="literal">roles_data</code> file located at <code class="literal">/usr/share/openstack-tripleo-heat-templates/roles_data.yaml</code>. The default file defines the following role types:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">Controller</code>
						</li><li class="listitem">
							<code class="literal">Compute</code>
						</li><li class="listitem">
							<code class="literal">BlockStorage</code>
						</li><li class="listitem">
							<code class="literal">ObjectStorage</code>
						</li><li class="listitem">
							<code class="literal">CephStorage</code>.
						</li></ul></div><p>
					The <code class="literal">openstack overcloud deploy</code> command includes this file during deployment. You can override this file with a custom <code class="literal">roles_data</code> file using the <code class="literal">-r</code> argument. For example:
				</p><pre class="screen">$ openstack overcloud deploy --templates -r ~/templates/roles_data-custom.yaml</pre></section><section class="section" id="sect-Creating_a_Custom_Roles_File"><div class="titlepage"><div><div><h3 class="title">6.2.2. Creating a roles_data File</h3></div></div></div><p>
					Although you can manually create a custom <code class="literal">roles_data</code> file, you can also automatically generate the file using individual role templates. The director provides several commands to manage role templates and automatically generate a custom <code class="literal">roles_data</code> file.
				</p><p>
					To list the default role templates, use the <code class="literal">openstack overcloud roles list</code> command:
				</p><pre class="screen">$ openstack overcloud roles list
BlockStorage
CephStorage
Compute
ComputeHCI
ComputeOvsDpdk
Controller
...</pre><p>
					To see the role’s YAML definition, use the <code class="literal">openstack overcloud roles show</code> command:
				</p><pre class="screen">$ openstack overcloud roles show Compute</pre><p>
					To generate a custom <code class="literal">roles_data</code> file, use the <code class="literal">openstack overcloud roles generate</code> command to join multiple predefined roles into a single file. For example, the following command joins the <code class="literal">Controller</code>, <code class="literal">Compute</code>, and <code class="literal">Networker</code> roles into a single file:
				</p><pre class="screen">$ openstack overcloud roles generate -o ~/roles_data.yaml Controller Compute Networker</pre><p>
					The <code class="literal">-o</code> defines the name of the file to create.
				</p><p>
					This creates a custom <code class="literal">roles_data</code> file. However, the previous example uses the <code class="literal">Controller</code> and <code class="literal">Networker</code> roles, which both contain the same networking agents. This means the networking services scale from <code class="literal">Controller</code> to the <code class="literal">Networker</code> role. The overcloud balances the load for networking services between the <code class="literal">Controller</code> and <code class="literal">Networker</code> nodes.
				</p><p>
					To make this <code class="literal">Networker</code> role standalone, you can create your own custom <code class="literal">Controller</code> role, as well as any other role needed. This allows you to generate a <code class="literal">roles_data</code> file from your own custom roles.
				</p><p>
					Copy the directory from the core Heat template collection to the <code class="literal">stack</code> user’s home directory:
				</p><pre class="screen">$ cp -r /usr/share/openstack-tripleo-heat-templates/roles ~/.</pre><p>
					Add or modify the custom role files in this directory. Use the <code class="literal">--roles-path</code> option with any of the aforementioned role sub-commands to use this directory as the source for your custom roles. For example:
				</p><pre class="screen">$ openstack overcloud roles generate -o my_roles_data.yaml \
  --roles-path ~/roles \
  Controller Compute Networker</pre><p>
					This generates a single <code class="literal">my_roles_data.yaml</code> file from the individual roles in the <code class="literal">~/roles</code> directory.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The default roles collection also contains the <code class="literal">ControllerOpenStack</code> role, which does not include services for <code class="literal">Networker</code>, <code class="literal">Messaging</code>, and <code class="literal">Database</code> roles. You can use the <code class="literal">ControllerOpenStack</code> combined with with the standalone <code class="literal">Networker</code>, <code class="literal">Messaging</code>, and <code class="literal">Database</code> roles.
					</p></div></div></section><section class="section" id="supported-custom-roles"><div class="titlepage"><div><div><h3 class="title">6.2.3. Supported Custom Roles</h3></div></div></div><p>
					The following table contains information about the available custom roles. You can find custom role templates in the <code class="literal">/usr/share/openstack-tripleo-heat-templates/roles</code> directory.
				</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col><col style="width: 25%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097859129920" scope="col">Role</th><th align="left" valign="top" id="idm140097859128832" scope="col">Description</th><th align="left" valign="top" id="idm140097859127744" scope="col">File</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">BlockStorage</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									OpenStack Block Storage (cinder) node.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">BlockStorage.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">CephAll</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Full standalone Ceph Storage node. Includes OSD, MON, Object Gateway (RGW), Object Operations (MDS), Manager (MGR), and RBD Mirroring.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">CephAll.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">CephFile</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Standalone scale-out Ceph Storage file role. Includes OSD and Object Operations (MDS).
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">CephFile.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">CephObject</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Standalone scale-out Ceph Storage object role. Includes OSD and Object Gateway (RGW).
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">CephObject.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">CephStorage</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Ceph Storage OSD node role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">CephStorage.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeAlt</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Alternate Compute node role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeAlt.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeDVR</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									DVR enabled Compute node role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeDVR.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeHCI</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute node with hyper-converged infrastructure. Includes Compute and Ceph OSD services.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeHCI.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeInstanceHA</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute Instance HA node role. Use in conjunction with the <code class="literal">environments/compute-instanceha.yaml`</code> environment file.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeInstanceHA.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeLiquidio</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute node with Cavium Liquidio Smart NIC.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeLiquidio.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeOvsDpdkRT</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute OVS DPDK RealTime role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeOvsDpdkRT.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeOvsDpdk</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute OVS DPDK role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeOvsDpdk.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputePPC64LE</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute role for ppc64le servers.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputePPC64LE.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeRealTime</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute role optimized for real-time behaviour. When using this role, it is mandatory that an <code class="literal">overcloud-realtime-compute</code> image is available and the role specific parameters <code class="literal">IsolCpusList</code>, <code class="literal">NovaComputeCpuDedicatedSet</code> and <code class="literal">NovaComputeCpuSharedSet</code> are set according to the hardware of the real-time compute nodes.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeRealTime.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeSriovRT</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute SR-IOV RealTime role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeSriovRT.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ComputeSriov</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Compute SR-IOV role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ComputeSriov.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">Compute</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Standard Compute node role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">Compute.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ControllerAllNovaStandalone</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Controller role that does not contain the database, messaging, networking, and OpenStack Compute (nova) control components. Use in combination with the <code class="literal">Database</code>, <code class="literal">Messaging</code>, <code class="literal">Networker</code>, and <code class="literal">Novacontrol</code> roles.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ControllerAllNovaStandalone.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ControllerNoCeph</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Controller role with core Controller services loaded but no Ceph Storage (MON) components. This role handles database, messaging, and network functions but not any Ceph Storage functions.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ControllerNoCeph.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ControllerNovaStandalone</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Controller role that does not contain the OpenStack Compute (nova) control component. Use in combination with the <code class="literal">Novacontrol</code> role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ControllerNovaStandalone.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ControllerOpenstack</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Controller role that does not contain the database, messaging, and networking components. Use in combination with the <code class="literal">Database</code>, <code class="literal">Messaging</code>, and <code class="literal">Networker</code> roles.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ControllerOpenstack.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ControllerStorageNfs</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Controller role with all core services loaded and uses Ceph NFS. This roles handles database, messaging, and network functions.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ControllerStorageNfs.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">Controller</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Controller role with all core services loaded. This roles handles database, messaging, and network functions.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">Controller.yaml</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									<code class="literal">ControllerSriov</code> (ML2/OVN)
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									Same as the normal Controller role but with the OVN Metadata agent deployed.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">Database</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Standalone database role. Database managed as a Galera cluster using Pacemaker.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">Database.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">HciCephAll</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Compute node with hyper-converged infrastructure and all Ceph Storage services. Includes OSD, MON, Object Gateway (RGW), Object Operations (MDS), Manager (MGR), and RBD Mirroring.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">HciCephAll.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">HciCephFile</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Compute node with hyper-converged infrastructure and Ceph Storage file services. Includes OSD and Object Operations (MDS).
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">HciCephFile.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">HciCephMon</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Compute node with hyper-converged infrastructure and Ceph Storage block services. Includes OSD, MON, and Manager.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">HciCephMon.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">HciCephObject</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Compute node with hyper-converged infrastructure and Ceph Storage object services. Includes OSD and Object Gateway (RGW).
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">HciCephObject.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">IronicConductor</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Ironic Conductor node role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">IronicConductor.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">Messaging</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Standalone messaging role. RabbitMQ managed with Pacemaker.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">Messaging.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">Networker</code> (ML2/OVS)
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Standalone networking role under ML2/OVS. Runs OpenStack networking (neutron) agents on their own. If your deployment uses the ML2/OVN mechanism driver, see <a class="link" href="index.html#create-custom-network-role-ovn" title="6.2.4. Creating a Custom Networker Role with ML2/OVN">Creating a Custom Networker Role with ML2/OVN</a>.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">Networker.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">NetworkerSriov</code> (ML2/OVN)
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Same as the normal Networker role but with the OVN Metadata agent deployed. See <a class="link" href="index.html#create-custom-network-role-ovn" title="6.2.4. Creating a Custom Networker Role with ML2/OVN">Creating a Custom Networker Role with ML2/OVN</a>.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">NetworkerSriov.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">Novacontrol</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Standalone <code class="literal">nova-control</code> role to run OpenStack Compute (nova) control agents on their own.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">Novacontrol.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">ObjectStorage</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140097859129920"> <p>
									Swift Object Storage node role.
								</p>
								 </td><td align="left" valign="top" headers="idm140097859128832"> <p>
									<code class="literal">ObjectStorage.yaml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140097859127744"> <p>
									<code class="literal">Telemetry</code>
								</p>
								 </td></tr></tbody></table></div></section><section class="section" id="create-custom-network-role-ovn"><div class="titlepage"><div><div><h3 class="title">6.2.4. Creating a Custom Networker Role with ML2/OVN</h3></div></div></div><p>
					To deploy a custom networker role when your deployment uses the ML2/OVN mechanism driver, you must use an environment file to set the parameter for the role on networker nodes and clear it on controller nodes. Use an environment file such as <code class="literal">neutron-ovn-dvr-ha.yaml</code>.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							On controller nodes, clear <code class="literal">OVNCMSOptions</code>:
						</p><pre class="screen">ControllerParameters:
    OVNCMSOptions: ""</pre></li><li class="listitem"><p class="simpara">
							To deploy a custom network role without SR-IOV, on networker nodes set <code class="literal">OVNCMSOptions</code> to <code class="literal">'enable-chassis-as-gw'</code>:
						</p><pre class="screen">NetworkerParameters:
    OVNCMSOptions: "enable-chassis-as-gw"</pre></li><li class="listitem"><p class="simpara">
							To deploy a custom networker role with SR-IOV, add the following to networker nodes:
						</p><pre class="screen">NetworkerSriovParameters:
    OVNCMSOptions: "enable-chassis-as-gw"</pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The following limitations apply to the use of SR-IOV with ML2/OVN and native OVN DHCP in this release.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								All external ports are scheduled on a single gateway node because there is only one HA Chassis Group for all of the ports.
							</li><li class="listitem">
								Routing on VLAN tenant network does not work with SR-IOV because the external ports are not co-located with the logical router’s gateway ports. See <a class="link" href="https://bugs.launchpad.net/neutron/+bug/1875852">https://bugs.launchpad.net/neutron/+bug/1875852</a>.
							</li></ul></div></div></div></section><section class="section" id="Examining_Composable_Role_Parameters"><div class="titlepage"><div><div><h3 class="title">6.2.5. Examining Role Parameters</h3></div></div></div><p>
					Each role uses the following parameters:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">name</span></dt><dd>
								<span class="strong strong"><strong>(Mandatory)</strong></span> The name of the role, which is a plain text name with no spaces or special characters. Check that the chosen name does not cause conflicts with other resources. For example, use <code class="literal">Networker</code> as a name instead of <code class="literal">Network</code>.
							</dd><dt><span class="term">description</span></dt><dd>
								<span class="strong strong"><strong>(Optional)</strong></span> A plain text description for the role.
							</dd><dt><span class="term">tags</span></dt><dd><p class="simpara">
								<span class="strong strong"><strong>(Optional)</strong></span> A YAML list of tags that define role properties. Use this parameter to define the primary role with both the <code class="literal">controller</code> and <code class="literal">primary</code> tags together:
							</p><pre class="screen">- name: Controller
  ...
  tags:
    - primary
    - controller
  ...</pre></dd></dl></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						If you do not tag the primary role, the first role defined becomes the primary role. Ensure that this role is the Controller role.
					</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">networks</span></dt><dd><p class="simpara">
								A YAML list or dictionary of networks to configure on the role. If using a YAML list, list each composable network:
							</p><pre class="screen">  networks:
    - External
    - InternalApi
    - Storage
    - StorageMgmt
    - Tenant</pre><p class="simpara">
								If using a dictionary, map each network to a specific <code class="literal">subnet</code> in your composable networks.
							</p><pre class="screen">  networks:
    External:
      subnet: external_subnet
    InternalApi:
      subnet: internal_api_subnet
    Storage:
      subnet: storage_subnet
    StorageMgmt:
      subnet: storage_mgmt_subnet
    Tenant:
      subnet: tenant_subnet</pre><p class="simpara">
								Default networks include <code class="literal">External</code>, <code class="literal">InternalApi</code>, <code class="literal">Storage</code>, <code class="literal">StorageMgmt</code>, <code class="literal">Tenant</code>, and <code class="literal">Management</code>.
							</p></dd><dt><span class="term">CountDefault</span></dt><dd>
								<span class="strong strong"><strong>(Optional)</strong></span> Defines the default number of nodes to deploy for this role.
							</dd><dt><span class="term">HostnameFormatDefault</span></dt><dd><p class="simpara">
								<span class="strong strong"><strong>(Optional)</strong></span> Defines the default hostname format for the role. The default naming convention uses the following format:
							</p><pre class="screen">[STACK NAME]-[ROLE NAME]-[NODE ID]</pre><p class="simpara">
								For example, the default Controller nodes are named:
							</p><pre class="screen">overcloud-controller-0
overcloud-controller-1
overcloud-controller-2
...</pre></dd><dt><span class="term">disable_constraints</span></dt><dd>
								<span class="strong strong"><strong>(Optional)</strong></span> Defines whether to disable OpenStack Compute (nova) and OpenStack Image Storage (glance) constraints when deploying with the director. Used when deploying an overcloud with pre-provisioned nodes. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/director_installation_and_usage/configuring-a-basic-overcloud-with-pre-provisioned-nodes">Configuring a Basic Overcloud with Pre-Provisioned Nodes</a> in the <span class="emphasis"><em>Director Installation and Usage</em></span> guide.
							</dd><dt><span class="term">update_serial</span></dt><dd><p class="simpara">
								<span class="strong strong"><strong>(Optional)</strong></span> Defines how many nodes to update simultaneously during the OpenStack update options. In the default <code class="literal">roles_data.yaml</code> file:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										The default is <code class="literal">1</code> for Controller, Object Storage, and Ceph Storage nodes.
									</li><li class="listitem">
										The default is <code class="literal">25</code> for Compute and Block Storage nodes.
									</li></ul></div><p class="simpara">
								If you omit this parameter from a custom role, the default is <code class="literal">1</code>.
							</p></dd><dt><span class="term">ServicesDefault</span></dt><dd>
								<span class="strong strong"><strong>(Optional)</strong></span> Defines the default list of services to include on the node. See <a class="xref" href="index.html#Examining_Composable_Service_Architecture" title="6.3.2. Examining Composable Service Architecture">Section 6.3.2, “Examining Composable Service Architecture”</a> for more information.
							</dd></dl></div><p>
					These parameters provide a means to create new roles and also define which services to include.
				</p><p>
					The <code class="literal">openstack overcloud deploy</code> command integrates the parameters from the <code class="literal">roles_data</code> file into some of the Jinja2-based templates. For example, at certain points, the <code class="literal">overcloud.j2.yaml</code> Heat template iterates over the list of roles from <code class="literal">roles_data.yaml</code> and creates parameters and resources specific to each respective role.
				</p><p>
					The resource definition for each role in the <code class="literal">overcloud.j2.yaml</code> Heat template appears as the following snippet:
				</p><pre class="screen">  {{role.name}}:
    type: OS::Heat::ResourceGroup
    depends_on: Networks
    properties:
      count: {get_param: {{role.name}}Count}
      removal_policies: {get_param: {{role.name}}RemovalPolicies}
      resource_def:
        type: OS::TripleO::{{role.name}}
        properties:
          CloudDomain: {get_param: CloudDomain}
          ServiceNetMap: {get_attr: [ServiceNetMap, service_net_map]}
          EndpointMap: {get_attr: [EndpointMap, endpoint_map]}
...</pre><p>
					This snippet shows how the Jinja2-based template incorporates the <code class="literal">{{role.name}}</code> variable to define the name of each role as a <code class="literal">OS::Heat::ResourceGroup</code> resource. This in turn uses each <code class="literal">name</code> parameter from the <code class="literal">roles_data</code> file to name each respective <code class="literal">OS::Heat::ResourceGroup</code> resource.
				</p></section><section class="section" id="sect-Creating_a_New_Role"><div class="titlepage"><div><div><h3 class="title">6.2.6. Creating a New Role</h3></div></div></div><p>
					In this example, the aim is to create a new <code class="literal">Horizon</code> role to host the OpenStack Dashboard (<code class="literal">horizon</code>) only. In this situation, you create a custom <code class="literal">roles</code> directory that includes the new role information.
				</p><p>
					Create a custom copy of the default <code class="literal">roles</code> directory:
				</p><pre class="screen">$ cp -r /usr/share/openstack-tripleo-heat-templates/roles ~/.</pre><p>
					Create a new file called <code class="literal">~/roles/Horizon.yaml</code> and create a new <code class="literal">Horizon</code> role containing base and core OpenStack Dashboard services. For example:
				</p><pre class="screen">- name: Horizon
  CountDefault: 1
  HostnameFormatDefault: '%stackname%-horizon-%index%'
  ServicesDefault:
    - OS::TripleO::Services::CACerts
    - OS::TripleO::Services::Kernel
    - OS::TripleO::Services::Ntp
    - OS::TripleO::Services::Snmp
    - OS::TripleO::Services::Sshd
    - OS::TripleO::Services::Timezone
    - OS::TripleO::Services::TripleoPackages
    - OS::TripleO::Services::TripleoFirewall
    - OS::TripleO::Services::SensuClient
    - OS::TripleO::Services::FluentdClient
    - OS::TripleO::Services::AuditD
    - OS::TripleO::Services::Collectd
    - OS::TripleO::Services::MySQLClient
    - OS::TripleO::Services::Apache
    - OS::TripleO::Services::Horizon</pre><p>
					It is a good idea to set the <code class="literal">CountDefault</code> to <code class="literal">1</code> so that a default Overcloud always includes the <code class="literal">Horizon</code> node.
				</p><p>
					If scaling the services in an existing overcloud, keep the existing services on the <code class="literal">Controller</code> role. If creating a new overcloud and you want the OpenStack Dashboard to remain on the standalone role, remove the OpenStack Dashboard components from the <code class="literal">Controller</code> role definition:
				</p><pre class="screen">- name: Controller
  CountDefault: 1
  ServicesDefault:
    ...
    - OS::TripleO::Services::GnocchiMetricd
    - OS::TripleO::Services::GnocchiStatsd
    - OS::TripleO::Services::HAproxy
    - OS::TripleO::Services::HeatApi
    - OS::TripleO::Services::HeatApiCfn
    - OS::TripleO::Services::HeatApiCloudwatch
    - OS::TripleO::Services::HeatEngine
    # - OS::TripleO::Services::Horizon                # Remove this service
    - OS::TripleO::Services::IronicApi
    - OS::TripleO::Services::IronicConductor
    - OS::TripleO::Services::Iscsid
    - OS::TripleO::Services::Keepalived
    ...</pre><p>
					Generate the new <code class="literal">roles_data</code> file using the <code class="literal">roles</code> directory as the source:
				</p><pre class="screen">$ openstack overcloud roles generate -o roles_data-horizon.yaml \
  --roles-path ~/roles \
  Controller Compute Horizon</pre><p>
					You might need to define a new flavor for this role so that you can tag specific nodes. For this example, use the following commands to create a <code class="literal">horizon</code> flavor:
				</p><pre class="screen">$ openstack flavor create --id auto --ram 6144 --disk 40 --vcpus 4 horizon
$ openstack flavor set --property "cpu_arch"="x86_64" --property "capabilities:boot_option"="local" --property "capabilities:profile"="horizon" horizon
$ openstack flavor set --property resources:VCPU=0 --property resources:MEMORY_MB=0 --property resources:DISK_GB=0 --property resources:CUSTOM_BAREMETAL=1 horizon</pre><p>
					Tag nodes into the new flavor using the following command:
				</p><pre class="screen">$ openstack baremetal node set --property capabilities='profile:horizon,boot_option:local' 58c3d07e-24f2-48a7-bbb6-6843f0e8ee13</pre><p>
					Define the Horizon node count and flavor using the following environment file snippet:
				</p><pre class="screen">parameter_defaults:
  OvercloudHorizonFlavor: horizon
  HorizonCount: 1</pre><p>
					Include the new <code class="literal">roles_data</code> file and environment file when running the <code class="literal">openstack overcloud deploy</code> command. For example:
				</p><pre class="screen">$ openstack overcloud deploy --templates -r ~/templates/roles_data-horizon.yaml -e ~/templates/node-count-flavor.yaml</pre><p>
					When the deployment completes, this creates a three-node Overcloud consisting of one Controller node, one Compute node, and one Networker node. To view the Overcloud’s list of nodes, run the following command:
				</p><pre class="screen">$ openstack server list</pre></section></section><section class="section" id="composable_services"><div class="titlepage"><div><div><h2 class="title">6.3. Composable Services</h2></div></div></div><section class="section" id="sect-Composable_Services-Guidelines"><div class="titlepage"><div><div><h3 class="title">6.3.1. Guidelines and Limitations</h3></div></div></div><p>
					Note the following guidelines and limitations for the composable node architecture.
				</p><p>
					For services not managed by Pacemaker:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							You can assign services to standalone custom roles.
						</li><li class="listitem">
							You can create additional custom roles after the initial deployment and deploy them to scale existing services.
						</li></ul></div><p>
					For services managed by Pacemaker:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							You can assign Pacemaker-managed services to standalone custom roles.
						</li><li class="listitem">
							Pacemaker has a 16 node limit. If you assign the Pacemaker service (<code class="literal">OS::TripleO::Services::Pacemaker</code>) to 16 nodes, subsequent nodes must use the Pacemaker Remote service (<code class="literal">OS::TripleO::Services::PacemakerRemote</code>) instead. You cannot have the Pacemaker service and Pacemaker Remote service on the same role.
						</li><li class="listitem">
							Do not include the Pacemaker service (<code class="literal">OS::TripleO::Services::Pacemaker</code>) on roles that do not contain Pacemaker-managed services.
						</li><li class="listitem">
							You cannot scale up or scale down a custom role that contains <code class="literal">OS::TripleO::Services::Pacemaker</code> or <code class="literal">OS::TripleO::Services::PacemakerRemote</code> services.
						</li></ul></div><p>
					General limitations:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							You cannot change custom roles and composable services during the a major version upgrade.
						</li><li class="listitem">
							You cannot modify the list of services for any role after deploying an Overcloud. Modifying the service lists after Overcloud deployment can cause deployment errors and leave orphaned services on nodes.
						</li></ul></div></section><section class="section" id="Examining_Composable_Service_Architecture"><div class="titlepage"><div><div><h3 class="title">6.3.2. Examining Composable Service Architecture</h3></div></div></div><p>
					The core Heat template collection contains two sets of composable service templates:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">deployment</code> contains the templates for key OpenStack Platform services.
						</li><li class="listitem">
							<code class="literal">puppet/services</code> contains legacy templates for configuring composable services. In some cases, the composable services use templates from this directory for compatibility. In most cases, the composable services use the templates in the <code class="literal">deployment</code> directory.
						</li></ul></div><p>
					Each template contains a description that identifies its purpose. For example, the <code class="literal">deployment/time/ntp-baremetal-puppet.yaml</code> service template contains the following description:
				</p><pre class="screen">description: &gt;
  NTP service deployment using puppet, this YAML file
  creates the interface between the HOT template
  and the puppet manifest that actually installs
  and configure NTP.</pre><p>
					These service templates are registered as resources specific to a Red Hat OpenStack Platform deployment. This means you can call each resource using a unique Heat resource namespace defined in the <code class="literal">overcloud-resource-registry-puppet.j2.yaml</code> file. All services use the <code class="literal">OS::TripleO::Services</code> namespace for their resource type.
				</p><p>
					Some resources use the base composable service templates directly. For example:
				</p><pre class="screen">resource_registry:
  ...
  OS::TripleO::Services::Ntp: deployment/time/ntp-baremetal-puppet.yaml
  ...</pre><p>
					However, core services require containers and use the containerized service templates. For example, the <code class="literal">keystone</code> containerized service uses the following resource:
				</p><pre class="screen">resource_registry:
  ...
  OS::TripleO::Services::Keystone: deployment/keystone/keystone-container-puppet.yaml
  ...</pre><p>
					These containerized templates usually reference other templates to include dependencies. For example, the <code class="literal">deployment/keystone/keystone-container-puppet.yaml</code> template stores the output of the base template in the <code class="literal">ContainersCommon</code> resource:
				</p><pre class="screen">resources:
  ContainersCommon:
    type: ../containers-common.yaml</pre><p>
					The containerized template can then incorporate functions and data from the <code class="literal">containers-common.yaml</code> template.
				</p><p>
					The <code class="literal">overcloud.j2.yaml</code> Heat template includes a section of Jinja2-based code to define a service list for each custom role in the <code class="literal">roles_data.yaml</code> file:
				</p><pre class="screen">{{role.name}}Services:
  description: A list of service resources (configured in the Heat
               resource_registry) which represent nested stacks
               for each service that should get installed on the {{role.name}} role.
  type: comma_delimited_list
  default: {{role.ServicesDefault|default([])}}</pre><p>
					For the default roles, this creates the following service list parameters: <code class="literal">ControllerServices</code>, <code class="literal">ComputeServices</code>, <code class="literal">BlockStorageServices</code>, <code class="literal">ObjectStorageServices</code>, and <code class="literal">CephStorageServices</code>.
				</p><p>
					You define the default services for each custom role in the <code class="literal">roles_data.yaml</code> file. For example, the default Controller role contains the following content:
				</p><pre class="screen">- name: Controller
  CountDefault: 1
  ServicesDefault:
    - OS::TripleO::Services::CACerts
    - OS::TripleO::Services::CephMon
    - OS::TripleO::Services::CephExternal
    - OS::TripleO::Services::CephRgw
    - OS::TripleO::Services::CinderApi
    - OS::TripleO::Services::CinderBackup
    - OS::TripleO::Services::CinderScheduler
    - OS::TripleO::Services::CinderVolume
    - OS::TripleO::Services::Core
    - OS::TripleO::Services::Kernel
    - OS::TripleO::Services::Keystone
    - OS::TripleO::Services::GlanceApi
    - OS::TripleO::Services::GlanceRegistry
...</pre><p>
					These services are then defined as the default list for the <code class="literal">ControllerServices</code> parameter.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can also use an environment file to override the default list for the service parameters. For example, you can define <code class="literal">ControllerServices</code> as a <code class="literal">parameter_default</code> in an environment file to override the services list from the <code class="literal">roles_data.yaml</code> file.
					</p></div></div></section><section class="section" id="sect-Adding_and_Removing_Services_from_Roles"><div class="titlepage"><div><div><h3 class="title">6.3.3. Adding and Removing Services from Roles</h3></div></div></div><p>
					The basic method of adding or removing services involves creating a copy of the default service list for a node role and then adding or removing services. For example, you might aim to remove OpenStack Orchestration (<code class="literal">heat</code>) from the Controller nodes. In this situation, create a custom copy of the default <code class="literal">roles</code> directory:
				</p><pre class="screen">$ cp -r /usr/share/openstack-tripleo-heat-templates/roles ~/.</pre><p>
					Edit the <code class="literal">~/roles/Controller.yaml</code> file and modify the service list for the <code class="literal">ServicesDefault</code> parameter. Scroll to the OpenStack Orchestration services and remove them:
				</p><pre class="screen">    - OS::TripleO::Services::GlanceApi
    - OS::TripleO::Services::GlanceRegistry
    - OS::TripleO::Services::HeatApi            # Remove this service
    - OS::TripleO::Services::HeatApiCfn         # Remove this service
    - OS::TripleO::Services::HeatApiCloudwatch  # Remove this service
    - OS::TripleO::Services::HeatEngine         # Remove this service
    - OS::TripleO::Services::MySQL
    - OS::TripleO::Services::NeutronDhcpAgent</pre><p>
					Generate the new <code class="literal">roles_data</code> file. For example:
				</p><pre class="screen">$ openstack overcloud roles generate -o roles_data-no_heat.yaml \
  --roles-path ~/roles \
  Controller Compute Networker</pre><p>
					Include this new <code class="literal">roles_data</code> file when running the <code class="literal">openstack overcloud deploy</code> command. For example:
				</p><pre class="screen">$ openstack overcloud deploy --templates -r ~/templates/roles_data-no_heat.yaml</pre><p>
					This deploys an Overcloud without OpenStack Orchestration services installed on the Controller nodes.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can also disable services in the <code class="literal">roles_data</code> file using a custom environment file. Redirect the services to disable to the <code class="literal">OS::Heat::None</code> resource. For example:
					</p><pre class="screen">resource_registry:
  OS::TripleO::Services::HeatApi: OS::Heat::None
  OS::TripleO::Services::HeatApiCfn: OS::Heat::None
  OS::TripleO::Services::HeatApiCloudwatch: OS::Heat::None
  OS::TripleO::Services::HeatEngine: OS::Heat::None</pre></div></div></section><section class="section" id="sect-Enabling_Disabled_Services"><div class="titlepage"><div><div><h3 class="title">6.3.4. Enabling Disabled Services</h3></div></div></div><p>
					Some services are disabled by default. These services are registered as null operations (<code class="literal">OS::Heat::None</code>) in the <code class="literal">overcloud-resource-registry-puppet.j2.yaml</code> file. For example, the Block Storage backup service (<code class="literal">cinder-backup</code>) is disabled:
				</p><pre class="screen">  OS::TripleO::Services::CinderBackup: OS::Heat::None</pre><p>
					To enable this service, include an environment file that links the resource to its respective Heat templates in the <code class="literal">puppet/services</code> directory. Some services have predefined environment files in the <code class="literal">environments</code> directory. For example, the Block Storage backup service uses the <code class="literal">environments/cinder-backup.yaml</code> file, which contains the following:
				</p><pre class="screen">resource_registry:
  OS::TripleO::Services::CinderBackup: ../podman/services/pacemaker/cinder-backup.yaml
...</pre><p>
					This overrides the default null operation resource and enables the service. Include this environment file when running the <code class="literal">openstack overcloud deploy</code> command.
				</p><pre class="screen">$ openstack overcloud deploy --templates -e /usr/share/openstack-tripleo-heat-templates/environments/cinder-backup.yaml</pre></section><section class="section" id="sect-Creating_a_Generic_Node_with_No_Services"><div class="titlepage"><div><div><h3 class="title">6.3.5. Creating a Generic Node with No Services</h3></div></div></div><p>
					Red Hat OpenStack Platform provides the ability to create generic Red Hat Enterprise Linux 8 nodes without any OpenStack services configured. This is useful when you need to host software outside of the core Red Hat OpenStack Platform environment. For example, OpenStack Platform provides integration with monitoring tools such as Kibana and Sensu, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/monitoring_tools_configuration_guide"><span class="emphasis"><em>Monitoring Tools Configuration Guide</em></span></a>. While Red Hat does not provide support for the monitoring tools themselves, the director can create a generic Red Hat Enterprise Linux 8 node to host these tools.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The generic node still uses the base <code class="literal">overcloud-full</code> image rather than a base Red Hat Enterprise Linux 8 image. This means the node has some Red Hat OpenStack Platform software installed but not enabled or configured.
					</p></div></div><p>
					Creating a generic node requires a new role without a <code class="literal">ServicesDefault</code> list:
				</p><pre class="screen">- name: Generic</pre><p>
					Include the role in your custom <code class="literal">roles_data</code> file (<code class="literal">roles_data_with_generic.yaml</code>). Make sure to keep the existing <code class="literal">Controller</code> and <code class="literal">Compute</code> roles.
				</p><p>
					You can also include an environment file (<code class="literal">generic-node-params.yaml</code>) to specify how many generic Red Hat Enterprise Linux 8 nodes you require and the flavor when selecting nodes to provision. For example:
				</p><pre class="screen">parameter_defaults:
  OvercloudGenericFlavor: baremetal
  GenericCount: 1</pre><p>
					Include both the roles file and the environment file when running the <code class="literal">openstack overcloud deploy</code> command. For example:
				</p><pre class="screen">$ openstack overcloud deploy --templates -r ~/templates/roles_data_with_generic.yaml -e ~/templates/generic-node-params.yaml</pre><p>
					This deploys a three-node environment with one Controller node, one Compute node, and one generic Red Hat Enterprise Linux 8 node.
				</p></section></section></section><section class="chapter" id="sect-Containerized_Services"><div class="titlepage"><div><div><h1 class="title">Chapter 7. Containerized Services</h1></div></div></div><p>
			The director installs the core OpenStack Platform services as containers on the overcloud. This section provides some background information on how containerized services work.
		</p><section class="section" id="sect-Containerized_Service_Architecture"><div class="titlepage"><div><div><h2 class="title">7.1. Containerized Service Architecture</h2></div></div></div><p>
				The director installs the core OpenStack Platform services as containers on the overcloud. The templates for the containerized services are located in the <code class="literal">/usr/share/openstack-tripleo-heat-templates/deployment/</code>.
			</p><p>
				All nodes using containerized services must enable the <code class="literal">OS::TripleO::Services::Podman</code> service. When you create a <code class="literal">roles_data.yaml</code> file for your custom roles configuration, include the <code class="literal">OS::TripleO::Services::Podman</code> service with the base composable services, as the containerized services. For example, the <code class="literal">IronicConductor</code> role uses the following role definition:
			</p><pre class="screen">- name: IronicConductor
  description: |
    Ironic Conductor node role
  networks:
    InternalApi:
      subnet: internal_api_subnet
    Storage:
      subnet: storage_subnet
  HostnameFormatDefault: '%stackname%-ironic-%index%'
  ServicesDefault:
    - OS::TripleO::Services::Aide
    - OS::TripleO::Services::AuditD
    - OS::TripleO::Services::BootParams
    - OS::TripleO::Services::CACerts
    - OS::TripleO::Services::CertmongerUser
    - OS::TripleO::Services::Collectd
    - OS::TripleO::Services::Docker
    - OS::TripleO::Services::Fluentd
    - OS::TripleO::Services::IpaClient
    - OS::TripleO::Services::Ipsec
    - OS::TripleO::Services::IronicConductor
    - OS::TripleO::Services::IronicPxe
    - OS::TripleO::Services::Kernel
    - OS::TripleO::Services::LoginDefs
    - OS::TripleO::Services::MetricsQdr
    - OS::TripleO::Services::MySQLClient
    - OS::TripleO::Services::ContainersLogrotateCrond
    - OS::TripleO::Services::Podman
    - OS::TripleO::Services::Rhsm
    - OS::TripleO::Services::SensuClient
    - OS::TripleO::Services::Snmp
    - OS::TripleO::Services::Timesync
    - OS::TripleO::Services::Timezone
    - OS::TripleO::Services::TripleoFirewall
    - OS::TripleO::Services::TripleoPackages
    - OS::TripleO::Services::Tuned</pre></section><section class="section" id="sect-Containerized_Service_Parameters"><div class="titlepage"><div><div><h2 class="title">7.2. Containerized Service Parameters</h2></div></div></div><p>
				Each containerized service template contains an <code class="literal">outputs</code> section that defines a data set passed to the director’s OpenStack Orchestration (Heat) service. In addition to the standard composable service parameters (see <a class="xref" href="index.html#Examining_Composable_Role_Parameters" title="6.2.5. Examining Role Parameters">Section 6.2.5, “Examining Role Parameters”</a>), the template contain a set of parameters specific to the container configuration.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">puppet_config</code></span></dt><dd><p class="simpara">
							Data to pass to Puppet when configuring the service. In the initial overcloud deployment steps, the director creates a set of containers used to configure the service before the actual containerized service runs. This parameter includes the following sub-parameters: +
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<code class="literal">config_volume</code> - The mounted volume that stores the configuration.
								</li><li class="listitem">
									<code class="literal">puppet_tags</code> - Tags to pass to Puppet during configuration. These tags are used in OpenStack Platform to restrict the Puppet run to a particular service’s configuration resource. For example, the OpenStack Identity (keystone) containerized service uses the <code class="literal">keystone_config</code> tag to ensure that all require only the <code class="literal">keystone_config</code> Puppet resource run on the configuration container.
								</li><li class="listitem">
									<code class="literal">step_config</code> - The configuration data passed to Puppet. This is usually inherited from the referenced composable service.
								</li><li class="listitem">
									<code class="literal">config_image</code> - The container image used to configure the service.
								</li></ul></div></dd><dt><span class="term"><code class="literal">kolla_config</code></span></dt><dd>
							A set of container-specific data that defines configuration file locations, directory permissions, and the command to run on the container to launch the service.
						</dd><dt><span class="term"><code class="literal">docker_config</code></span></dt><dd><p class="simpara">
							Tasks to run on the service’s configuration container. All tasks are grouped into the following steps to help the director perform a staged deployment:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<span class="strong strong"><strong>Step 1</strong></span> - Load balancer configuration
								</li><li class="listitem">
									<span class="strong strong"><strong>Step 2</strong></span> - Core services (Database, Redis)
								</li><li class="listitem">
									<span class="strong strong"><strong>Step 3</strong></span> - Initial configuration of OpenStack Platform service
								</li><li class="listitem">
									<span class="strong strong"><strong>Step 4</strong></span> - General OpenStack Platform services configuration
								</li><li class="listitem">
									<span class="strong strong"><strong>Step 5</strong></span> - Service activation
								</li></ul></div></dd><dt><span class="term"><code class="literal">host_prep_tasks</code></span></dt><dd>
							Preparation tasks for the bare metal node to accommodate the containerized service.
						</dd></dl></div></section><section class="section" id="preparing-container-images"><div class="titlepage"><div><div><h2 class="title">7.3. Preparing container images</h2></div></div></div><p>
				The overcloud installation requires an environment file to determine where to obtain container images and how to store them. Generate and customize this environment file that you can use to prepare your container images.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Log in to your undercloud host as the <code class="literal">stack</code> user.
					</li><li class="listitem"><p class="simpara">
						Generate the default container image preparation file:
					</p><pre class="screen">$ openstack tripleo container image prepare default \
  --local-push-destination \
  --output-env-file containers-prepare-parameter.yaml</pre><p class="simpara">
						This command includes the following additional options:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">--local-push-destination</code> sets the registry on the undercloud as the location for container images. With this option, director pulls the necessary images from the Red Hat Container Catalog and pushes the images to the registry on the undercloud. Director uses the undercloud registry as the container image source. To pull container images directly from the Red Hat Container Catalog, omit this option.
							</li><li class="listitem"><p class="simpara">
								<code class="literal">--output-env-file</code> specifies an environment file that includes include the parameters for preparing your container images. In this example, the name of the file is <code class="literal">containers-prepare-parameter.yaml</code>.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									You can use the same <code class="literal">containers-prepare-parameter.yaml</code> file to define a container image source for both the undercloud and the overcloud.
								</p></div></div></li></ul></div></li><li class="listitem">
						Modify the <code class="literal">containers-prepare-parameter.yaml</code> to suit your requirements.
					</li></ol></div></section><section class="section" id="container-image-preparation-parameters"><div class="titlepage"><div><div><h2 class="title">7.4. Container image preparation parameters</h2></div></div></div><p>
				The default file for preparing your containers (<code class="literal">containers-prepare-parameter.yaml</code>) contains the <code class="literal">ContainerImagePrepare</code> heat parameter. This parameter defines a list of strategies for preparing a set of images:
			</p><pre class="screen">parameter_defaults:
  ContainerImagePrepare:
  - (strategy one)
  - (strategy two)
  - (strategy three)
  ...</pre><p>
				Each strategy accepts a set of sub-parameters that defines which images to use and what to do with the images. The following table contains information about the sub-parameters you can use with each <code class="literal">ContainerImagePrepare</code> strategy:
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097849180112" scope="col">Parameter</th><th align="left" valign="top" id="idm140097849179024" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">excludes</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								List of image name substrings to exclude from a strategy.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">includes</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								List of image name substrings to include in a strategy. At least one image name must match an existing image. All <code class="literal">excludes</code> are ignored if <code class="literal">includes</code> is specified.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">modify_append_tag</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								String to append to the tag for the destination image. For example, if you pull an image with the tag <code class="literal">14.0-89</code> and set the <code class="literal">modify_append_tag</code> to <code class="literal">-hotfix</code>, the director tags the final image as <code class="literal">14.0-89-hotfix</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">modify_only_with_labels</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								A dictionary of image labels that filter the images that you want to modify. If an image matches the labels defined, the director includes the image in the modification process.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">modify_role</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								String of ansible role names to run during upload but before pushing the image to the destination registry.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">modify_vars</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								Dictionary of variables to pass to <code class="literal">modify_role</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">push_destination</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								Defines the namespace of the registry that you want to push images to during the upload process.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										If set to <code class="literal">true</code>, the <code class="literal">push_destination</code> is set to the undercloud registry namespace using the hostname, which is the recommended method.
									</li><li class="listitem">
										If set to <code class="literal">false</code>, the push to a local registry does not occur and nodes pull images directly from the source.
									</li><li class="listitem">
										If set to a custom value, director pushes images to an external local registry.
									</li></ul></div>
							 <p>
								If you choose to pull container images directly from the Red Hat Container Catalog, do not set this parameter to <code class="literal">false</code> in production environments or else all overcloud nodes will simultaneously pull the images from the Red Hat Container Catalog over your external connection, which can cause bandwidth issues. If the <code class="literal">push_destination</code> parameter is set to <code class="literal">false</code> or is not defined and the remote registry requires authentication, set the <code class="literal">ContainerImageRegistryLogin</code> parameter to <code class="literal">true</code> and include the credentials with the <code class="literal">ContainerImageRegistryCredentials</code> parameter.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">pull_source</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								The source registry from where to pull the original container images.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">set</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								A dictionary of <code class="literal">key: value</code> definitions that define where to obtain the initial images.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097849180112"> <p>
								<code class="literal">tag_from_label</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097849179024"> <p>
								Defines the label pattern to tag the resulting images. Usually sets to <code class="literal">{version}-{release}</code>.
							</p>
							 </td></tr></tbody></table></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					When you push images to the undercloud, use <code class="literal">push_destination: true</code> instead of <code class="literal">push_destination: UNDERCLOUD_IP:PORT</code>. The <code class="literal">push_destination: true</code> method provides a level of consistency across both IPv4 and IPv6 addresses.
				</p></div></div><p>
				The <code class="literal">set</code> parameter accepts a set of <code class="literal">key: value</code> definitions:
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097853391792" scope="col">Key</th><th align="left" valign="top" id="idm140097860192272" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097853391792"> <p>
								<code class="literal">ceph_image</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860192272"> <p>
								The name of the Ceph Storage container image.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853391792"> <p>
								<code class="literal">ceph_namespace</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860192272"> <p>
								The namespace of the Ceph Storage container image.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853391792"> <p>
								<code class="literal">ceph_tag</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860192272"> <p>
								The tag of the Ceph Storage container image.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853391792"> <p>
								<code class="literal">name_prefix</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860192272"> <p>
								A prefix for each OpenStack service image.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853391792"> <p>
								<code class="literal">name_suffix</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860192272"> <p>
								A suffix for each OpenStack service image.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853391792"> <p>
								<code class="literal">namespace</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860192272"> <p>
								The namespace for each OpenStack service image.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853391792"> <p>
								<code class="literal">neutron_driver</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860192272"> <p>
								The driver to use to determine which OpenStack Networking (neutron) container to use. Use a null value to set to the standard <code class="literal">neutron-server</code> container. Set to <code class="literal">ovn</code> to use OVN-based containers.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853391792"> <p>
								<code class="literal">tag</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097860192272"> <p>
								The tag that the director uses to identify the images to pull from the source registry. You usually keep this key set to the default value, which is the Red Hat OpenStack Platform version number.
							</p>
							 </td></tr></tbody></table></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The container images use multi-stream tags based on Red Hat OpenStack Platform version. This means there is no longer a <code class="literal">latest</code> tag.
				</p></div></div><p>
				The <code class="literal">ContainerImageRegistryCredentials</code> parameter maps a container registry to a username and password to authenticate to that registry.
			</p><p>
				If a container registry requires a username and password, you can use <code class="literal">ContainerImageRegistryCredentials</code> to include credentials with the following syntax:
			</p><pre class="screen">  ContainerImagePrepare:
  - push_destination: true
    set:
      namespace: registry.redhat.io/...
      ...
  ContainerImageRegistryCredentials:
    registry.redhat.io:
      my_username: my_password</pre><p>
				In the example, replace <code class="literal">my_username</code> and <code class="literal">my_password</code> with your authentication credentials. Instead of using your individual user credentials, Red Hat recommends creating a registry service account and using those credentials to access <code class="literal">registry.redhat.io</code> content. For more information, see <a class="link" href="https://access.redhat.com/RegistryAuthentication">"Red Hat Container Registry Authentication"</a>.
			</p><p>
				The <code class="literal">ContainerImageRegistryLogin</code> parameter is used to control the registry login on the systems being deployed. This must be set to <code class="literal">true</code> if <code class="literal">push_destination</code> is set to false or not used.
			</p><pre class="screen">  ContainerImagePrepare:
  - set:
      namespace: registry.redhat.io/...
      ...
  ContainerImageRegistryCredentials:
    registry.redhat.io:
      my_username: my_password
  ContainerImageRegistryLogin: true</pre><p>
				If you have configured <code class="literal">push_destination</code>, do not set <code class="literal">ContainerImageRegistryLogin</code> to <code class="literal">true</code>. If you set this option to <code class="literal">true</code> and the overcloud nodes do not have network connectivity to the registry hosts defined in <code class="literal">ContainerImageRegistryCredentials</code>, the deployment might fail when trying to perform a login.
			</p></section><section class="section" id="layering-image-preparation-entries"><div class="titlepage"><div><div><h2 class="title">7.5. Layering image preparation entries</h2></div></div></div><p>
				The value of the <code class="literal">ContainerImagePrepare</code> parameter is a YAML list. This means that you can specify multiple entries. The following example demonstrates two entries where director uses the latest version of all images except for the <code class="literal">nova-api</code> image, which uses the version tagged with <code class="literal">16.0-44</code>:
			</p><pre class="screen">ContainerImagePrepare:
- tag_from_label: "{version}-{release}"
  push_destination: true
  excludes:
  - nova-api
  set:
    namespace: registry.redhat.io/rhosp-rhel8
    name_prefix: openstack-
    name_suffix: ''
    tag: 16.1
- push_destination: true
  includes:
  - nova-api
  set:
    namespace: registry.redhat.io/rhosp-rhel8
    tag: 16.1-44</pre><p>
				The <code class="literal">includes</code> and <code class="literal">excludes</code> entries control image filtering for each entry. The images that match the <code class="literal">includes</code> strategy take precedence over <code class="literal">excludes</code> matches. The image name must contain the <code class="literal">includes</code> or <code class="literal">excludes</code> value to be considered a match.
			</p></section><section class="section" id="modifying-images-during-preparation"><div class="titlepage"><div><div><h2 class="title">7.6. Modifying images during preparation</h2></div></div></div><p>
				It is possible to modify images during image preparation, and then immediately deploy with modified images. Scenarios for modifying images include:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						As part of a continuous integration pipeline where images are modified with the changes being tested before deployment.
					</li><li class="listitem">
						As part of a development workflow where local changes must be deployed for testing and development.
					</li><li class="listitem">
						When changes must be deployed but are not available through an image build pipeline. For example, adding proprietary add-ons or emergency fixes.
					</li></ul></div><p>
				To modify an image during preparation, invoke an Ansible role on each image that you want to modify. The role takes a source image, makes the requested changes, and tags the result. The prepare command can push the image to the destination registry and set the heat parameters to refer to the modified image.
			</p><p>
				The Ansible role <code class="literal">tripleo-modify-image</code> conforms with the required role interface and provides the behaviour necessary for the modify use cases. Control the modification with the modify-specific keys in the <code class="literal">ContainerImagePrepare</code> parameter:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">modify_role</code> specifies the Ansible role to invoke for each image to modify.
					</li><li class="listitem">
						<code class="literal">modify_append_tag</code> appends a string to the end of the source image tag. This makes it obvious that the resulting image has been modified. Use this parameter to skip modification if the <code class="literal">push_destination</code> registry already contains the modified image. Change <code class="literal">modify_append_tag</code> whenever you modify the image.
					</li><li class="listitem">
						<code class="literal">modify_vars</code> is a dictionary of Ansible variables to pass to the role.
					</li></ul></div><p>
				To select a use case that the <code class="literal">tripleo-modify-image</code> role handles, set the <code class="literal">tasks_from</code> variable to the required file in that role.
			</p><p>
				While developing and testing the <code class="literal">ContainerImagePrepare</code> entries that modify images, run the image prepare command without any additional options to confirm that the image is modified as you expect:
			</p><pre class="screen">sudo openstack tripleo container image prepare \
  -e ~/containers-prepare-parameter.yaml</pre></section><section class="section" id="updating-existing-packages-on-container-images"><div class="titlepage"><div><div><h2 class="title">7.7. Updating existing packages on container images</h2></div></div></div><p>
				The following example <code class="literal">ContainerImagePrepare</code> entry updates in all packages on the container images using the dnf repository configuration of the undercloud host:
			</p><pre class="screen">ContainerImagePrepare:
- push_destination: true
  ...
  modify_role: tripleo-modify-image
  modify_append_tag: "-updated"
  modify_vars:
    tasks_from: yum_update.yml
    compare_host_packages: true
    yum_repos_dir_path: /etc/yum.repos.d
  ...</pre></section><section class="section" id="installing-additional-rpm-files-to-container-images"><div class="titlepage"><div><div><h2 class="title">7.8. Installing additional RPM files to container images</h2></div></div></div><p>
				You can install a directory of RPM files in your container images. This is useful for installing hotfixes, local package builds, or any package that is not available through a package repository. For example, the following <code class="literal">ContainerImagePrepare</code> entry installs some hotfix packages only on the <code class="literal">nova-compute</code> image:
			</p><pre class="screen">ContainerImagePrepare:
- push_destination: true
  ...
  includes:
  - nova-compute
  modify_role: tripleo-modify-image
  modify_append_tag: "-hotfix"
  modify_vars:
    tasks_from: rpm_install.yml
    rpms_path: /home/stack/nova-hotfix-pkgs
  ...</pre></section><section class="section" id="modifying-container-images-with-a-custom-dockerfile"><div class="titlepage"><div><div><h2 class="title">7.9. Modifying container images with a custom Dockerfile</h2></div></div></div><p>
				For maximum flexibility, you can specify a directory containing a Dockerfile to make the required changes. When you invoke the <code class="literal">tripleo-modify-image</code> role, the role generates a <code class="literal">Dockerfile.modified</code> file that changes the <code class="literal">FROM</code> directive and adds extra <code class="literal">LABEL</code> directives. The following example runs the custom Dockerfile on the <code class="literal">nova-compute</code> image:
			</p><pre class="screen">ContainerImagePrepare:
- push_destination: true
  ...
  includes:
  - nova-compute
  modify_role: tripleo-modify-image
  modify_append_tag: "-hotfix"
  modify_vars:
    tasks_from: modify_image.yml
    modify_dir_path: /home/stack/nova-custom
  ...</pre><p>
				The following example shows the <code class="literal">/home/stack/nova-custom/Dockerfile</code> file. After you run any <code class="literal">USER</code> root directives, you must switch back to the original image default user:
			</p><pre class="screen">FROM registry.redhat.io/rhosp-rhel8/openstack-nova-compute:latest

USER "root"

COPY customize.sh /tmp/
RUN /tmp/customize.sh

USER "nova"</pre></section></section><section class="chapter" id="basic-network-isolation"><div class="titlepage"><div><div><h1 class="title">Chapter 8. Basic network isolation</h1></div></div></div><p>
			This chapter shows you how to configure the overcloud with the standard network isolation configuration. This includes the following configurations:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					The rendered environment file to enable network isolation (<code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml</code>).
				</li><li class="listitem">
					A copied environment file to configure network defaults (<code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/network-environment.yaml</code>).
				</li><li class="listitem">
					A <code class="literal">network_data</code> file to define network settings such as IP ranges, subnets, and virtual IPs. This example shows you how to create a copy of the default and edit it to suit your own network.
				</li><li class="listitem">
					Templates to define your NIC layout for each node. The overcloud core template collection contains a set of defaults for different use cases.
				</li><li class="listitem">
					An environment file to enable NICs. This example uses a default file located in the <code class="literal">environments</code> directory.
				</li><li class="listitem">
					Any additional environment files to customize your networking parameters.
				</li></ul></div><p>
			The following content in this chapter shows how to define each of these aspects.
		</p><section class="section" id="network-isolation"><div class="titlepage"><div><div><h2 class="title">8.1. Network isolation</h2></div></div></div><p>
				The overcloud assigns services to the provisioning network by default. However, the director can divide overcloud network traffic into isolated networks. To use isolated networks, the overcloud contains an environment file that enables this feature. The <code class="literal">environments/network-isolation.j2.yaml</code> file in the director’s core Heat templates is a Jinja2 file that defines all ports and VIPs for each network in your composable network file. When rendered, it results in a <code class="literal">network-isolation.yaml</code> file in the same location with the full resource registry. For example:
			</p><pre class="screen">resource_registry:
  # networks as defined in network_data.yaml
  OS::TripleO::Network::Storage: ../network/storage.yaml
  OS::TripleO::Network::StorageMgmt: ../network/storage_mgmt.yaml
  OS::TripleO::Network::InternalApi: ../network/internal_api.yaml
  OS::TripleO::Network::Tenant: ../network/tenant.yaml
  OS::TripleO::Network::External: ../network/external.yaml

  # Port assignments for the VIPs
  OS::TripleO::Network::Ports::StorageVipPort: ../network/ports/storage.yaml
  OS::TripleO::Network::Ports::StorageMgmtVipPort: ../network/ports/storage_mgmt.yaml
  OS::TripleO::Network::Ports::InternalApiVipPort: ../network/ports/internal_api.yaml
  OS::TripleO::Network::Ports::ExternalVipPort: ../network/ports/external.yaml
  OS::TripleO::Network::Ports::RedisVipPort: ../network/ports/vip.yaml

  # Port assignments by role, edit role definition to assign networks to roles.
  # Port assignments for the Controller
  OS::TripleO::Controller::Ports::StoragePort: ../network/ports/storage.yaml
  OS::TripleO::Controller::Ports::StorageMgmtPort: ../network/ports/storage_mgmt.yaml
  OS::TripleO::Controller::Ports::InternalApiPort: ../network/ports/internal_api.yaml
  OS::TripleO::Controller::Ports::TenantPort: ../network/ports/tenant.yaml
  OS::TripleO::Controller::Ports::ExternalPort: ../network/ports/external.yaml

  # Port assignments for the Compute
  OS::TripleO::Compute::Ports::StoragePort: ../network/ports/storage.yaml
  OS::TripleO::Compute::Ports::InternalApiPort: ../network/ports/internal_api.yaml
  OS::TripleO::Compute::Ports::TenantPort: ../network/ports/tenant.yaml

  # Port assignments for the CephStorage
  OS::TripleO::CephStorage::Ports::StoragePort: ../network/ports/storage.yaml
  OS::TripleO::CephStorage::Ports::StorageMgmtPort: ../network/ports/storage_mgmt.yaml</pre><p>
				The first section of this file has the resource registry declaration for the <code class="literal">OS::TripleO::Network::*</code> resources. By default, these resources use the <code class="literal">OS::Heat::None</code> resource type, which does not create any networks. By redirecting these resources to the YAML files for each network, you enable the creation of these networks.
			</p><p>
				The next several sections create the IP addresses for the nodes in each role. The controller nodes have IPs on each network. The compute and storage nodes each have IPs on a subset of the networks.
			</p><p>
				Other functions of overcloud networking, such as <a class="xref" href="index.html#custom-composable-networks" title="Chapter 9. Custom composable networks">Chapter 9, <em>Custom composable networks</em></a> and <a class="xref" href="index.html#custom-network-interface-templates" title="Chapter 10. Custom network interface templates">Chapter 10, <em>Custom network interface templates</em></a> rely on this network isolation environment file. As a result, you need to include the name of the rendered file with your deployment commands. For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml \
    ...</pre></section><section class="section" id="modifying-isolated-network-configuration"><div class="titlepage"><div><div><h2 class="title">8.2. Modifying isolated network configuration</h2></div></div></div><p>
				The <code class="literal">network_data</code> file provides a method to configure the default isolated networks. This procedure shows how to create a custom <code class="literal">network_data</code> file and configure it according to your network requirements.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Copy the default <code class="literal">network_data</code> file:
					</p><pre class="screen">$ cp /usr/share/openstack-tripleo-heat-templates/network_data.yaml /home/stack/.</pre></li><li class="listitem"><p class="simpara">
						Edit the local copy of the <code class="literal">network_data.yaml</code> file and modify the parameters to suit your networking requirements. For example, the Internal API network contains the following default network details:
					</p><pre class="screen">- name: InternalApi
  name_lower: internal_api
  vip: true
  vlan: 201
  ip_subnet: '172.16.2.0/24'
  allocation_pools: [{'start': '172.16.2.4', 'end': '172.16.2.250'}]</pre></li></ol></div><p>
				Edit the following for each network:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">vlan</code> defines the VLAN ID to use for this network.
					</li><li class="listitem">
						<code class="literal">ip_subnet</code> and <code class="literal">ip_allocation_pools</code> set the default subnet and IP range for the network..
					</li><li class="listitem">
						<code class="literal">gateway</code> sets the gateway for the network. Used mostly to define the default route for the External network, but can be used for other networks if necessary.
					</li></ul></div><p>
				Include the custom <code class="literal">network_data</code> file with your deployment using the <code class="literal">-n</code> option. Without the <code class="literal">-n</code> option, the deployment command uses the default network details.
			</p></section><section class="section" id="network-interface-templates"><div class="titlepage"><div><div><h2 class="title">8.3. Network Interface Templates</h2></div></div></div><p>
				The overcloud network configuration requires a set of the network interface templates. These templates are standard Heat templates in YAML format. Each role requires a NIC template so the director can configure each node within that role correctly.
			</p><p>
				All NIC templates contain the same sections as standard Heat templates:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">heat_template_version</code></span></dt><dd>
							The syntax version to use.
						</dd><dt><span class="term"><code class="literal">description</code></span></dt><dd>
							A string description of the template.
						</dd><dt><span class="term"><code class="literal">parameters</code></span></dt><dd>
							Network parameters to include in the template.
						</dd><dt><span class="term"><code class="literal">resources</code></span></dt><dd>
							Takes parameters defined in <code class="literal">parameters</code> and applies them to a network configuration script.
						</dd><dt><span class="term"><code class="literal">outputs</code></span></dt><dd>
							Renders the final script used for configuration.
						</dd></dl></div><p>
				The default NIC templates in <code class="literal">/usr/share/openstack-tripleo-heat-templates/network/config</code> take advantage of Jinja2 syntax to help render the template. For example, the following snippet from the <code class="literal">single-nic-vlans</code> configuration renders a set of VLANs for each network:
			</p><pre class="screen">{%- for network in networks if network.enabled|default(true) and network.name in role.networks %}
- type: vlan
  vlan_id:
    get_param: {{network.name}}NetworkVlanID
  addresses:
  - ip_netmask:
      get_param: {{network.name}}IpSubnet
{%- if network.name in role.default_route_networks %}</pre><p>
				For default Compute nodes, this only renders network information for the Storage, Internal API, and Tenant networks:
			</p><pre class="screen">- type: vlan
  vlan_id:
    get_param: StorageNetworkVlanID
  device: bridge_name
  addresses:
  - ip_netmask:
      get_param: StorageIpSubnet
- type: vlan
  vlan_id:
    get_param: InternalApiNetworkVlanID
  device: bridge_name
  addresses:
  - ip_netmask:
      get_param: InternalApiIpSubnet
- type: vlan
  vlan_id:
    get_param: TenantNetworkVlanID
  device: bridge_name
  addresses:
  - ip_netmask:
      get_param: TenantIpSubnet</pre><p>
				<a class="xref" href="index.html#custom-network-interface-templates" title="Chapter 10. Custom network interface templates">Chapter 10, <em>Custom network interface templates</em></a> explores how to render the default Jinja2-based templates to standard YAML versions, which you can use as a basis for customization.
			</p></section><section class="section" id="default-network-interface-templates"><div class="titlepage"><div><div><h2 class="title">8.4. Default network interface templates</h2></div></div></div><p>
				The director contains templates in <code class="literal">/usr/share/openstack-tripleo-heat-templates/network/config/</code> to suit most common network scenarios. The following table outlines each NIC template set and the respective environment file to use to enable the templates.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Each environment file for enabling NIC templates uses the suffix <code class="literal">.j2.yaml</code>. This is the unrendered Jinja2 version. Ensure that you include the rendered file name, which only uses the <code class="literal">.yaml</code> suffix, in your deployment.
				</p></div></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097852232448" scope="col">NIC directory</th><th align="left" valign="top" id="idm140097852231360" scope="col">Description</th><th align="left" valign="top" id="idm140097852230272" scope="col">Environment file</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097852232448"> <p>
								<code class="literal">single-nic-vlans</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852231360"> <p>
								Single NIC (<code class="literal">nic1</code>) with control plane and VLANs attached to default Open vSwitch bridge.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852230272"> <p>
								<code class="literal">environments/net-single-nic-with-vlans.j2.yaml</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852232448"> <p>
								<code class="literal">single-nic-linux-bridge-vlans</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852231360"> <p>
								Single NIC (<code class="literal">nic1</code>) with control plane and VLANs attached to default Linux bridge.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852230272"> <p>
								<code class="literal">environments/net-single-nic-linux-bridge-with-vlans</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852232448"> <p>
								<code class="literal">bond-with-vlans</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852231360"> <p>
								Control plane attached to <code class="literal">nic1</code>. Default Open vSwitch bridge with bonded NIC configuration (<code class="literal">nic2</code> and <code class="literal">nic3</code>) and VLANs attached.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852230272"> <p>
								<code class="literal">environments/net-bond-with-vlans.yaml</code>
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852232448"> <p>
								<code class="literal">multiple-nics</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852231360"> <p>
								Control plane attached to <code class="literal">nic1</code>. Assigns each sequential NIC to each network defined in the <code class="literal">network_data</code> file. By default, this is Storage to <code class="literal">nic2</code>, Storage Management to <code class="literal">nic3</code>, Internal API to <code class="literal">nic4</code>, Tenant to <code class="literal">nic5</code> on the <code class="literal">br-tenant</code> bridge, and External to <code class="literal">nic6</code> on the default Open vSwitch bridge.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852230272"> <p>
								<code class="literal">environments/net-multiple-nics.yaml</code>
							</p>
							 </td></tr></tbody></table></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Environment files exist for using no external network, for example, <code class="literal">net-bond-with-vlans-no-external.yaml</code>, and using IPv6, for example, <code class="literal">net-bond-with-vlans-v6.yaml</code>. These are provided for backwards compatibility and do not function with composable networks.
				</p></div></div><p>
				Each default NIC template set contains a <code class="literal">role.role.j2.yaml</code> template. This file uses Jinja2 to render additional files for each composable role. For example, if your overcloud uses Compute, Controller, and Ceph Storage roles, the deployment renders new templates based on <code class="literal">role.role.j2.yaml</code>, such as the following templates:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">compute.yaml</code>
					</li><li class="listitem">
						<code class="literal">controller.yaml</code>
					</li><li class="listitem">
						<code class="literal">ceph-storage.yaml</code>.
					</li></ul></div></section><section class="section" id="enabling-basic-network-isolation"><div class="titlepage"><div><div><h2 class="title">8.5. Enabling basic network isolation</h2></div></div></div><p>
				This procedure shows you how to enable basic network isolation using one of the default NIC templates. In this case, it is the single NIC with VLANs template (<code class="literal">single-nic-vlans</code>).
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						When running the <code class="literal">openstack overcloud deploy</code> command, ensure that you include the rendered environment file names for the following files:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The custom <code class="literal">network_data</code> file.
							</li><li class="listitem">
								The rendered file name of the default network isolation.
							</li><li class="listitem">
								The rendered file name of the default network environment file.
							</li><li class="listitem">
								The rendered file name of the default network interface configuration
							</li><li class="listitem">
								Any additional environment files relevant to your configuration.
							</li></ul></div></li></ol></div><p>
				For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -n /home/stack/network_data.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-environment.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/net-single-nic-with-vlans.yaml \
    ...</pre></section></section><section class="chapter" id="custom-composable-networks"><div class="titlepage"><div><div><h1 class="title">Chapter 9. Custom composable networks</h1></div></div></div><p>
			This chapter follows on from the concepts and procedures outlined in <a class="xref" href="index.html#basic-network-isolation" title="Chapter 8. Basic network isolation">Chapter 8, <em>Basic network isolation</em></a> and shows you how to configure the overcloud with an additional composable network. This includes configuration of the following files and templates:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					The environment file to enable network isolation (<code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml</code>).
				</li><li class="listitem">
					The environment file to configure network defaults (<code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/network-environment.yaml</code>).
				</li><li class="listitem">
					A custom <code class="literal">network_data</code> file to create additional networks outside of the defaults.
				</li><li class="listitem">
					A custom <code class="literal">roles_data</code> file to assign custom networks to roles.
				</li><li class="listitem">
					Templates to define your NIC layout for each node. The overcloud core template collection contains a set of defaults for different use cases.
				</li><li class="listitem">
					An environment file to enable NICs. This example uses a a default file located in the <code class="literal">environments</code> directory.
				</li><li class="listitem">
					Any additional environment files to customize your networking parameters. This example uses an environment file to customize OpenStack service mappings to composable networks.
				</li></ul></div><p>
			The following content in this chapter shows you how to define each of these aspects.
		</p><section class="section" id="composable-networks"><div class="titlepage"><div><div><h2 class="title">9.1. Composable networks</h2></div></div></div><p>
				The overcloud uses the following pre-defined set of network segments by default:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Control Plane
					</li><li class="listitem">
						Internal API
					</li><li class="listitem">
						Storage
					</li><li class="listitem">
						Storage Management
					</li><li class="listitem">
						Tenant
					</li><li class="listitem">
						External
					</li><li class="listitem">
						Management (optional)
					</li></ul></div><p>
				You can use Composable networks to add networks for various services. For example, if you have a network dedicated to NFS traffic, you can present it to multiple roles.
			</p><p>
				Director supports the creation of custom networks during the deployment and update phases. These additional networks can be used for ironic bare metal nodes, system management, or to create separate networks for different roles. You can also use them to create multiple sets of networks for split deployments where traffic is routed between networks.
			</p><p>
				A single data file (<code class="literal">network_data.yaml</code>) manages the list of networks to be deployed. Include this file with your deployment command using the <code class="literal">-n</code> option. Without this option, the deployment uses the default file (<code class="literal">/usr/share/openstack-tripleo-heat-templates/network_data.yaml</code>).
			</p></section><section class="section" id="adding-a-composable-network"><div class="titlepage"><div><div><h2 class="title">9.2. Adding a composable network</h2></div></div></div><p>
				This procedure shows you how to add an additional composable network to your overcloud.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Copy the default <code class="literal">network_data</code> file:
					</p><pre class="screen">$ cp /usr/share/openstack-tripleo-heat-templates/network_data.yaml /home/stack/.</pre></li><li class="listitem"><p class="simpara">
						Edit the local copy of the <code class="literal">network_data.yaml</code> file and add a section for your new network. For example:
					</p><pre class="screen">- name: StorageBackup
  name_lower: storage_backup
  vlan: 21
  vip: true
  ip_subnet: '172.21.1.0/24'
  allocation_pools: [{'start': '171.21.1.4', 'end': '172.21.1.250'}]
  gateway_ip: '172.21.1.1'</pre></li></ol></div><p>
				You can use the following parameters in your <code class="literal">network_data</code> file:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd>
							Sets the human readable name of the network. This parameter is the only mandatory parameter. You can also use <code class="literal">name_lower</code> to normalize names for readability. For example, changing <code class="literal">InternalApi</code> to <code class="literal">internal_api</code>.
						</dd><dt><span class="term"><code class="literal">name_lower</code></span></dt><dd>
							Sets the lowercase version of the name, which the director maps to respective networks assigned to roles in the <code class="literal">roles_data</code> file.
						</dd><dt><span class="term"><code class="literal">vlan</code></span></dt><dd>
							Sets the VLAN to use for this network.
						</dd><dt><span class="term"><code class="literal">vip: true</code></span></dt><dd>
							Creates a virtual IP address (VIP) on the new network. This IP is used as the target IP for services listed in the service-to-network mapping parameter (<code class="literal">ServiceNetMap</code>). Note that VIPs are only used by roles that use Pacemaker. The overcloud’s load-balancing service redirects traffic from these IPs to their respective service endpoint.
						</dd><dt><span class="term"><code class="literal">ip_subnet</code></span></dt><dd>
							Sets the default IPv4 subnet in CIDR format.
						</dd><dt><span class="term"><code class="literal">allocation_pools</code></span></dt><dd>
							Sets the IP range for the IPv4 subnet
						</dd><dt><span class="term"><code class="literal">gateway_ip</code></span></dt><dd>
							Sets the gateway for the network.
						</dd><dt><span class="term"><code class="literal">routes</code></span></dt><dd><p class="simpara">
							Adds additional routes to the network. Uses a JSON list containing each additional route. Each list item contains a dictionary value mapping. The example demonstrates the syntax:
						</p><pre class="screen">  routes: [{'destination':'10.0.0.0/16', 'nexthop':'10.0.2.254'}]</pre></dd><dt><span class="term"><code class="literal">subnets</code></span></dt><dd><p class="simpara">
							Creates additional routed subnets that fall within this network. This parameter accepts a <code class="literal">dict</code> value containing the lowercase name of the routed subnet as the key and the previously mentioned <code class="literal">vlan</code>, <code class="literal">ip_subnet</code>, <code class="literal">allocation_pools</code>, and <code class="literal">gateway_ip</code> parameters as the value mapped to the subnet. The following example demonstrates this layout:
						</p><pre class="screen">- name: StorageBackup
  name_lower: storage_backup
  vlan: 200
  vip: true
  ip_subnet: '172.21.0.0/24'
  allocation_pools: [{'start': '171.21.0.4', 'end': '172.21.0.250'}]
  gateway_ip: '172.21.0.1'
  subnets:
    storage_backup_leaf1:
      vlan: 201
      ip_subnet: '172.21.1.0/24'
      allocation_pools: [{'start': '171.21.1.4', 'end': '172.21.1.250'}]
      gateway_ip: '172.19.1.254'</pre><p class="simpara">
							This mapping is often used in spine leaf deployments. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/spine_leaf_networking/index"><span class="emphasis"><em>Spine Leaf Networking</em></span></a> guide.
						</p></dd></dl></div><p>
				Include the custom <code class="literal">network_data</code> file with your deployment using the <code class="literal">-n</code> option. Without the <code class="literal">-n</code> option, the deployment command uses the default set of networks.
			</p></section><section class="section" id="including-a-composable-network-in-a-role"><div class="titlepage"><div><div><h2 class="title">9.3. Including a composable network in a role</h2></div></div></div><p>
				You can assign composable networks to the roles defined in your environment. For example, you might include a custom <code class="literal">StorageBackup</code> network with your Ceph Storage nodes.
			</p><p>
				This procedure shows you how to add composable networks to a role in your overcloud.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						If you do not already have a custom <code class="literal">roles_data</code> file, copy the default to your home directory:
					</p><pre class="screen">$ cp /usr/share/openstack-tripleo-heat-templates/roles_data.yaml /home/stack/.</pre></li><li class="listitem">
						Edit the custom <code class="literal">roles_data</code> file.
					</li><li class="listitem"><p class="simpara">
						Scroll to the role you want to add the composable network and add the network name to the list of <code class="literal">networks</code>. For example, to add the network to the Ceph Storage role, use the following snippet as a guide:
					</p><pre class="screen">- name: CephStorage
  description: |
    Ceph OSD Storage node role
  networks:
    - Storage
    - StorageMgmt
    - StorageBackup</pre></li><li class="listitem">
						After adding custom networks to their respective roles, save the file.
					</li></ol></div><p>
				When running the <code class="literal">openstack overcloud deploy</code> command, include the <code class="literal">roles_data</code> file using the <code class="literal">-r</code> option. Without the <code class="literal">-r</code> option, the deployment command uses the default set of roles with their respective assigned networks.
			</p></section><section class="section" id="assigning-openstack-services-to-composable-networks"><div class="titlepage"><div><div><h2 class="title">9.4. Assigning OpenStack services to composable networks</h2></div></div></div><p>
				Each OpenStack service is assigned to a default network type in the resource registry. These services are then bound to IP addresses within the network type’s assigned network. Although the OpenStack services are divided among these networks, the number of actual physical networks can differ as defined in the network environment file. You can reassign OpenStack services to different network types by defining a new network map in an environment file, for example, <code class="literal">/home/stack/templates/service-reassignments.yaml</code>. The <code class="literal">ServiceNetMap</code> parameter determines the network types used for each service.
			</p><p>
				For example, you can reassign the Storage Management network services to the Storage Backup Network by modifying the highlighted sections:
			</p><pre class="screen">parameter_defaults:
  ServiceNetMap:
    SwiftMgmtNetwork: storage_backup
    CephClusterNetwork: storage_backup</pre><p>
				Changing these parameters to <code class="literal">storage_backup</code> places these services on the Storage Backup network instead of the Storage Management network. This means you only need to define a set of <code class="literal">parameter_defaults</code> for the Storage Backup network and not the Storage Management network.
			</p><p>
				The director merges your custom <code class="literal">ServiceNetMap</code> parameter definitions into a pre-defined list of defaults taken from <code class="literal">ServiceNetMapDefaults</code> and overrides the defaults. The director returns the full list, including customizations back to <code class="literal">ServiceNetMap</code>, which is used to configure network assignments for various services.
			</p><p>
				Service mappings apply to networks that use <code class="literal">vip: true</code> in the <code class="literal">network_data</code> file for nodes that use Pacemaker. The overcloud’s load balancer redirects traffic from the VIPs to the specific service endpoints.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					A full list of default services can be found in the <code class="literal">ServiceNetMapDefaults</code> parameter within <code class="literal">/usr/share/openstack-tripleo-heat-templates/network/service_net_map.j2.yaml</code>.
				</p></div></div></section><section class="section" id="enabling-custom-composable-networks"><div class="titlepage"><div><div><h2 class="title">9.5. Enabling custom composable networks</h2></div></div></div><p>
				This procedure shows you how to enable custom composable networks using one of the default NIC templates. In this case, it is the Single NIC with VLANs (<code class="literal">single-nic-vlans</code>).
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						When you run the <code class="literal">openstack overcloud deploy</code> command, ensure that you include the following files:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The custom <code class="literal">network_data</code> file.
							</li><li class="listitem">
								The custom <code class="literal">roles_data</code> file with network-to-role assignments.
							</li><li class="listitem">
								The rendered file name of the default network isolation.
							</li><li class="listitem">
								The rendered file name of the default network environment file.
							</li><li class="listitem">
								The rendered file name of the default network interface configuration.
							</li><li class="listitem">
								Any additional environment files related to your network, such as the service reassignments.
							</li></ul></div></li></ol></div><p>
				For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -n /home/stack/network_data.yaml \
    -r /home/stack/roles_data.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-environment.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/net-single-nic-with-vlans.yaml \
    -e /home/stack/templates/service-reassignments.yaml \
    ...</pre><p>
				This example command deploys the composable networks, including your additional custom networks, across nodes in your overcloud.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Remember that you must render the templates again if you are introducing a new custom network, such as a management network. Simply adding the network name to the <code class="literal">roles_data.yaml</code> file is not sufficient.
				</p></div></div></section><section class="section" id="renaming-default-networks"><div class="titlepage"><div><div><h2 class="title">9.6. Renaming the default networks</h2></div></div></div><p>
				You can use the <code class="literal">network_data.yaml</code> file to modify the user-visible names of the default networks:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						InternalApi
					</li><li class="listitem">
						External
					</li><li class="listitem">
						Storage
					</li><li class="listitem">
						StorageMgmt
					</li><li class="listitem">
						Tenant
					</li></ul></div><p>
				To change these names, do not modify the <code class="literal">name</code> field. Instead, change the <code class="literal">name_lower</code> field to the new name for the network and update the ServiceNetMap with the new name.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In your <code class="literal">network_data.yaml</code> file, enter new names in the <code class="literal">name_lower</code> parameter for each network that you want to rename:
					</p><pre class="screen">- name: InternalApi
  name_lower: MyCustomInternalApi</pre></li><li class="listitem"><p class="simpara">
						Include the default value of the <code class="literal">name_lower</code> parameter in the <code class="literal">service_net_map_replace</code> parameter:
					</p><pre class="screen">- name: InternalApi
  name_lower: MyCustomInternalApi
  service_net_map_replace: internal_api</pre></li></ol></div></section></section><section class="chapter" id="custom-network-interface-templates"><div class="titlepage"><div><div><h1 class="title">Chapter 10. Custom network interface templates</h1></div></div></div><p>
			This chapter follows on from the concepts and procedures outlined in <a class="xref" href="index.html#basic-network-isolation" title="Chapter 8. Basic network isolation">Chapter 8, <em>Basic network isolation</em></a>. The purpose of this chapter is to demonstrate how to create a set of custom network interface template to suit nodes in your environment. This includes:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					The environment file to enable network isolation (<code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml</code>).
				</li><li class="listitem">
					The environment file to configure network defaults (<code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/network-environment.yaml</code>).
				</li><li class="listitem">
					Templates to define your NIC layout for each node. The overcloud core template collection contains a set of defaults for different use cases. In this situation, you will render a default a basis for your custom templates.
				</li><li class="listitem">
					A custom environment file to enable NICs. This example uses a custom environment file (<code class="literal">/home/stack/templates/custom-network-configuration.yaml</code>) that references your custom interface templates.
				</li><li class="listitem">
					Any additional environment files to customize your networking parameters.
				</li><li class="listitem">
					If using customizing your networks, a custom <code class="literal">network_data</code> file.
				</li><li class="listitem">
					If creating additional or custom composable networks, a custom <code class="literal">network_data</code> file and a custom <code class="literal">roles_data</code> file.
				</li></ul></div><section class="section" id="custom-network-architecture"><div class="titlepage"><div><div><h2 class="title">10.1. Custom network architecture</h2></div></div></div><p>
				The default NIC templates might not suit a specific network configuration. For example, you might want to create your own custom NIC template that suits a specific network layout. You might aim to separate the control services and data services on to separate NICs. In this situation, the service to NIC assignments result in the following mapping:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						NIC1 (Provisioning):
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Provisioning / Control Plane
							</li></ul></div></li><li class="listitem"><p class="simpara">
						NIC2 (Control Group)
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Internal API
							</li><li class="listitem">
								Storage Management
							</li><li class="listitem">
								External (Public API)
							</li></ul></div></li><li class="listitem"><p class="simpara">
						NIC3 (Data Group)
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Tenant Network (VXLAN tunneling)
							</li><li class="listitem">
								Tenant VLANs / Provider VLANs
							</li><li class="listitem">
								Storage
							</li><li class="listitem">
								External VLANs (Floating IP/SNAT)
							</li></ul></div></li><li class="listitem"><p class="simpara">
						NIC4 (Management)
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Management
							</li></ul></div></li></ul></div></section><section class="section" id="rendering-default-network-interface-templates-for-customization"><div class="titlepage"><div><div><h2 class="title">10.2. Rendering default network interface templates for customization</h2></div></div></div><p>
				For the purposes of simplifying the configuration of custom interface templates, this procedure shows you how to render the Jinja2 syntax of a default NIC template. This way you can use the rendered templates as a basis for your custom configuration.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Render a copy of the <code class="literal">openstack-tripleo-heat-templates</code> collection using the <code class="literal">process-templates.py</code> script:
					</p><pre class="screen">$ cd /usr/share/openstack-tripleo-heat-templates
$ ./tools/process-templates.py -o ~/openstack-tripleo-heat-templates-rendered</pre><p class="simpara">
						This converts all Jinja2 templates to their rendered YAML versions and saves the results to <code class="literal">~/openstack-tripleo-heat-templates-rendered</code>.
					</p><p class="simpara">
						If using a custom network file or custom roles file, you can include these files using the <code class="literal">-n</code> and <code class="literal">-r</code> options respectively. For example:
					</p><pre class="screen">$ ./tools/process-templates.py -o ~/openstack-tripleo-heat-templates-rendered -n /home/stack/network_data.yaml -r /home/stack/roles_data.yaml</pre></li><li class="listitem"><p class="simpara">
						Copy the multiple NIC example:
					</p><pre class="screen">$ cp -r ~/openstack-tripleo-heat-templates-rendered/network/config/multiple-nics/ ~/templates/custom-nics/</pre></li><li class="listitem">
						You can edit the template set in <code class="literal">custom-nics</code> to suit your own network configuration.
					</li></ol></div></section><section class="section" id="network-interface-architecture"><div class="titlepage"><div><div><h2 class="title">10.3. Network interface architecture</h2></div></div></div><p>
				This section explores the architecture of the custom NIC templates in <code class="literal">custom-nics</code> and provides recommendations on editing them.
			</p><div class="formalpara"><p class="title"><strong>Parameters</strong></p><p>
					The <code class="literal">parameters</code> section contains all network configuration parameters for network interfaces. This includes information such as subnet ranges and VLAN IDs. This section should remain unchanged as the Heat template inherits values from its parent template. However, you can modify the values for some parameters using a network environment file.
				</p></div><div class="formalpara"><p class="title"><strong>Resources</strong></p><p>
					The <code class="literal">resources</code> section is where the main network interface configuration occurs. In most cases, the <code class="literal">resources</code> section is the only one that requires editing. Each <code class="literal">resources</code> section begins with the following header:
				</p></div><pre class="screen">resources:
  OsNetConfigImpl:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      config:
        str_replace:
          template:
            get_file: /usr/share/openstack-tripleo-heat-templates/network/scripts/run-os-net-config.sh
          params:
            $network_config:
              network_config:</pre><p>
				This runs a script (<code class="literal">run-os-net-config.sh</code>) that creates a configuration file for <code class="literal">os-net-config</code> to use for configuring network properties on a node. The <code class="literal">network_config</code> section contains the custom network interface data sent to the <code class="literal">run-os-net-config.sh</code> script. You arrange this custom interface data in a sequence based on the type of device.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					If creating custom NIC templates, you must set the <code class="literal">run-os-net-config.sh</code> script location to an absolute location for each NIC template. The script is located at <code class="literal">/usr/share/openstack-tripleo-heat-templates/network/scripts/run-os-net-config.sh</code> on the undercloud.
				</p></div></div></section><section class="section" id="network-interface-reference"><div class="titlepage"><div><div><h2 class="title">10.4. Network interface reference</h2></div></div></div><p>
				The following sections define the network interface types and the parameters used in each.
			</p><div class="formalpara"><p class="title"><strong>interface</strong></p><p>
					Defines a single network interface. The configuration defines each interface using either the actual interface name ("eth0", "eth1", "enp0s25") or a set of numbered interfaces ("nic1", "nic2", "nic3").
				</p></div><p>
				For example:
			</p><pre class="screen">  - type: interface
    name: nic2</pre><div class="table" id="idm140097851871984"><p class="title"><strong>Table 10.1. interface options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097852887264" scope="col">Option</th><th align="left" valign="top" id="idm140097852886176" scope="col">Default</th><th align="left" valign="top" id="idm140097852885088" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								name
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								Name of the Interface
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								use_dhcp
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								Use DHCP to get an IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								use_dhcpv6
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								Use DHCP to get a v6 IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								addresses
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								A list of IP addresses assigned to the interface
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								routes
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								A list of routes assigned to the interface. See <a class="xref" href="index.html#network-interface-reference_routes" title="routes">routes</a>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								mtu
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> <p>
								1500
							</p>
							 </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								The maximum transmission unit (MTU) of the connection
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								primary
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								Defines the interface as the primary interface
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								defroute
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> <p>
								True
							</p>
							 </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								Use a default route provided by the DHCP service. Only applies when <code class="literal">use_dhcp</code> or <code class="literal">use_dhcpv6</code> is enabled.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								persist_mapping
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								Write the device alias configuration instead of the system names
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								dhclient_args
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								Arguments to pass to the DHCP client
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852887264"> <p>
								dns_servers
							</p>
							 </td><td align="left" valign="top" headers="idm140097852886176"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097852885088"> <p>
								List of DNS servers to use for the interface
							</p>
							 </td></tr></tbody></table></div></div><div class="formalpara"><p class="title"><strong>vlan</strong></p><p>
					Defines a VLAN. Use the VLAN ID and subnet passed from the <code class="literal">parameters</code> section.
				</p></div><p>
				For example:
			</p><pre class="screen">  - type: vlan
    vlan_id:{get_param: ExternalNetworkVlanID}
    addresses:
      - ip_netmask: {get_param: ExternalIpSubnet}</pre><div class="table" id="idm140097852054832"><p class="title"><strong>Table 10.2. vlan options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097852049072" scope="col">Option</th><th align="left" valign="top" id="idm140097852047984" scope="col">Default</th><th align="left" valign="top" id="idm140097852046896" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								vlan_id
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								The VLAN ID
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								device
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								The parent device to attach the VLAN. Use this parameter when the VLAN is not a member of an OVS bridge. For example, use this parameter to attach the VLAN to a bonded interface device.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								use_dhcp
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								Use DHCP to get an IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								use_dhcpv6
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								Use DHCP to get a v6 IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								addresses
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								A list of IP addresses assigned to the VLAN
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								routes
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								A list of routes assigned to the VLAN. See <a class="xref" href="index.html#network-interface-reference_routes" title="routes">routes</a>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								mtu
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> <p>
								1500
							</p>
							 </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								The maximum transmission unit (MTU) of the connection
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								primary
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								Defines the VLAN as the primary interface
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								defroute
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> <p>
								True
							</p>
							 </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								Use a default route provided by the DHCP service. Only applies when <code class="literal">use_dhcp</code> or <code class="literal">use_dhcpv6</code> is enabled.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								persist_mapping
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								Write the device alias configuration instead of the system names
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								dhclient_args
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								Arguments to pass to the DHCP client
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852049072"> <p>
								dns_servers
							</p>
							 </td><td align="left" valign="top" headers="idm140097852047984"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097852046896"> <p>
								List of DNS servers to use for the VLAN
							</p>
							 </td></tr></tbody></table></div></div><div class="formalpara"><p class="title"><strong>ovs_bond</strong></p><p>
					Defines a bond in Open vSwitch to join two or more <code class="literal">interfaces</code> together. This helps with redundancy and increases bandwidth.
				</p></div><p>
				For example:
			</p><pre class="screen">          - type: ovs_bond
            name: bond1
            members:
            - type: interface
              name: nic2
            - type: interface
              name: nic3</pre><div class="table" id="idm140097848227872"><p class="title"><strong>Table 10.3. ovs_bond options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097848222112" scope="col">Option</th><th align="left" valign="top" id="idm140097848221024" scope="col">Default</th><th align="left" valign="top" id="idm140097848219936" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								name
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								Name of the bond
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								use_dhcp
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								Use DHCP to get an IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								use_dhcpv6
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								Use DHCP to get a v6 IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								addresses
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								A list of IP addresses assigned to the bond
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								routes
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								A list of routes assigned to the bond. See <a class="xref" href="index.html#network-interface-reference_routes" title="routes">routes</a>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								mtu
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> <p>
								1500
							</p>
							 </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								The maximum transmission unit (MTU) of the connection
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								primary
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								Defines the interface as the primary interface
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								members
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								A sequence of interface objects to use in the bond
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								ovs_options
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								A set of options to pass to OVS when creating the bond
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								ovs_extra
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								A set of options to to set as the OVS_EXTRA parameter in the bond’s network configuration file
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								defroute
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> <p>
								True
							</p>
							 </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								Use a default route provided by the DHCP service. Only applies when <code class="literal">use_dhcp</code> or <code class="literal">use_dhcpv6</code> is enabled.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								persist_mapping
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								Write the device alias configuration instead of the system names
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								dhclient_args
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								Arguments to pass to the DHCP client
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097848222112"> <p>
								dns_servers
							</p>
							 </td><td align="left" valign="top" headers="idm140097848221024"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097848219936"> <p>
								List of DNS servers to use for the bond
							</p>
							 </td></tr></tbody></table></div></div><div class="formalpara"><p class="title"><strong>ovs_bridge</strong></p><p>
					Defines a bridge in Open vSwitch, which connects multiple <code class="literal">interface</code>, <code class="literal">ovs_bond</code>, and <code class="literal">vlan</code> objects together. The external bridge also uses two special values for parameters:
				</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">bridge_name</code>, which is replaced with the external bridge name.
					</li><li class="listitem">
						<code class="literal">interface_name</code>, which is replaced with the external interface.
					</li></ul></div><p>
				For example:
			</p><pre class="screen">      - type: ovs_bridge
        name: bridge_name
        addresses:
        - ip_netmask:
            list_join:
            - /
            - - {get_param: ControlPlaneIp}
              - {get_param: ControlPlaneSubnetCidr}
        members:
          - type: interface
            name: interface_name
      - type: vlan
        device: bridge_name
        vlan_id:
          {get_param: ExternalNetworkVlanID}
        addresses:
          - ip_netmask:
              {get_param: ExternalIpSubnet}</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The OVS bridge connects to the Neutron server in order to get configuration data. If the OpenStack control traffic (typically the Control Plane and Internal API networks) is placed on an OVS bridge, then connectivity to the Neutron server gets lost whenever OVS is upgraded or the OVS bridge is restarted by the admin user or process. This will cause some downtime. If downtime is not acceptable under these circumstances, then the Control group networks should be placed on a separate interface or bond rather than on an OVS bridge:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							A minimal setting can be achieved, when you put the Internal API network on a VLAN on the provisioning interface and the OVS bridge on a second interface.
						</li><li class="listitem">
							If you want bonding, you need at least two bonds (four network interfaces). The control group should be placed on a Linux bond (Linux bridge). If the switch does not support LACP fallback to a single interface for PXE boot, then this solution requires at least five NICs.
						</li></ul></div></div></div><div class="table" id="idm140097864573072"><p class="title"><strong>Table 10.4. ovs_bridge options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097864567312" scope="col">Option</th><th align="left" valign="top" id="idm140097864566224" scope="col">Default</th><th align="left" valign="top" id="idm140097864565136" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								name
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								Name of the bridge
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								use_dhcp
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								Use DHCP to get an IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								use_dhcpv6
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								Use DHCP to get a v6 IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								addresses
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								A list of IP addresses assigned to the bridge
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								routes
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								A list of routes assigned to the bridge. See <a class="xref" href="index.html#network-interface-reference_routes" title="routes">routes</a>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								mtu
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> <p>
								1500
							</p>
							 </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								The maximum transmission unit (MTU) of the connection
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								members
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								A sequence of interface, VLAN, and bond objects to use in the bridge
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								ovs_options
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								A set of options to pass to OVS when creating the bridge
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								ovs_extra
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								A set of options to to set as the OVS_EXTRA parameter in the bridge’s  network configuration file
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								defroute
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> <p>
								True
							</p>
							 </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								Use a default route provided by the DHCP service. Only applies when <code class="literal">use_dhcp</code> or <code class="literal">use_dhcpv6</code> is enabled.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								persist_mapping
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								Write the device alias configuration instead of the system names
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								dhclient_args
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								Arguments to pass to the DHCP client
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097864567312"> <p>
								dns_servers
							</p>
							 </td><td align="left" valign="top" headers="idm140097864566224"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097864565136"> <p>
								List of DNS servers to use for the bridge
							</p>
							 </td></tr></tbody></table></div></div><div class="formalpara"><p class="title"><strong>linux_bond</strong></p><p>
					Defines a Linux bond that joins two or more <code class="literal">interfaces</code> together. This helps with redundancy and increases bandwidth. Make sure to include the kernel-based bonding options in the <code class="literal">bonding_options</code> parameter.
				</p></div><p>
				For example:
			</p><pre class="screen">      - type: linux_bond
        name: bond1
        members:
        - type: interface
          name: nic2
          primary: true
        - type: interface
          name: nic3
        bonding_options: "mode=802.3ad"</pre><p>
				Note that <code class="literal">nic2</code> uses <code class="literal">primary: true</code>. This ensures the bond uses the MAC address for <code class="literal">nic2</code>.
			</p><div class="table" id="idm140097856802160"><p class="title"><strong>Table 10.5. linux_bond options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097856796400" scope="col">Option</th><th align="left" valign="top" id="idm140097856795312" scope="col">Default</th><th align="left" valign="top" id="idm140097856794224" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								name
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								Name of the bond
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								use_dhcp
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								Use DHCP to get an IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								use_dhcpv6
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								Use DHCP to get a v6 IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								addresses
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								A list of IP addresses assigned to the bond
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								routes
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								A list of routes assigned to the bond. See <a class="xref" href="index.html#network-interface-reference_routes" title="routes">routes</a>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								mtu
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> <p>
								1500
							</p>
							 </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								The maximum transmission unit (MTU) of the connection
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								primary
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								Defines the interface as the primary interface.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								members
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								A sequence of interface objects to use in the bond
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								bonding_options
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								A set of options when creating the bond.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								defroute
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> <p>
								True
							</p>
							 </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								Use a default route provided by the DHCP service. Only applies when <code class="literal">use_dhcp</code> or <code class="literal">use_dhcpv6</code> is enabled.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								persist_mapping
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								Write the device alias configuration instead of the system names
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								dhclient_args
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								Arguments to pass to the DHCP client
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097856796400"> <p>
								dns_servers
							</p>
							 </td><td align="left" valign="top" headers="idm140097856795312"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097856794224"> <p>
								List of DNS servers to use for the bond
							</p>
							 </td></tr></tbody></table></div></div><div class="formalpara"><p class="title"><strong>linux_bridge</strong></p><p>
					Defines a Linux bridge, which connects multiple <code class="literal">interface</code>, <code class="literal">linux_bond</code>, and <code class="literal">vlan</code> objects together. The external bridge also uses two special values for parameters:
				</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">bridge_name</code>, which is replaced with the external bridge name.
					</li><li class="listitem">
						<code class="literal">interface_name</code>, which is replaced with the external interface.
					</li></ul></div><p>
				For example:
			</p><pre class="screen">      - type: linux_bridge
        name: bridge_name
        addresses:
          - ip_netmask:
              list_join:
                - /
                - - {get_param: ControlPlaneIp}
                  - {get_param: ControlPlaneSubnetCidr}
        members:
          - type: interface
            name: interface_name
      - type: vlan
        device: bridge_name
        vlan_id:
          {get_param: ExternalNetworkVlanID}
        addresses:
          - ip_netmask:
              {get_param: ExternalIpSubnet}</pre><div class="table" id="idm140097853303696"><p class="title"><strong>Table 10.6. linux_bridge options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097853297936" scope="col">Option</th><th align="left" valign="top" id="idm140097853296848" scope="col">Default</th><th align="left" valign="top" id="idm140097853295760" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								name
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								Name of the bridge
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								use_dhcp
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								Use DHCP to get an IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								use_dhcpv6
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								Use DHCP to get a v6 IP address
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								addresses
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								A list of IP addresses assigned to the bridge
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								routes
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								A list of routes assigned to the bridge. See <a class="xref" href="index.html#network-interface-reference_routes" title="routes">routes</a>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								mtu
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> <p>
								1500
							</p>
							 </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								The maximum transmission unit (MTU) of the connection
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								members
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								A sequence of interface, VLAN, and bond objects to use in the bridge
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								defroute
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> <p>
								True
							</p>
							 </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								Use a default route provided by the DHCP service. Only applies when <code class="literal">use_dhcp</code> or <code class="literal">use_dhcpv6</code> is enabled.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								persist_mapping
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								Write the device alias configuration instead of the system names
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								dhclient_args
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								Arguments to pass to the DHCP client
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097853297936"> <p>
								dns_servers
							</p>
							 </td><td align="left" valign="top" headers="idm140097853296848"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097853295760"> <p>
								List of DNS servers to use for the bridge
							</p>
							 </td></tr></tbody></table></div></div><div id="network-interface-reference_routes" class="formalpara"><p class="title"><strong>routes</strong></p><p>
					Defines a list of routes to apply to a network interface, VLAN, bridge, or bond.
				</p></div><p>
				For example:
			</p><pre class="screen">  - type: interface
    name: nic2
    ...
    routes:
      - ip_netmask: 10.1.2.0/24
        default: true
        next_hop:
          get_param: EC2MetadataIp</pre><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097852906640" scope="col">Option</th><th align="left" valign="top" id="idm140097852905552" scope="col">Default</th><th align="left" valign="top" id="idm140097852904464" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097852906640"> <p>
								ip_netmask
							</p>
							 </td><td align="left" valign="top" headers="idm140097852905552"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097852904464"> <p>
								IP and netmask of the destination network.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852906640"> <p>
								default
							</p>
							 </td><td align="left" valign="top" headers="idm140097852905552"> <p>
								False
							</p>
							 </td><td align="left" valign="top" headers="idm140097852904464"> <p>
								Sets this this route to a default route. Equivalent to setting <code class="literal">ip_netmask: 0.0.0.0/0</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852906640"> <p>
								next_hop
							</p>
							 </td><td align="left" valign="top" headers="idm140097852905552"> <p>
								None
							</p>
							 </td><td align="left" valign="top" headers="idm140097852904464"> <p>
								The IP address of the router used to reach the destination network.
							</p>
							 </td></tr></tbody></table></div></section><section class="section" id="example-network-interface-layout"><div class="titlepage"><div><div><h2 class="title">10.5. Example network interface layout</h2></div></div></div><p>
				The following snippet for a possible Controller node NIC template demonstrates how to configure the custom network scenario to keep the control group apart from the OVS bridge:
			</p><pre class="screen">resources:
  OsNetConfigImpl:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      config:
        str_replace:
          template:
            get_file: /usr/share/openstack-tripleo-heat-templates/network/scripts/run-os-net-config.sh
          params:
            $network_config:
              network_config:

              # NIC 1 - Provisioning
              - type: interface
                name: nic1
                use_dhcp: false
                addresses:
                - ip_netmask:
                    list_join:
                    - /
                    - - get_param: ControlPlaneIp
                      - get_param: ControlPlaneSubnetCidr
                routes:
                - ip_netmask: 169.254.169.254/32
                  next_hop:
                    get_param: EC2MetadataIp

              # NIC 2 - Control Group
              - type: interface
                name: nic2
                use_dhcp: false
              - type: vlan
                device: nic2
                vlan_id:
                  get_param: InternalApiNetworkVlanID
                addresses:
                - ip_netmask:
                    get_param: InternalApiIpSubnet
              - type: vlan
                device: nic2
                vlan_id:
                  get_param: StorageMgmtNetworkVlanID
                addresses:
                - ip_netmask:
                    get_param: StorageMgmtIpSubnet
              - type: vlan
                device: nic2
                vlan_id:
                  get_param: ExternalNetworkVlanID
                addresses:
                - ip_netmask:
                    get_param: ExternalIpSubnet
                routes:
                - default: true
                  next_hop:
                    get_param: ExternalInterfaceDefaultRoute

              # NIC 3 - Data Group
              - type: ovs_bridge
                name: bridge_name
                dns_servers:
                  get_param: DnsServers
                members:
                - type: interface
                  name: nic3
                  primary: true
                - type: vlan
                  vlan_id:
                    get_param: StorageNetworkVlanID
                  addresses:
                  - ip_netmask:
                      get_param: StorageIpSubnet
                - type: vlan
                  vlan_id:
                    get_param: TenantNetworkVlanID
                  addresses:
                  - ip_netmask:
                      get_param: TenantIpSubnet

                # NIC 4 - Management
                - type: interface
                  name: nic4
                  use_dhcp: false
                  addresses:
                  - ip_netmask: {get_param: ManagementIpSubnet}
                  routes:
                  - default: true
                    next_hop: {get_param: ManagementInterfaceDefaultRoute}</pre><p>
				This template uses four network interfaces and assigns a number of tagged VLAN devices to the numbered interfaces, <code class="literal">nic1</code> to <code class="literal">nic4</code>. On <code class="literal">nic3</code> it creates the OVS bridge that hosts the Storage and Tenant networks. As a result, it creates the following layout:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						NIC1 (Provisioning):
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Provisioning / Control Plane
							</li></ul></div></li><li class="listitem"><p class="simpara">
						NIC2 (Control Group)
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Internal API
							</li><li class="listitem">
								Storage Management
							</li><li class="listitem">
								External (Public API)
							</li></ul></div></li><li class="listitem"><p class="simpara">
						NIC3 (Data Group)
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Tenant Network (VXLAN tunneling)
							</li><li class="listitem">
								Tenant VLANs / Provider VLANs
							</li><li class="listitem">
								Storage
							</li><li class="listitem">
								External VLANs (Floating IP/SNAT)
							</li></ul></div></li><li class="listitem"><p class="simpara">
						NIC4 (Management)
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Management
							</li></ul></div></li></ul></div></section><section class="section" id="network_interface_template_considerations_for_custom_networks"><div class="titlepage"><div><div><h2 class="title">10.6. Network interface template considerations for custom networks</h2></div></div></div><p>
				When using composable networks, the <code class="literal">process-templates.py</code> script renders the static templates to include networks and roles defined in your <code class="literal">network_data</code> and <code class="literal">roles_data</code> files. Check the rendered NIC templates and ensure it contains:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Static file for each roles, including custom composable networks.
					</li><li class="listitem">
						Each static file for each role contains the correct network definitions.
					</li></ul></div><p>
				Each static file requires all the parameter definitions for any custom networks even if the network is not used on the role. Check to make sure the rendered templates contain these parameters. For example, if a <code class="literal">StorageBackup</code> network is added to only the Ceph nodes, the <code class="literal">parameters</code> section in NIC configuration templates for all roles must also include this definition:
			</p><pre class="screen">parameters:
  ...
  StorageBackupIpSubnet:
    default: ''
    description: IP address/subnet on the external network
    type: string
  ...</pre><p>
				You can also include the <code class="literal">parameters</code> definitions for VLAN IDs and/or gateway IP, if needed:
			</p><pre class="screen">parameters:
  ...
  StorageBackupNetworkVlanID:
    default: 60
    description: Vlan ID for the management network traffic.
    type: number
  StorageBackupDefaultRoute:
	  description: The default route of the storage backup network.
	  type: string
  ...</pre><p>
				The <code class="literal">IpSubnet</code> parameter for the custom network appears in the parameter definitions for each role. However, since the Ceph role might be the only role that uses the <code class="literal">StorageBackup</code> network, only the NIC configuration template for the Ceph role would make use of the <code class="literal">StorageBackup</code> parameters in the <code class="literal">network_config</code> section of the template.
			</p><pre class="screen">      $network_config:
        network_config:
        - type: interface
          name: nic1
          use_dhcp: false
          addresses:
          - ip_netmask:
              get_param: StorageBackupIpSubnet</pre></section><section class="section" id="custom-network-environment-file"><div class="titlepage"><div><div><h2 class="title">10.7. Custom network environment file</h2></div></div></div><p>
				The custom network environment file (in this case, <code class="literal">/home/stack/templates/custom-network-configuration.yaml</code>) is a Heat environment file that describes the Overcloud’s network environment and points to the custom network interface configuration templates. You can define the subnets and VLANs for your network along with IP address ranges. You can then customize these values for the local environment.
			</p><p>
				The <code class="literal">resource_registry</code> section contains references to the custom network interface templates for each node role. Each resource registered uses the following format:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">OS::TripleO::[ROLE]::Net::SoftwareConfig: [FILE]</code>
					</li></ul></div><p>
				<code class="literal">[ROLE]</code> is the role name and <code class="literal">[FILE]</code> is the respective network interface template for that particular role. For example:
			</p><pre class="screen">resource_registry:
  OS::TripleO::Controller::Net::SoftwareConfig: /home/stack/templates/custom-nics/controller.yaml</pre><p>
				The <code class="literal">parameter_defaults</code> section contains a list of parameters that define the network options for each network type.
			</p></section><section class="section" id="network-environment-parameters"><div class="titlepage"><div><div><h2 class="title">10.8. Network environment parameters</h2></div></div></div><p>
				The following table is a list of parameters you can use in a network environment file’s <code class="literal">parameter_defaults</code> section to override the default parameter values in your NIC templates.
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140097852263712" scope="col">Parameter</th><th align="left" valign="top" id="idm140097852262624" scope="col">Description</th><th align="left" valign="top" id="idm140097852261536" scope="col">Type</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">ControlPlaneDefaultRoute</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The IP address of the router on the Control Plane, which is used as a default route for roles other than the Controller nodes by default. Set to the undercloud IP if using IP masquerade instead of a router.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">ControlPlaneSubnetCidr</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The CIDR netmask of the IP network used on the Control Plane. If the Control Plane network uses 192.168.24.0/24, the CIDR is <code class="literal">24</code>.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string (though is always a number)
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">*NetCidr</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The full network and CIDR netmask for a particular network. The default is automatically set to the network’s <code class="literal">ip_subnet</code> setting in the <code class="literal">network_data</code> file. For example: <code class="literal">InternalApiNetCidr: 172.16.0.0/24</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">*AllocationPools</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								"The IP allocation range for a particular network. The default is automatically set to the network’s <code class="literal">allocation_pools</code> setting in the <code class="literal">network_data</code> file. For example: <code class="literal">InternalApiAllocationPools: [{'start': '172.16.0.10', 'end': '172.16.0.200'}]</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								hash
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">*NetworkVlanID</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The node’s VLAN ID for on a particular network. The default is set automatically to the network’s <code class="literal">vlan</code> setting in the <code class="literal">network_data</code> file. For example: <code class="literal">InternalApiNetworkVlanID: 201</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								number
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">*InterfaceDefaultRoute</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The router address for a particular network, which you can use as a default route for roles or used for routes to other networks. The default is automatically set to the network’s <code class="literal">gateway_ip</code> setting in the <code class="literal">network_data</code> file. For example: <code class="literal">InternalApiInterfaceDefaultRoute: 172.16.0.1</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">DnsServers</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								A list of DNS servers added to resolv.conf. Usually allows a maximum of 2 servers.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								comma delimited list
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">EC2MetadataIp</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The IP address of the metadata server used to provision overcloud nodes. Set to the IP address of the undercloud on the Control Plane.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">BondInterfaceOvsOptions</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The options for bonding interfaces. For example: <code class="literal">BondInterfaceOvsOptions: "bond_mode=balance-slb"</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronExternalNetworkBridge</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								Legacy value for the name of the external bridge to use for OpeNStack Networking (neutron). This value is empty by default, which allows for multiple physical bridges to be defined in the <code class="literal">NeutronBridgeMappings</code>. This should not normally be overridden.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronFlatNetworks</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								Defines the flat networks to configure in neutron plugins. Defaults to "datacentre" to permit external network creation. For example: <code class="literal">NeutronFlatNetworks: "datacentre"</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronBridgeMappings</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The logical to physical bridge mappings to use. Defaults to mapping the external bridge on hosts (<code class="literal">br-ex</code>) to a physical name (<code class="literal">datacentre</code>). You would refer to the logical name when creating OpenStack Networking (neutron) provider networks or floating IP networks. For example <code class="literal">NeutronBridgeMappings: "datacentre:br-ex,tenant:br-tenant"</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronPublicInterface</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								Defines the interface to bridge onto <code class="literal">br-ex</code> for network nodes when not using network isolation. Usually not used except in small deployments with only two networks. For example: <code class="literal">NeutronPublicInterface: "eth0"</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronNetworkType</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								TThe tenant network type for OpenStack Networking (neutron). To specify multiple values, use a comma separated list. The first type specified is used until all available networks are exhausted, then the next type is used. For example: <code class="literal">NeutronNetworkType: "vxlan"</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronTunnelTypes</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The tunnel types for the neutron tenant network. To specify multiple values, use a comma separated string. For example: <span class="emphasis"><em>NeutronTunnelTypes: 'gre,vxlan</em></span>'
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string / comma separated list
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronTunnelIdRanges</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								Ranges of GRE tunnel IDs to make available for tenant network allocation. For example: <code class="literal">NeutronTunnelIdRanges "1:1000"</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronVniRanges</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								Ranges of VXLAN VNI IDs to make available for tenant network allocation. For example: <code class="literal">NeutronVniRanges: "1:1000"</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronEnableTunnelling</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								Defines whether to enable or completely disable all tunnelled networks. Leave this enabled unless you are sure you will never want to create tunelled networks. Defaults to enabled.
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								Boolean
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronNetworkVLANRanges</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The ML2 and Open vSwitch VLAN mapping range to support. Defaults to permitting any VLAN on the <code class="literal">datacentre</code> physical network. To specify multiple values, use a comma separated list. For example: <code class="literal">NeutronNetworkVLANRanges: "datacentre:1:1000,tenant:100:299,tenant:310:399"</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140097852263712"> <p>
								<code class="literal">NeutronMechanismDrivers</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852262624"> <p>
								The mechanism drivers for the neutron tenant network. Defaults to "ovn". To specify multiple values, use a comma-separated string. For example: <code class="literal">NeutronMechanismDrivers: 'openvswitch,l2population'</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140097852261536"> <p>
								string / comma separated list
							</p>
							 </td></tr></tbody></table></div></section><section class="section" id="example-custom-network-environment-file"><div class="titlepage"><div><div><h2 class="title">10.9. Example custom network environment file</h2></div></div></div><p>
				The following is an example of an environment file to enable your NIC templates and set custom parameters.
			</p><pre class="screen">resource_registry:
  OS::TripleO::BlockStorage::Net::SoftwareConfig:
    /home/stack/templates/nic-configs/cinder-storage.yaml
  OS::TripleO::Compute::Net::SoftwareConfig:
    /home/stack/templates/nic-configs/compute.yaml
  OS::TripleO::Controller::Net::SoftwareConfig:
    /home/stack/templates/nic-configs/controller.yaml
  OS::TripleO::ObjectStorage::Net::SoftwareConfig:
    /home/stack/templates/nic-configs/swift-storage.yaml
  OS::TripleO::CephStorage::Net::SoftwareConfig:
    /home/stack/templates/nic-configs/ceph-storage.yaml

parameter_defaults:
  # Gateway router for the provisioning network (or Undercloud IP)
  ControlPlaneDefaultRoute: 192.0.2.254
  # The IP address of the EC2 metadata server. Generally the IP of the Undercloud
  EC2MetadataIp: 192.0.2.1
  # Define the DNS servers (maximum 2) for the overcloud nodes
  DnsServers: ["8.8.8.8","8.8.4.4"]
  NeutronExternalNetworkBridge: "''"</pre></section><section class="section" id="enabling-network-isolation-with-custom-nics"><div class="titlepage"><div><div><h2 class="title">10.10. Enabling network isolation with custom NICs</h2></div></div></div><p>
				This procedure show how to enable network isolation using custom NIC templates.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						When running the <code class="literal">openstack overcloud deploy</code> command, make sure to include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The custom <code class="literal">network_data</code> file.
							</li><li class="listitem">
								The rendered file name of the default network isolation.
							</li><li class="listitem">
								The rendered file name of the default network environment file.
							</li><li class="listitem">
								The custom environment network configuration that includes resource references to your custom NIC templates.
							</li><li class="listitem">
								Any additional environment files relevant to your configuration.
							</li></ul></div></li></ol></div><p>
				For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
    ...
    -n /home/stack/network_data.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-environment.yaml \
    -e /home/stack/templates/custom-network-configuration.yaml \
    ...</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Include the <code class="literal">network-isolation.yaml</code> file first, then the <code class="literal">network-environment.yaml</code> file. The subsequent <code class="literal">custom-network-configuration.yaml</code> overrides the <code class="literal">OS::TripleO::[ROLE]::Net::SoftwareConfig</code> resources from the previous two files..
					</li><li class="listitem">
						If using composable networks, include the <code class="literal">network_data</code> and <code class="literal">roles_data</code> files with this command.
					</li></ul></div></section></section><section class="chapter" id="additional-network-configuration"><div class="titlepage"><div><div><h1 class="title">Chapter 11. Additional network configuration</h1></div></div></div><p>
			This chapter follows on from the concepts and procedures outlined in <a class="xref" href="index.html#custom-network-interface-templates" title="Chapter 10. Custom network interface templates">Chapter 10, <em>Custom network interface templates</em></a> and provides some additional information to help configure parts of your overcloud network.
		</p><section class="section" id="configuring-custom-interfaces"><div class="titlepage"><div><div><h2 class="title">11.1. Configuring custom Interfaces</h2></div></div></div><p>
				Individual interfaces might require modification. The example below shows modifications required to use the second NIC to connect to an infrastructure network with DHCP addresses, and to use the third and fourth NICs for the bond:
			</p><pre class="screen">network_config:
  # Add a DHCP infrastructure network to nic2
  - type: interface
    name: nic2
    use_dhcp: true
  - type: ovs_bridge
    name: br-bond
    members:
      - type: ovs_bond
        name: bond1
        ovs_options:
          get_param: BondInterfaceOvsOptions
        members:
          # Modify bond NICs to use nic3 and nic4
          - type: interface
            name: nic3
            primary: true
          - type: interface
            name: nic4</pre><p>
				The network interface template uses either the actual interface name (<code class="literal">eth0</code>, <code class="literal">eth1</code>, <code class="literal">enp0s25</code>) or a set of numbered interfaces (<code class="literal">nic1</code>, <code class="literal">nic2</code>, <code class="literal">nic3</code>). The network interfaces of hosts within a role do not have to be exactly the same when using numbered interfaces (<code class="literal">nic1</code>, <code class="literal">nic2</code>, etc.) instead of named interfaces (<code class="literal">eth0</code>, <code class="literal">eno2</code>, etc.). For example, one host might have interfaces <code class="literal">em1</code> and <code class="literal">em2</code>, while another has <code class="literal">eno1</code> and <code class="literal">eno2</code>, but you can refer to the NICs of both hosts as <code class="literal">nic1</code> and <code class="literal">nic2</code>.
			</p><p>
				The order of numbered interfaces corresponds to the order of named network interface types:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">ethX</code> interfaces, such as <code class="literal">eth0</code>, <code class="literal">eth1</code>, etc. These are usually onboard interfaces.
					</li><li class="listitem">
						<code class="literal">enoX</code> interfaces, such as <code class="literal">eno0</code>, <code class="literal">eno1</code>, etc. These are usually onboard interfaces.
					</li><li class="listitem">
						<code class="literal">enX</code> interfaces, sorted alpha numerically, such as <code class="literal">enp3s0</code>, <code class="literal">enp3s1</code>, <code class="literal">ens3</code>, etc. These are usually add-on interfaces.
					</li></ul></div><p>
				The numbered NIC scheme only takes into account the interfaces that are live, for example, if they have a cable attached to the switch. If you have some hosts with four interfaces and some with six interfaces, you should use <code class="literal">nic1</code> to <code class="literal">nic4</code> and only plug four cables on each host.
			</p><p>
				You can hardcode physical interfaces to specific aliases. This allows you to be pre-determine which physical NIC will map as <code class="literal">nic1</code> or <code class="literal">nic2</code> and so on. You can also map a MAC address to a specified alias.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Normally, <code class="literal">os-net-config</code> only registers interfaces that are already connected in an <code class="literal">UP</code> state. However, if you hardcode interfaces using a custom mapping file, the interface is registered even if it is in a <code class="literal">DOWN</code> state.
				</p></div></div><p>
				Interfaces are mapped to aliases using an environment file. In this example, each node has predefined entries for <code class="literal">nic1</code> and <code class="literal">nic2</code>:
			</p><pre class="screen">parameter_defaults:
  NetConfigDataLookup:
    node1:
      nic1: "em1"
      nic2: "em2"
    node2:
      nic1: "00:50:56:2F:9F:2E"
      nic2: "em2"</pre><p>
				The resulting configuration is applied by <code class="literal">os-net-config</code>. On each node, you can see the applied configuration under <code class="literal">interface_mapping</code> in <code class="literal">/etc/os-net-config/mapping.yaml</code>.
			</p></section><section class="section" id="configuring-routes-and-default-routes"><div class="titlepage"><div><div><h2 class="title">11.2. Configuring routes and default routes</h2></div></div></div><p>
				There are two ways to set the default route of a host. If the interface is using DHCP and the DHCP server offers a gateway address, the system uses a default route for that gateway. Otherwise, you can set a default route on an interface with a static IP.
			</p><p>
				Although the Linux kernel supports multiple default gateways, it only uses the one with the lowest metric. If there are multiple DHCP interfaces, this can result in an unpredictable default gateway. In this case, it is recommended to set <code class="literal">defroute: false</code> for interfaces other than the one using the default route.
			</p><p>
				For example, you might want a DHCP interface (<code class="literal">nic3</code>) to be the default route. Use the following YAML to disable the default route on another DHCP interface (<code class="literal">nic2</code>):
			</p><pre class="screen"># No default route on this DHCP interface
- type: interface
  name: nic2
  use_dhcp: true
  defroute: false
# Instead use this DHCP interface as the default route
- type: interface
  name: nic3
  use_dhcp: true</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The <code class="literal">defroute</code> parameter only applies to routes obtained through DHCP.
				</p></div></div><p>
				To set a static route on an interface with a static IP, specify a route to the subnet. For example, you can set a route to the 10.1.2.0/24 subnet through the gateway at 172.17.0.1 on the Internal API network:
			</p><pre class="screen">    - type: vlan
      device: bond1
      vlan_id:
        get_param: InternalApiNetworkVlanID
      addresses:
      - ip_netmask:
          get_param: InternalApiIpSubnet
      routes:
      - ip_netmask: 10.1.2.0/24
        next_hop: 172.17.0.1</pre></section><section class="section" id="configuring-policy-based-routing"><div class="titlepage"><div><div><h2 class="title">11.3. Configuring policy-based routing</h2></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					This feature is available in this release as a <span class="emphasis"><em>Technology Preview</em></span>, and therefore is not fully supported by Red Hat. It should only be used for testing, and should not be deployed in a production environment. For more information about Technology Preview features, see <a class="link" href="https://access.redhat.com/support/offerings/production/scope_moredetail">Scope of Coverage Details</a>.
				</p></div></div><p>
				On Controller nodes, to configure unlimited access from different networks, configure policy-based routing. Policy-based routing uses route tables where, on a host with multiple interfaces, you can send traffic through a particular interface depending on the source address. You can route packets that come from different sources to different networks, even if the destinations are the same.
			</p><p>
				For example, you can configure a route to send traffic to the Internal API network, based on the source address of the packet, even when the default route is for the External network. You can also define specific route rules for each interface.
			</p><p>
				Red Hat OpenStack Platform uses the <code class="literal">os-net-config</code> tool to configure network properties for your overcloud nodes. The <code class="literal">os-net-config</code> tool manages the following network routing on Controller nodes:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Routing tables in the <code class="literal">/etc/iproute2/rt_tables</code> file
					</li><li class="listitem">
						IPv4 rules in the <code class="literal">/etc/sysconfig/network-scripts/rule-{ifname}</code> file
					</li><li class="listitem">
						IPv6 rules in the <code class="literal">/etc/sysconfig/network-scripts/rule6-{ifname}</code> file
					</li><li class="listitem">
						Routing table specific routes in the <code class="literal">/etc/sysconfig/network-scripts/route-{ifname}</code>
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed the undercloud successfully. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/director_installation_and_usage/index#installing-the-undercloud">Installing director</a> in the <span class="emphasis"><em>Director Installation and Usage</em></span> guide.
					</li><li class="listitem">
						You have rendered the default <code class="literal">.j2</code> network interface templates from the <code class="literal">openstack-tripleo-heat-templates</code> directory. For more information, see <a class="xref" href="index.html#rendering-default-network-interface-templates-for-customization" title="10.2. Rendering default network interface templates for customization">Section 10.2, “Rendering default network interface templates for customization”</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create <code class="literal">route_table</code> and <code class="literal">interface</code> entries in a custom NIC template from the <code class="literal">~/templates/custom-nics</code> directory, define a route for the interface, and define rules that are relevant to your deployment:
					</p><pre class="screen">$network_config:
  network_config:

  - type: route_table
    name: &lt;custom&gt;
    table_id: 200

  - type: interface
    name: em1
    use_dhcp: false
    addresses:
      - ip_netmask: {get_param: ExternalIpSubnet}
    routes:
      - ip_netmask: 10.1.3.0/24
        next_hop: {get_param: ExternalInterfaceDefaultRoute}
        table: 200
    rules:
      - rule: "iif em1 table 200"
        comment: "Route incoming traffic to em1 with table 200"
      - rule: "from 192.0.2.0/24 table 200"
        comment: "Route all traffic from 192.0.2.0/24 with table 200"
      - rule: "add blackhole from 172.19.40.0/24 table 200"
      - rule: "add unreachable iif em1 from 192.168.1.0/24"</pre></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">run-os-net-config.sh</code> script location to an absolute path in each custom NIC template that you create. The script is located in the <code class="literal">/usr/share/openstack-tripleo-heat-templates/network/scripts/</code> directory on the undercloud:
					</p><pre class="screen">resources:
  OsNetConfigImpl:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      config:
        str_replace:
          template:
            get_file: /usr/share/openstack-tripleo-heat-templates/network/scripts/run-os-net-config.sh</pre></li><li class="listitem"><p class="simpara">
						Include your custom NIC configuration and network environment files in the deployment command, along with any other environment files relevant to your deployment:
					</p><pre class="screen">$ openstack overcloud deploy --templates \
-e ~/templates/&lt;custom-nic-template&gt;
-e &lt;OTHER_ENVIRONMENT_FILES&gt;</pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Enter the following commands on a Controller node to verify that the routing configuration is functioning correctly:
					</p><pre class="screen">$ cat /etc/iproute2/rt_tables
$ ip route
$ ip rule</pre></li></ul></div></section><section class="section" id="configuring-jumbo-frames"><div class="titlepage"><div><div><h2 class="title">11.4. Configuring jumbo frames</h2></div></div></div><p>
				The Maximum Transmission Unit (MTU) setting determines the maximum amount of data transmitted with a single Ethernet frame. Using a larger value results in less overhead since each frame adds data in the form of a header. The default value is 1500 and using a higher value requires the configuration of the switch port to support jumbo frames. Most switches support an MTU of at least 9000, but many are configured for 1500 by default.
			</p><p>
				The MTU of a VLAN cannot exceed the MTU of the physical interface. Ensure that you include the MTU value on the bond and/or interface.
			</p><p>
				The Storage, Storage Management, Internal API, and Tenant networks all benefit from jumbo frames. In testing, a project’s networking throughput demonstrated substantial improvement when using jumbo frames in conjunction with VXLAN tunnels.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					It is recommended that the Provisioning interface, External interface, and any floating IP interfaces be left at the default MTU of 1500. Connectivity problems are likely to occur otherwise. This is because routers typically cannot forward jumbo frames across Layer 3 boundaries.
				</p></div></div><pre class="screen">- type: ovs_bond
  name: bond1
  mtu: 9000
  ovs_options: {get_param: BondInterfaceOvsOptions}
  members:
    - type: interface
      name: nic3
      mtu: 9000
      primary: true
    - type: interface
      name: nic4
      mtu: 9000

# The external interface should stay at default
- type: vlan
  device: bond1
  vlan_id:
    get_param: ExternalNetworkVlanID
  addresses:
    - ip_netmask:
        get_param: ExternalIpSubnet
  routes:
    - ip_netmask: 0.0.0.0/0
      next_hop:
        get_param: ExternalInterfaceDefaultRoute

# MTU 9000 for Internal API, Storage, and Storage Management
- type: vlan
  device: bond1
  mtu: 9000
  vlan_id:
    get_param: InternalApiNetworkVlanID
  addresses:
  - ip_netmask:
      get_param: InternalApiIpSubnet</pre></section><section class="section" id="configuring-the-native-vlan-for-floating-ips"><div class="titlepage"><div><div><h2 class="title">11.5. Configuring the native VLAN for floating IPs</h2></div></div></div><p>
				Neutron uses a default empty string for its external bridge mapping. This maps the physical interface to the <code class="literal">br-int</code> instead of using <code class="literal">br-ex</code> directly. This model allows multiple Floating IP networks using either VLANs or multiple physical connections.
			</p><p>
				Use the <code class="literal">NeutronExternalNetworkBridge</code> parameter in the <code class="literal">parameter_defaults</code> section of your network isolation environment file:
			</p><pre class="screen">  parameter_defaults:
    # Set to "br-ex" when using floating IPs on the native VLAN
    NeutronExternalNetworkBridge: "''"</pre><p>
				If you use only one Floating IP network on the native VLAN of a bridge, you can optionally set the neutron external bridge. This results in the packets only having to traverse one bridge instead of two, which might result in slightly lower CPU usage when passing traffic over the Floating IP network.
			</p></section><section class="section" id="configuring-the-native-vlan-on-a-trunked-interface"><div class="titlepage"><div><div><h2 class="title">11.6. Configuring the native VLAN on a trunked interface</h2></div></div></div><p>
				If a trunked interface or bond has a network on the native VLAN, the IP addresses are assigned directly to the bridge and is no VLAN interface.
			</p><p>
				For example, if the External network is on the native VLAN, a bonded configuration looks like this:
			</p><pre class="screen">network_config:
  - type: ovs_bridge
    name: bridge_name
    dns_servers:
      get_param: DnsServers
    addresses:
      - ip_netmask:
          get_param: ExternalIpSubnet
    routes:
      - ip_netmask: 0.0.0.0/0
        next_hop:
          get_param: ExternalInterfaceDefaultRoute
    members:
      - type: ovs_bond
        name: bond1
        ovs_options:
          get_param: BondInterfaceOvsOptions
        members:
          - type: interface
            name: nic3
            primary: true
          - type: interface
            name: nic4</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					When moving the address (and possibly route) statements onto the bridge, remove the corresponding VLAN interface from the bridge. Make the changes to all applicable roles. The External network is only on the controllers, so only the controller template requires a change. The Storage network on the other hand is attached to all roles, so if the Storage network is on the default VLAN, all roles require modifications.
				</p></div></div></section></section><section class="chapter" id="overcloud-network-interface-bonding"><div class="titlepage"><div><div><h1 class="title">Chapter 12. Network Interface Bonding</h1></div></div></div><p>
			This chapter defines some of the bonding options you can use in your custom network configuration.
		</p><section class="section" id="bonding-overview"><div class="titlepage"><div><div><h2 class="title">12.1. Network Interface Bonding and Link Aggregation Control Protocol (LACP)</h2></div></div></div><p>
				You can bundle multiple physical NICs together to form a single logical channel known as a bond. Bonds can be configured to provide redundancy for high availability systems or increased throughput.
			</p><p>
				Red Hat OpenStack Platform supports Linux bonds, Open vSwitch (OVS) kernel bonds, and OVS-DPDK bonds.
			</p><p>
				The bonds can be used with the optional Link Aggregation Control Protocol (LACP). LACP is a negotiation protocol that creates a dynamic bond for load balancing and fault tolerance.
			</p><p>
				Red Hat recommends the use of Linux kernel bonds (bond type: linux_bond) over OvS kernel bonds (bond type: ovs_bond). User mode bonds (bond type: ovs_dpdk_bond) should be used with user mode bridges (type: ovs_user_bridge) as opposed to kernel mode bridges (type: ovs_bridge). However, don’t combine ovs_bridge and ovs_user_bridge on the same node.
			</p><p>
				On control and storage networks, Red Hat recommends the use of Linux bonds with VLAN and LACP, because OVS bonds carry the potential for control plane disruption that can occur when OVS or the neutron agent is restarted for updates, hot fixes, and other events. The Linux bond/LACP/VLAN configuration provides NIC management without the OVS disruption potential.
			</p><p>
				Here is an example configuration of a Linux bond with one VLAN.
			</p><pre class="screen">params:
            $network_config:
              network_config:

              - type: linux_bond
                name: bond_api
                bonding_options: "mode=active-backup"
                use_dhcp: false
                dns_servers:
        `          get_param: DnsServers
                members:
                - type: interface
                  name: nic3
                  primary: true
                - type: interface
                  name: nic4

              - type: vlan
                vlan_id:
                  get_param: InternalApiNetworkVlanID
                device: bond_api
                addresses:
                - ip_netmask:
                    get_param: InternalApiIpSubnet</pre><p>
				The following example shows a Linux bond plugged into the OVS bridge
			</p><pre class="screen">params:
            $network_config:
              network_config:

            -  type: ovs_bridge
                name: br-tenant
                use_dhcp: false
                mtu: 9000
                members:
                  - type: linux_bond
                    name: bond_tenant
                    bonding_options: "mode=802.3ad updelay=1000 miimon=100"
                    use_dhcp: false
                    dns_servers:
                      get_param: DnsServers
                    members:
                    - type: interface
                      name: p1p1
                      primary: true
                    - type: interface
                      name: p1p2
                  - type: vlan
                    device: bond_tenant
                    vlan_id: {get_param: TenantNetworkVlanID}
                    addresses:
                      -
                        ip_netmask: {get_param: TenantIpSubnet}</pre><p>
				The following example shows an OVS user space bridge:
			</p><pre class="screen">params:
            $network_config:
              network_config:

          -    type: ovs_user_bridge
                name: br-ex
                use_dhcp: false
                members:
                - type: ovs_dpdk_bond
                  name: dpdkbond0
                  mtu: 2140
                  ovs_options: {get_param: BondInterfaceOvsOptions}
                  #ovs_extra:
                  #- set interface dpdk0 mtu_request=$MTU
                  #- set interface dpdk1 mtu_request=$MTU
                  rx_queue:
                    get_param: NumDpdkInterfaceRxQueues
                  members:
                  - type: ovs_dpdk_port
                    name: dpdk0
                    mtu: 2140
                    members:
                    - type: interface
                      name: p1p1
                  - type: ovs_dpdk_port
                    name: dpdk1
                    mtu: 2140
                    members:
                    - type: interface
                      name: p1p2</pre></section><section class="section" id="open-vswitch-bonding-options"><div class="titlepage"><div><div><h2 class="title">12.2. Open vSwitch Bonding Options</h2></div></div></div><p>
				The Overcloud provides networking through Open vSwitch (OVS). The following table describes support for OVS kernel and OVS-DPDK for bonded interfaces. The OVS/OVS-DPDK balance-tcp mode is available as a technology preview only.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					This support requires Open vSwitch 2.11 or later.
				</p></div></div><div class="informaltable"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 25%; " class="col_2"><!--Empty--></col><col style="width: 25%; " class="col_3"><!--Empty--></col><col style="width: 25%; " class="col_4"><!--Empty--></col></colgroup><tbody><tr><td align="left" valign="top"> <p>
								OVS Bond mode
							</p>
							 </td><td align="left" valign="top"> <p>
								Application
							</p>
							 </td><td align="left" valign="top"> <p>
								Notes
							</p>
							 </td><td align="left" valign="top"> <p>
								Compatible LACP options
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								active-backup
							</p>
							 </td><td align="left" valign="top"> <p>
								High availability (active-passive)
							</p>
							 </td><td align="left" valign="top"> </td><td align="left" valign="top"> <p>
								off
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								balance-slb
							</p>
							 </td><td align="left" valign="top"> <p>
								Increased throughput (active-active)
							</p>
							 </td><td align="left" valign="top"> <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Performance is affected by extra parsing per packet.
									</li><li class="listitem">
										There is a potential for vhost-user lock contention.
									</li></ul></div>
							 </td><td align="left" valign="top"> <p>
								active, passive, or off
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								balance-tcp (tech preview only )
							</p>
							 </td><td align="left" valign="top"> <p>
								Not recommended (active-active)
							</p>
							 </td><td align="left" valign="top"> <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Recirculation needed for L4 hashing has a performance impact.
									</li><li class="listitem">
										As with balance-slb, performance is affected by extra parsing per packet and there is a potential for vhost-user lock contention.
									</li><li class="listitem">
										LACP must be enabled.
									</li></ul></div>
							 </td><td align="left" valign="top"> <p>
								active or passive
							</p>
							 </td></tr></tbody></table></div><p>
				You can configure a bonded interface in the network environment file using the BondInterfaceOvsOptions parameter as shown in this example:
			</p><pre class="screen">parameter_defaults:
  BondInterfaceOvsOptions: "bond_mode=balance-slb"</pre></section><section class="section" id="linux-bonding-options"><div class="titlepage"><div><div><h2 class="title">12.3. Linux bonding options</h2></div></div></div><p>
				You can use LACP with Linux bonding in your network interface templates. For example:
			</p><pre class="screen">      - type: linux_bond
        name: bond1
        members:
        - type: interface
          name: nic2
        - type: interface
          name: nic3
        bonding_options: "mode=802.3ad lacp_rate=[fast|slow] updelay=1000 miimon=100"</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">mode</code> - enables LACP.
					</li><li class="listitem">
						<code class="literal">lacp_rate</code> - defines whether LACP packets are sent every 1 second, or every 30 seconds.
					</li><li class="listitem">
						<code class="literal">updelay</code> - defines the minimum amount of time that an interface must be active before it is used for traffic (this helps mitigate port flapping outages).
					</li><li class="listitem">
						<code class="literal">miimon</code> - the interval in milliseconds that is used for monitoring the port state using the driver’s MIIMON functionality.
					</li></ul></div></section><section class="section" id="general-bonding-options"><div class="titlepage"><div><div><h2 class="title">12.4. General bonding options</h2></div></div></div><p>
				The following table provides some explanation of these options and some alternatives depending on your hardware.
			</p><div class="table" id="idm140097848389440"><p class="title"><strong>Table 12.1. Bonding Options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><tbody><tr><td align="left" valign="top"> <p>
								<code class="literal">bond_mode=balance-slb</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								Balances flows based on source MAC address and output VLAN, with periodic rebalancing as traffic patterns change. Bonding with <code class="literal">balance-slb</code> allows a limited form of load balancing without the remote switch’s knowledge or cooperation. SLB assigns each source MAC and VLAN pair to a link and transmits all packets from that MAC and VLAN through that link. This mode uses a simple hashing algorithm based on source MAC address and VLAN number, with periodic rebalancing as traffic patterns change. This mode is similar to mode 2 bonds used by the Linux bonding driver. This mode can be used to provide load balancing even when the switch is not configured to use LACP.
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								<code class="literal">bond_mode=active-backup</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								This mode offers active/standby failover where the standby NIC resumes network operations when the active connection fails. Only one MAC address is presented to the physical switch. This mode does not require any special switch support or configuration, and works when the links are connected to separate switches. This mode does not provide load balancing.
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								<code class="literal">lacp=[active|passive|off]</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								Controls the Link Aggregation Control Protocol (LACP) behavior. Only certain switches support LACP. If your switch does not support LACP, use <code class="literal">bond_mode=balance-slb</code> or <code class="literal">bond_mode=active-backup</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								<code class="literal">other-config:lacp-fallback-ab=true</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								Sets the LACP behavior to switch to bond_mode=active-backup as a fallback.
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								<code class="literal">other_config:lacp-time=[fast|slow]</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								Set the LACP heartbeat to 1 second (fast) or 30 seconds (slow). The default is slow.
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								<code class="literal">other_config:bond-detect-mode=[miimon|carrier]</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								Set the link detection to use miimon heartbeats (miimon) or monitor carrier (carrier). The default is carrier.
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								<code class="literal">other_config:bond-miimon-interval=100</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								If using miimon, set the heartbeat interval in milliseconds.
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								<code class="literal">other_config:bond_updelay=1000</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								Number of milliseconds a link must be up to be activated to prevent flapping.
							</p>
							 </td></tr><tr><td align="left" valign="top"> <p>
								<code class="literal">other_config:bond-rebalance-interval=10000</code>
							</p>
							 </td><td align="left" valign="top"> <p>
								Milliseconds between rebalancing flows between bond members. Set to zero to disable.
							</p>
							 </td></tr></tbody></table></div></div></section></section><section class="chapter" id="sect-Controlling_Node_Placement"><div class="titlepage"><div><div><h1 class="title">Chapter 13. Controlling Node Placement</h1></div></div></div><p>
			The default behavior for the director is to randomly select nodes for each role, usually based on their profile tag. However, the director provides the ability to define specific node placement. This is a useful method to:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Assign specific node IDs e.g. <code class="literal">controller-0</code>, <code class="literal">controller-1</code>, etc
				</li><li class="listitem">
					Assign custom hostnames
				</li><li class="listitem">
					Assign specific IP addresses
				</li><li class="listitem">
					Assign specific Virtual IP addresses
				</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				Manually setting predictable IP addresses, virtual IP addresses, and ports for a network alleviates the need for allocation pools. However, it is recommended to retain allocation pools for each network to ease with scaling new nodes. Make sure that any statically defined IP addresses fall outside the allocation pools. For more information on setting allocation pools, see <a class="xref" href="index.html#custom-network-environment-file" title="10.7. Custom network environment file">Section 10.7, “Custom network environment file”</a>.
			</p></div></div><section class="section" id="sect-Assign_Specific_Node_IDs"><div class="titlepage"><div><div><h2 class="title">13.1. Assigning Specific Node IDs</h2></div></div></div><p>
				This procedure assigns node ID to specific nodes. Examples of node IDs include <code class="literal">controller-0</code>, <code class="literal">controller-1</code>, <code class="literal">compute-0</code>, <code class="literal">compute-1</code>, and so forth.
			</p><p>
				The first step is to assign the ID as a per-node capability that the Compute scheduler matches on deployment. For example:
			</p><pre class="screen">openstack baremetal node set --property capabilities='node:controller-0,boot_option:local' &lt;id&gt;</pre><p>
				This assigns the capability <code class="literal">node:controller-0</code> to the node. Repeat this pattern using a unique continuous index, starting from 0, for all nodes. Make sure all nodes for a given role (Controller, Compute, or each of the storage roles) are tagged in the same way or else the Compute scheduler will not match the capabilities correctly.
			</p><p>
				The next step is to create a Heat environment file (for example, <code class="literal">scheduler_hints_env.yaml</code>) that uses scheduler hints to match the capabilities for each node. For example:
			</p><pre class="screen">parameter_defaults:
  ControllerSchedulerHints:
    'capabilities:node': 'controller-%index%'</pre><p>
				To use these scheduler hints, include the ` scheduler_hints_env.yaml` environment file with the <code class="literal">overcloud deploy command</code> during overcloud creation.
			</p><p>
				The same approach is possible for each role via these parameters:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">ControllerSchedulerHints</code> for Controller nodes.
					</li><li class="listitem">
						<code class="literal">ComputeSchedulerHints</code> for Compute nodes.
					</li><li class="listitem">
						<code class="literal">BlockStorageSchedulerHints</code> for Block Storage nodes.
					</li><li class="listitem">
						<code class="literal">ObjectStorageSchedulerHints</code> for Object Storage nodes.
					</li><li class="listitem">
						<code class="literal">CephStorageSchedulerHints</code> for Ceph Storage nodes.
					</li><li class="listitem">
						<code class="literal">[ROLE]SchedulerHints</code> for custom roles. Replace <code class="literal">[ROLE]</code> with the role name.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Node placement takes priority over profile matching. To avoid scheduling failures, use the default <code class="literal">baremetal</code> flavor for deployment and not the flavors designed for profile matching (<code class="literal">compute</code>, <code class="literal">control</code>, etc). For example:
				</p><pre class="screen">$ openstack overcloud deploy ... --control-flavor baremetal --compute-flavor baremetal ...</pre></div></div></section><section class="section" id="sect-Custom_Hostnames"><div class="titlepage"><div><div><h2 class="title">13.2. Assigning Custom Hostnames</h2></div></div></div><p>
				In combination with the node ID configuration in <a class="xref" href="index.html#sect-Assign_Specific_Node_IDs" title="13.1. Assigning Specific Node IDs">Section 13.1, “Assigning Specific Node IDs”</a>, the director can also assign a specific custom hostname to each node. This is useful when you need to define where a system is located (e.g. <code class="literal">rack2-row12</code>), match an inventory identifier, or other situations where a custom hostname is desired.
			</p><p>
				To customize node hostnames, use the <code class="literal">HostnameMap</code> parameter in an environment file, such as the ` scheduler_hints_env.yaml` file from <a class="xref" href="index.html#sect-Assign_Specific_Node_IDs" title="13.1. Assigning Specific Node IDs">Section 13.1, “Assigning Specific Node IDs”</a>. For example:
			</p><pre class="screen">parameter_defaults:
  ControllerSchedulerHints:
    'capabilities:node': 'controller-%index%'
  ComputeSchedulerHints:
    'capabilities:node': 'compute-%index%'
  HostnameMap:
    overcloud-controller-0: overcloud-controller-prod-123-0
    overcloud-controller-1: overcloud-controller-prod-456-0
    overcloud-controller-2: overcloud-controller-prod-789-0
    overcloud-novacompute-0: overcloud-compute-prod-abc-0</pre><p>
				Define the <code class="literal">HostnameMap</code> in the <code class="literal">parameter_defaults</code> section, and set each mapping as the original hostname that Heat defines using <code class="literal">HostnameFormat</code> parameters (e.g. <code class="literal">overcloud-controller-0</code>) and the second value is the desired custom hostname for that node (e.g. <code class="literal">overcloud-controller-prod-123-0</code>).
			</p><p>
				Using this method in combination with the node ID placement ensures each node has a custom hostname.
			</p></section><section class="section" id="sect-Predictable_IPs"><div class="titlepage"><div><div><h2 class="title">13.3. Assigning Predictable IPs</h2></div></div></div><p>
				For further control over the resulting environment, director can assign overcloud nodes with specific IPs on each network.
			</p><p>
				Create an environment file to define the predictive IP addressing:
			</p><pre class="screen">$ touch ~/templates/predictive_ips.yaml</pre><p>
				Create a <code class="literal">parameter_defaults</code> section in the <code class="literal">~/templates/predictive_ips.yaml</code> file and use the following syntax to define predictive IP addressing for each node on each network:
			</p><pre class="screen">parameter_defaults:
  &lt;role_name&gt;IPs:
    &lt;network&gt;:
    - &lt;IP_address&gt;
    &lt;network&gt;:
    - &lt;IP_address&gt;</pre><p>
				Each node role has a unique parameter. Replace <code class="literal">&lt;role_name&gt;IPs</code> with the relevant parameter:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">ControllerIPs</code> for Controller nodes.
					</li><li class="listitem">
						<code class="literal">ComputeIPs</code> for Compute nodes.
					</li><li class="listitem">
						<code class="literal">CephStorageIPs</code> for Ceph Storage nodes.
					</li><li class="listitem">
						<code class="literal">BlockStorageIPs</code> for Block Storage nodes.
					</li><li class="listitem">
						<code class="literal">SwiftStorageIPs</code> for Object Storage nodes.
					</li><li class="listitem">
						<code class="literal">[ROLE]IPs</code> for custom roles. Replace <code class="literal">[ROLE]</code> with the role name.
					</li></ul></div><p>
				Each parameter is a map of network names to a list of addresses. Each network type must have at least as many addresses as there will be nodes on that network. Director assigns addresses in order. The first node of each type receives the first address on each respective list, the second node receives the second address on each respective lists, and so forth.
			</p><p>
				For example, if an overcloud will contain three Ceph Storage nodes, the <code class="literal">CephStorageIPs</code> parameter might look like:
			</p><pre class="screen">parameter_defaults:
  CephStorageIPs:
    storage:
    - 172.16.1.100
    - 172.16.1.101
    - 172.16.1.102
    storage_mgmt:
    - 172.16.3.100
    - 172.16.3.101
    - 172.16.3.102</pre><p>
				The first Ceph Storage node receives two addresses: 172.16.1.100 and 172.16.3.100. The second receives 172.16.1.101 and 172.16.3.101, and the third receives 172.16.1.102 and 172.16.3.102. The same pattern applies to the other node types.
			</p><p>
				To configure predictable IP addresses on the control plane, copy the <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/ips-from-pool-ctlplane.yaml</code> file to the <code class="literal">templates</code> directory of the <code class="literal">stack</code> user:
			</p><pre class="screen">$ cp /usr/share/openstack-tripleo-heat-templates/environments/ips-from-pool-ctlplane.yaml ~/templates/.</pre><p>
				Configure the new <code class="literal">ips-from-pool-ctlplane.yaml</code> file with the following parameter example. You can combine the control plane IP address declarations with the IP address declarations for other networks and use only one file to declare the IP addresses for all networks on all roles. You can also use predictable IP addresses for spine/leaf. Each node must have IP addresses from the correct subnet.
			</p><pre class="screen">parameter_defaults:
  ControllerIPs:
    ctlplane:
    - 192.168.24.10
    - 192.168.24.11
    - 192.168.24.12
    internal_api:
    - 172.16.1.20
    - 172.16.1.21
    - 172.16.1.22
    external:
    - 10.0.0.40
    - 10.0.0.57
    - 10.0.0.104
  ComputeLeaf1IPs:
    ctlplane:
    - 192.168.25.100
    - 192.168.25.101
    internal_api:
    - 172.16.2.100
    - 172.16.2.101
  ComputeLeaf2IPs:
    ctlplane:
    - 192.168.26.100
    - 192.168.26.101
    internal_api:
    - 172.16.3.100
    - 172.16.3.101</pre><p>
				Ensure that the IP addresses that you choose fall outside the allocation pools for each network that you define in your network environment file (see <a class="xref" href="index.html#custom-network-environment-file" title="10.7. Custom network environment file">Section 10.7, “Custom network environment file”</a>). For example, ensure that the <code class="literal">internal_api</code> assignments fall outside of the <code class="literal">InternalApiAllocationPools</code> range to avoid conflicts with any IPs chosen automatically. Likewise, ensure that the IP assignments do not conflict with the VIP configuration, either for standard predictable VIP placement (see <a class="xref" href="index.html#sect-Predictable_VIPs" title="13.4. Assigning Predictable Virtual IPs">Section 13.4, “Assigning Predictable Virtual IPs”</a>) or external load balancing (see <a class="xref" href="index.html#sect-Configuring_External_Load_Balancing" title="24.2. Configuring External Load Balancing">Section 24.2, “Configuring External Load Balancing”</a>).
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					If an overcloud node is deleted, do not remove its entries in the IP lists. The IP list is based on the underlying Heat indices, which do not change even if you delete nodes. To indicate a given entry in the list is no longer used, replace the IP value with a value such as <code class="literal">DELETED</code> or <code class="literal">UNUSED</code>. Entries should never be removed from the IP lists, only changed or added.
				</p></div></div><p>
				To apply this configuration during a deployment, include the <code class="literal">predictive_ips.yaml</code> environment file with the <code class="literal">openstack overcloud deploy</code> command.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					If using network isolation, include the <code class="literal">predictive_ips.yaml</code> file after the <code class="literal">network-isolation.yaml</code> file.
				</p></div></div><p>
				For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates \
  -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml \
  -e ~/templates/predictive_ips.yaml \
  [OTHER OPTIONS]</pre></section><section class="section" id="sect-Predictable_VIPs"><div class="titlepage"><div><div><h2 class="title">13.4. Assigning Predictable Virtual IPs</h2></div></div></div><p>
				In addition to defining predictable IP addresses for each node, the director also provides a similar ability to define predictable Virtual IPs (VIPs) for clustered services. To accomplish this, edit the network environment file from <a class="xref" href="index.html#custom-network-environment-file" title="10.7. Custom network environment file">Section 10.7, “Custom network environment file”</a> and add the VIP parameters in the <code class="literal">parameter_defaults</code> section:
			</p><pre class="screen">parameter_defaults:
  ...
  # Predictable VIPs
  ControlFixedIPs: [{'ip_address':'192.168.201.101'}]
  InternalApiVirtualFixedIPs: [{'ip_address':'172.16.0.9'}]
  PublicVirtualFixedIPs: [{'ip_address':'10.1.1.9'}]
  StorageVirtualFixedIPs: [{'ip_address':'172.18.0.9'}]
  StorageMgmtVirtualFixedIPs: [{'ip_address':'172.19.0.9'}]
  RedisVirtualFixedIPs: [{'ip_address':'172.16.0.8'}]</pre><p>
				Select these IPs from outside of their respective allocation pool ranges. For example, select an IP address for <code class="literal">InternalApiVirtualFixedIPs</code> that is not within the <code class="literal">InternalApiAllocationPools</code> range.
			</p><p>
				This step is only for overclouds using the default internal load balancing configuration. If assigning VIPs with an external load balancer, use the procedure in the dedicated <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/external_load_balancing_for_the_overcloud">External Load Balancing for the Overcloud</a> guide.
			</p></section></section><section class="chapter" id="sect-Enabling_SSLTLS_on_the_Overcloud"><div class="titlepage"><div><div><h1 class="title">Chapter 14. Enabling SSL/TLS on Overcloud Public Endpoints</h1></div></div></div><p>
			By default, the overcloud uses unencrypted endpoints for its services. This means that the overcloud configuration requires an additional environment file to enable SSL/TLS for its Public API endpoints. The following chapter shows how to configure your SSL/TLS certificate and include it as a part of your overcloud creation.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				This process only enables SSL/TLS for Public API endpoints. The Internal and Admin APIs remain unencrypted.
			</p></div></div><p>
			This process requires network isolation to define the endpoints for the Public API.
		</p><section class="section" id="Initializing_the_Certificate_Authority"><div class="titlepage"><div><div><h2 class="title">14.1. Initializing the Signing Host</h2></div></div></div><p>
				The signing host is the host that generates and signs new certificates with a certificate authority. If you have never created SSL certificates on the chosen signing host, you might need to initialize the host so that it can sign new certificates.
			</p><p>
				The <code class="literal">/etc/pki/CA/index.txt</code> file contains records of all signed certificates. Check if this file exists. If the file does not exist, create the directory path if needed, then create an empty file, <code class="literal">index.txt</code>:
			</p><pre class="screen">$ mkdir -p /etc/pki/CA
$ sudo touch /etc/pki/CA/index.txt</pre><p>
				The <code class="literal">/etc/pki/CA/serial</code> file identifies the next serial number to use for the next certificate to sign. Check if this file exists. If the file does not exist, create a new file, <code class="literal">serial</code>, with a starting value of <code class="literal">1000</code>:
			</p><pre class="screen">$ echo '1000' | sudo tee /etc/pki/CA/serial</pre></section><section class="section" id="Creating_a_Certificate_Authority"><div class="titlepage"><div><div><h2 class="title">14.2. Creating a Certificate Authority</h2></div></div></div><p>
				Normally you sign your SSL/TLS certificates with an external certificate authority. In some situations, you might want to use your own certificate authority. For example, you might want to have an internal-only certificate authority.
			</p><p>
				Generate a key and certificate pair to act as the certificate authority:
			</p><pre class="screen">$ openssl genrsa -out ca.key.pem 4096
$ openssl req  -key ca.key.pem -new -x509 -days 7300 -extensions v3_ca -out ca.crt.pem</pre><p>
				The <code class="literal">openssl req</code> command asks for certain details about your authority. Enter these details at the prompt.
			</p><p>
				These commands create a certificate authority file called <code class="literal">ca.crt.pem</code>.
			</p></section><section class="section" id="Adding_the_Certificate_Authority_to_Clients"><div class="titlepage"><div><div><h2 class="title">14.3. Adding the Certificate Authority to Clients</h2></div></div></div><p>
				For any external clients aiming to communicate using SSL/TLS, copy the certificate authority file to each client that requires access to your Red Hat OpenStack Platform environment.
			</p><pre class="screen">$ sudo cp ca.crt.pem /etc/pki/ca-trust/source/anchors/</pre><p>
				After you copy the certificate authority file to each client, run the following command on each client to add the certificate to the certificate authority trust bundle:
			</p><pre class="screen">$ sudo update-ca-trust extract</pre><p>
				For example, the undercloud requires a copy of the certificate authority file so that it can communicate with the overcloud endpoints during creation.
			</p></section><section class="section" id="Creating_an_SSL_TLS_Key"><div class="titlepage"><div><div><h2 class="title">14.4. Creating an SSL/TLS Key</h2></div></div></div><p>
				Run the following commands to generate the SSL/TLS key (<code class="literal">server.key.pem</code>) that you use at different points to generate your undercloud or overcloud certificates:
			</p><pre class="screen">$ openssl genrsa -out server.key.pem 2048</pre></section><section class="section" id="Creating_an_SSL_TLS_Certificate_Signing_Request"><div class="titlepage"><div><div><h2 class="title">14.5. Creating an SSL/TLS Certificate Signing Request</h2></div></div></div><p>
				This next procedure creates a certificate signing request for the overcloud. Copy the default OpenSSL configuration file for customization.
			</p><pre class="screen">$ cp /etc/pki/tls/openssl.cnf .</pre><p>
				Edit the custom <code class="literal">openssl.cnf</code> file and set SSL parameters to use for the overcloud. An example of the types of parameters to modify include:
			</p><pre class="screen">[req]
distinguished_name = req_distinguished_name
req_extensions = v3_req

[req_distinguished_name]
countryName = Country Name (2 letter code)
countryName_default = AU
stateOrProvinceName = State or Province Name (full name)
stateOrProvinceName_default = Queensland
localityName = Locality Name (eg, city)
localityName_default = Brisbane
organizationalUnitName = Organizational Unit Name (eg, section)
organizationalUnitName_default = Red Hat
commonName = Common Name
commonName_default = 10.0.0.1
commonName_max = 64

[ v3_req ]
# Extensions to add to a certificate request
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[alt_names]
IP.1 = 10.0.0.1
DNS.1 = 10.0.0.1
DNS.2 = myovercloud.example.com</pre><p>
				Set the <code class="literal">commonName_default</code> to one of the following:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						If using an IP to access over SSL/TLS, use the Virtual IP for the Public API. Set this VIP using the <code class="literal">PublicVirtualFixedIPs</code> parameter in an environment file. For more information, see <a class="xref" href="index.html#sect-Predictable_VIPs" title="13.4. Assigning Predictable Virtual IPs">Section 13.4, “Assigning Predictable Virtual IPs”</a>. If you are not using predictable VIPs, the director assigns the first IP address from the range defined in the <code class="literal">ExternalAllocationPools</code> parameter.
					</li><li class="listitem">
						If using a fully qualified domain name to access over SSL/TLS, use the domain name instead.
					</li></ul></div><p>
				Include the same Public API IP address as an IP entry and a DNS entry in the <code class="literal">alt_names</code> section. If also using DNS, include the hostname for the server as DNS entries in the same section. For more information about <code class="literal">openssl.cnf</code>, run <code class="literal">man openssl.cnf</code>.
			</p><p>
				Run the following command to generate certificate signing request (<code class="literal">server.csr.pem</code>):
			</p><pre class="screen">$ openssl req -config openssl.cnf -key server.key.pem -new -out server.csr.pem</pre><p>
				Make sure to include the SSL/TLS key you created in <a class="xref" href="index.html#Creating_an_SSL_TLS_Key" title="14.4. Creating an SSL/TLS Key">Section 14.4, “Creating an SSL/TLS Key”</a> for the <code class="literal">-key</code> option.
			</p><p>
				Use the <code class="literal">server.csr.pem</code> file to create the SSL/TLS certificate in the next section.
			</p></section><section class="section" id="Creating_the_SSL_TLS_Certificate"><div class="titlepage"><div><div><h2 class="title">14.6. Creating the SSL/TLS Certificate</h2></div></div></div><p>
				Run the following command to create a certificate for your undercloud or overcloud:
			</p><pre class="screen">$ sudo openssl ca -config openssl.cnf -extensions v3_req -days 3650 -in server.csr.pem -out server.crt.pem -cert ca.crt.pem -keyfile ca.key.pem</pre><p>
				This command uses the following options:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The configuration file specifying the v3 extensions. Include the configuration file with the <code class="literal">-config</code> option.
					</li><li class="listitem">
						The certificate signing request from <a class="xref" href="index.html#Creating_an_SSL_TLS_Certificate_Signing_Request" title="14.5. Creating an SSL/TLS Certificate Signing Request">Section 14.5, “Creating an SSL/TLS Certificate Signing Request”</a> to generate and sign the certificate with a certificate authority. Include the certificate signing request with the <code class="literal">-in</code> option.
					</li><li class="listitem">
						The certificate authority you created in <a class="xref" href="index.html#Creating_a_Certificate_Authority" title="14.2. Creating a Certificate Authority">Section 14.2, “Creating a Certificate Authority”</a>, which signs the certificate. Include the certificate authority with the <code class="literal">-cert</code> option.
					</li><li class="listitem">
						The certificate authority private key you created in <a class="xref" href="index.html#Creating_a_Certificate_Authority" title="14.2. Creating a Certificate Authority">Section 14.2, “Creating a Certificate Authority”</a>. Include the private key with the <code class="literal">-keyfile</code> option.
					</li></ul></div><p>
				This command creates a new certificate named <code class="literal">server.crt.pem</code>. Use this certificate in conjunction with the SSL/TLS key from <a class="xref" href="index.html#Creating_an_SSL_TLS_Key" title="14.4. Creating an SSL/TLS Key">Section 14.4, “Creating an SSL/TLS Key”</a> to enable SSL/TLS.
			</p></section><section class="section" id="enabling_ssl_tls"><div class="titlepage"><div><div><h2 class="title">14.7. Enabling SSL/TLS</h2></div></div></div><p>
				Copy the <code class="literal">enable-tls.yaml</code> environment file from the Heat template collection:
			</p><pre class="screen">$ cp -r /usr/share/openstack-tripleo-heat-templates/environments/ssl/enable-tls.yaml ~/templates/.</pre><p>
				Edit this file and make the following changes for these parameters:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">SSLCertificate</span></dt><dd><p class="simpara">
							Copy the contents of the certificate file (<code class="literal">server.crt.pem</code>) into the <code class="literal">SSLCertificate</code> parameter. For example:
						</p><pre class="screen">parameter_defaults:
  SSLCertificate: |
    -----BEGIN CERTIFICATE-----
    MIIDgzCCAmugAwIBAgIJAKk46qw6ncJaMA0GCSqGS
    ...
    sFW3S2roS4X0Af/kSSD8mlBBTFTCMBAj6rtLBKLaQ
    -----END CERTIFICATE-----</pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								The certificate contents require the same indentation level for all new lines.
							</p></div></div></dd><dt><span class="term">SSLIntermediateCertificate</span></dt><dd><p class="simpara">
							If you have an intermediate certificate, copy the contents of the intermediate certificate into the <code class="literal">SSLIntermediateCertificate</code> parameter:
						</p><pre class="screen">parameter_defaults:
  SSLIntermediateCertificate: |
    -----BEGIN CERTIFICATE-----
    sFW3S2roS4X0Af/kSSD8mlBBTFTCMBAj6rtLBKLaQbIxEpIzrgvpBCwUAMFgxCzAJB
    ...
    MIIDgzCCAmugAwIBAgIJAKk46qw6ncJaMA0GCSqGSIb3DQE
    -----END CERTIFICATE-----</pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								The certificate contents require the same indentation level for all new lines.
							</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">SSLKey</span></dt><dd><p class="simpara">
										Copy the contents of the private key (<code class="literal">server.key.pem</code>) into the <code class="literal">SSLKey</code> parameter. For example:
									</p><pre class="screen">parameter_defaults:
  ...
  SSLKey: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIEowIBAAKCAQEAqVw8lnQ9RbeI1EdLN5PJP0lVO
    ...
    ctlKn3rAAdyumi4JDjESAXHIKFjJNOLrBmpQyES4X
    -----END RSA PRIVATE KEY-----</pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
											The private key contents require the same indentation level for all new lines.
										</p></div></div></dd></dl></div></dd></dl></div></section><section class="section" id="injecting_a_root_certificate"><div class="titlepage"><div><div><h2 class="title">14.8. Injecting a Root Certificate</h2></div></div></div><p>
				If the certificate signer is not in the default trust store on the overcloud image, you must inject the certificate authority into the overcloud image. Copy the <code class="literal">inject-trust-anchor-hiera.yaml</code> environment file from the heat template collection:
			</p><pre class="screen">$ cp -r /usr/share/openstack-tripleo-heat-templates/environments/ssl/inject-trust-anchor-hiera.yaml ~/templates/.</pre><p>
				Edit this file and make the following changes for these parameters:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CAMap</span></dt><dd><p class="simpara">
							Lists each certificate authority content (CA) to inject into the overcloud. The overcloud requires both a CA files used to sign the certificates for the undercloud and the overcloud. Copy the contents of the root certificate authority file (<code class="literal">ca.crt.pem</code>) into an entry. For example, your <code class="literal">CAMap</code> parameter might look like the following:
						</p><pre class="screen">parameter_defaults:
  CAMap:
    ...
    undercloud-ca:
      content: |
        -----BEGIN CERTIFICATE-----
        MIIDlTCCAn2gAwIBAgIJAOnPtx2hHEhrMA0GCS
        BAYTAlVTMQswCQYDVQQIDAJOQzEQMA4GA1UEBw
        UmVkIEhhdDELMAkGA1UECwwCUUUxFDASBgNVBA
        -----END CERTIFICATE-----
    overcloud-ca:
      content: |
        -----BEGIN CERTIFICATE-----
        MIIDBzCCAe+gAwIBAgIJAIc75A7FD++DMA0GCS
        BAMMD3d3dy5leGFtcGxlLmNvbTAeFw0xOTAxMz
        Um54yGCARyp3LpkxvyfMXX1DokpS1uKi7s6CkF
        -----END CERTIFICATE-----</pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								The certificate authority contents require the same indentation level for all new lines.
							</p></div></div></dd></dl></div><p>
				You can also inject additional CAs with the <code class="literal">CAMap</code> parameter.
			</p></section><section class="section" id="configuring_dns_endpoints"><div class="titlepage"><div><div><h2 class="title">14.9. Configuring DNS endpoints</h2></div></div></div><p>
				If using a DNS hostname to access the overcloud through SSL/TLS, you will need to copy the <code class="literal">custom-domain.yaml</code> file into <code class="literal">/home/stack/templates</code>. You can find this file in <code class="literal">/usr/share/tripleo-heat-templates/environments/predictable-placement/</code>.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Configure the host and domain names for all fields, adding parameters for custom networks if needed:
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							It is not possible to redeploy with a TLS-everywhere architecture if this environment file is not included in the initial deployment.
						</p></div></div><pre class="screen"># title: Custom Domain Name
# description: |
#   This environment contains the parameters that need to be set in order to
#   use a custom domain name and have all of the various FQDNs reflect it.
parameter_defaults:
  # The DNS domain used for the hosts. This must match the overcloud_domain_name configured on the undercloud.
  # Type: string
  CloudDomain: localdomain

  # The DNS name of this cloud. E.g. ci-overcloud.tripleo.org
  # Type: string
  CloudName: overcloud.localdomain

  # The DNS name of this cloud's provisioning network endpoint. E.g. 'ci-overcloud.ctlplane.tripleo.org'.
  # Type: string
  CloudNameCtlplane: overcloud.ctlplane.localdomain

  # The DNS name of this cloud's internal_api endpoint. E.g. 'ci-overcloud.internalapi.tripleo.org'.
  # Type: string
  CloudNameInternal: overcloud.internalapi.localdomain

  # The DNS name of this cloud's storage endpoint. E.g. 'ci-overcloud.storage.tripleo.org'.
  # Type: string
  CloudNameStorage: overcloud.storage.localdomain

  # The DNS name of this cloud's storage_mgmt endpoint. E.g. 'ci-overcloud.storagemgmt.tripleo.org'.
  # Type: string
  CloudNameStorageManagement: overcloud.storagemgmt.localdomain</pre></li><li class="listitem"><p class="simpara">
						Add a list of DNS servers to use under parameter defaults, in either a new or existing environment file:
					</p><pre class="screen">parameter_defaults:
  DnsServers: ["10.0.0.254"]
  ....</pre></li></ol></div></section><section class="section" id="adding_environment_files_during_overcloud_creation"><div class="titlepage"><div><div><h2 class="title">14.10. Adding Environment Files During Overcloud Creation</h2></div></div></div><p>
				The deployment command (<code class="literal">openstack overcloud deploy</code>) uses the <code class="literal">-e</code> option to add environment files. Add the environment files from this section in the following order:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The environment file to enable SSL/TLS (<code class="literal">enable-tls.yaml</code>)
					</li><li class="listitem">
						The environment file to set the DNS hostname (<code class="literal">cloudname.yaml</code>)
					</li><li class="listitem">
						The environment file to inject the root certificate authority (<code class="literal">inject-trust-anchor-hiera.yaml</code>)
					</li><li class="listitem"><p class="simpara">
						The environment file to set the public endpoint mapping:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								If using a DNS name for accessing the public endpoints, use <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/ssl/tls-endpoints-public-dns.yaml</code>
							</li><li class="listitem">
								If using a IP address for accessing the public endpoints, use <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/ssl/tls-endpoints-public-ip.yaml</code>
							</li></ul></div></li></ul></div><p>
				For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates [...] -e /home/stack/templates/enable-tls.yaml -e ~/templates/cloudname.yaml -e ~/templates/inject-trust-anchor-hiera.yaml -e /usr/share/openstack-tripleo-heat-templates/environments/ssl/tls-endpoints-public-dns.yaml</pre></section><section class="section" id="updating_ssl_tls_certificates"><div class="titlepage"><div><div><h2 class="title">14.11. Updating SSL/TLS Certificates</h2></div></div></div><p>
				If you need to update certificates in the future:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Edit the <code class="literal">enable-tls.yaml</code> file and update the <code class="literal">SSLCertificate</code>, <code class="literal">SSLKey</code>, and <code class="literal">SSLIntermediateCertificate</code> parameters.
					</li><li class="listitem">
						If your certificate authority has changed, edit the <code class="literal">inject-trust-anchor.yaml</code> file and update the <code class="literal">SSLRootCertificate</code> parameter.
					</li></ul></div><p>
				Once the new certificate content is in place, rerun your deployment command. For example:
			</p><pre class="screen">$ openstack overcloud deploy --templates [...] -e /home/stack/templates/enable-tls.yaml -e ~/templates/cloudname.yaml -e ~/templates/inject-trust-anchor.yaml -e /usr/share/openstack-tripleo-heat-templates/environments/ssl/tls-endpoints-public-dns.yaml</pre></section></section><section class="chapter" id="sect-Enabling_Internal_SSLTLS_on_the_Overcloud"><div class="titlepage"><div><div><h1 class="title">Chapter 15. Enabling SSL/TLS on Internal and Public Endpoints with Identity Management</h1></div></div></div><p>
			You can enable SSL/TLS on certain overcloud endpoints. Due to the number of certificates required, the director integrates with a Red Hat Identity Management (IdM) server to act as a certificate authority and manage the overcloud certificates. This process involves using <code class="literal">novajoin</code> to enroll overcloud nodes to the IdM server.
		</p><p>
			To check the status of TLS support across the OpenStack components, refer to the <a class="link" href="https://access.redhat.com/articles/4039501">TLS Enablement status matrix</a>.
		</p><section class="section" id="add_the_undercloud_to_the_ca"><div class="titlepage"><div><div><h2 class="title">15.1. Add the undercloud to the CA</h2></div></div></div><p>
				Before deploying the overcloud, you must add the undercloud to the Certificate Authority (CA):
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						On the undercloud node, install the <code class="literal">python3-novajoin</code> package:
					</p><pre class="screen">$ sudo dnf install python3-novajoin</pre></li><li class="listitem"><p class="simpara">
						On the undercloud node, run the <code class="literal">novajoin-ipa-setup</code> script, adjusting the values to suit your deployment:
					</p><pre class="screen">$ sudo /usr/libexec/novajoin-ipa-setup \
    --principal admin \
    --password &lt;IdM admin password&gt; \
    --server &lt;IdM server hostname&gt; \
    --realm &lt;overcloud cloud domain (in upper case)&gt; \
    --domain &lt;overcloud cloud domain&gt; \
    --hostname &lt;undercloud hostname&gt; \
    --precreate</pre><p class="simpara">
						In the following section, you will use the resulting One-Time Password (OTP) to enroll the undercloud.
					</p></li></ol></div></section><section class="section" id="add_the_undercloud_to_idm"><div class="titlepage"><div><div><h2 class="title">15.2. Add the undercloud to IdM</h2></div></div></div><p>
				This procedure registers the undercloud with IdM and configures novajoin. Configure the following settings in <code class="literal">undercloud.conf</code> (within the <code class="literal">[DEFAULT]</code> section):
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						The novajoin service is disabled by default. To enable it:
					</p><pre class="screen">[DEFAULT]
enable_novajoin = true</pre></li><li class="listitem"><p class="simpara">
						You need set a One-Time Password (OTP) to register the undercloud node with IdM:
					</p><pre class="screen">ipa_otp = &lt;otp&gt;</pre></li><li class="listitem"><p class="simpara">
						Set the overcloud’s domain name to be served by neutron’s DHCP server:
					</p><pre class="screen">overcloud_domain_name = &lt;domain&gt;</pre></li><li class="listitem"><p class="simpara">
						Set the appropriate hostname for the undercloud:
					</p><pre class="screen">undercloud_hostname = &lt;undercloud FQDN&gt;</pre></li><li class="listitem"><p class="simpara">
						Set IdM as the nameserver for the undercloud:
					</p><pre class="screen">undercloud_nameservers = &lt;IdM IP&gt;</pre></li><li class="listitem"><p class="simpara">
						For larger environments, you will need to review the novajoin connection timeout values. In <code class="literal">undercloud.conf</code>, add a reference to a new file called <code class="literal">undercloud-timeout.yaml</code>:
					</p><pre class="screen">hieradata_override = /home/stack/undercloud-timeout.yaml</pre><p class="simpara">
						Add the following options to <code class="literal">undercloud-timeout.yaml</code>. You can specify the timeout value in seconds, for example, <code class="literal">5</code>:
					</p><pre class="screen">nova::api::vendordata_dynamic_connect_timeout: &lt;timeout value&gt;
nova::api::vendordata_dynamic_read_timeout: &lt;timeout value&gt;</pre></li><li class="listitem">
						Save the <code class="literal">undercloud.conf</code> file.
					</li><li class="listitem"><p class="simpara">
						Run the undercloud deployment command to apply the changes to your existing undercloud:
					</p><pre class="screen">$ openstack undercloud install</pre></li></ol></div></section><section class="section" id="configure_overcloud_dns"><div class="titlepage"><div><div><h2 class="title">15.3. Configure overcloud DNS</h2></div></div></div><p>
				For automatic detection of your IdM environment, and easier enrollment, consider using IdM as your DNS server:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Connect to your undercloud:
					</p><pre class="screen">$ source ~/stackrc</pre></li><li class="listitem"><p class="simpara">
						Configure the control plane subnet to use IdM as the DNS name server:
					</p><pre class="screen">$ openstack subnet set ctlplane-subnet --dns-nameserver  &lt;idm_server_address&gt;</pre></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">DnsServers</code> parameter in an environment file to use your IdM server:
					</p><pre class="screen">parameter_defaults:
  DnsServers: ["&lt;idm_server_address&gt;"]</pre><p class="simpara">
						This parameter is usually defined in a custom <code class="literal">network-environment.yaml</code> file.
					</p></li></ol></div></section><section class="section" id="configure_overcloud_to_use_novajoin"><div class="titlepage"><div><div><h2 class="title">15.4. Configure overcloud to use novajoin</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						To enable IdM integration, create a copy of the <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/predictable-placement/custom-domain.yaml</code> environment file:
					</p><pre class="screen">$ cp /usr/share/openstack-tripleo-heat-templates/environments/predictable-placement/custom-domain.yaml \
  /home/stack/templates/custom-domain.yaml</pre></li><li class="listitem"><p class="simpara">
						Edit the <code class="literal">/home/stack/templates/custom-domain.yaml</code> environment file and set the <code class="literal">CloudDomain</code> and <code class="literal">CloudName*</code> values to suit your deployment. For example:
					</p><pre class="screen">parameter_defaults:
  CloudDomain: lab.local
  CloudName: overcloud.lab.local
  CloudNameInternal: overcloud.internalapi.lab.local
  CloudNameStorage: overcloud.storage.lab.local
  CloudNameStorageManagement: overcloud.storagemgmt.lab.local
  CloudNameCtlplane: overcloud.ctlplane.lab.local</pre></li><li class="listitem"><p class="simpara">
						Include the following environment files in the overcloud deployment process:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/ssl/enable-internal-tls.yaml</code>
							</li><li class="listitem">
								<code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/ssl/tls-everywhere-endpoints-dns.yaml</code>
							</li><li class="listitem"><p class="simpara">
								<code class="literal">/home/stack/templates/custom-domain.yaml</code>
							</p><p class="simpara">
								For example:
							</p><pre class="screen">openstack overcloud deploy \
  --templates \
   -e /usr/share/openstack-tripleo-heat-templates/environments/ssl/enable-internal-tls.yaml \
   -e /usr/share/openstack-tripleo-heat-templates/environments/ssl/tls-everywhere-endpoints-dns.yaml \
   -e /home/stack/templates/custom-domain.yaml \</pre><p class="simpara">
								As a result, the deployed overcloud nodes will be automatically enrolled with IdM.
							</p></li></ul></div></li><li class="listitem"><p class="simpara">
						This only sets TLS for the internal endpoints. For the external endpoints you can use the normal means of adding TLS with the <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/ssl/enable-tls.yaml</code> environment file (which must be modified to add your custom certificate and key). Consequently, your <code class="literal">openstack deploy</code> command would be similar to this:
					</p><pre class="screen">openstack overcloud deploy \
  --templates \
  -e /usr/share/openstack-tripleo-heat-templates/environments/ssl/enable-internal-tls.yaml \
  -e /usr/share/openstack-tripleo-heat-templates/environments/ssl/tls-everywhere-endpoints-dns.yaml \
  -e /home/stack/templates/custom-domain.yaml \
  -e /home/stack/templates/enable-tls.yaml</pre></li><li class="listitem"><p class="simpara">
						Alternatively, you can also use IdM to issue your public certificates. In that case, you need to use the <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/services/haproxy-public-tls-certmonger.yaml</code> environment file. For example:
					</p><pre class="screen">openstack overcloud deploy \
  --templates \
   -e /usr/share/openstack-tripleo-heat-templates/environments/ssl/enable-internal-tls.yaml \
   -e /usr/share/openstack-tripleo-heat-templates/environments/ssl/tls-everywhere-endpoints-dns.yaml \
   -e /home/stack/templates/custom-domain.yaml \
   -e /usr/share/openstack-tripleo-heat-templates/environments/services/haproxy-public-tls-certmonger.yaml</pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					You can no longer use novajoin to implement TLS everywhere (TLS-e) on a pre-existing deployment. For information on hardening an existing deployment of Red Hat OpenStack Platform using TLS-e, see <a class="xref" href="index.html#sect-tripleo-ipa" title="Chapter 16. Implementing TLS-e with Ansible">Chapter 16, <em>Implementing TLS-e with Ansible</em></a>.
				</p></div></div></section></section><section class="chapter" id="sect-tripleo-ipa"><div class="titlepage"><div><div><h1 class="title">Chapter 16. Implementing TLS-e with Ansible</h1></div></div></div><p>
			Red Hat recommends the new ansible-based <code class="literal">tripleo-ipa</code> method over the default <code class="literal">novajoin</code> method to configure your undercloud and overcloud with TLS-e. You can use the following procedure to implement TLSe on either a new installation of Red Hat OpenStack Platform, or an existing deployment you wish to configure with TLS-e. You must use this method if you deploy Red Hat OpenStack Platform with TLS-e on pre-provisioned nodes.
		</p><section class="section" id="configuring_tls_e_on_the_undercloud"><div class="titlepage"><div><div><h2 class="title">16.1. Configuring TLS-e on the undercloud</h2></div></div></div><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
					Ensure that all configuration steps for the undercloud, such as the creation of the stack user, are complete. For more details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/director_installation_and_usage/index">Director Installation and Usage</a> for more details
				</p></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Configure the hosts file
					</p><p class="simpara">
						Set the appropriate search domains and the nameserver on the undercloud in <code class="literal">/etc/resolv.conf</code>. For example, if the deployment domain is <code class="literal">example.com</code>, and the domain of the FreeIPA server is <code class="literal">bigcorp.com</code>, then add the following lines to /etc/resolv.conf:
					</p><pre class="screen">search example.com bigcorp.com
nameserver $IDM_SERVER_IP_ADDR</pre></li><li class="listitem"><p class="simpara">
						Install required software:
					</p><pre class="screen">sudo yum install -y python3-ipalib python3-ipaclient krb5-devel</pre></li><li class="listitem"><p class="simpara">
						Export environmental variables with values specific to your environment.:
					</p><pre class="screen">export IPA_DOMAIN=bigcorp.com
export IPA_REALM=BIGCORP.COM
export IPA_ADMIN_USER=$IPA_USER
export IPA_ADMIN_PASSWORD=$IPA_PASSWORD
export IPA_SERVER_HOSTNAME=ipa.bigcorp.com
export UNDERCLOUD_FQDN=undercloud.example.com
export USER=stack
export CLOUD_DOMAIN=example.com</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The IdM user credentials must be an administrative user that can add new hosts and services.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Run the <code class="literal">undercloud-ipa-install.yaml</code> ansible playbook on the undercloud:
					</p><pre class="screen">ansible-playbook \
--ssh-extra-args "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" \
/usr/share/ansible/tripleo-playbooks/undercloud-ipa-install.yaml</pre></li><li class="listitem"><p class="simpara">
						Add the following parameters to undercloud.conf
					</p><pre class="screen">undercloud_nameservers = $IDM_SERVER_IP_ADDR
overcloud_domain_name = example.com</pre></li><li class="listitem"><p class="simpara">
						Deploy the undercloud:
					</p><pre class="screen">openstack undercloud install</pre></li></ol></div><div class="formalpara"><p class="title"><strong>Verification</strong></p><p>
					Verify that the undercloud was enrolled correctly by completing the following steps:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						List the hosts in IdM:
					</p><pre class="screen">$ kinit
$ ipa host-find</pre></li><li class="listitem"><p class="simpara">
						Confirm that <code class="literal">/etc/novajoin/krb5.keytab</code> exists on the undercloud.
					</p><pre class="screen">ls /etc/novajoin/krb5.keytab</pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The <code class="literal">novajoin</code> directory name is for legacy naming purposes only.
				</p></div></div></section><section class="section" id="configuring_tls_e_on_the_overcloud"><div class="titlepage"><div><div><h2 class="title">16.2. Configuring TLS-e on the overcloud</h2></div></div></div><p>
				When you deploy the overcloud with TLS everywhere (TLS-e), IP addresses from the Undercloud and Overcloud will automatically be registered with IdM. This feature is provided as a technology preview. This feature is available in this release as a <span class="emphasis"><em>Technology Preview</em></span>, and therefore is not fully supported by Red Hat. It should only be used for testing, and should not be deployed in a production environment. For more information about Technology Preview features, see <a class="link" href="https://access.redhat.com/support/offerings/production/scope_moredetail">Scope of Coverage Details</a>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					To disable automatic IP address registration, set the <code class="literal">IDMModifyDNS</code> heat parameter to false:
				</p><pre class="screen">parameter_defaults:
    ....
    IdMModifyDNS: false</pre></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Before deploying the overcloud, create a YAML file <code class="literal">tls-parameters.yaml</code> with contents similar to the following. The values you select will be specific for your environment:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The <code class="literal">DnsServers</code> parameter should have a value that reflects the IP address of the IdM server.
							</li><li class="listitem">
								If the domain of the IdM server is different than the cloud domain, include it in the <code class="literal">DnsSearchDomains</code> parameter. For example: <code class="literal">DnsSearchDomains: ["example.com", "bigcorp.com"]</code>
							</li><li class="listitem">
								The shown value of the <code class="literal">OS::TripleO::Services::IpaClient</code> parameter overrides the default setting in the <code class="literal">enable-internal-tls.yaml</code> file. You must ensure the <code class="literal">tls-parameters.yaml</code> file follows <code class="literal">enable-internal-tls.yaml</code> in the <code class="literal">openstack overcloud deploy</code> command.
							</li><li class="listitem"><p class="simpara">
								If you are running a distributed compute node (DCN) architecture with cinder configured as active-active, you must set the <code class="literal">EnableEtcdInternalTLS</code> parameter to <code class="literal">true</code>.
							</p><pre class="screen">parameter_defaults:
    DnsSearchDomains: ["example.com"]
    DnsServers: ["192.168.1.13"]
    CloudDomain: example.com
    CloudName: overcloud.example.com
    CloudNameInternal: overcloud.internalapi.example.com
    CloudNameStorage: overcloud.storage.example.com
    CloudNameStorageManagement: overcloud.storagemgmt.example.com
    CloudNameCtlplane: overcloud.ctlplane.example.com
resource_registry:
      OS::TripleO::Services::IpaClient: /usr/share/openstack-tripleo-heat-templates/deployment/ipa/ipaservices-baremetal-ansible.yaml</pre></li></ul></div></li><li class="listitem"><p class="simpara">
						Deploy the overcloud. You will need to include the tls-parameters.yaml in the deployment command:
					</p><pre class="screen">DEFAULT_TEMPLATES=/usr/share/openstack-tripleo-heat-templates/
CUSTOM_TEMPLATES=/home/stack/templates

openstack overcloud deploy \
-e ${DEFAULT_TEMPLATES}/environments/ssl/tls-everywhere-endpoints-dns.yaml \
-e ${DEFAULT_TEMPLATES}/environments/services/haproxy-public-tls-certmonger.yaml \
-e ${DEFAULT_TEMPLATES}/environments/ssl/enable-internal-tls.yaml \
-e ${CUSTOM_TEMPLATES}/tls-parameters.yaml \
...</pre></li><li class="listitem"><p class="simpara">
						Confirm each endpoint is using HTTPS by querying keystone for a list of endpoints:
					</p><pre class="screen">openstack overcloud endpoint list</pre></li></ol></div></section></section><section class="chapter" id="chap-Debug_Modes"><div class="titlepage"><div><div><h1 class="title">Chapter 17. Debug Modes</h1></div></div></div><p>
			You can enable and disable the <code class="literal">DEBUG</code> level logging mode for certain services in the overcloud. To configure debug mode for a service, set the respective debug parameter.
		</p><p>
			For example, OpenStack Identity (keystone) uses the <code class="literal">KeystoneDebug</code> parameter. Create a <code class="literal">debug.yaml</code> environment file to store debug parameters and set the <code class="literal">KeystoneDebug</code> parameter in the <code class="literal">parameter_defaults</code> section:
		</p><pre class="screen">parameter_defaults:
  KeystoneDebug: True</pre><p>
			After you have set the <code class="literal">KeystoneDebug</code> parameter to <code class="literal">True</code>, the <code class="literal">/var/log/containers/keystone/keystone.log</code> standard keystone log file is updated with <code class="literal">DEBUG</code> level logs.
		</p><p>
			For a full list of debug parameters, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/overcloud_parameters/debug-parameters">"Debug Parameters"</a> in the <span class="emphasis"><em>Overcloud Parameters</em></span> guide.
		</p></section><section class="chapter" id="chap-Policies"><div class="titlepage"><div><div><h1 class="title">Chapter 18. Policies</h1></div></div></div><p>
			You can configure access policies for certain services in the overcloud. To configure policies for a service, set the respective policy parameter with a hash value containing the service’s policies. For example:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
					OpenStack Identity (keystone) uses the <code class="literal">KeystonePolicies</code> parameter. Set this parameter in the <code class="literal">parameter_defaults</code> section of an environment file:
				</p><pre class="screen">parameter_defaults:
  KeystonePolicies: { keystone-context_is_admin: { key: context_is_admin, value: 'role:admin' } }</pre></li><li class="listitem"><p class="simpara">
					OpenStack Compute (nova) uses the <code class="literal">NovaApiPolicies</code> parameter. Set this parameter in the <code class="literal">parameter_defaults</code> section of an environment file:
				</p><pre class="screen">parameter_defaults:
  NovaApiPolicies: { nova-context_is_admin: { key: 'compute:get_all', value: '@' } }</pre></li></ul></div><p>
			For a full list of policy parameters, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/overcloud_parameters/policy-parameters">"Policy Parameters"</a> in the <span class="emphasis"><em>Overcloud Parameters</em></span> guide.
		</p></section><section class="chapter" id="storage_configuration"><div class="titlepage"><div><div><h1 class="title">Chapter 19. Storage Configuration</h1></div></div></div><p>
			This chapter outlines several methods of configuring storage options for your Overcloud.
		</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				By default, the overcloud uses local ephemeral storage provided by OpenStack Compute (nova) and LVM block storage provided by OpenStack Storage (cinder). However, these options are not supported for enterprise-level overclouds. Instead, use one of the storage options in this chapter.
			</p></div></div><section class="section" id="sect-Configuring_NFS_Storage"><div class="titlepage"><div><div><h2 class="title">19.1. Configuring NFS Storage</h2></div></div></div><p>
				This section describes how to configure the overcloud to use an NFS share. The installation and configuration process is based on the modification of an existing environment file in the core heat template collection.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Red Hat recommends that you use a certified storage back end and driver. Red Hat does not recommend that you use NFS that comes from the generic NFS back end, because its capabilities are limited when compared to a certified storage back end and driver. For example, the generic NFS back end does not support features such as volume encryption and volume multi-attach. For information about supported drivers, see the <a class="link" href="https://access.redhat.com/ecosystem/search/#/category/Software?sort=sortTitle%20asc&amp;softwareCategories=Storage&amp;ecosystem=Red%20Hat%20OpenStack%20Platform">Red Hat Ecosystem Catalog</a>.
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					There are several director heat parameters that control whether an NFS back end or a NetApp NFS Block Storage back end supports a NetApp feature called NAS secure:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							CinderNetappNasSecureFileOperations
						</li><li class="listitem">
							CinderNetappNasSecureFilePermissions
						</li><li class="listitem">
							CinderNasSecureFileOperations
						</li><li class="listitem">
							CinderNasSecureFilePermissions
						</li></ul></div><p>
					Red Hat does not recommend that you enable the feature, because it interferes with normal volume operations. Director disables the feature by default, and Red Hat OpenStack Platform does not support it.
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					For Block Storage and Compute services, you must use NFS version 4.1 or later.
				</p></div></div><p>
				The core heat template collection contains a set of environment files in <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/</code>. With these environment files you can create customized configuration of some of the supported features in a director-created overcloud. This includes an environment file designed to configure storage. This file is located at <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/storage-environment.yaml</code>.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Copy the file to the <code class="literal">stack</code> user’s template directory:
					</p><pre class="screen">$ cp /usr/share/openstack-tripleo-heat-templates/environments/storage-environment.yaml ~/templates/.</pre></li><li class="listitem"><p class="simpara">
						Modify the following parameters:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CinderEnableIscsiBackend</span></dt><dd>
									Enables the iSCSI backend. Set to <code class="literal">false</code>.
								</dd><dt><span class="term">CinderEnableRbdBackend</span></dt><dd>
									Enables the Ceph Storage backend. Set to <code class="literal">false</code>.
								</dd><dt><span class="term">CinderEnableNfsBackend</span></dt><dd>
									Enables the NFS backend. Set to <code class="literal">true</code>.
								</dd><dt><span class="term">NovaEnableRbdBackend</span></dt><dd>
									Enables Ceph Storage for Nova ephemeral storage. Set to <code class="literal">false</code>.
								</dd><dt><span class="term">GlanceBackend</span></dt><dd>
									Define the back end to use for glance. Set to <code class="literal">file</code> to use file-based storage for images. The overcloud saves these files in a mounted NFS share for glance.
								</dd><dt><span class="term">CinderNfsServers</span></dt><dd>
									The NFS share to mount for volume storage. For example, 192.168.122.1:/export/cinder.
								</dd><dt><span class="term">GlanceNfsEnabled</span></dt><dd>
									When <code class="literal">GlanceBackend</code> is set to <code class="literal">file</code>, <code class="literal">GlanceNfsEnabled</code> enables images to be stored through NFS in a shared location so that all Controller nodes have access to the images. If disabled, the overcloud stores images in the file system of the Controller node. Set to <code class="literal">true</code>.
								</dd><dt><span class="term">GlanceNfsShare</span></dt><dd><p class="simpara">
									The NFS share to mount for image storage. For example, 192.168.122.1:/export/glance.
								</p><p class="simpara">
									The environment file contains parameters that configure different storage options for the Red Hat OpenStack Platform Block Storage (cinder) and Image (glance) services. This example demonstrates how to configure the overcloud to use an NFS share.
								</p><p class="simpara">
									The options in the environment file should look similar to the following:
								</p><pre class="screen">parameter_defaults:
  CinderEnableIscsiBackend: false
  CinderEnableRbdBackend: false
  CinderEnableNfsBackend: true
  NovaEnableRbdBackend: false
  GlanceBackend: <span class="emphasis"><em>file</em></span>

  CinderNfsServers: <span class="emphasis"><em>192.0.2.230:/cinder</em></span>

  GlanceNfsEnabled: true
  GlanceNfsShare: <span class="emphasis"><em>192.0.2.230:/glance</em></span></pre><p class="simpara">
									These parameters are integrated as part of the heat template collection. Setting them as shown in the example code creates two NFS mount points for the Block Storage and Image services to use.
								</p></dd></dl></div></li><li class="listitem">
						Include the file when you deploy the overcloud.
					</li></ol></div></section><section class="section" id="sect-Configuring_Ceph_Storage"><div class="titlepage"><div><div><h2 class="title">19.2. Configuring Ceph Storage</h2></div></div></div><p>
				The director provides two main methods for integrating Red Hat Ceph Storage into an Overcloud.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Creating an overcloud with its own Ceph Storage cluster</span></dt><dd>
							Director has the ability to create a Ceph Storage cluster during overcloud creation. Director creates a set of Ceph Storage nodes that use the Ceph OSD to store data. In addition, director installs the Ceph Monitor service on the overcloud Controller nodes. This means if an organization creates an overcloud with three highly available Controller nodes, the Ceph Monitor also becomes a highly available service. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/deploying_an_overcloud_with_containerized_red_hat_ceph/">Deploying an Overcloud with Containerized Red Hat Ceph</a>.
						</dd><dt><span class="term">Integrating an existing Ceph Storage cluster into an Oovercloud</span></dt><dd>
							If you already have an existing Ceph Storage cluster, you can integrate this during an overcloud deployment. This means you manage and scale the cluster outside of the overcloud configuration. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/integrating_an_overcloud_with_an_existing_red_hat_ceph_cluster/">Integrating an Overcloud with an Existing Red Hat Ceph Cluster</a>.
						</dd></dl></div></section><section class="section" id="sect-Standalone_Swift_Cluster"><div class="titlepage"><div><div><h2 class="title">19.3. Using an External Object Storage Cluster</h2></div></div></div><p>
				You can reuse an external Object Storage (swift) cluster by disabling the default Object Storage service deployment on the Controller nodes. Doing so disables both the proxy and storage services for Object Storage and configures haproxy and keystone to use the given external swift endpoint.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					User accounts on the external Object Storage cluster must be managed manually.
				</p></div></div><p>
				You need the endpoint IP address of the external Object Storage cluster as well as the <code class="literal">authtoken</code> password from the external Object Storage <code class="literal filename">proxy-server.conf</code> file. You can find this information by using the <code class="literal command">openstack endpoint list</code> command.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create a new file named <code class="literal filename">swift-external-params.yaml</code> with the following content:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Replace <code class="literal">EXTERNAL.IP:PORT</code> with the IP address and port of the external proxy and
							</li><li class="listitem"><p class="simpara">
								Replace <code class="literal">AUTHTOKEN</code> with the <code class="literal">authtoken</code> password for the external proxy on the <code class="literal">SwiftPassword</code> line.
							</p><pre class="screen">parameter_defaults:
  ExternalPublicUrl: 'https://EXTERNAL.IP:PORT/v1/AUTH_%(tenant_id)s'
  ExternalInternalUrl: 'http://192.168.24.9:8080/v1/AUTH_%(tenant_id)s'
  ExternalAdminUrl: 'http://192.168.24.9:8080'
  ExternalSwiftUserTenant: 'service'
  SwiftPassword: AUTHTOKEN</pre></li></ul></div></li><li class="listitem">
						Save this file as <code class="literal filename">swift-external-params.yaml</code>.
					</li><li class="listitem"><p class="simpara">
						Deploy the overcloud using these additional environment files.
					</p><pre class="screen">openstack overcloud deploy --templates \
-e [your environment files]
-e /usr/share/openstack-tripleo-heat-templates/environments/swift-external.yaml
-e swift-external-params.yaml</pre></li></ol></div></section><section class="section" id="configuring_ceph_object_store_to_use_external_ceph_object_gateway"><div class="titlepage"><div><div><h2 class="title">19.4. Configuring Ceph Object Store to use external Ceph Object Gateway</h2></div></div></div><p>
				Red Hat OpenStack Platform (RHOSP) director supports configuring an external Ceph Object Gateway (RGW) as an Object Store service. To authenticate with the external RGW service, you must configure RGW to verify users and their roles in the Identity service (keystone).
			</p><p>
				For more information about how to configure an external Ceph Object Gateway, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/4/html-single/using_keystone_with_the_ceph_object_gateway_guide/index#configuring-the-ceph-object-getaway-to-use-keystone-authentication_rgw-keystone">Configuring the Ceph Object Gateway to use Keystone authentication</a> in the <span class="emphasis"><em>Using Keystone with the Ceph Object Gateway Guide</em></span>.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Add the following <code class="literal">parameter_defaults</code> to a custom environment file, for example, <code class="literal">swift-external-params.yaml</code>, and adjust the values to suit your deployment:
					</p><pre class="screen">parameter_defaults:
   ExternalSwiftPublicUrl: 'http://&lt;Public RGW endpoint or loadbalancer&gt;:8080/swift/v1/AUTH_%(project_id)s'
   ExternalSwiftInternalUrl: 'http://&lt;Internal RGW endpoint&gt;:8080/swift/v1/AUTH_%(project_id)s'
   ExternalSwiftAdminUrl: 'http://&lt;Admin RGW endpoint&gt;:8080/swift/v1/AUTH_%(project_id)s'
   ExternalSwiftUserTenant: 'service'
   SwiftPassword: 'choose_a_random_password'</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The example code snippet contains parameter values that might differ from values that you use in your environment:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The default port where the remote RGW instance listens is <code class="literal">8080</code>. The port might be different depending on how the external RGW is configured.
								</li><li class="listitem">
									The <code class="literal">swift</code> user created in the overcloud uses the password defined by the <code class="literal">SwiftPassword</code> parameter. You must configure the external RGW instance to use the same password to authenticate with the Identity service by using the <code class="literal">rgw_keystone_admin_password</code>.
								</li></ul></div></div></div></li><li class="listitem"><p class="simpara">
						Add the following code to the Ceph config file to configure RGW to use the Identity service. Adjust the variable values to suit your environment.
					</p><pre class="screen">    rgw_keystone_api_version: 3
    rgw_keystone_url: http://&lt;public Keystone endpoint&gt;:5000/
    rgw_keystone_accepted_roles: 'member, Member, admin'
    rgw_keystone_accepted_admin_roles: ResellerAdmin, swiftoperator
    rgw_keystone_admin_domain: default
    rgw_keystone_admin_project: service
    rgw_keystone_admin_user: swift
    rgw_keystone_admin_password: &lt;Password as defined in the environment parameters&gt;
    rgw_keystone_implicit_tenants: 'true'
    rgw_keystone_revocation_interval: '0'
    rgw_s3_auth_use_keystone: 'true'
    rgw_swift_versioning_enabled: 'true'
    rgw_swift_account_in_url: 'true'</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Director creates the following roles and users in the Identity service by default:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									rgw_keystone_accepted_admin_roles: ResellerAdmin, swiftoperator
								</li><li class="listitem">
									rgw_keystone_admin_domain: default
								</li><li class="listitem">
									rgw_keystone_admin_project: service
								</li><li class="listitem">
									rgw_keystone_admin_user: swift
								</li></ul></div></div></div></li><li class="listitem"><p class="simpara">
						Deploy the overcloud with the additional environment files:
					</p><pre class="screen">openstack overcloud deploy --templates \
-e &lt;your environment files&gt;
-e /usr/share/openstack-tripleo-heat-templates/environments/swift-external.yaml
-e swift-external-params.yaml</pre></li></ol></div></section><section class="section" id="sect-configure-image-import"><div class="titlepage"><div><div><h2 class="title">19.5. Configuring the Image Import Method and Shared Staging Area</h2></div></div></div><p>
				The default settings for the OpenStack Image service (glance) are determined by the Heat templates used when OpenStack is installed. The Image service Heat template is <code class="literal filename">deployment/glance/glance-api-container-puppet.yaml</code>.
			</p><p>
				The interoperable image import allows two methods for image import:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						web-download
					</li><li class="listitem">
						glance-direct
					</li></ul></div><p>
				The <code class="literal command">web-download</code> method lets you import an image from a URL; the <code class="literal command">glance-direct</code> method lets you import an image from a local volume.
			</p><section class="section" id="sect-create-glance-settings"><div class="titlepage"><div><div><h3 class="title">19.5.1. Creating and Deploying the <code class="literal command">glance-settings.yaml</code> File</h3></div></div></div><p>
					You use an environment file to configure the import parameters. These parameters override the default values established in the Heat template. The example environment content provides parameters for the interoperable image import.
				</p><pre class="screen">parameter_defaults:
  # Configure NFS backend
  GlanceBackend: file
  GlanceNfsEnabled: true
  GlanceNfsShare: 192.168.122.1:/export/glance

  # Enable glance-direct import method
  GlanceEnabledImportMethods: glance-direct,web-download

  # Configure NFS staging area (required for glance-direct import method)
  GlanceStagingNfsShare: 192.168.122.1:/export/glance-staging</pre><p>
					The <code class="literal">GlanceBackend</code>, <code class="literal">GlanceNfsEnabled</code>, and <code class="literal">GlanceNfsShare</code> parameters are defined in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/storage_configuration">Storage Configuration</a> section in the <span class="emphasis"><em>Advanced Overcloud Customization Guide</em></span>.
				</p><p>
					Two new parameters for interoperable image import define the import method and a shared NFS staging area.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">GlanceEnabledImportMethods</span></dt><dd>
								Defines the available import methods, web-download (default) and glance-direct. This line is only necessary if you wish to enable additional methods besides web-download.
							</dd><dt><span class="term">GlanceStagingNfsShare</span></dt><dd>
								Configures the NFS staging area used by the glance-direct import method. This space can be shared amongst nodes in a high-availability cluster setup. Requires GlanceNfsEnabled be set to true.
							</dd></dl></div><p>
					To configure the settings:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Create a new file called, for example, glance-settings.yaml. The contents of this file should be similar to the example above.
						</li><li class="listitem"><p class="simpara">
							Add the file to your OpenStack environment using the <code class="literal command">openstack overcloud deploy</code> command:
						</p><pre class="screen">$ openstack overcloud deploy --templates -e glance-settings.yaml</pre></li></ol></div><p>
					For additional information about using environment files, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/sect-understanding_heat_templates#sect-Including_Environment_Files_in_Overcloud_Creation">Including Environment Files in Overcloud Creation</a> section in the <span class="emphasis"><em>Advanced Overcloud Customization Guide</em></span>.
				</p></section><section class="section" id="sect-glance-import-white-black-list-settings"><div class="titlepage"><div><div><h3 class="title">19.5.2. Controlling Image Web-Import Sources</h3></div></div></div><p>
					You can limit the sources of Web-import image downloads by adding URI blacklists and whitelists to the optional <code class="literal command">glance-image-import.conf</code> file.
				</p><p>
					You can whitelist or blacklist image source URIs at three levels:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							scheme (allowed_schemes, disallowed_schemes)
						</li><li class="listitem">
							host (allowed_hosts, disallowed_hosts)
						</li><li class="listitem">
							port (allowed_ports, disallowed_ports)
						</li></ul></div><p>
					If you specify both at any level, the whitelist is honored and the blacklist is ignored.
				</p><p>
					The Image service applies the following decision logic to validate image source URIs:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							The scheme is checked.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Missing scheme: reject
								</li><li class="listitem">
									If there’s a whitelist, and the scheme is not in it: reject. Otherwise, skip C and continue on to 2.
								</li><li class="listitem">
									If there’s a blacklist, and the scheme is in it: reject.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							The host name is checked.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Missing host name: reject
								</li><li class="listitem">
									If there’s a whitelist, and the host name is not in it: reject. Otherwise, skip C and continue on to 3.
								</li><li class="listitem">
									If there’s a blacklist, and the host name is in it: reject.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							If there’s a port in the URI, the port is checked.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									If there’s a whitelist, and the port is not in it: reject. Otherwise, skip B and continue on to 4.
								</li><li class="listitem">
									If there’s a black list, and the port is in it: reject.
								</li></ol></div></li><li class="listitem">
							The URI is accepted as valid.
						</li></ol></div><p>
					Note that if you allow a scheme, either by whitelisting it or by not blacklisting it, any URI that uses the default port for that scheme by not including a port in the URI is allowed. If it does include a port in the URI, the URI is validated according to the above rules.
				</p><section class="section" id="example"><div class="titlepage"><div><div><h4 class="title">19.5.2.1. Example</h4></div></div></div><p>
						For instance, the default port for FTP is 21. Because <span class="emphasis"><em>ftp</em></span> is a whitelisted scheme, this URL is allowed: <a class="link" href="ftp://example.org/some/resource">ftp://example.org/some/resource</a> But because 21 is not in the port whitelist, this URL to the same resource is rejected: <a class="link" href="ftp://example.org:21/some/resource">ftp://example.org:21/some/resource</a>
					</p><pre class="screen">allowed_schemes = [http,https,ftp]
disallowed_schemes = []
allowed_hosts = []
disallowed_hosts = []
allowed_ports = [80,443]
disallowed_ports = []</pre><p>
						[Including Environment Files in Overcloud Creation] section in the <span class="emphasis"><em>Advanced Overcloud Customization Guide</em></span>.
					</p></section><section class="section" id="default_image_import_blacklist_and_whitelist_settings"><div class="titlepage"><div><div><h4 class="title">19.5.2.2. Default Image Import Blacklist and Whitelist Settings</h4></div></div></div><p>
						The glance-image-import.conf file is an optional file. Here are the default settings for these options:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								allowed_schemes - [<span class="emphasis"><em>http</em></span>, <span class="emphasis"><em>https</em></span>]
							</li><li class="listitem">
								disallowed_schemes - empty list
							</li><li class="listitem">
								allowed_hosts - empty list
							</li><li class="listitem">
								disallowed_hosts - empty list
							</li><li class="listitem">
								allowed_ports - [80, 443]
							</li><li class="listitem">
								disallowed_ports - empty list
							</li></ul></div><p>
						Thus if you use the defaults, end users will only be able to access URIs using the <span class="emphasis"><em>http</em></span> or <span class="emphasis"><em>https</em></span> scheme. The only ports users will be able to specify are 80 and 443. (Users do not have to specify a port, but if they do, it must be either 80 or 443.)
					</p><p>
						You can find the <code class="literal command">glance-image-import.conf</code> file in the etc/ subdirectory of the Image service source code tree. Make sure that you are looking in the correct branch for the OpenStack release you are working with.
					</p></section></section><section class="section" id="sect-glance-import-inject-metadata"><div class="titlepage"><div><div><h3 class="title">19.5.3. Injecting Metadata on Image Import to Control Where VMs Launch</h3></div></div></div><p>
					End users can add images in the Image service and use these images to launch VMs. These user-provided (non-admin) images should be launched on a specific set of compute nodes. The assignment of an instance to a compute node is controlled by image metadata properties.
				</p><p>
					The Image Property Injection plugin injects metadata properties to images on import. Specify the properties by editing the [image_import_opts] and [inject_metadata_properties] sections of the <code class="literal command">glance-image-import.conf</code> file.
				</p><p>
					To enable the Image Property Injection plugin, add this line to the [image_import_opts] section:
				</p><pre class="screen">[image_import_opts]
image_import_plugins = [inject_image_metadata]</pre><p>
					To limit the metadata injection to images provided by a certain set of users, set the ignore_user_roles parameter. For instance, the following configuration injects one value for property1 and two values for property2 into images downloaded by by any non-admin user.
				</p><pre class="screen">[DEFAULT]
[image_conversion]
[image_import_opts]
image_import_plugins = [inject_image_metadata]
[import_filtering_opts]
[inject_metadata_properties]
ignore_user_roles = admin
inject = PROPERTY1:value,PROPERTY2:value;another value</pre><p>
					The parameter <code class="literal command">ignore_user_roles</code> is a comma-separated list of Keystone roles that the plugin will ignore. In other words, if the user making the image import call has any of these roles, the plugin will not inject any properties into the image.
				</p><p>
					The parameter <code class="literal command">inject</code> is a comma-separated list of properties and values that will be injected into the image record for the imported image. Each property and value should be quoted and separated by a colon (‘:’) as shown in the example above.
				</p><p>
					You can find the <code class="literal command">glance-image-import.conf</code> file in the etc/ subdirectory of the Image service source code tree. Make sure that you are looking in the correct branch for the OpenStack release you are working with.
				</p></section></section><section class="section" id="sect-cinder-backend-glance"><div class="titlepage"><div><div><h2 class="title">19.6. Configuring cinder back end for the Image service</h2></div></div></div><p>
				The <code class="literal">GlanceBackend</code> parameter sets the back end that the Image service uses to store images.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					The default maximum number of volumes you can create for a project is 10.
				</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						To configure <code class="literal">cinder</code> as the Image service back end, add the following to the environment file:
					</p><pre class="screen">parameter_defaults:
  GlanceBackend: cinder</pre></li><li class="listitem">
						If the <code class="literal">cinder</code> back end is enabled, the following parameters and values are set by default:
					</li></ol></div><pre class="screen">cinder_store_auth_address = http://172.17.1.19:5000/v3
cinder_store_project_name = service
cinder_store_user_name = glance
cinder_store_password = ****secret****</pre><p>
				To use a custom user name, or any custom value for the <code class="literal">cinder_store_</code> parameters, add the <code class="literal">ExtraConfig</code> settings to <code class="literal">parameter_defaults</code> and pass the custom values:
			</p><pre class="screen">ExtraConfig:
    glance::config::api_config:
      glance_store/cinder_store_auth_address:
        value: "%{hiera('glance::api::authtoken::auth_url')}/v3"
      glance_store/cinder_store_user_name:
        value: &lt;user-name&gt;
      glance_store/cinder_store_password:
        value: "%{hiera('glance::api::authtoken::password')}"
      glance_store/cinder_store_project_name:
        value: "%{hiera('glance::api::authtoken::project_name')}"</pre></section><section class="section" id="sect-Config_max_disk_devices_to_attach"><div class="titlepage"><div><div><h2 class="title">19.7. Configuring the maximum number of storage devices to attach to one instance</h2></div></div></div><p>
				By default, you can attach an unlimited number of storage devices to a single instance. To limit the maximum number of devices, add the <code class="literal">max_disk_devices_to_attach</code> parameter to your Compute environment file. The following example shows how to change the value of <code class="literal">max_disk_devices_to_attach</code> to "30":
			</p><pre class="screen">parameter_defaults:
   ComputeExtraConfig:
          nova::config::nova_config:
            compute/max_disk_devices_to_attach:
                value: '30'</pre><div class="itemizedlist"><p class="title"><strong>Guidelines and considerations</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The number of storage disks supported by an instance depends on the bus that the disk uses. For example, the IDE disk bus is limited to 4 attached devices.
					</li><li class="listitem">
						Changing the <code class="literal">max_disk_devices_to_attach</code> on a Compute node with active instances can cause rebuilds to fail if the maximum number is lower than the number of devices already attached to instances. For example, if instance <span class="strong strong"><strong>A</strong></span> has 26 devices attached and you change <code class="literal">max_disk_devices_to_attach</code> to 20, a request to rebuild instance <span class="strong strong"><strong>A</strong></span> will fail.
					</li><li class="listitem">
						During cold migration, the configured maximum number of storage devices is only enforced on the source for the instance that you want to migrate. The destination is not checked before the move. This means that if Compute node A has 26 attached disk devices, and Compute node B has a configured maximum of 20 attached disk devices, a cold migration of an instance with 26 attached devices from Compute node A to Compute node B succeeds. However, a subsequent request to rebuild the instance in Compute node B fails because 26 devices are already attached which exceeds the configured maximum of 20.
					</li><li class="listitem">
						The configured maximum is not enforced on shelved offloaded instances, as they have no Compute node.
					</li><li class="listitem">
						Attaching a large number of disk devices to instances can degrade performance on the instance. You should tune the maximum number based on the boundaries of what your environment can support.
					</li><li class="listitem">
						Instances with machine type Q35 can attach a maximum of 500 disk devices.
					</li></ul></div></section><section class="section" id="section-image-service-caching"><div class="titlepage"><div><div><h2 class="title">19.8. Improving scalability with Image service caching</h2></div></div></div><p>
				Use the glance-api caching mechanism to store copies of images on your local machine and retrieve them automatically to improve scalability. With Image service caching, the glance-api can run on multiple hosts. This means that it does not need to retrieve the same image from back-end storage multiple times. Image service caching does not affect any Image service operations.
			</p><p>
				To configure Image service caching with the Red Hat OpenStack Platform director (tripleo) heat templates, complete the following steps:
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In an environment file, set the value of the <code class="literal">GlanceCacheEnabled</code> parameter to <code class="literal">true</code>, which automatically sets the <code class="literal">flavor</code> value to <code class="literal">keystone+cachemanagement</code> in the <code class="literal">glance-api.conf</code> heat template:
					</p><pre class="screen">parameter_defaults:
    GlanceCacheEnabled: true</pre></li><li class="listitem">
						Include the environment file in the <code class="literal">openstack overcloud deploy</code> command when you redeploy the overcloud.
					</li><li class="listitem"><p class="simpara">
						Optional: Tune the <code class="literal">glance_cache_pruner</code> to an alternative frequency when you redeploy the overcloud. The following example shows a frequency of 5 minutes:
					</p><pre class="screen">parameter_defaults:
  ControllerExtraConfig:
    glance::cache::pruner::minute: '*/5'</pre><p class="simpara">
						Adjust the frequency according to your needs to avoid file system full scenarios. Include the following elements when you choose an alternative frequency:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The size of the files that you want to cache in your environment.
							</li><li class="listitem">
								The amount of available file system space.
							</li><li class="listitem">
								The frequency at which the environment caches images.
							</li></ul></div></li></ol></div></section><section class="section" id="sect-Configuring_Third_Party_Storage"><div class="titlepage"><div><div><h2 class="title">19.9. Configuring Third Party Storage</h2></div></div></div><p>
				The director include a couple of environment files to help configure third-party storage providers. This includes:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Dell EMC Storage Center</span></dt><dd><p class="simpara">
							Deploys a single Dell EMC Storage Center back end for the Block Storage (cinder) service.
						</p><p class="simpara">
							The environment file is located at <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/cinder-dellsc-config.yaml</code>.
						</p><p class="simpara">
							See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/dell_storage_center_back_end_guide">Dell Storage Center Back End Guide</a> for full configuration information.
						</p></dd><dt><span class="term">Dell EMC PS Series</span></dt><dd><p class="simpara">
							Deploys a single Dell EMC PS Series back end for the Block Storage (cinder) service.
						</p><p class="simpara">
							The environment file is located at <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/cinder-dellps-config.yaml</code>.
						</p><p class="simpara">
							See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/dell_emc_ps_series_back_end_guide">Dell EMC PS Series Back End Guide</a> for full configuration information.
						</p></dd><dt><span class="term">NetApp Block Storage</span></dt><dd><p class="simpara">
							Deploys a NetApp storage appliance as a back end for the Block Storage (cinder) service.
						</p><p class="simpara">
							The environment file is located at <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/cinder-netapp-config.yaml</code>.
						</p><p class="simpara">
							See the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/netapp_block_storage_back_end_guide">NetApp Block Storage Back End Guide</a> for full configuration information.
						</p></dd></dl></div></section></section><section class="chapter" id="sect-Security_Enhancements"><div class="titlepage"><div><div><h1 class="title">Chapter 20. Security Enhancements</h1></div></div></div><p>
			The following sections provide some suggestions to harden the security of your overcloud.
		</p><section class="section" id="managing_the_overcloud_firewall"><div class="titlepage"><div><div><h2 class="title">20.1. Managing the Overcloud Firewall</h2></div></div></div><p>
				Each of the core OpenStack Platform services contains firewall rules in their respective composable service templates. This automatically creates a default set of firewall rules for each overcloud node.
			</p><p>
				The overcloud Heat templates contain a set of parameters to help with additional firewall management:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ManageFirewall</span></dt><dd>
							Defines whether to automatically manage the firewall rules. Set to <code class="literal">true</code> to allow Puppet to automatically configure the firewall on each node. Set to <code class="literal">false</code> if you want to manually manage the firewall. The default is <code class="literal">true</code>.
						</dd><dt><span class="term">PurgeFirewallRules</span></dt><dd>
							Defines whether to purge the default Linux firewall rules before configuring new ones. The default is <code class="literal">false</code>.
						</dd></dl></div><p>
				If <code class="literal">ManageFirewall</code> is set to <code class="literal">true</code>, you can create additional firewall rules on deployment. Set the <code class="literal">tripleo::firewall::firewall_rules</code> hieradata using a configuration hook (see <a class="xref" href="index.html#sect-Customizing_Puppet_Configuration_Data" title="4.5. Puppet: Customizing Hieradata for Roles">Section 4.5, “Puppet: Customizing Hieradata for Roles”</a>) in an environment file for your overcloud. This hieradata is a hash containing the firewall rule names and their respective parameters as keys, all of which are optional:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">port</span></dt><dd>
							The port associated to the rule.
						</dd><dt><span class="term">dport</span></dt><dd>
							The destination port associated to the rule.
						</dd><dt><span class="term">sport</span></dt><dd>
							The source port associated to the rule.
						</dd><dt><span class="term">proto</span></dt><dd>
							The protocol associated to the rule. Defaults to <code class="literal">tcp</code>.
						</dd><dt><span class="term">action</span></dt><dd>
							The action policy associated to the rule. Defaults to <code class="literal">accept</code>.
						</dd><dt><span class="term">jump</span></dt><dd>
							The chain to jump to. If present, it overrides <code class="literal">action</code>.
						</dd><dt><span class="term">state</span></dt><dd>
							An Array of states associated to the rule. Defaults to <code class="literal">['NEW']</code>.
						</dd><dt><span class="term">source</span></dt><dd>
							The source IP address associated to the rule.
						</dd><dt><span class="term">iniface</span></dt><dd>
							The network interface associated to the rule.
						</dd><dt><span class="term">chain</span></dt><dd>
							The chain associated to the rule. Defaults to <code class="literal">INPUT</code>.
						</dd><dt><span class="term">destination</span></dt><dd>
							The destination CIDR associated to the rule.
						</dd></dl></div><p>
				The following example demonstrates the syntax of the firewall rule format:
			</p><pre class="screen">ExtraConfig:
  tripleo::firewall::firewall_rules:
    '300 allow custom application 1':
      port: 999
      proto: udp
      action: accept
    '301 allow custom application 2':
      port: 8081
      proto: tcp
      action: accept</pre><p>
				This applies two additional firewall rules to all nodes through <code class="literal">ExtraConfig</code>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Each rule name becomes the comment for the respective <code class="literal">iptables</code> rule. Note also each rule name starts with a three-digit prefix to help Puppet order all defined rules in the final <code class="literal">iptables</code> file. The default OpenStack Platform rules use prefixes in the 000 to 200 range.
				</p></div></div></section><section class="section" id="changing_the_simple_network_management_protocol_snmp_strings"><div class="titlepage"><div><div><h2 class="title">20.2. Changing the Simple Network Management Protocol (SNMP) Strings</h2></div></div></div><p>
				The director provides a default read-only SNMP configuration for your overcloud. It is advisable to change the SNMP strings to mitigate the risk of unauthorized users learning about your network devices.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					When you configure the <code class="literal">ExtraConfig</code> interface with a string parameter, you must use the following syntax to ensure that Heat and Hiera do not interpret the string as a boolean value: <code class="literal">'"&lt;VALUE&gt;"'</code>.
				</p></div></div><p>
				Set the following hieradata using the <code class="literal">ExtraConfig</code> hook in an environment file for your overcloud:
			</p><p>
				<span class="strong strong"><strong>SNMP traditional access control settings</strong></span>
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">snmp::ro_community</span></dt><dd>
							IPv4 read-only SNMP community string. The default value is <code class="literal">public</code>.
						</dd><dt><span class="term">snmp::ro_community6</span></dt><dd>
							IPv6 read-only SNMP community string. The default value is <code class="literal">public</code>.
						</dd><dt><span class="term">snmp::ro_network</span></dt><dd>
							Network that is allowed to <code class="literal">RO query</code> the daemon. This value can be a string or an array. Default value is <code class="literal">127.0.0.1</code>.
						</dd><dt><span class="term">snmp::ro_network6</span></dt><dd>
							Network that is allowed to <code class="literal">RO query</code> the daemon with IPv6. This value can be a string or an array. The default value is <code class="literal">::1/128</code>.
						</dd><dt><span class="term">tripleo::profile::base::snmp::snmpd_config</span></dt><dd>
							Array of lines to add to the <span class="strong strong"><strong><span class="emphasis"><em>snmpd.conf</em></span></strong></span> file as a safety valve. The default value is <code class="literal">[]</code>. See the <a class="link" href="http://www.net-snmp.org/docs/man/snmpd.conf.html">SNMP Configuration File</a> web page for all available options.
						</dd></dl></div><p>
				For example:
			</p><pre class="screen">parameter_defaults:
  ExtraConfig:
    snmp::ro_community: mysecurestring
    snmp::ro_community6: myv6securestring</pre><p>
				This changes the read-only SNMP community string on all nodes.
			</p><p>
				<span class="strong strong"><strong>SNMP view-based access control settings (VACM)</strong></span>
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">snmp::com2sec</span></dt><dd>
							IPv4 security name.
						</dd><dt><span class="term">snmp::com2sec6</span></dt><dd>
							IPv6 security name.
						</dd></dl></div><p>
				For example:
			</p><pre class="screen">parameter_defaults:
  ExtraConfig:
    snmp::com2sec: mysecurestring
    snmp::com2sec6: myv6securestring</pre><p>
				This changes the read-only SNMP community string on all nodes.
			</p><p>
				For more information, see the <code class="literal">snmpd.conf</code> man page.
			</p></section><section class="section" id="changing_the_ssl_tls_cipher_and_rules_for_haproxy"><div class="titlepage"><div><div><h2 class="title">20.3. Changing the SSL/TLS Cipher and Rules for HAProxy</h2></div></div></div><p>
				If you enabled SSL/TLS in the overcloud (see <a class="xref" href="index.html#sect-Enabling_SSLTLS_on_the_Overcloud" title="Chapter 14. Enabling SSL/TLS on Overcloud Public Endpoints">Chapter 14, <em>Enabling SSL/TLS on Overcloud Public Endpoints</em></a>), you might want to harden the SSL/TLS ciphers and rules used with the HAProxy configuration. This helps avoid SSL/TLS vulnerabilities, such as the <a class="link" href="https://access.redhat.com/solutions/1291123">POODLE vulnerability</a>.
			</p><p>
				Set the following hieradata using the <code class="literal">ExtraConfig</code> hook in an environment file for your overcloud:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">tripleo::haproxy::ssl_cipher_suite</span></dt><dd>
							The cipher suite to use in HAProxy.
						</dd><dt><span class="term">tripleo::haproxy::ssl_options</span></dt><dd>
							The SSL/TLS rules to use in HAProxy.
						</dd></dl></div><p>
				For example, you might aim to use the following cipher and rules:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Cipher: <code class="literal">ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS</code>
					</li><li class="listitem">
						Rules: <code class="literal">no-sslv3 no-tls-tickets</code>
					</li></ul></div><p>
				Create an environment file with the following content:
			</p><pre class="screen">parameter_defaults:
  ExtraConfig:
    tripleo::haproxy::ssl_cipher_suite: ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS
    tripleo::haproxy::ssl_options: no-sslv3 no-tls-tickets</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The cipher collection is one continuous line.
				</p></div></div><p>
				Include this environment file with your overcloud creation.
			</p></section><section class="section" id="sect_OVS_Firewall"><div class="titlepage"><div><div><h2 class="title">20.4. Using the Open vSwitch Firewall</h2></div></div></div><p>
				You can configure security groups to use the Open vSwitch (OVS) firewall driver in Red Hat OpenStack Platform director. The <code class="literal">NeutronOVSFirewallDriver</code> parameter allows you to specify which firewall driver to use:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">iptables_hybrid</code> - Configures neutron to use the iptables/hybrid based implementation.
					</li><li class="listitem">
						<code class="literal">openvswitch</code> - Configures neutron to use the OVS firewall flow-based driver.
					</li></ul></div><p>
				The <code class="literal">openvswitch</code> firewall driver includes higher performance and reduces the number of interfaces and bridges used to connect guests to the project network.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The <code class="literal">iptables_hybrid</code> option is not compatible with OVS-DPDK.
				</p></div></div><p>
				Configure the <code class="literal">NeutronOVSFirewallDriver</code> parameter in the <code class="literal">network-environment.yaml</code> file:
			</p><pre class="programlisting language-yaml">NeutronOVSFirewallDriver: openvswitch</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">NeutronOVSFirewallDriver</code> : Configures the name of the firewall driver to use when implementing security groups. Possible values depend on your system configuration. Examples include: <code class="literal">noop</code>, <code class="literal">openvswitch</code>, <code class="literal">iptables_hybrid</code>. The default value, an empty string, equates to <code class="literal">iptables_hybrid</code>.
					</li></ul></div></section><section class="section" id="enabling_root_user_access"><div class="titlepage"><div><div><h2 class="title">20.5. Using Secure Root User Access</h2></div></div></div><p>
				The overcloud image automatically contains hardened security for the <code class="literal">root</code> user. For example, each deployed overcloud node automatically disables direct SSH access to the <code class="literal">root</code> user. You can still access the <code class="literal">root</code> user on overcloud nodes through the following method:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Log into the undercloud node’s <code class="literal">stack</code> user.
					</li><li class="listitem">
						Each overcloud node has a <code class="literal">heat-admin</code> user account. This user account contains the undercloud’s public SSH key, which provides SSH access without a password from the undercloud to the overcloud node. On the undercloud node, log into the chosen overcloud node through SSH using the <code class="literal">heat-admin</code> user.
					</li><li class="listitem">
						Switch to the <code class="literal">root</code> user with <code class="literal">sudo -i</code>.
					</li></ol></div><div class="formalpara"><p class="title"><strong>Reducing Root User Security</strong></p><p>
					Some situations might require direct SSH access to the <code class="literal">root</code> user. In this case, you can reduce the SSH restrictions on the <code class="literal">root</code> user for each overcloud node.
				</p></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					This method is intended for debugging purposes only. It is not recommended for use in a production environment.
				</p></div></div><p>
				The method uses the first boot configuration hook (see <a class="xref" href="index.html#sect-Customizing_Configuration_on_First_Boot" title="4.1. First Boot: Customizing First Boot Configuration">Section 4.1, “First Boot: Customizing First Boot Configuration”</a>). Place the following content in an environment file:
			</p><pre class="screen">resource_registry:
  OS::TripleO::NodeUserData: /usr/share/openstack-tripleo-heat-templates/firstboot/userdata_root_password.yaml

parameter_defaults:
  NodeRootPassword: "p@55w0rd!"</pre><p>
				Note the following:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">OS::TripleO::NodeUserData</code> resource refers to the a template that configures the <code class="literal">root</code> user during the first boot <code class="literal">cloud-init</code> stage.
					</li><li class="listitem">
						The <code class="literal">NodeRootPassword</code> parameter sets the password for the <code class="literal">root</code> user. Change the value of this parameter to your desired password. Note the environment file contains the password as a plain text string, which is considered a security risk.
					</li></ul></div><p>
				Include this environment file with the <code class="literal">openstack overcloud deploy</code> command when creating your overcloud.
			</p></section></section><section class="chapter" id="sect-Monitoring_Tools_Configuration"><div class="titlepage"><div><div><h1 class="title">Chapter 21. Configuring Monitoring Tools</h1></div></div></div><p>
			Monitoring tools are an optional suite of tools that can be used for availability monitoring and centralized logging. The availability monitoring allows you to monitor the functionality of all components, while the centralized logging allows you to view all of the logs across your OpenStack environment in one central place.
		</p><p>
			For more information about configuring monitoring tools, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/monitoring_tools_configuration_guide"><span class="emphasis"><em>Monitoring Tools Configuration Guide</em></span></a>.
		</p></section><section class="chapter" id="sect-Network_Plugins"><div class="titlepage"><div><div><h1 class="title">Chapter 22. Configuring Network Plugins</h1></div></div></div><p>
			The director includes environment files to help configure third-party network plugins:
		</p><section class="section" id="fujitsu_converged_fabric_c_fabric"><div class="titlepage"><div><div><h2 class="title">22.1. Fujitsu Converged Fabric (C-Fabric)</h2></div></div></div><p>
				You can enable the Fujitsu Converged Fabric (C-Fabric) plugin using the environment file located at <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/neutron-ml2-fujitsu-cfab.yaml</code>.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Copy the environment file to your <code class="literal">templates</code> subdirectory:
					</p><pre class="screen">$ cp /usr/share/openstack-tripleo-heat-templates/environments/neutron-ml2-fujitsu-cfab.yaml /home/stack/templates/</pre></li><li class="listitem"><p class="simpara">
						Edit the <code class="literal">resource_registry</code> to use an absolute path:
					</p><pre class="screen">resource_registry:
  OS::TripleO::Services::NeutronML2FujitsuCfab: /usr/share/openstack-tripleo-heat-templates/puppet/services/neutron-plugin-ml2-fujitsu-cfab.yaml</pre></li><li class="listitem"><p class="simpara">
						Review the <code class="literal">parameter_defaults</code> in <code class="literal">/home/stack/templates/neutron-ml2-fujitsu-cfab.yaml</code>:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">NeutronFujitsuCfabAddress</code> - The telnet IP address of the C-Fabric. (string)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuCfabUserName</code> - The C-Fabric username to use. (string)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuCfabPassword</code> - The password of the C-Fabric user account. (string)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuCfabPhysicalNetworks</code> - List of <code class="literal">&lt;physical_network&gt;:&lt;vfab_id&gt;</code> tuples that specify <code class="literal">physical_network</code> names and their corresponding vfab IDs. (comma_delimited_list)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuCfabSharePprofile</code> - Determines whether to share a C-Fabric pprofile among neutron ports that use the same VLAN ID. (boolean)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuCfabPprofilePrefix</code> - The prefix string for pprofile name. (string)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuCfabSaveConfig</code> - Determines whether to save the configuration. (boolean)
							</li></ul></div></li><li class="listitem"><p class="simpara">
						To apply the template to your deployment, include the environment file in the <code class="literal">openstack overcloud deploy</code> command. For example:
					</p><pre class="screen">$ openstack overcloud deploy --templates -e /home/stack/templates/neutron-ml2-fujitsu-cfab.yaml [OTHER OPTIONS] ...</pre></li></ol></div></section><section class="section" id="fujitsu_fos_switch"><div class="titlepage"><div><div><h2 class="title">22.2. Fujitsu FOS Switch</h2></div></div></div><p>
				You can enable the Fujitsu FOS Switch plugin using the environment file located at <code class="literal">/usr/share/openstack-tripleo-heat-templates/environments/neutron-ml2-fujitsu-fossw.yaml</code>.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Copy the environment file to your <code class="literal">templates</code> subdirectory:
					</p><pre class="screen">$ cp /usr/share/openstack-tripleo-heat-templates/environments/neutron-ml2-fujitsu-fossw.yaml /home/stack/templates/</pre></li><li class="listitem"><p class="simpara">
						Edit the <code class="literal">resource_registry</code> to use an absolute path:
					</p><pre class="screen">resource_registry:
  OS::TripleO::Services::NeutronML2FujitsuFossw: /usr/share/openstack-tripleo-heat-templates/puppet/services/neutron-plugin-ml2-fujitsu-fossw.yaml</pre></li><li class="listitem"><p class="simpara">
						Review the <code class="literal">parameter_defaults</code> in <code class="literal">/home/stack/templates/neutron-ml2-fujitsu-fossw.yaml</code>:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">NeutronFujitsuFosswIps</code> - The IP addresses of all FOS switches. (comma_delimited_list)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuFosswUserName</code> - The FOS username to use. (string)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuFosswPassword</code> - The password of the FOS user account. (string)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuFosswPort</code> - The port number to use for the SSH connection. (number)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuFosswTimeout</code> - The timeout period of the SSH connection. (number)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuFosswUdpDestPort</code> - The port number of the VXLAN UDP destination on the FOS switches. (number)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuFosswOvsdbVlanidRangeMin</code> - The minimum VLAN ID in the range that is used for binding VNI and physical port. (number)
							</li><li class="listitem">
								<code class="literal">NeutronFujitsuFosswOvsdbPort</code> - The port number for the OVSDB server on the FOS switches. (number)
							</li></ul></div></li><li class="listitem"><p class="simpara">
						To apply the template to your deployment, include the environment file in the <code class="literal">openstack overcloud deploy</code> command. For example:
					</p><pre class="screen">$ openstack overcloud deploy --templates -e /home/stack/templates/neutron-ml2-fujitsu-fossw.yaml [OTHER OPTIONS] ...</pre></li></ol></div></section></section><section class="chapter" id="sect-Identity_Configuration"><div class="titlepage"><div><div><h1 class="title">Chapter 23. Configuring Identity</h1></div></div></div><p>
			The director includes parameters to help configure Identity Service (keystone) settings:
		</p><section class="section" id="region_name"><div class="titlepage"><div><div><h2 class="title">23.1. Region Name</h2></div></div></div><p>
				By default, your overcloud’s region will be named <code class="literal">regionOne</code>. You can change this by adding a <code class="literal">KeystoneRegion</code> entry your environment file. This setting cannot be changed post-deployment:
			</p><pre class="screen">parameter_defaults:
  KeystoneRegion: 'SampleRegion'</pre></section></section><section class="chapter" id="other_configurations"><div class="titlepage"><div><div><h1 class="title">Chapter 24. Other Configurations</h1></div></div></div><section class="section" id="configuring-the-kernel-on-overcloud-nodes"><div class="titlepage"><div><div><h2 class="title">24.1. Configuring the kernel on overcloud nodes</h2></div></div></div><p>
				OpenStack Platform director includes parameters that configure the kernel on overcloud nodes.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ExtraKernelModules</span></dt><dd><p class="simpara">
							Kernel modules to load. The modules names are listed as a hash key with an empty value:
						</p><pre class="screen">  ExtraKernelModules:
    &lt;MODULE_NAME&gt;: {}</pre></dd><dt><span class="term">ExtraKernelPackages</span></dt><dd><p class="simpara">
							Kernel-related packages to install prior to loading the kernel modules from <code class="literal">ExtraKernelModules</code>. The package names are listed as a hash key with an empty value.
						</p><pre class="screen">  ExtraKernelPackages:
    &lt;PACKAGE_NAME&gt;: {}</pre></dd><dt><span class="term">ExtraSysctlSettings</span></dt><dd><p class="simpara">
							Hash of sysctl settings to apply. Set the value of each parameter using the <code class="literal">value</code> key.
						</p><pre class="screen">  ExtraSysctlSettings:
    &lt;KERNEL_PARAMETER&gt;:
      value: &lt;VALUE&gt;</pre></dd></dl></div><p>
				This example shows the syntax of these parameters in an environment file:
			</p><pre class="screen">parameter_defaults:
  ExtraKernelModules:
    iscsi_target_mod: {}
  ExtraKernelPackages:
    iscsi-initiator-utils: {}
  ExtraSysctlSettings:
    dev.scsi.logging_level:
      value: 1</pre></section><section class="section" id="sect-Configuring_External_Load_Balancing"><div class="titlepage"><div><div><h2 class="title">24.2. Configuring External Load Balancing</h2></div></div></div><p>
				An Overcloud uses multiple Controllers together as a high availability cluster, which ensures maximum operational performance for your OpenStack services. In addition, the cluster provides load balancing for access to the OpenStack services, which evenly distributes traffic to the Controller nodes and reduces server overload for each node. It is also possible to use an external load balancer to perform this distribution. For example, an organization might use their own hardware-based load balancer to handle traffic distribution to the Controller nodes.
			</p><p>
				For more information about configuring external load balancing, see the dedicated <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/external_load_balancing_for_the_overcloud">External Load Balancing for the Overcloud</a> guide for full instructions.
			</p></section><section class="section" id="sect-Configuring_IPv6_Networking"><div class="titlepage"><div><div><h2 class="title">24.3. Configuring IPv6 Networking</h2></div></div></div><p>
				As a default, the Overcloud uses Internet Protocol version 4 (IPv4) to configure the service endpoints. However, the Overcloud also supports Internet Protocol version 6 (IPv6) endpoints, which is useful for organizations that support IPv6 infrastructure. The director includes a set of environment files to help with creating IPv6-based Overclouds.
			</p><p>
				For more information about configuring IPv6 in the Overcloud, see the dedicated <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/ipv6_networking_for_the_overcloud">IPv6 Networking for the Overcloud</a> guide for full instructions.
			</p></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm140097851105392"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"><!--Empty--></span>© 2020 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></div>
  
  </div>
  </div>
</div>
<div id="comments-footer" class="book-comments">
  </div>
<meta itemscope="" itemref="md1">

    <!-- Display: Next/Previous Nav -->
          
      </div>
</article>


  

            </div>
        </main>
    </div>
    <!--googleoff: all-->
    <div id="to-top"><a class="btn_slideto" href="index.html#masthead" aria-label="Back to Top"><span class="web-icon-upload"></span></a></div>
    <footer class="footer-main">
        <div class="footer-top">
            <div class="container">

              <div class="brand">
                <a href="https://redhat.com">
                  <svg class="rh-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 613 145">
                    <defs>
                      <style>
                        .rh-logo-hat {
                          fill: #e00;
                        }
                        .rh-logo-type {
                          fill: #fff;
                        }
                      </style>
                    </defs>
                    <title>Red Hat</title>
                    <path
                      class="rh-logo-hat"
                      d="M127.47,83.49c12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89,8.69,103.76.5,97.51.5,91.69.5,90,8,83.06,8c-6.68,0-11.64-5.6-17.89-5.6-6,0-9.91,4.09-12.93,12.5,0,0-8.41,23.72-9.49,27.16A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33C22.27,52,.5,55,.5,74.22c0,31.48,74.59,70.28,133.65,70.28,45.28,0,56.7-20.48,56.7-36.65,0-12.72-11-27.16-30.83-35.78"/>
                      <path class="rh-logo-band"
                      d="M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33l3.66-9.06A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45,12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42Z"/>
                      <path
                      class="rh-logo-type"
                      d="M579.74,92.8c0,11.89,7.15,17.67,20.19,17.67a52.11,52.11,0,0,0,11.89-1.68V95a24.84,24.84,0,0,1-7.68,1.16c-5.37,0-7.36-1.68-7.36-6.73V68.3h15.56V54.1H596.78v-18l-17,3.68V54.1H568.49V68.3h11.25Zm-53,.32c0-3.68,3.69-5.47,9.26-5.47a43.12,43.12,0,0,1,10.1,1.26v7.15a21.51,21.51,0,0,1-10.63,2.63c-5.46,0-8.73-2.1-8.73-5.57m5.2,17.56c6,0,10.84-1.26,15.36-4.31v3.37h16.82V74.08c0-13.56-9.14-21-24.39-21-8.52,0-16.94,2-26,6.1l6.1,12.52c6.52-2.74,12-4.42,16.83-4.42,7,0,10.62,2.73,10.62,8.31v2.73a49.53,49.53,0,0,0-12.62-1.58c-14.31,0-22.93,6-22.93,16.73,0,9.78,7.78,17.24,20.19,17.24m-92.44-.94h18.09V80.92h30.29v28.82H506V36.12H487.93V64.41H457.64V36.12H439.55ZM370.62,81.87c0-8,6.31-14.1,14.62-14.1A17.22,17.22,0,0,1,397,72.09V91.54A16.36,16.36,0,0,1,385.24,96c-8.2,0-14.62-6.1-14.62-14.09m26.61,27.87h16.83V32.44l-17,3.68V57.05a28.3,28.3,0,0,0-14.2-3.68c-16.19,0-28.92,12.51-28.92,28.5a28.25,28.25,0,0,0,28.4,28.6,25.12,25.12,0,0,0,14.93-4.83ZM320,67c5.36,0,9.88,3.47,11.67,8.83H308.47C310.15,70.3,314.36,67,320,67M291.33,82c0,16.2,13.25,28.82,30.28,28.82,9.36,0,16.2-2.53,23.25-8.42l-11.26-10c-2.63,2.74-6.52,4.21-11.14,4.21a14.39,14.39,0,0,1-13.68-8.83h39.65V83.55c0-17.67-11.88-30.39-28.08-30.39a28.57,28.57,0,0,0-29,28.81M262,51.58c6,0,9.36,3.78,9.36,8.31S268,68.2,262,68.2H244.11V51.58Zm-36,58.16h18.09V82.92h13.77l13.89,26.82H292l-16.2-29.45a22.27,22.27,0,0,0,13.88-20.72c0-13.25-10.41-23.45-26-23.45H226Z"/>
                  </svg>
                </a>
              </div>

            <div role="navigation">
                <h3>Quick Links</h3>
                <ul>
                    <li><a class="download-software" href="https://access.redhat.com/downloads/">Downloads</a></li>
                    <li><a class="manage-subscriptions" href="https://access.redhat.com/management/subscriptions/#active">Subscriptions</a></li>
                    <li><a class="support-cases" href="https://access.redhat.com/support">Support Cases</a></li>
                    <li><a class="customer-service" href="https://access.redhat.com/support/customer-service">Customer Service</a></li>
                    <li><a class="quick-docs" href="https://access.redhat.com/documentation">Product Documentation</a></li>
                </ul>
            </div>

            <div role="navigation">
                <h3>Help</h3>
                <ul>
                    <li><a class="contact-us" href="https://access.redhat.com/support/contact/">Contact Us</a></li>
                    <li><a class="cp-faqs" href="https://access.redhat.com/articles/33844">Customer Portal FAQ</a></li>
                    <li><a class="login-problems" href="https://access.redhat.com/help/login_assistance">Log-in Assistance</a></li>
                </ul>
            </div>

            <div role="navigation">
                <h3>Site Info</h3>
                <ul>
                  <li><a class="trust-red-hat" href="https://www.redhat.com/en/trust">Trust Red Hat</a></li>
                  <li><a class="browser-support-policy" href="https://access.redhat.com/help/browsers/">Browser Support Policy</a></li>
                  <li><a class="accessibility" href="https://access.redhat.com/help/accessibility/">Accessibility</a></li>
                  <li><a class="recognition" href="https://access.redhat.com/recognition/">Awards and Recognition</a></li>
                  <li><a class="colophon" href="https://access.redhat.com/help/colophon/">Colophon</a></li>
                </ul>
            </div>

            <div role="navigation">
                <h3>Related Sites</h3>
                <ul>
                    <li><a href="https://www.redhat.com/" class="red-hat-com">redhat.com</a></li>
                    <li><a href="https://www.openshift.com" class="openshift-com">openshift.com</a></li>
                    <li><a href="http://developers.redhat.com/" class="red-hat-developers">developers.redhat.com</a></li>
                    <li><a href="https://connect.redhat.com/" class="partner-connect">connect.redhat.com</a></li>
                </ul>
            </div>

            <div role="navigation">
                <h3>About</h3>
                <ul>
                    <li><a href="https://access.redhat.com/subscription-value" class="subscription-value">Red Hat Subscription Value</a></li>
                    <li><a href="https://www.redhat.com/about/" class="about-red-hat">About Red Hat</a></li>
                    <li><a href="http://jobs.redhat.com" class="about-jobs">Red Hat Jobs</a></li>
                </ul>
            </div>

            </div>
        </div>

        <div class="anchor">
            <div class="container">
                <div class="status-legal">
                    <a hidden href="https://status.redhat.com" class="status-page-widget">
                          <span class="status-description"></span>
                          <span class="status-dot shape-circle"></span>
                    </a>
                    <div class="legal-copyright">
                        <div class="copyright">Copyright © 2020 Red Hat, Inc.</div>

                        <div role="navigation" class="legal">
                            <ul>
                                <li><a href="http://www.redhat.com/en/about/privacy-policy" class="privacy-policy">Privacy Statement</a></li>
                                <li><a href="https://access.redhat.com/help/terms/" class="terms-of-use">Customer Portal Terms of Use</a></li>
                                <li><a href="http://www.redhat.com/en/about/all-policies-guidelines" class="all-policies">All Policies and Guidelines</a></li>
                                <li><a id="teconsent"></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="social">
                    <a href="http://www.redhat.com/summit/" class="summit">
                      <img src="rh-summit-red-a.svg" alt="Red Hat Summit" />
                    </a>

                    <div class="social-media">
                        <a href="https://twitter.com/RedHatSupport" class="sm-icon twitter"><span class="nicon-twitter"></span><span class="offscreen">Twitter</span></a>
                        <a href="https://www.facebook.com/RedHatSupport" class="sm-icon facebook"><span class="nicon-facebook"></span><span class="offscreen">Facebook</span></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- TrustArc -->
    <div id="consent_blackbar"></div> 
    <!--googleon: all-->
</div>
  
  <div id="formatHelp" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="formatTitle" aria-hidden="true"><div class="modal-dialog"><div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="formatTitle">Formatting Tips</h3>
    </div>
    <div class="modal-body">
      <p>Here are the common uses of Markdown.</p><dl class="formatting-help">
        <dt class="codeblock">Code blocks</dt><dd class="codeblock"><pre><code>~~~
Code surrounded in tildes is easier to read
~~~</code></pre></dd>
        <dt class="urls">Links/URLs</dt><dd class="urls"><code>[Red Hat Customer Portal](https://access.redhat.com)</code></dd>
       </dl>
    </div>
    <div class="modal-footer">
      <a target="_blank" href="https://access.redhat.com/help/markdown" class="btn btn-primary">Learn more</a>
      <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
  </div></div></div></body>
</html>
